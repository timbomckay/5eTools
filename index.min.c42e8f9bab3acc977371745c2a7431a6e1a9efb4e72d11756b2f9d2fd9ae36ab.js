(()=>{var pv=Object.create,d_=Object.defineProperty,lC=Object.getOwnPropertyDescriptor,lz=Object.getOwnPropertyNames,rc=Object.getPrototypeOf,rH=Object.prototype.hasOwnProperty,rI=a=>d_(a,"__esModule",{value:!0}),lw=(b,a)=>function(){return a||(0,b[lz(b)[0]])((a={exports:{}}).exports,a),a.exports},rL=(b,a,d,c)=>{if(a&&typeof a=="object"||typeof a=="function")for(let e of lz(a))!rH.call(b,e)&&(d||e!=="default")&&d_(b,e,{get:()=>a[e],enumerable:!(c=lC(a,e))||c.enumerable});return b},rM=(a,b)=>rL(rI(d_(a!=null?pv(rc(a)):{},"default",!b&&a&&a.__esModule?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a),M=(g,b,e,c)=>{for(var a=c>1?void 0:c?lC(b,e):b,f=g.length-1,d;f>=0;f--)(d=g[f])&&(a=(c?d(b,e,a):d(a))||a);return c&&a&&d_(b,e,a),a},sU=lw({"node_modules/tailwindcss/colors.js"(c,b){var a=!1;b.exports={black:"#000",white:"#fff",rose:{50:"#fff1f2",100:"#ffe4e6",200:"#fecdd3",300:"#fda4af",400:"#fb7185",500:"#f43f5e",600:"#e11d48",700:"#be123c",800:"#9f1239",900:"#881337"},pink:{50:"#fdf2f8",100:"#fce7f3",200:"#fbcfe8",300:"#f9a8d4",400:"#f472b6",500:"#ec4899",600:"#db2777",700:"#be185d",800:"#9d174d",900:"#831843"},fuchsia:{50:"#fdf4ff",100:"#fae8ff",200:"#f5d0fe",300:"#f0abfc",400:"#e879f9",500:"#d946ef",600:"#c026d3",700:"#a21caf",800:"#86198f",900:"#701a75"},purple:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7e22ce",800:"#6b21a8",900:"#581c87"},violet:{50:"#f5f3ff",100:"#ede9fe",200:"#ddd6fe",300:"#c4b5fd",400:"#a78bfa",500:"#8b5cf6",600:"#7c3aed",700:"#6d28d9",800:"#5b21b6",900:"#4c1d95"},indigo:{50:"#eef2ff",100:"#e0e7ff",200:"#c7d2fe",300:"#a5b4fc",400:"#818cf8",500:"#6366f1",600:"#4f46e5",700:"#4338ca",800:"#3730a3",900:"#312e81"},blue:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a"},get lightBlue(){return a||(console.log("warn - As of Tailwind CSS v2.2, `lightBlue` has been renamed to `sky`."),console.log("warn - Please update your color palette to eliminate this warning."),a=!0),{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e"}},sky:{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e"},cyan:{50:"#ecfeff",100:"#cffafe",200:"#a5f3fc",300:"#67e8f9",400:"#22d3ee",500:"#06b6d4",600:"#0891b2",700:"#0e7490",800:"#155e75",900:"#164e63"},teal:{50:"#f0fdfa",100:"#ccfbf1",200:"#99f6e4",300:"#5eead4",400:"#2dd4bf",500:"#14b8a6",600:"#0d9488",700:"#0f766e",800:"#115e59",900:"#134e4a"},emerald:{50:"#ecfdf5",100:"#d1fae5",200:"#a7f3d0",300:"#6ee7b7",400:"#34d399",500:"#10b981",600:"#059669",700:"#047857",800:"#065f46",900:"#064e3b"},green:{50:"#f0fdf4",100:"#dcfce7",200:"#bbf7d0",300:"#86efac",400:"#4ade80",500:"#22c55e",600:"#16a34a",700:"#15803d",800:"#166534",900:"#14532d"},lime:{50:"#f7fee7",100:"#ecfccb",200:"#d9f99d",300:"#bef264",400:"#a3e635",500:"#84cc16",600:"#65a30d",700:"#4d7c0f",800:"#3f6212",900:"#365314"},yellow:{50:"#fefce8",100:"#fef9c3",200:"#fef08a",300:"#fde047",400:"#facc15",500:"#eab308",600:"#ca8a04",700:"#a16207",800:"#854d0e",900:"#713f12"},amber:{50:"#fffbeb",100:"#fef3c7",200:"#fde68a",300:"#fcd34d",400:"#fbbf24",500:"#f59e0b",600:"#d97706",700:"#b45309",800:"#92400e",900:"#78350f"},orange:{50:"#fff7ed",100:"#ffedd5",200:"#fed7aa",300:"#fdba74",400:"#fb923c",500:"#f97316",600:"#ea580c",700:"#c2410c",800:"#9a3412",900:"#7c2d12"},red:{50:"#fef2f2",100:"#fee2e2",200:"#fecaca",300:"#fca5a5",400:"#f87171",500:"#ef4444",600:"#dc2626",700:"#b91c1c",800:"#991b1b",900:"#7f1d1d"},warmGray:{50:"#fafaf9",100:"#f5f5f4",200:"#e7e5e4",300:"#d6d3d1",400:"#a8a29e",500:"#78716c",600:"#57534e",700:"#44403c",800:"#292524",900:"#1c1917"},trueGray:{50:"#fafafa",100:"#f5f5f5",200:"#e5e5e5",300:"#d4d4d4",400:"#a3a3a3",500:"#737373",600:"#525252",700:"#404040",800:"#262626",900:"#171717"},gray:{50:"#fafafa",100:"#f4f4f5",200:"#e4e4e7",300:"#d4d4d8",400:"#a1a1aa",500:"#71717a",600:"#52525b",700:"#3f3f46",800:"#27272a",900:"#18181b"},coolGray:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"},blueGray:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"}}}}),t_=lw({"ns-hugo:/home/runner/work/5eTools/5eTools/assets/colors.js"(c,a){var b=sU();a.exports={...b,primary:{50:"#faf3f3",100:"#f5e7e7",200:"#e7c2c3",300:"#d89d9f",400:"#ba5456",500:"#9d0a0e",600:"#8d090d",700:"#76080b",800:"#5e0608",900:"#4d0507"}}}}),lr=function(c){const a=[];let b=0;for(let e=0;e<c.length;e++){let d=c.charCodeAt(e);d<128?a[b++]=d:d<2048?(a[b++]=d>>6|192,a[b++]=d&63|128):(d&64512)===55296&&e+1<c.length&&(c.charCodeAt(e+1)&64512)===56320?(d=65536+((d&1023)<<10)+(c.charCodeAt(++e)&1023),a[b++]=d>>18|240,a[b++]=d>>12&63|128,a[b++]=d>>6&63|128,a[b++]=d&63|128):(a[b++]=d>>12|224,a[b++]=d>>6&63|128,a[b++]=d&63|128)}return a},tZ=function(a){const c=[];let b=0,d=0;while(b<a.length){const e=a[b++];if(e<128)c[d++]=String.fromCharCode(e);else if(e>191&&e<224){const f=a[b++];c[d++]=String.fromCharCode((e&31)<<6|f&63)}else if(e>239&&e<365){const g=a[b++],h=a[b++],i=a[b++],f=((e&7)<<18|(g&63)<<12|(h&63)<<6|i&63)-65536;c[d++]=String.fromCharCode(55296+(f>>10)),c[d++]=String.fromCharCode(56320+(f&1023))}else{const f=a[b++],g=a[b++];c[d++]=String.fromCharCode((e&15)<<12|(f&63)<<6|g&63)}}return c.join("")},tV={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(a,d){if(!Array.isArray(a))throw Error("encodeByteArray takes an array as a parameter");this.init_();const b=d?this.byteToCharMapWebSafe_:this.byteToCharMap_,c=[];for(let d=0;d<a.length;d+=3){const e=a[d],f=d+1<a.length,g=f?a[d+1]:0,h=d+2<a.length,i=h?a[d+2]:0,l=e>>2,m=(e&3)<<4|g>>4;let j=(g&15)<<2|i>>6,k=i&63;h||(k=64,f||(j=64)),c.push(b[l],b[m],b[j],b[k])}return c.join("")},encodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?btoa(a):this.encodeByteArray(lr(a),b)},decodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?atob(a):tZ(this.decodeStringToByteArray(a,b))},decodeStringToByteArray(a,d){this.init_();const b=d?this.charToByteMapWebSafe_:this.charToByteMap_,c=[];for(let d=0;d<a.length;){const h=b[a.charAt(d++)],i=d<a.length,g=i?b[a.charAt(d)]:0;++d;const j=d<a.length,e=j?b[a.charAt(d)]:64;++d;const k=d<a.length,f=k?b[a.charAt(d)]:64;if(++d,h==null||g==null||e==null||f==null)throw Error();const l=h<<2|g>>4;if(c.push(l),e!==64){const a=g<<4&240|e>>2;if(c.push(a),f!==64){const a=e<<6&192|f;c.push(a)}}}return c},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let a=0;a<this.ENCODED_VALS.length;a++)this.byteToCharMap_[a]=this.ENCODED_VALS.charAt(a),this.charToByteMap_[this.byteToCharMap_[a]]=a,this.byteToCharMapWebSafe_[a]=this.ENCODED_VALS_WEBSAFE.charAt(a),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[a]]=a,a>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(a)]=a,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(a)]=a)}}},tU=function(a){const b=lr(a);return tV.encodeByteArray(b,!0)},lk=function(a){return tU(a).replace(/\./g,"")},tT=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}wrapCallback(a){return(b,c)=>{b?this.reject(b):this.resolve(c),typeof a=="function"&&(this.promise.catch(()=>{}),a.length===1?a(b):a(b,c))}}},ti,ex,kK,sY,uj,cB,aF,sT,sQ,sP,n,sG,sE,sB,sA,j$,sz,jT,jS,jC,eJ,jx,eM,eN,eQ,eS,sn,sh,eY,sd,fu,iN,e$,rV,rU,rT,rR,rQ,rP,rD,rA,rz,ry,rx,rw,ro,rn,rj,ri,rf,rd,rb,ra,q$,qZ,qY,qX,qW,h$,qV,da,fr,qN,aH,qL,qK,qF,qE,bI,fs,qB,qA,qz,qx,qv,qu,qs,aj,f,fA,i,fH,qq,qm,ql,hj,hi,hf,P,fN,fP,gY,qi,bp,gS,fU,gP,qh,cJ,cI,cH,dU,qg,fY,fZ,qe,qc,qb,cD,qa,ge,gh,fR,fI,t$,hu,pV,fp,fk,is,pO,iC,aR,jB,dN,kH,cp,ep,pz,ei,d$,lE,jU,pj,ph,pg,pf,pa,o$,ff,oU,ij,oT,oS,oJ,oG,gb,oF,oD,gr,oC,cV,oA,gm,R,bu,aW,b,e,ab,ov,ou,os,or,oq,op,oo,X,oj,A,h,cM,q,oa,J,n$,D,n_,nZ,aL,d,ak,cQ,$,v,hD,nR,fw,_,G,cT,L,s,iO,nO,K,nM,nK,nF,nE,nB,nA,nz,be,bU,bV,dn,cg,bi,bk,ch,ng,ne,aJ,dz,dB,dE,ji,jj,m_,w,m,am,mX,mW,mP,mO,mK,eK,dF,dH,jD,jE,jF,mJ,mE,mC,mB,kt,ml,mi,mh,mc,mb,ma,l$,l_,lY,lX,lW,lV,lU,lT,lS,kL,lR,kN,lQ,kP,kQ,a,ev,al,lP,cn,lO,kZ,k$,en,lc,ej,aZ,lf,lM,lu,a_,lJ,lI,lG,cy,bd,tf,lH,ee,dZ,lK,kU,V,kJ,bz,lZ,md,me,mf,mg,kx,mj,mk,mq,eC,kf,mx,jZ,jO,mA,mM,mN,eL,y,mQ,mR,mS,mT,mU,mV,js,jq,jn,mZ,jk,m$,na,nb,iW,iV,nh,ni,nj,nk,nl,hS,bG,hG,bQ,nT,nU,gV,gT,gR,ob,oc,od,oe,go,oB,gq,gs,oE,ho,ia,ii,ah,dv,cF,oY,dx,jm,cq,jG,eH,pi,jW,pl,ps,k_,pw,cE,ld,dD,pB,pE,pG,pL,jp,pR,fo,dh,pU,fv,fC,hp,gI,bJ,br,p$,gu,ga,gw,qd,gx,fX,gK,fV,bo,fT,bg,hk,at,hl,qo,ba,bO,bM,hv,qt,cw,hy,hB,aS,hF,hK,hM,hN,o,ui,aQ,p,hV,qH,bj,qJ,cU,qM,cW,cX,qP,qQ,qR,qS,qT,hW,fq,fn,aw,ig,df,q_,fm,uh,Y,re,rh,H,W,rm,bF,rp,ip,iq,ir,iw,rB,rC,oX,rE,rF,rG,ug,uf,rJ,rK,ue,ud,uc,rO,fg,g$,iz,rS,dq,iZ,si,eV,dC,ss,je,eP,jr,jM,jP,j_,kb,sM,sN,sW,s$,ta,tb,tg,th,kR,tj,tk,kT,ck,to,tp,tz,kX,kY,tF,le,tL,tM,tN,lg,li,tQ,tR,tS,lj,ll,bA,tW,tX,tY,eg,lv,pW,dX,rN,dY,cm,aY,qD,bZ;function az(){return typeof navigator!="undefined"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function tP(){return typeof window!="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(az())}function tO(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(a){return!1}}function tK(){const a=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof a=="object"&&a.id!==void 0}function tD(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function tB(){return az().indexOf("Electron/")>=0}function tA(){const a=az();return a.indexOf("MSIE ")>=0||a.indexOf("Trident/")>=0}function tx(){return az().indexOf("MSAppHost/")>=0}function tn(){return!tO()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function kV(){return typeof indexedDB=="object"}function tl(){return new Promise((b,a)=>{try{let d=!0;const e="validate-browser-context-for-indexeddb-analytics-module",c=self.indexedDB.open(e);c.onsuccess=()=>{c.result.close(),d||self.indexedDB.deleteDatabase(e),b(!0)},c.onupgradeneeded=()=>{d=!1},c.onerror=()=>{var b;a(((b=c.error)===null||b===void 0?void 0:b.message)||"")}}catch(b){a(b)}})}ti="FirebaseError",ex=class extends Error{constructor(a,b,c){super(b),this.code=a,this.customData=c,this.name=ti,Object.setPrototypeOf(this,ex.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,kK.prototype.create)}},kK=class{constructor(a,b,c){this.service=a,this.serviceName=b,this.errors=c}create(a,...e){const b=e[0]||{},c=`${this.service}/${a}`,d=this.errors[a],f=d?sZ(d,b):"Error",g=`${this.serviceName}: ${f} (${c}).`,h=new ex(c,g,b);return h}};function sZ(a,b){return a.replace(sY,(d,a)=>{const c=b[a];return c!=null?String(c):`<${a}?>`})}sY=/\{\$([^}]+)}/g;function ez(a,b){if(a===b)return!0;const c=Object.keys(a),d=Object.keys(b);for(const e of c){if(!d.includes(e))return!1;const f=a[e],g=b[e];if(kD(f)&&kD(g)){if(!ez(f,g))return!1}else if(f!==g)return!1}for(const a of d)if(!c.includes(a))return!1;return!0}function kD(a){return a!==null&&typeof a=="object"}uj=4*60*60*1e3;function dO(a){return a&&a._delegate?a._delegate:a}cB=class{constructor(a,b,c){this.name=a,this.instanceFactory=b,this.type=c,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(a){return this.instantiationMode=a,this}setMultipleInstances(a){return this.multipleInstances=a,this}setServiceProps(a){return this.serviceProps=a,this}setInstanceCreatedCallback(a){return this.onInstanceCreated=a,this}},aF="[DEFAULT]",sT=class{constructor(a,b){this.name=a,this.container=b,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(b){const a=this.normalizeInstanceIdentifier(b);if(!this.instancesDeferred.has(a)){const b=new tT;if(this.instancesDeferred.set(a,b),this.isInitialized(a)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:a});c&&b.resolve(c)}catch(a){}}return this.instancesDeferred.get(a).promise}getImmediate(a){var b;const c=this.normalizeInstanceIdentifier(a===null||a===void 0?void 0:a.identifier),d=!!((b=a===null||a===void 0?void 0:a.optional)!==null&&b!==void 0)&&b;if(this.isInitialized(c)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:c})}catch(a){if(d)return null;throw a}else{if(d)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(a){if(a.name!==this.name)throw Error(`Mismatching Component ${a.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=a,!this.shouldAutoInitialize())return;if(sR(a))try{this.getOrInitializeService({instanceIdentifier:aF})}catch(a){}for(const[a,b]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(a);try{const a=this.getOrInitializeService({instanceIdentifier:c});b.resolve(a)}catch(a){}}}clearInstance(a=aF){this.instancesDeferred.delete(a),this.instancesOptions.delete(a),this.instances.delete(a)}async delete(){const a=Array.from(this.instances.values());await Promise.all([...a.filter(a=>"INTERNAL"in a).map(a=>a.INTERNAL.delete()),...a.filter(a=>"_delete"in a).map(a=>a._delete())])}isComponentSet(){return this.component!=null}isInitialized(a=aF){return this.instances.has(a)}getOptions(a=aF){return this.instancesOptions.get(a)||{}}initialize(b={}){const{options:d={}}=b,a=this.normalizeInstanceIdentifier(b.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:a,options:d});for(const[b,d]of this.instancesDeferred.entries()){const e=this.normalizeInstanceIdentifier(b);a===e&&d.resolve(c)}return c}onInit(b,f){var c;const a=this.normalizeInstanceIdentifier(f),d=(c=this.onInitCallbacks.get(a))!==null&&c!==void 0?c:new Set;d.add(b),this.onInitCallbacks.set(a,d);const e=this.instances.get(a);return e&&b(e,a),()=>{d.delete(b)}}invokeOnInitCallbacks(c,a){const b=this.onInitCallbacks.get(a);if(!b)return;for(const d of b)try{d(c,a)}catch(a){}}getOrInitializeService({instanceIdentifier:a,options:c={}}){let b=this.instances.get(a);if(!b&&this.component)if(b=this.component.instanceFactory(this.container,{instanceIdentifier:sS(a),options:c}),this.instances.set(a,b),this.instancesOptions.set(a,c),this.invokeOnInitCallbacks(b,a),this.component.onInstanceCreated)try{this.component.onInstanceCreated(this.container,a,b)}catch(a){}return b||null}normalizeInstanceIdentifier(a=aF){return this.component?this.component.multipleInstances?a:aF:a}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function sS(a){return a===aF?void 0:a}function sR(a){return a.instantiationMode==="EAGER"}sQ=class{constructor(a){this.name=a,this.providers=new Map}addComponent(a){const b=this.getProvider(a.name);if(b.isComponentSet())throw new Error(`Component ${a.name} has already been registered with ${this.name}`);b.setComponent(a)}addOrOverwriteComponent(a){const b=this.getProvider(a.name);b.isComponentSet()&&this.providers.delete(a.name),this.addComponent(a)}getProvider(a){if(this.providers.has(a))return this.providers.get(a);const b=new sT(a,this);return this.providers.set(a,b),b}getProviders(){return Array.from(this.providers.values())}},sP=[],function(a){a[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT"}(n||(n={})),sG={debug:n.DEBUG,verbose:n.VERBOSE,info:n.INFO,warn:n.WARN,error:n.ERROR,silent:n.SILENT},sE=n.INFO,sB={[n.DEBUG]:"log",[n.VERBOSE]:"log",[n.INFO]:"info",[n.WARN]:"warn",[n.ERROR]:"error"},sA=(b,a,...d)=>{if(a<b.logLevel)return;const e=(new Date).toISOString(),c=sB[a];if(c)console[c](`[${e}]  ${b.name}:`,...d);else throw new Error(`Attempted to log a message with an invalid logType (value: ${a})`)},j$=class{constructor(a){this.name=a,this._logLevel=sE,this._logHandler=sA,this._userLogHandler=null,sP.push(this)}get logLevel(){return this._logLevel}set logLevel(a){if(!(a in n))throw new TypeError(`Invalid value "${a}" assigned to \`logLevel\``);this._logLevel=a}setLogLevel(a){this._logLevel=typeof a=="string"?sG[a]:a}get logHandler(){return this._logHandler}set logHandler(a){if(typeof a!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=a}get userLogHandler(){return this._userLogHandler}set userLogHandler(a){this._userLogHandler=a}debug(...a){this._userLogHandler&&this._userLogHandler(this,n.DEBUG,...a),this._logHandler(this,n.DEBUG,...a)}log(...a){this._userLogHandler&&this._userLogHandler(this,n.VERBOSE,...a),this._logHandler(this,n.VERBOSE,...a)}info(...a){this._userLogHandler&&this._userLogHandler(this,n.INFO,...a),this._logHandler(this,n.INFO,...a)}warn(...a){this._userLogHandler&&this._userLogHandler(this,n.WARN,...a),this._logHandler(this,n.WARN,...a)}error(...a){this._userLogHandler&&this._userLogHandler(this,n.ERROR,...a),this._logHandler(this,n.ERROR,...a)}},sz=(a,b)=>b.some(b=>a instanceof b);function sy(){return jT||(jT=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function sx(){return jS||(jS=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}jC=new WeakMap,eJ=new WeakMap,jx=new WeakMap,eM=new WeakMap,eN=new WeakMap;function sw(a){const b=new Promise((e,f)=>{const b=()=>{a.removeEventListener("success",c),a.removeEventListener("error",d)},c=()=>{e(ao(a.result)),b()},d=()=>{f(a.error),b()};a.addEventListener("success",c),a.addEventListener("error",d)});return b.then(b=>{b instanceof IDBCursor&&jC.set(b,a)}).catch(()=>{}),eN.set(b,a),b}function sv(a){if(eJ.has(a))return;const b=new Promise((e,f)=>{const c=()=>{a.removeEventListener("complete",d),a.removeEventListener("error",b),a.removeEventListener("abort",b)},d=()=>{e(),c()},b=()=>{f(a.error||new DOMException("AbortError","AbortError")),c()};a.addEventListener("complete",d),a.addEventListener("error",b),a.addEventListener("abort",b)});eJ.set(a,b)}eQ={get(a,b,c){if(a instanceof IDBTransaction){if(b==="done")return eJ.get(a);if(b==="objectStoreNames")return a.objectStoreNames||jx.get(a);if(b==="store")return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return ao(a[b])},set(a,b,c){return a[b]=c,!0},has(b,a){return!!(b instanceof IDBTransaction&&(a==="done"||a==="store"))||a in b}};function su(a){eQ=a(eQ)}function st(a){return a===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(b,...d){const c=a.call(eS(this),b,...d);return jx.set(c,b.sort?b.sort():[b]),ao(c)}:sx().includes(a)?function(...b){return a.apply(eS(this),b),ao(jC.get(this))}:function(...b){return ao(a.apply(eS(this),b))}}function sr(a){return typeof a=="function"?st(a):(a instanceof IDBTransaction&&sv(a),sz(a,sy()))?new Proxy(a,eQ):a}function ao(a){if(a instanceof IDBRequest)return sw(a);if(eM.has(a))return eM.get(a);const b=sr(a);return b!==a&&(eM.set(a,b),eN.set(b,a)),b}eS=a=>eN.get(a);function sq(g,h,{blocked:c,upgrade:d,blocking:e,terminated:f}={}){const a=indexedDB.open(g,h),b=ao(a);return d&&a.addEventListener("upgradeneeded",b=>{d(ao(a.result),b.oldVersion,b.newVersion,ao(a.transaction))}),c&&a.addEventListener("blocked",()=>c()),b.then(a=>{f&&a.addEventListener("close",()=>f()),e&&a.addEventListener("versionchange",()=>e())}).catch(()=>{}),b}sn=["get","getKey","getAll","getAllKeys","count"],sh=["put","add","delete","clear"],eY=new Map;function iX(d,a){if(!(d instanceof IDBDatabase&&!(a in d)&&typeof a=="string"))return;if(eY.get(a))return eY.get(a);const b=a.replace(/FromIndex$/,""),e=a!==b,c=sh.includes(b);if(!(b in(e?IDBIndex:IDBObjectStore).prototype)||!(c||sn.includes(b)))return;const f=async function(g,...d){const f=this.transaction(g,c?"readwrite":"readonly");let a=f.store;return e&&(a=a.index(d.shift())),(await Promise.all([a[b](...d),c&&f.done]))[0]};return eY.set(a,f),f}su(a=>({...a,get:(b,c,d)=>iX(b,c)||a.get(b,c,d),has:(b,c)=>!!iX(b,c)||a.has(b,c)})),sd=class{constructor(a){this.container=a}getPlatformInfoString(){const a=this.container.getProviders();return a.map(a=>{if(rZ(a)){const b=a.getImmediate();return`${b.library}/${b.version}`}return null}).filter(a=>a).join(" ")}};function rZ(b){const a=b.getComponent();return(a===null||a===void 0?void 0:a.type)==="VERSION"}fu="@firebase/app",iN="0.7.24",e$=new j$("@firebase/app"),rV="@firebase/app-compat",rU="@firebase/analytics-compat",rT="@firebase/analytics",rR="@firebase/app-check-compat",rQ="@firebase/app-check",rP="@firebase/auth",rD="@firebase/auth-compat",rA="@firebase/database",rz="@firebase/database-compat",ry="@firebase/functions",rx="@firebase/functions-compat",rw="@firebase/installations",ro="@firebase/installations-compat",rn="@firebase/messaging",rj="@firebase/messaging-compat",ri="@firebase/performance",rf="@firebase/performance-compat",rd="@firebase/remote-config",rb="@firebase/remote-config-compat",ra="@firebase/storage",q$="@firebase/storage-compat",qZ="@firebase/firestore",qY="@firebase/firestore-compat",qX="firebase",qW="9.8.1",h$="[DEFAULT]",qV={[fu]:"fire-core",[rV]:"fire-core-compat",[rT]:"fire-analytics",[rU]:"fire-analytics-compat",[rQ]:"fire-app-check",[rR]:"fire-app-check-compat",[rP]:"fire-auth",[rD]:"fire-auth-compat",[rA]:"fire-rtdb",[rz]:"fire-rtdb-compat",[ry]:"fire-fn",[rx]:"fire-fn-compat",[rw]:"fire-iid",[ro]:"fire-iid-compat",[rn]:"fire-fcm",[rj]:"fire-fcm-compat",[ri]:"fire-perf",[rf]:"fire-perf-compat",[rd]:"fire-rc",[rb]:"fire-rc-compat",[ra]:"fire-gcs",[q$]:"fire-gcs-compat",[qZ]:"fire-fst",[qY]:"fire-fst-compat","fire-js":"fire-js",[qX]:"fire-js-all"},da=new Map,fr=new Map;function qU(a,b){try{a.container.addComponent(b)}catch(c){e$.debug(`Component ${b.name} failed to register with FirebaseApp ${a.name}`,c)}}function cZ(a){const b=a.name;if(fr.has(b))return e$.debug(`There were multiple attempts to register component ${b}.`),!1;fr.set(b,a);for(const b of da.values())qU(b,a);return!0}function qO(a,c){const b=a.container.getProvider("heartbeat").getImmediate({optional:!0});return b&&void b.triggerHeartbeat(),a.container.getProvider(c)}qN={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["storage-open"]:"Error thrown when opening storage. Original error: {$originalErrorMessage}.",["storage-get"]:"Error thrown when reading from storage. Original error: {$originalErrorMessage}.",["storage-set"]:"Error thrown when writing to storage. Original error: {$originalErrorMessage}.",["storage-delete"]:"Error thrown when deleting from storage. Original error: {$originalErrorMessage}."},aH=new kK("app","Firebase",qN),qL=class{constructor(b,a,c){this._isDeleted=!1,this._options=Object.assign({},b),this._config=Object.assign({},a),this._name=a.name,this._automaticDataCollectionEnabled=a.automaticDataCollectionEnabled,this._container=c,this.container.addComponent(new cB("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(a){this.checkDestroyed(),this._automaticDataCollectionEnabled=a}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(a){this._isDeleted=a}checkDestroyed(){if(this.isDeleted)throw aH.create("app-deleted",{appName:this._name})}},qK=qW;function qI(e,b={}){if(typeof b!="object"){const a=b;b={name:a}}const d=Object.assign({name:h$,automaticDataCollectionEnabled:!1},b),a=d.name;if(typeof a!="string"||!a)throw aH.create("bad-app-name",{appName:String(a)});const c=da.get(a);if(c){if(ez(e,c.options)&&ez(d,c.config))return c;throw aH.create("duplicate-app",{appName:a})}const f=new sQ(a);for(const a of fr.values())f.addComponent(a);const g=new qL(e,d,f);return da.set(a,g),g}function qG(a=h$){const b=da.get(a);if(!b)throw aH.create("no-app",{appName:a});return b}function bl(g,b,f){var d;let a=(d=qV[g])!==null&&d!==void 0?d:g;f&&(a+=`-${f}`);const e=a.match(/\s|\//),c=b.match(/\s|\//);if(e||c){const d=[`Unable to register library "${a}" with version "${b}":`];e&&d.push(`library name "${a}" contains illegal characters (whitespace or "/")`),e&&c&&d.push("and"),c&&d.push(`version name "${b}" contains illegal characters (whitespace or "/")`),e$.warn(d.join(" "));return}cZ(new cB(`${a}-version`,()=>({library:a,version:b}),"VERSION"))}qF="firebase-heartbeat-database",qE=1,bI="firebase-heartbeat-store",fs=null;function hR(){return fs||(fs=sq(qF,qE,{upgrade:(a,b)=>{switch(b){case 0:a.createObjectStore(bI)}}}).catch(a=>{throw aH.create("storage-open",{originalErrorMessage:a.message})})),fs}async function qC(a){try{const b=await hR();return b.transaction(bI).objectStore(bI).get(hO(a))}catch(a){throw aH.create("storage-get",{originalErrorMessage:a.message})}}async function hP(a,b){try{const d=await hR(),c=d.transaction(bI,"readwrite"),e=c.objectStore(bI);return await e.put(b,hO(a)),c.done}catch(a){throw aH.create("storage-set",{originalErrorMessage:a.message})}}function hO(a){return`${a.name}!${a.options.appId}`}qB=1024,qA=30*24*60*60*1e3,qz=class{constructor(a){this.container=a,this._heartbeatsCache=null;const b=this.container.getProvider("app").getImmediate();this._storage=new qx(b),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){const b=this.container.getProvider("platform-logger").getImmediate(),c=b.getPlatformInfoString(),a=hI();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(b=>b.date===a))return;return this._heartbeatsCache.heartbeats.push({date:a,agent:c}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const b=new Date(a.date).valueOf(),c=Date.now();return c-b<=qA}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const b=hI(),{heartbeatsToSend:c,unsentEntries:a}=qy(this._heartbeatsCache.heartbeats),d=lk(JSON.stringify({version:2,heartbeats:c}));return this._heartbeatsCache.lastSentHeartbeatDate=b,a.length>0?(this._heartbeatsCache.heartbeats=a,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],void this._storage.overwrite(this._heartbeatsCache)),d}};function hI(){const a=new Date;return a.toISOString().substring(0,10)}function qy(c,d=qB){const a=[];let b=c.slice();for(const e of c){const f=a.find(a=>a.agent===e.agent);if(f){if(f.dates.push(e.date),hC(a)>d){f.dates.pop();break}}else if(a.push({agent:e.agent,dates:[e.date]}),hC(a)>d){a.pop();break}b=b.slice(1)}return{heartbeatsToSend:a,unsentEntries:b}}qx=class{constructor(a){this.app=a,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!kV()&&tl().then(()=>!0).catch(()=>!1)}async read(){const a=await this._canUseIndexedDBPromise;if(!a)return{heartbeats:[]};const b=await qC(this.app);return b||{heartbeats:[]}}async overwrite(b){var a;const c=await this._canUseIndexedDBPromise;if(!c)return;const d=await this.read();return hP(this.app,{lastSentHeartbeatDate:(a=b.lastSentHeartbeatDate)!==null&&a!==void 0?a:d.lastSentHeartbeatDate,heartbeats:b.heartbeats})}async add(b){var a;const d=await this._canUseIndexedDBPromise;if(!d)return;const c=await this.read();return hP(this.app,{lastSentHeartbeatDate:(a=b.lastSentHeartbeatDate)!==null&&a!==void 0?a:c.lastSentHeartbeatDate,heartbeats:[...c.heartbeats,...b.heartbeats]})}};function hC(a){return lk(JSON.stringify({version:2,heartbeats:a})).length}function qw(a){cZ(new cB("platform-logger",a=>new sd(a),"PRIVATE")),cZ(new cB("heartbeat",a=>new qz(a),"PRIVATE")),bl(fu,iN,a),bl(fu,iN,"esm2017"),bl("fire-js","")}qw(""),qv="firebase",qu="9.8.1",bl(qv,qu,"app"),qs=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},aj={},fA=fA||{},i=qs||self;function cS(){}function fF(b){var a=typeof b;return a=a!="object"?a:b?Array.isArray(b)?"array":a:"null",a=="array"||a=="object"&&typeof b.length=="number"}function bL(a){var b=typeof a;return b=="object"&&a!=null||b=="function"}function qr(a){return Object.prototype.hasOwnProperty.call(a,fH)&&a[fH]||(a[fH]=++qq)}fH="closure_uid_"+(1e9*Math.random()>>>0),qq=0;function qp(a,b,c){return a.call.apply(a.bind,arguments)}function qn(a,b,d){if(!a)throw Error();if(2<arguments.length){var c=Array.prototype.slice.call(arguments,2);return function(){var d=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(d,c),a.apply(b,d)}}return function(){return a.apply(b,arguments)}}function F(a,b,c){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?F=qp:F=qn,F.apply(null,arguments)}function cR(a,c){var b=Array.prototype.slice.call(arguments,1);return function(){var c=b.slice();return c.push.apply(c,arguments),a.apply(this,c)}}function E(a,b){function c(){}c.prototype=b.prototype,a.Z=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.Vb=function(d,e,f){for(var c=Array(arguments.length-2),a=2;a<arguments.length;a++)c[a-2]=arguments[a];return b.prototype[e].apply(d,c)}}function ar(){this.s=this.s,this.o=this.o}qm=0,ql={},ar.prototype.s=!1,ar.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),qm!=0)){var a=qr(this);delete ql[a]}},ar.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()},hj=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if(typeof a=="string")return typeof b!="string"||b.length!=1?-1:a.indexOf(b,0);for(let c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},hi=Array.prototype.forEach?function(a,b,c){Array.prototype.forEach.call(a,b,c)}:function(a,c,d){const e=a.length,b=typeof a=="string"?a.split(""):a;for(let f=0;f<e;f++)f in b&&c.call(d,b[f],f,a)};function qk(a){a:{var b=oQ;const d=a.length,c=typeof a=="string"?a.split(""):a;for(let e=0;e<d;e++)if(e in c&&b.call(void 0,c[e],e,a)){b=e;break a}b=-1}return 0>b?null:typeof a=="string"?a.charAt(b):a[b]}function hh(a){return Array.prototype.concat.apply([],arguments)}function fJ(b){const a=b.length;if(0<a){const c=Array(a);for(let d=0;d<a;d++)c[d]=b[d];return c}return[]}function cP(a){return/^[\s\xa0]*$/.test(a)}hf=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};function Q(a,b){return a.indexOf(b)!=-1}function fK(a,b){return a<b?-1:a>b?1:0}a:{fN=i.navigator;if(fN){fP=fN.userAgent;if(fP){P=fP;break a}}P=""}function ey(a,b,c){for(const d in a)b.call(c,a[d],d,a)}function gZ(a){const b={};for(const c in a)b[c]=a[c];return b}gY="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function gX(c,d){let a,b;for(let d=1;d<arguments.length;d++){b=arguments[d];for(a in b)c[a]=b[a];for(let d=0;d<gY.length;d++)a=gY[d],Object.prototype.hasOwnProperty.call(b,a)&&(c[a]=b[a])}}function fS(a){return fS[" "](a),a}fS[" "]=cS;function qj(b){var a=qg;return Object.prototype.hasOwnProperty.call(a,9)?a[9]:a[9]=b(9)}qi=Q(P,"Opera"),bp=Q(P,"Trident")||Q(P,"MSIE"),gS=Q(P,"Edge"),fU=gS||bp,gP=Q(P,"Gecko")&&!(Q(P.toLowerCase(),"webkit")&&!Q(P,"Edge"))&&!(Q(P,"Trident")||Q(P,"MSIE"))&&!Q(P,"Edge"),qh=Q(P.toLowerCase(),"webkit")&&!Q(P,"Edge");function gL(){var a=i.document;return a?a.documentMode:void 0}a:{cI="",cH=function(){var a=P;if(gP)return/rv:([^\);]+)(\)|;)/.exec(a);if(gS)return/Edge\/([\d\.]+)/.exec(a);if(bp)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(qh)return/WebKit\/(\S+)/.exec(a);if(qi)return/(?:Version)[ \/]?(\S+)/.exec(a)}();cH&&(cI=cH?cH[1]:"");if(bp){dU=gL();if(dU!=null&&dU>parseFloat(cI)){cJ=String(dU);break a}}cJ=cI}qg={};function qf(){return qj(function(){let c=0;const d=hf(String(cJ)).split("."),e=hf("9").split("."),f=Math.max(d.length,e.length);for(let g=0;c==0&&g<f;g++){var a=d[g]||"",b=e[g]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],b=/(\d*)(\D*)(.*)/.exec(b)||["","","",""],a[0].length==0&&b[0].length==0)break;c=fK(a[1].length==0?0:parseInt(a[1],10),b[1].length==0?0:parseInt(b[1],10))||fK(a[2].length==0,b[2].length==0)||fK(a[2],b[2]),a=a[3],b=b[3]}while(c==0)}return 0<=c})}i.document&&bp?(fZ=gL(),fY=fZ||parseInt(cJ,10)||void 0):fY=void 0,qe=fY,qc=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{i.addEventListener("test",cS,b),i.removeEventListener("test",cS,b)}catch(a){}return a}();function I(a,b){this.type=a,this.g=this.target=b,this.defaultPrevented=!1}I.prototype.h=function(){this.defaultPrevented=!0};function cC(a,c){var d,b,e;if(I.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){if(d=this.type=a.type,b=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null,this.target=a.target||a.srcElement,this.g=c,c=a.relatedTarget){if(gP){a:{try{fS(c.nodeName),e=!0;break a}catch(a){}e=!1}e||(c=null)}}else d=="mouseover"?c=a.fromElement:d=="mouseout"&&(c=a.toElement);this.relatedTarget=c,b?(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:qb[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&cC.Z.h.call(this)}}E(cC,I),qb={2:"touch",3:"pen",4:"mouse"},cC.prototype.h=function(){cC.Z.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1},cD="closure_listenable_"+(1e6*Math.random()|0),qa=0;function p_(a,b,c,d,e){this.listener=a,this.proxy=null,this.src=b,this.type=c,this.capture=!!d,this.ia=e,this.key=++qa,this.ca=this.fa=!1}function cK(a){a.ca=!0,a.listener=null,a.proxy=null,a.src=null,a.ia=null}function cL(a){this.src=a,this.g={},this.h=0}cL.prototype.add=function(b,a,d,e,f){var c=b.toString(),g;return b=this.g[c],b||(b=this.g[c]=[],this.h++),g=gd(b,a,e,f),-1<g?(a=b[g],d||(a.fa=!1)):(a=new p_(a,this.src,c,!!e,f),a.fa=d,b.push(a)),a};function gc(a,c){var b=c.type,d,e,f;b in a.g&&(d=a.g[b],e=hj(d,c),(f=0<=e)&&Array.prototype.splice.call(d,e,1),f&&(cK(c),a.g[b].length==0&&(delete a.g[b],a.h--)))}function gd(c,d,e,f){for(var a=0,b;a<c.length;++a)if(b=c[a],!b.ca&&b.listener==d&&b.capture==!!e&&b.ia==f)return a;return-1}ge="closure_lm_"+(1e6*Math.random()|0),gh={};function gn(b,c,d,a,e){if(a&&a.once)return gk(b,c,d,a,e);if(Array.isArray(c)){for(var f=0;f<c.length;f++)gn(b,c[f],d,a,e);return null}return d=fO(d),b&&b[cD]?b.N(c,d,bL(a)?!!a.capture:!!a,e):gl(b,c,d,!1,a,e)}function gl(a,e,c,b,d,h){if(!e)throw Error("Invalid event type");var g=bL(d)?!!d.capture:!!d,f=fW(a);if(f||(a[ge]=f=new cL(a)),c=f.add(e,c,b,g,h),c.proxy)return c;if(b=pZ(),c.proxy=b,b.src=a,b.listener=c,a.addEventListener)qc||(d=g),d===void 0&&(d=!1),a.addEventListener(e.toString(),b,d);else if(a.attachEvent)a.attachEvent(gB(e.toString()),b);else if(a.addListener&&a.removeListener)a.addListener(b);else throw Error("addEventListener and attachEvent are unavailable.");return c}function pZ(){function a(c){return b.call(a.src,a.listener,c)}var b=pY;return a}function gk(a,b,c,d,e){if(Array.isArray(b)){for(var f=0;f<b.length;f++)gk(a,b[f],c,d,e);return null}return c=fO(c),a&&a[cD]?a.O(b,c,bL(d)?!!d.capture:!!d,e):gl(a,b,c,!0,d,e)}function gj(a,b,c,e,f){if(Array.isArray(b))for(var d=0;d<b.length;d++)gj(a,b[d],c,e,f);else e=bL(e)?!!e.capture:!!e,c=fO(c),a&&a[cD]?(a=a.i,b=String(b).toString(),b in a.g&&(d=a.g[b],c=gd(d,c,e,f),-1<c&&(cK(d[c]),Array.prototype.splice.call(d,c,1),d.length==0&&(delete a.g[b],a.h--)))):a&&(a=fW(a))&&(b=a.g[b.toString()],a=-1,b&&(a=gd(b,c,e,f)),(c=-1<a?b[a]:null)&&gg(c))}function gg(b){var a,c,d;typeof b!="number"&&b&&!b.ca&&(a=b.src,a&&a[cD]?gc(a.i,b):(c=b.type,d=b.proxy,a.removeEventListener?a.removeEventListener(c,d,b.capture):a.detachEvent?a.detachEvent(gB(c),d):a.addListener&&a.removeListener&&a.removeListener(d),(c=fW(a))?(gc(c,b),c.h==0&&(c.src=null,a[ge]=null)):cK(b)))}function gB(a){return a in gh?gh[a]:gh[a]="on"+a}function pY(a,b){if(a.ca)a=!0;else{b=new cC(b,this);var c=a.listener,d=a.ia||a.src;a.fa&&gg(a),a=c.call(d,b)}return a}function fW(a){return a=a[ge],a instanceof cL?a:null}fR="__closure_events_fn_"+(1e9*Math.random()>>>0);function fO(a){return typeof a=="function"?a:(a[fR]||(a[fR]=function(b){return a.handleEvent(b)}),a[fR])}function z(){ar.call(this),this.i=new cL(this),this.P=this,this.I=null}E(z,ar),z.prototype[cD]=!0,z.prototype.removeEventListener=function(a,b,c,d){gj(this,a,b,c,d)};function C(e,a){var d,b=e.I,c,f,g;if(b)for(d=[];b;b=b.I)d.push(b);if(e=e.P,b=a.type||a,typeof a=="string"?a=new I(a,e):a instanceof I?a.target=a.target||e:(c=a,a=new I(b,e),gX(a,c)),c=!0,d)for(f=d.length-1;0<=f;f--)g=a.g=d[f],c=db(g,b,!0,a)&&c;if(g=a.g=e,c=db(g,b,!0,a)&&c,c=db(g,b,!1,a)&&c,d)for(f=0;f<d.length;f++)g=a.g=d[f],c=db(g,b,!1,a)&&c}z.prototype.M=function(){var a,b,d,c;if(z.Z.M.call(this),this.i){a=this.i;for(b in a.g){for(d=a.g[b],c=0;c<d.length;c++)cK(d[c]);delete a.g[b],a.h--}}this.I=null},z.prototype.N=function(a,b,c,d){return this.i.add(String(a),b,!1,c,d)},z.prototype.O=function(a,b,c,d){return this.i.add(String(a),b,!0,c,d)};function db(g,b,i,f){var c,d,a,h,e;if(b=g.i.g[String(b)],!b)return!0;b=b.concat();for(c=!0,d=0;d<b.length;++d)a=b[d],a&&!a.ca&&a.capture==i&&(h=a.listener,e=a.ia||a.src,a.fa&&gc(g.i,a),c=h.call(e,f)!==!1&&c);return c&&!f.defaultPrevented}fI=i.JSON.stringify;function pX(){var a=is;let b=null;return a.g&&(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null),b}t$=class{constructor(){this.h=this.g=null}add(b,c){const a=hu.get();a.set(b,c),this.h?this.h.next=a:this.g=a,this.h=a}},hu=new class{constructor(a,b){this.i=a,this.j=b,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}(()=>new pV,a=>a.reset()),pV=class{constructor(){this.next=this.g=this.h=null}set(a,b){this.h=a,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}};function pT(a){i.setTimeout(()=>{throw a},0)}function ft(a,b){fp||pS(),fk||(fp(),fk=!0),is.add(a,b)}function pS(){var a=i.Promise.resolve(void 0);fp=function(){a.then(pQ)}}fk=!1,is=new t$;function pQ(){for(var a,b;a=pX();){try{a.h.call(a.g)}catch(a){pT(a)}b=hu,b.j(a),100>b.h&&(b.h++,a.next=b.g,b.g=a)}fk=!1}function dp(a,b){z.call(this),this.h=a||1,this.g=b||i,this.j=F(this.kb,this),this.l=Date.now()}E(dp,z),f=dp.prototype,f.da=!1,f.S=null,f.kb=function(){if(this.da){var a=Date.now()-this.l;0<a&&a<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-a):(this.S&&(this.g.clearTimeout(this.S),this.S=null),C(this,"tick"),this.da&&(fh(this),this.start()))}},f.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function fh(a){a.da=!1,a.S&&(a.g.clearTimeout(a.S),a.S=null)}f.M=function(){dp.Z.M.call(this),fh(this),delete this.g};function fe(a,b,c){if(typeof a=="function")c&&(a=F(a,c));else if(a&&typeof a.handleEvent=="function")a=F(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(b)?-1:i.setTimeout(a,b||0)}function iy(a){a.g=fe(()=>{a.g=null,a.i&&(a.i=!1,iy(a))},a.j);const b=a.h;a.h=null,a.m.apply(null,b)}pO=class extends ar{constructor(a,b){super(),this.m=a,this.j=b,this.h=null,this.i=!1,this.g=null}l(a){this.h=arguments,this.g?this.i=!0:iy(this)}M(){super.M(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function cj(a){ar.call(this),this.h=a,this.g={}}E(cj,ar),iC=[];function iF(b,e,a,f){var c,d;Array.isArray(a)||(a&&(iC[0]=a.toString()),a=iC);for(c=0;c<a.length;c++){if(d=gn(e,a[c],f||b.handleEvent,!1,b.h||b),!d)break;b.g[d.key]=d}}function iM(a){ey(a.g,function(a,b){this.g.hasOwnProperty(b)&&gg(a)},a),a.g={}}cj.prototype.M=function(){cj.Z.M.call(this),iM(this)},cj.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function dy(){this.g=!0}dy.prototype.Aa=function(){this.g=!1};function pN(b,c,d,e,f,a){b.info(function(){var g,k,i,h,j,l;if(b.g)if(a){{g="";for(k=a.split("&"),i=0;i<k.length;i++)h=k[i].split("="),1<h.length&&(j=h[0],h=h[1],l=j.split("_"),g=2<=l.length&&l[1]=="type"?g+(j+"="+h+"&"):g+(j+"=redacted&"))}}else g=null;else g=a;return"XMLHTTP REQ ("+e+") [attempt "+f+"]: "+c+"\n"+d+"\n"+g})}function pJ(a,b,c,d,e,f,g){a.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+e+"]: "+b+"\n"+c+"\n"+f+" "+g})}function bn(a,c,d,b){a.info(function(){return"XMLHTTP TEXT ("+c+"): "+pA(a,d)+(b?" "+b:"")})}function pI(a,b){a.info(function(){return"TIMEOUT: "+b})}dy.prototype.info=function(){};function pA(a,d){var b,g,c,e,f;if(!a.g)return d;if(!d)return null;try{if(b=JSON.parse(d),b)for(a=0;a<b.length;a++)if(Array.isArray(b[a]))if(g=b[a],!(2>g.length))if(c=g[1],Array.isArray(c)&&!(1>c.length))if(e=c[0],e!="noop"&&e!="stop"&&e!="close")for(f=1;f<c.length;f++)c[f]="";return fI(b)}catch(a){return d}}aR={},jB=null;function dG(){return jB=jB||new z}aR.Ma="serverreachability";function ka(a){I.call(this,aR.Ma,a)}E(ka,I);function cu(b){const a=dG();C(a,new ka(a,b))}aR.STAT_EVENT="statevent";function kh(a,b){I.call(this,aR.STAT_EVENT,a),this.stat=b}E(kh,I);function O(b){const a=dG();C(a,new kh(a,b))}aR.Na="timingevent";function kE(a,b){I.call(this,aR.Na,a),this.size=b}E(kE,I);function cz(a,b){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){a()},b)}dN={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},kH={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function ew(){}ew.prototype.h=null;function kS(a){return a.h||(a.h=a.i())}function kW(){}cp={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function et(){I.call(this,"d")}E(et,I);function es(){I.call(this,"c")}E(es,I);function dW(){}E(dW,ew),dW.prototype.g=function(){return new XMLHttpRequest},dW.prototype.i=function(){return{}},ep=new dW;function cf(a,b,c,d){this.l=a,this.j=b,this.m=c,this.X=d||1,this.V=new cj(this),this.P=pz,a=fU?125:void 0,this.W=new dp(a),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new lb}function lb(){this.i=null,this.g="",this.h=!1}pz=45e3,ei={},d$={},f=cf.prototype,f.setTimeout=function(a){this.P=a};function eh(a,b,c){a.K=1,a.v=dL(ai(b)),a.s=c,a.U=!0,lp(a,null)}function lp(a,b){a.F=Date.now(),b_(a),a.A=ai(a.v);var d=a.A,c=a.X;Array.isArray(c)||(c=[String(c)]),jt(d.h,"t",c),a.C=0,d=a.l.H,a.h=new lb,a.g=gQ(a.l,d?b:null,!a.s),0<a.O&&(a.L=new pO(F(a.Ia,a,a.g),a.O)),iF(a.V,a.g,"readystatechange",a.gb),b=a.H?gZ(a.H):{},a.s?(a.u||(a.u="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.s,b)):(a.u="GET",a.g.ea(a.A,a.u,null,b)),cu(1),pN(a.j,a.u,a.A,a.m,a.X,a.s)}f.gb=function(a){a=a.target;const b=this.L;b&&ae(a)==3?b.l():this.Ia(a)},f.Ia=function(f){var a,b,d,e,k,c,g,h,j;try{if(f==this.g)a:{const l=ae(this.g);a=this.g.Da();const m=this.g.ba();if(!(3>l)&&(l!=3||fU||this.g&&(this.h.h||this.g.ga()||hH(this.g)))){this.I||l!=4||a==7||(a==8||0>=m?cu(3):cu(2));ea(this);b=this.g.ba();this.N=b;b:if(lA(this)){d=hH(this.g);f="";e=d.length,k=ae(this.g)==4;if(!this.h.i){if(typeof TextDecoder=="undefined"){aD(this);cA(this);c="";break b}this.h.i=new i.TextDecoder}for(a=0;a<e;a++)this.h.h=!0,f+=this.h.i.decode(d[a],{stream:k&&a==e-1});d.splice(0,e);this.h.g+=f;this.C=0;c=this.h.g}else c=this.g.ga();this.i=b==200;pJ(this.j,this.u,this.A,this.m,this.X,l,b);if(this.i){if(this.$&&!this.J){b:{if(this.g){g,h=this.g;if((g=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!cP(g)){j=g;break b}}j=null}if(b=j)bn(this.j,this.m,b,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,ek(this,b);else{this.i=!1;this.o=3;O(12);aD(this);cA(this);break a}}this.U?(gi(this,l,c),fU&&this.i&&l==3&&(iF(this.V,this.W,"tick",this.fb),this.W.start())):(bn(this.j,this.m,c,null),ek(this,c));l==4&&aD(this);this.i&&!this.I&&(l==4?hb(this.l,this):(this.i=!1,b_(this)))}else b==400&&0<c.indexOf("Unknown SID")?(this.o=3,O(12)):(this.o=0,O(13)),aD(this),cA(this)}}}catch(a){}finally{}};function lA(a){return!!a.g&&a.u=="GET"&&a.K!=2&&a.l.Ba}function gi(a,b,c){let e=!0,d;for(;!a.I&&a.C<c.length;){if(d=py(a,c),d==d$){b==4&&(a.o=4,O(14),e=!1),bn(a.j,a.m,null,"[Incomplete Response]");break}if(d==ei){a.o=4,O(15),bn(a.j,a.m,c,"[Invalid Chunk]"),e=!1;break}bn(a.j,a.m,d,null),ek(a,d)}lA(a)&&d!=d$&&d!=ei&&(a.h.g="",a.C=0),b!=4||c.length!=0||a.h.h||(a.o=1,O(16),e=!1),a.i=a.i&&e,e?0<c.length&&!a.aa&&(a.aa=!0,b=a.l,b.g==a&&b.$&&!b.L&&(b.h.info("Great, no buffering proxy detected. Bytes received: "+c.length),fM(b),b.L=!0,O(11))):(bn(a.j,a.m,c,"[Invalid Chunked Response]"),aD(a),cA(a))}f.fb=function(){if(this.g){var a=ae(this.g),b=this.g.ga();this.C<b.length&&(ea(this),gi(this,a,b),this.i&&a!=4&&b_(this))}};function py(d,b){var a=d.C,c=b.indexOf("\n",a);return c==-1?d$:(a=Number(b.substring(a,c)),isNaN(a))?ei:(c+=1,c+a>b.length)?d$:(b=b.substr(c,a),d.C=c+a,b)}f.cancel=function(){this.I=!0,aD(this)};function b_(a){a.Y=Date.now()+a.P,lm(a,a.P)}function lm(a,b){if(a.B!=null)throw Error("WatchDog timer not null");a.B=cz(F(a.eb,a),b)}function ea(a){a.B&&(i.clearTimeout(a.B),a.B=null)}f.eb=function(){this.B=null;const a=Date.now();0<=a-this.Y?(pI(this.j,this.A),this.K!=2&&(cu(3),O(17)),aD(this),this.o=2,cA(this)):lm(this,this.Y-a)};function cA(a){a.l.G==0||a.I||hb(a.l,a)}function aD(a){ea(a);var b=a.L;b&&typeof b.na=="function"&&b.na(),a.L=null,fh(a.W),iM(a.V),a.g&&(b=a.g,a.g=null,b.abort(),b.na())}function ek(c,e){var a,b,f,d,g,h,i;try{if(a=c.l,a.G!=0&&(a.g==c||eW(a.i,c)))if(a.I=c.N,!c.J&&eW(a.i,c)&&a.G==3){try{b=a.Ca.g.parse(e)}catch(a){b=null}if(Array.isArray(b)&&b.length==3){{if(f=b,f[0]==0){a:{if(!a.u){if(a.g)if(a.g.F+3e3<c.F)c_(a),de(a);else break a;fL(a);O(18)}}}else a.ta=f[1],0<a.ta-a.U&&37500>f[2]&&a.N&&a.A==0&&!a.v&&(a.v=cz(F(a.ab,a),6e3));if(1>=i$(a.i)&&a.ka){try{a.ka()}catch(a){}a.ka=void 0}}}else aT(a,11)}else if((c.J||a.g==c)&&c_(a),!cP(e))for(f=a.Ca.g.parse(e),e=0;e<f.length;e++){let j=f[e];if(a.U=j[0],j=j[1],a.G==2)if(j[0]=="c"){a.J=j[1],a.la=j[2];const k=j[3];k!=null&&(a.ma=k,a.h.info("VER="+a.ma));const l=j[4];l!=null&&(a.za=l,a.h.info("SVER="+a.za));const f=j[5];f!=null&&typeof f=="number"&&0<f&&(b=1.5*f,a.K=b,a.h.info("backChannelRequestTimeoutMs_="+b)),b=a;const e=c.g;if(e){const a=e.g?e.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(a&&(d=b.i,!d.g&&(Q(a,"spdy")||Q(a,"quic")||Q(a,"h2"))&&(d.j=d.l,d.g=new Set,d.h&&(eX(d,d.h),d.h=null))),b.D){const a=e.g?e.g.getResponseHeader("X-HTTP-Session-Id"):null;a&&(b.sa=a,t(b.F,b.D,a))}}a.G=3,a.j&&a.j.xa(),a.$&&(a.O=Date.now()-c.F,a.h.info("Handshake RTT: "+a.O+"ms")),b=a,g=c,b.oa=gU(b,b.H?b.la:null,b.W),g.J?(iY(b.i,g),h=g,i=b.K,i&&h.setTimeout(i),h.B&&(ea(h),b_(h)),b.g=g):hd(b),0<a.l.length&&dd(a)}else j[0]!="stop"&&j[0]!="close"||aT(a,7);else a.G==3&&(j[0]=="stop"||j[0]=="close"?j[0]=="stop"?aT(a,7):fB(a):j[0]!="noop"&&a.j&&a.j.wa(j),a.A=0)}cu(4)}catch(a){}}function px(a){if(a.R&&typeof a.R=="function")return a.R();if(typeof a=="string")return a.split("");if(fF(a)){for(var b=[],d=a.length,c=0;c<d;c++)b.push(a[c]);return b}b=[],d=0;for(c in a)b[d++]=a[c];return b}function em(a,f){var b,d,c,e;if(a.forEach&&typeof a.forEach=="function")a.forEach(f,void 0);else if(fF(a)||typeof a=="string")hi(a,f,void 0);else{if(a.T&&typeof a.T=="function")b=a.T();else if(a.R&&typeof a.R=="function")b=void 0;else if(fF(a)||typeof a=="string"){b=[];for(d=a.length,c=0;c<d;c++)b.push(c)}else for(c in b=[],d=0,a)b[d++]=c;d=px(a),c=d.length;for(e=0;e<c;e++)f.call(void 0,d[e],b&&b[e],a)}}function bC(c,d){var b,a;if(this.h={},this.g=[],this.i=0,b=arguments.length,1<b){if(b%2)throw Error("Uneven number of arguments");for(a=0;a<b;a+=2)this.set(arguments[a],arguments[a+1])}else if(c)if(c instanceof bC)for(b=c.T(),a=0;a<b.length;a++)this.set(b[a],c.get(b[a]));else for(a in c)this.set(a,c[a])}f=bC.prototype,f.R=function(){eo(this);for(var b=[],a=0;a<this.g.length;a++)b.push(this.h[this.g[a]]);return b},f.T=function(){return eo(this),this.g.concat()};function eo(a){var b,d,c,e;if(a.i!=a.g.length){for(b=0,d=0;b<a.g.length;)c=a.g[b],aX(a.h,c)&&(a.g[d++]=c),b++;a.g.length=d}if(a.i!=a.g.length){e={};for(d=b=0;b<a.g.length;)c=a.g[b],aX(e,c)||(a.g[d++]=c,e[c]=1),b++;a.g.length=d}}f.get=function(a,b){return aX(this.h,a)?this.h[a]:b},f.set=function(a,b){aX(this.h,a)||(this.i++,this.g.push(a)),this.h[a]=b},f.forEach=function(d,e){for(var b=this.T(),a=0,c,f;a<b.length;a++)c=b[a],f=this.get(c),d.call(e,f,c,this)};function aX(a,b){return Object.prototype.hasOwnProperty.call(a,b)}lE=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function pu(a,f){var b,c,d,e;if(a){a=a.split("&");for(b=0;b<a.length;b++)c=a[b].indexOf("="),d=null,0<=c?(e=a[b].substring(0,c),d=a[b].substring(c+1)):e=a[b],f(e,d?decodeURIComponent(d.replace(/\+/g," ")):"")}}function aN(b,c){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,b instanceof aN){this.g=c!==void 0?c:b.g,dR(this,b.j),this.s=b.s,dQ(this,b.i),dP(this,b.m),this.l=b.l,c=b.h;var a=new cl;a.i=c.i,c.g&&(a.g=new bC(c.g),a.h=c.h),kO(this,a),this.o=b.o}else b&&(a=String(b).match(lE))?(this.g=!!c,dR(this,a[1]||"",!0),this.s=cv(a[2]||""),dQ(this,a[3]||"",!0),dP(this,a[4]),this.l=cv(a[5]||"",!0),kO(this,a[6]||"",!0),this.o=cv(a[7]||"")):(this.g=!!c,this.h=new cl(null,this.g))}aN.prototype.toString=function(){var b=[],c=this.j,a;return c&&b.push(cr(c,jU,!0),":"),a=this.i,(a||c=="file")&&(b.push("//"),(c=this.s)&&b.push(cr(c,jU,!0),"@"),b.push(encodeURIComponent(String(a)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a=this.m,a!=null&&b.push(":",String(a))),(a=this.l)&&(this.i&&a.charAt(0)!="/"&&b.push("/"),b.push(cr(a,a.charAt(0)=="/"?ph:pj,!0))),(a=this.h.toString())&&b.push("?",a),(a=this.o)&&b.push("#",cr(a,pf)),b.join("")};function ai(a){return new aN(a)}function dR(a,b,c){a.j=c?cv(b,!0):b,a.j&&(a.j=a.j.replace(/:$/,""))}function dQ(b,a,c){b.i=c?cv(a,!0):a}function dP(b,a){if(a){if(a=Number(a),isNaN(a)||0>a)throw Error("Bad port number "+a);b.m=a}else b.m=null}function kO(a,b,c){b instanceof cl?(a.h=b,pe(a.h,a.g)):(c||(b=cr(b,pg)),a.h=new cl(b,a.g))}function t(a,b,c){a.h.set(b,c)}function dL(a){return t(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function pq(a){return a instanceof aN?ai(a):new aN(a,void 0)}function po(b,c,d,e){var a=new aN(null,void 0);return b&&dR(a,b),c&&dQ(a,c),d&&dP(a,d),e&&(a.l=e),a}function cv(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function cr(a,b,c){return typeof a=="string"?(a=encodeURI(a).replace(b,pk),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function pk(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}jU=/[#\/\?@]/g,pj=/[#\?:]/g,ph=/[#\?]/g,pg=/[#\?@]/g,pf=/#/g;function cl(a,b){this.h=this.g=null,this.i=a||null,this.j=!!b}function ay(a){a.g||(a.g=new bC,a.h=0,a.i&&pu(a.i,function(b,c){a.add(decodeURIComponent(b.replace(/\+/g," ")),c)}))}f=cl.prototype,f.add=function(a,c){ay(this),this.i=null,a=bm(this,a);var b=this.g.get(a);return b||this.g.set(a,b=[]),b.push(c),this.h+=1,this};function jv(a,b){ay(a),b=bm(a,b),aX(a.g.h,b)&&(a.i=null,a.h-=a.g.get(b).length,a=a.g,aX(a.h,b)&&(delete a.h[b],a.i--,a.g.length>2*a.i&&eo(a)))}function ju(a,b){return ay(a),b=bm(a,b),aX(a.g.h,b)}f.forEach=function(a,b){ay(this),this.g.forEach(function(c,d){hi(c,function(c){a.call(b,c,d,this)},this)},this)},f.T=function(){var e,b,c,a,f,d;ay(this);for(e=this.g.R(),b=this.g.T(),c=[],a=0;a<b.length;a++)for(f=e[a],d=0;d<f.length;d++)c.push(b[a]);return c},f.R=function(a){var b,c;if(ay(this),b=[],typeof a=="string")ju(this,a)&&(b=hh(b,this.g.get(bm(this,a))));else{a=this.g.R();for(c=0;c<a.length;c++)b=hh(b,a[c])}return b},f.set=function(a,b){return ay(this),this.i=null,a=bm(this,a),ju(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[b]),this.h+=1,this},f.get=function(a,b){return a?(a=this.R(a),0<a.length?String(a[0]):b):b};function jt(a,c,b){jv(a,c),0<b.length&&(a.i=null,a.g.set(bm(a,c),fJ(b)),a.h+=b.length)}f.toString=function(){var d,e,c,a,g,b,f;if(this.i)return this.i;if(!this.g)return"";for(d=[],e=this.g.T(),c=0;c<e.length;c++){a=e[c],g=encodeURIComponent(String(a)),a=this.R(a);for(b=0;b<a.length;b++)f=g,a[b]!==""&&(f+="="+encodeURIComponent(String(a[b]))),d.push(f)}return this.i=d.join("&")};function bm(b,a){return a=String(a),b.j&&(a=a.toLowerCase()),a}function pe(a,b){b&&!a.j&&(ay(a),a.i=null,a.g.forEach(function(c,a){var b=a.toLowerCase();a!=b&&(jv(this,a),jt(this,b,c))},a)),a.j=b}pa=class{constructor(a,b){this.h=a,this.g=b}};function jd(a){this.l=a||o$,i.PerformanceNavigationTiming?(a=i.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(i.g&&i.g.Ea&&i.g.Ea()&&i.g.Ea().Zb),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}o$=10;function ja(a){return!!a.h||(!!a.g&&a.g.size>=a.j)}function i$(a){return a.h?1:a.g?a.g.size:0}function eW(a,b){return a.h?a.h==b:!!a.g&&a.g.has(b)}function eX(a,b){a.g?a.g.add(b):a.h=b}function iY(a,b){a.h&&a.h==b?a.h=null:a.g&&a.g.has(b)&&a.g.delete(b)}jd.prototype.cancel=function(){if(this.i=iQ(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const a of this.g.values())a.cancel();this.g.clear()}};function iQ(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let b=a.i;for(const c of a.g.values())b=b.concat(c.D);return b}return fJ(a.i)}function e_(){}e_.prototype.stringify=function(a){return i.JSON.stringify(a,void 0)},e_.prototype.parse=function(a){return i.JSON.parse(a,void 0)};function oZ(){this.g=new e_}function oW(c,a,d){const b=d||"";try{em(c,function(c,e){let d=c;bL(c)&&(d=fI(c)),a.push(b+e+"="+encodeURIComponent(d))})}catch(c){throw a.push(b+"type="+encodeURIComponent("_badmap")),c}}function oV(c,a){const b=new dy;if(i.Image){const d=new Image;d.onload=cR(dt,b,d,"TestLoadImage: loaded",!0,a),d.onerror=cR(dt,b,d,"TestLoadImage: error",!1,a),d.onabort=cR(dt,b,d,"TestLoadImage: abort",!1,a),d.ontimeout=cR(dt,b,d,"TestLoadImage: timeout",!1,a),i.setTimeout(function(){d.ontimeout&&d.ontimeout()},1e4),d.src=c}else a(!1)}function dt(d,a,e,b,c){try{a.onload=null,a.onerror=null,a.onabort=null,a.ontimeout=null,c(b)}catch(a){}}function ce(a){this.l=a.$b||null,this.j=a.ib||!1}E(ce,ew),ce.prototype.g=function(){return new dr(this.l,this.j)},ce.prototype.i=function(a){return function(){return a}}({});function dr(a,b){z.call(this),this.D=a,this.u=b,this.m=void 0,this.readyState=ff,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}E(dr,z),ff=0,f=dr.prototype,f.open=function(a,b){if(this.readyState!=ff)throw this.abort(),Error("Error reopening a connection");this.C=a,this.B=b,this.readyState=1,b$(this)},f.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const b={headers:this.v,method:this.C,credentials:this.m,cache:void 0};a&&(b.body=a),(this.D||i).fetch(new Request(this.B,b)).then(this.Va.bind(this),this.ha.bind(this))},f.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,cc(this)),this.readyState=ff},f.Va=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,b$(this)),this.g&&(this.readyState=3,b$(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(typeof i.ReadableStream!="undefined"&&"body"in a){if(this.j=a.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ix(this)}else a.text().then(this.Ua.bind(this),this.ha.bind(this))};function ix(a){a.j.read().then(a.Sa.bind(a)).catch(a.ha.bind(a))}f.Sa=function(a){if(this.g){if(this.u&&a.value)this.response.push(a.value);else if(!this.u){var b=a.value?a.value:new Uint8Array(0);(b=this.A.decode(b,{stream:!a.done}))&&(this.response=this.responseText+=b)}a.done?cc(this):b$(this),this.readyState==3&&ix(this)}},f.Ua=function(a){this.g&&(this.response=this.responseText=a,cc(this))},f.Ta=function(a){this.g&&(this.response=a,cc(this))},f.ha=function(){this.g&&cc(this)};function cc(a){a.readyState=4,a.l=null,a.j=null,a.A=null,b$(a)}f.setRequestHeader=function(a,b){this.v.append(a,b)},f.getResponseHeader=function(a){return this.h?this.h.get(a.toLowerCase())||"":""},f.getAllResponseHeaders=function(){if(!this.h)return"";const b=[],c=this.h.entries();for(var a=c.next();!a.done;)a=a.value,b.push(a[0]+": "+a[1]),a=c.next();return b.join("\r\n")};function b$(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(dr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}}),oU=i.JSON.parse;function x(a){z.call(this),this.headers=new bC,this.u=a||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=ij,this.K=this.L=!1}E(x,z),ij="",oT=/^https?$/i,oS=["POST","PUT"],f=x.prototype,f.ea=function(a,b,e,c){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+a);b=b?b.toUpperCase():"GET",this.H=a,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ep.g(),this.C=this.u?kS(this.u):kS(ep),this.g.onreadystatechange=F(this.Fa,this);try{this.F=!0,this.g.open(b,String(a),!0),this.F=!1}catch(a){hY(this,a);return}a=e||"";const d=new bC(this.headers);c&&em(c,function(a,b){d.set(b,a)}),c=qk(d.T()),e=i.FormData&&a instanceof i.FormData,!(0<=hj(oS,b))||c||e||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),d.forEach(function(a,b){this.g.setRequestHeader(b,a)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{hQ(this),0<this.B&&((this.K=oR(this.g))?(this.g.timeout=this.B,this.g.ontimeout=F(this.pa,this)):this.A=fe(this.pa,this.B,this)),this.v=!0,this.g.send(a),this.v=!1}catch(a){hY(this,a)}};function oR(a){return bp&&qf()&&typeof a.timeout=="number"&&a.ontimeout!==void 0}function oQ(a){return a.toLowerCase()=="content-type"}f.pa=function(){typeof fA!="undefined"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,C(this,"timeout"),this.abort(8))};function hY(a,b){a.h=!1,a.g&&(a.l=!0,a.g.abort(),a.l=!1),a.j=b,a.m=5,hX(a),di(a)}function hX(a){a.D||(a.D=!0,C(a,"complete"),C(a,"error"))}f.abort=function(a){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=a||7,C(this,"complete"),C(this,"abort"),di(this))},f.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),di(this,!0)),x.Z.M.call(this)},f.Fa=function(){this.s||(this.F||this.v||this.l?hU(this):this.cb())},f.cb=function(){hU(this)};function hU(a){var e,c,d,b,f,g;if(a.h&&typeof fA!="undefined"&&(!a.C[1]||ae(a)!=4||a.ba()!=2))if(a.v&&ae(a)==4)fe(a.Fa,0,a);else if(C(a,"readystatechange"),ae(a)==4){a.h=!1;try{const h=a.ba();a:switch(h){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:e=!0;break a;default:e=!1}if((c=e)||((d=h===0)&&(b=String(a.H).match(lE)[1]||null,!b&&i.self&&i.self.location&&(f=i.self.location.protocol,b=f.substr(0,f.length-1)),d=!oT.test(b?b.toLowerCase():"")),c=d),c)C(a,"complete"),C(a,"success");else{a.m=6;try{g=2<ae(a)?a.g.statusText:""}catch(a){g=""}a.j=g+" ["+a.ba()+"]",hX(a)}}finally{di(a)}}}function di(a,b){if(a.g){hQ(a);const c=a.g,d=a.C[0]?cS:null;a.g=null,a.C=null,b||C(a,"ready");try{c.onreadystatechange=d}catch(a){}}}function hQ(a){a.g&&a.K&&(a.g.ontimeout=null),a.A&&(i.clearTimeout(a.A),a.A=null)}function ae(a){return a.g?a.g.readyState:0}f.ba=function(){try{return 2<ae(this)?this.g.status:-1}catch(a){return-1}},f.ga=function(){try{return this.g?this.g.responseText:""}catch(a){return""}},f.Qa=function(b){if(this.g){var a=this.g.responseText;return b&&a.indexOf(b)==0&&(a=a.substring(b.length)),oU(a)}};function hH(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.J){case ij:case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(a){return null}}f.Da=function(){return this.m},f.La=function(){return typeof this.j=="string"?this.j:String(this.j)};function oP(b){let a="";return ey(b,function(b,c){a+=c,a+=":",a+=b,a+="\r\n"}),a}function fy(c,d,a){a:{for(b in a){var b=!1;break a}b=!0}b||(a=oP(a),typeof c=="string"?a!=null&&encodeURIComponent(String(a)):t(c,d,a))}function bS(c,b,a){return a&&a.internalChannelParams?a.internalChannelParams[c]||b:b}function hr(a){this.za=0,this.l=[],this.h=new dy,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=bS("failFast",!1,a),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=bS("baseRetryDelayMs",5e3,a),this.$a=bS("retryDelaySeedMs",1e4,a),this.Ya=bS("forwardChannelMaxRetries",2,a),this.ra=bS("forwardChannelRequestTimeoutMs",2e4,a),this.qa=a&&a.xmlHttpFactory||void 0,this.Ba=a&&a.Yb||!1,this.K=void 0,this.H=a&&a.supportsCrossDomainXhr||!1,this.J="",this.i=new jd(a&&a.concurrentRequestLimit),this.Ca=new oZ,this.ja=a&&a.fastHandshake||!1,this.Ra=a&&a.Wb||!1,a&&a.Aa&&this.h.Aa(),a&&a.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&a&&a.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!a||a.Xb!==!1}f=hr.prototype,f.ma=8,f.G=1;function fB(c){if(hq(c),c.G==3){var a=c.V++,b=ai(c.F);t(b,"SID",c.J),t(b,"RID",a),t(b,"TYPE","terminate"),bP(c,b),a=new cf(c,c.h,a,void 0),a.K=2,a.v=dL(ai(b)),b=!1,i.navigator&&i.navigator.sendBeacon&&(b=i.navigator.sendBeacon(a.v.toString(),"")),!b&&i.Image&&((new Image).src=a.v,b=!0),b||(a.g=gQ(a.l,null),a.g.ea(a.v)),a.F=Date.now(),b_(a)}gW(c)}f.hb=function(a){try{this.h.info("Origin Trials invoked: "+a)}catch(a){}};function de(a){a.g&&(fM(a),a.g.cancel(),a.g=null)}function hq(a){de(a),a.u&&(i.clearTimeout(a.u),a.u=null),c_(a),a.i.cancel(),a.m&&(typeof a.m=="number"&&i.clearTimeout(a.m),a.m=null)}function fE(a,b){a.l.push(new pa(a.Za++,b)),a.G==3&&dd(a)}function dd(a){ja(a.i)||a.m||(a.m=!0,ft(a.Ha,a),a.C=0)}function oM(a,b){return!(i$(a.i)>=a.i.j-(a.m?1:0))&&(a.m?(a.l=b.D.concat(a.l),!0):!(a.G==1||a.G==2||a.C>=(a.Xa?0:a.Ya))&&(a.m=cz(F(a.Ha,a,b),ha(a,a.C)),a.C++,!0))}f.Ha=function(d){var b,a,c;if(this.m)if(this.m=null,this.G==1){if(!d){this.V=Math.floor(1e5*Math.random()),d=this.V++;const f=new cf(this,this.h,d,void 0);let e=this.s;if(this.P&&(e?(e=gZ(e),gX(e,this.P)):e=this.P),this.o===null&&(f.H=e),this.ja)a:{b=0;for(a=0;a<this.l.length;a++){b:{c=this.l[a];if("__data__"in c.g&&(c=c.g.__data__,typeof c=="string")){c=c.length;break b}c=void 0}if(c===void 0)break;if(b+=c,4096<b){b=a;break a}if(b===4096||a===this.l.length-1){b=a+1;break a}}b=1e3}else b=1e3;b=hg(this,f,b),a=ai(this.F),t(a,"RID",d),t(a,"CVER",22),this.D&&t(a,"X-HTTP-Session-Id",this.D),bP(this,a),this.o&&e&&fy(a,this.o,e),eX(this.i,f),this.Ra&&t(a,"TYPE","init"),this.ja?(t(a,"$req",b),t(a,"SID","null"),f.$=!0,eh(f,a,null)):eh(f,a,b),this.G=2}}else this.G==3&&(d?hn(this,d):this.l.length==0||ja(this.i)||hn(this))};function hn(a,c){var b;c?b=c.m:b=a.V++;const d=ai(a.F);t(d,"SID",a.J),t(d,"RID",b),t(d,"AID",a.U),bP(a,d),a.o&&a.s&&fy(d,a.o,a.s),b=new cf(a,a.h,b,a.C+1),a.o===null&&(b.H=a.s),c&&(a.l=c.D.concat(a.l)),c=hg(a,b,1e3),b.setTimeout(Math.round(.5*a.ra)+Math.round(.5*a.ra*Math.random())),eX(a.i,b),eh(b,d,c)}function bP(a,b){a.j&&em({},function(a,c){t(b,c,a)})}function hg(a,e,b){var c,d;b=Math.min(a.l.length,b),c=a.j?F(a.j.Oa,a.j,a):null;a:{d=a.l;let e=-1;for(;;){const a=["count="+b];e==-1?0<b?(e=d[0].h,a.push("ofs="+e)):e=0:a.push("ofs="+e);let f=!0;for(let g=0;g<b;g++){let h=d[g].h;const i=d[g].g;if(h-=e,0>h)e=Math.max(0,d[g].h-100),f=!1;else try{oW(i,a,"req"+h+"_")}catch(a){c&&c(i)}}if(f){c=a.join("&");break a}}}return a=a.l.splice(0,b),e.D=a,c}function hd(a){a.g||a.u||(a.Y=1,ft(a.Ga,a),a.A=0)}function fL(a){return!(a.g||a.u||3<=a.A)&&(a.Y++,a.u=cz(F(a.Ga,a),ha(a,a.A)),a.A++,!0)}f.Ga=function(){if(this.u=null,hc(this),this.$&&!(this.L||this.g==null||0>=this.O)){var a=2*this.O;this.h.info("BP detection timer enabled: "+a),this.B=cz(F(this.bb,this),a)}},f.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,O(10),de(this),hc(this))};function fM(a){a.B!=null&&(i.clearTimeout(a.B),a.B=null)}function hc(a){var b,c;a.g=new cf(a,a.h,"rpc",a.Y),a.o===null&&(a.g.H=a.s),a.g.O=0,b=ai(a.oa),t(b,"RID","rpc"),t(b,"SID",a.J),t(b,"CI",a.N?"0":"1"),t(b,"AID",a.U),bP(a,b),t(b,"TYPE","xmlhttp"),a.o&&a.s&&fy(b,a.o,a.s),a.K&&a.g.setTimeout(a.K),c=a.g,a=a.la,c.K=1,c.v=dL(ai(b)),c.s=null,c.U=!0,lp(c,a)}f.ab=function(){this.v!=null&&(this.v=null,de(this),fL(this),O(19))};function c_(a){a.v!=null&&(i.clearTimeout(a.v),a.v=null)}function hb(a,b){var d=null,c,e;if(a.g==b)c_(a),fM(a),a.g=null,c=2;else if(eW(a.i,b))d=b.D,iY(a.i,b),c=1;else return;if(a.I=b.N,a.G!=0)if(b.i)c==1?(d=b.s?b.s.length:0,b=Date.now()-b.F,e=a.C,c=dG(),C(c,new kE(c,d,b,e)),dd(a)):hd(a);else if(e=b.o,e==3||e==0&&0<a.I||!(c==1&&oM(a,b)||c==2&&fL(a)))switch(d&&0<d.length&&(b=a.i,b.i=b.i.concat(d)),e){case 1:aT(a,5);break;case 4:aT(a,10);break;case 3:aT(a,6);break;default:aT(a,2)}}function ha(a,c){let b=a.Pa+Math.floor(Math.random()*a.$a);return a.j||(b*=2),b*c}function aT(a,c){var b,d;a.h.info("Error code "+c),c==2?(b=null,a.j&&(b=null),d=F(a.jb,a),b||(b=new aN("//www.google.com/images/cleardot.gif"),i.location&&i.location.protocol=="http"||dR(b,"https"),dL(b)),oV(b.toString(),d)):O(2),a.G=0,a.j&&a.j.va(c),gW(a),hq(a)}f.jb=function(a){a?(this.h.info("Successfully pinged google.com"),O(2)):(this.h.info("Failed to ping google.com"),O(1))};function gW(a){a.G=0,a.I=-1,a.j&&((iQ(a.i).length!=0||a.l.length!=0)&&(a.i.i.length=0,fJ(a.l),a.l.length=0),a.j.ua())}function gU(c,b,d){let a=pq(d);if(a.i!="")b&&dQ(a,b+"."+a.i),dP(a,a.m);else{const c=i.location;a=po(c.protocol,b?b+"."+c.hostname:c.hostname,+c.port,d)}return c.aa&&ey(c.aa,function(b,c){t(a,c,b)}),b=c.D,d=c.sa,b&&d&&t(a,b,d),t(a,"VER",c.ma),bP(c,a),a}function gQ(a,b,c){if(b&&!a.H)throw Error("Can't create secondary domain capable XhrIo object.");return b=c&&a.Ba&&!a.qa?new x(new ce({ib:!0})):new x(a.qa),b.L=a.H,b}function gN(){}f=gN.prototype,f.xa=function(){},f.wa=function(){},f.va=function(){},f.ua=function(){},f.Oa=function(){};function cY(){if(bp&&!(10<=Number(qe)))throw Error("Environmental error: no available transport.")}cY.prototype.g=function(a,b){return new T(a,b)};function T(b,a){z.call(this),this.g=new hr(a),this.l=b,this.h=a&&a.messageUrlParams||null,b=a&&a.messageHeaders||null,a&&a.clientProtocolHeaderRequired&&(b?b["X-Client-Protocol"]="webchannel":b={"X-Client-Protocol":"webchannel"}),this.g.s=b,b=a&&a.initMessageHeaders||null,a&&a.messageContentType&&(b?b["X-WebChannel-Content-Type"]=a.messageContentType:b={"X-WebChannel-Content-Type":a.messageContentType}),a&&a.ya&&(b?b["X-WebChannel-Client-Profile"]=a.ya:b={"X-WebChannel-Client-Profile":a.ya}),this.g.P=b,(b=a&&a.httpHeadersOverwriteParam)&&!cP(b)&&(this.g.o=b),this.A=a&&a.supportsCrossDomainXhr||!1,this.v=a&&a.sendRawJson||!1,(a=a&&a.httpSessionIdParam)&&!cP(a)&&(this.g.D=a,b=this.h,b!==null&&a in b&&(b=this.h,a in b&&delete b[a])),this.j=new bf(this)}E(T,z),T.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var a=this.g,b=this.l,c=this.h||void 0;a.Wa&&(a.h.info("Origin Trials enabled."),ft(F(a.hb,a,b))),O(0),a.W=b,a.aa=c||{},a.N=a.X,a.F=gU(a,null,a.W),dd(a)},T.prototype.close=function(){fB(this.g)},T.prototype.u=function(b){if(typeof b=="string"){var a={};a.__data__=b,fE(this.g,a)}else this.v?(a={},a.__data__=fI(b),fE(this.g,a)):fE(this.g,b)},T.prototype.M=function(){this.g.j=null,delete this.j,fB(this.g),delete this.g,T.Z.M.call(this)};function gH(a){et.call(this);var b=a.__sm__;if(b){a:{for(const c in b){a=c;break a}a=void 0}(this.i=a)&&(a=this.i,b=b!==null&&a in b?b[a]:void 0),this.data=b}else this.data=a}E(gH,et);function gE(){es.call(this),this.status=1}E(gE,es);function bf(a){this.g=a}E(bf,gN),bf.prototype.xa=function(){C(this.g,"a")},bf.prototype.wa=function(a){C(this.g,new gH(a))},bf.prototype.va=function(a){C(this.g,new gE(a))},bf.prototype.ua=function(){C(this.g,"b")},cY.prototype.createWebChannel=cY.prototype.g,T.prototype.send=T.prototype.u,T.prototype.open=T.prototype.m,T.prototype.close=T.prototype.close,dN.NO_ERROR=0,dN.TIMEOUT=8,dN.HTTP_ERROR=6,kH.COMPLETE="complete",kW.EventType=cp,cp.OPEN="a",cp.CLOSE="b",cp.ERROR="c",cp.MESSAGE="d",z.prototype.listen=z.prototype.N,x.prototype.listenOnce=x.prototype.O,x.prototype.getLastError=x.prototype.La,x.prototype.getLastErrorCode=x.prototype.Da,x.prototype.getStatus=x.prototype.ba,x.prototype.getResponseJson=x.prototype.Qa,x.prototype.getResponseText=x.prototype.ga,x.prototype.send=x.prototype.ea,oJ=aj.createWebChannelTransport=function(){return new cY},oG=aj.getStatEventTarget=function(){return dG()},gb=aj.ErrorCode=dN,oF=aj.EventType=kH,oD=aj.Event=aR,gr=aj.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},oC=aj.FetchXmlHttpFactory=ce,cV=aj.WebChannel=kW,oA=aj.XhrIo=x,gm="@firebase/firestore",R=class{constructor(a){this.uid=a}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(a){return a.uid===this.uid}},R.UNAUTHENTICATED=new R(null),R.GOOGLE_CREDENTIALS=new R("google-credentials-uid"),R.FIRST_PARTY=new R("first-party-uid"),R.MOCK_USER=new R("mock-user"),bu="9.8.0",aW=new j$("@firebase/firestore");function ed(){return aW.logLevel}function c(a,...b){if(aW.logLevel<=n.DEBUG){const c=b.map(gf);aW.debug(`Firestore (${bu}): ${a}`,...c)}}function S(a,...b){if(aW.logLevel<=n.ERROR){const c=b.map(gf);aW.error(`Firestore (${bu}): ${a}`,...c)}}function gp(a,...b){if(aW.logLevel<=n.WARN){const c=b.map(gf);aW.warn(`Firestore (${bu}): ${a}`,...c)}}function gf(a){if(typeof a=="string")return a;try{return b=a,JSON.stringify(b)}catch(b){return a}var b}function g(b="Unexpected state"){const a=`FIRESTORE (${bu}) INTERNAL ASSERTION FAILED: `+b;throw S(a),new Error(a)}function k(a,b){a||g()}function j(a,b){return a}b={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},e=class extends ex{constructor(a,b){super(a,b),this.code=a,this.message=b,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}},ab=class{constructor(){this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}},ov=class{constructor(a,b){this.user=b,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${a}`)}},ou=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(a,b){a.enqueueRetryable(()=>b(R.UNAUTHENTICATED))}shutdown(){}},os=class{constructor(a){this.t=a,this.currentUser=R.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(b,h){let d=this.i;const e=a=>this.i!==d?(d=this.i,h(a)):Promise.resolve();let a=new ab;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new ab,b.enqueueRetryable(()=>e(this.currentUser))};const f=()=>{const c=a;b.enqueueRetryable(async()=>{await c.promise,await e(this.currentUser)})},g=a=>{c("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=a,this.auth.addAuthTokenListener(this.o),f()};this.t.onInit(a=>g(a)),setTimeout(()=>{if(!this.auth){const b=this.t.getImmediate({optional:!0});b?g(b):(c("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new ab)}},0),f()}getToken(){const a=this.i,b=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(b).then(b=>this.i!==a?(c("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):b?(k(typeof b.accessToken=="string"),new ov(b.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const a=this.auth&&this.auth.getUid();return k(a===null||typeof a=="string"),new R(a)}},or=class{constructor(c,d,a){this.type="FirstParty",this.user=R.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",d);const b=c.auth.getAuthHeaderValueForFirstParty([]);b&&this.headers.set("Authorization",b),a&&this.headers.set("X-Goog-Iam-Authorization-Token",a)}},oq=class{constructor(a,b,c){this.h=a,this.l=b,this.m=c}getToken(){return Promise.resolve(new or(this.h,this.l,this.m))}start(a,b){a.enqueueRetryable(()=>b(R.FIRST_PARTY))}shutdown(){}invalidateToken(){}},op=class{constructor(a){this.value=a,this.type="AppCheck",this.headers=new Map,a&&a.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},oo=class{constructor(a){this.g=a,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(b,d){const e=a=>{a.error!=null&&c("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const b=a.token!==this.p;return this.p=a.token,c("FirebaseAppCheckTokenProvider",`Received ${b?"new":"existing"} token.`),b?d(a.token):Promise.resolve()};this.o=a=>{b.enqueueRetryable(()=>e(a))};const a=a=>{c("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.appCheck.addTokenListener(this.o)};this.g.onInit(b=>a(b)),setTimeout(()=>{if(!this.appCheck){const b=this.g.getImmediate({optional:!0});b?a(b):c("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const a=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(a).then(a=>a?(k(typeof a.token=="string"),this.p=a.token,new op(a.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}},X=class{constructor(b,a){this.previousValue=b,a&&(a.sequenceNumberHandler=a=>this.I(a),this.T=b=>a.writeSequenceNumber(b))}I(a){return this.previousValue=Math.max(a,this.previousValue),this.previousValue}next(){const a=++this.previousValue;return this.T&&this.T(a),a}};function ok(c){const a=typeof self!="undefined"&&(self.crypto||self.msCrypto),b=new Uint8Array(c);if(a&&typeof a.getRandomValues=="function")a.getRandomValues(b);else for(let a=0;a<c;a++)b[a]=Math.floor(256*Math.random());return b}X.A=-1,oj=class{static R(){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=Math.floor(256/a.length)*a.length;let b="";for(;b.length<20;){const d=ok(40);for(let e=0;e<d.length;++e)b.length<20&&d[e]<c&&(b+=a.charAt(d[e]%a.length))}return b}};function l(a,b){return a<b?-1:a>b?1:0}function bv(a,b,c){return a.length===b.length&&a.every((a,d)=>c(a,b[d]))}function gJ(a){return a+"\0"}A=class{constructor(a,c){if(this.seconds=a,this.nanoseconds=c,c<0)throw new e(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+c);if(c>=1e9)throw new e(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+c);if(a<-62135596800)throw new e(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+a);if(a>=253402300800)throw new e(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+a)}static now(){return A.fromMillis(Date.now())}static fromDate(a){return A.fromMillis(a.getTime())}static fromMillis(a){const b=Math.floor(a/1e3),c=Math.floor(1e6*(a-1e3*b));return new A(b,c)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(a){return this.seconds===a.seconds?l(this.nanoseconds,a.nanoseconds):l(this.seconds,a.seconds)}isEqual(a){return a.seconds===this.seconds&&a.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const a=this.seconds- -62135596800;return String(a).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}},h=class{constructor(a){this.timestamp=a}static fromTimestamp(a){return new h(a)}static min(){return new h(new A(0,0))}static max(){return new h(new A(253402300799,999999999))}compareTo(a){return this.timestamp._compareTo(a.timestamp)}isEqual(a){return this.timestamp.isEqual(a.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};function gM(a){let b=0;for(const c in a)Object.prototype.hasOwnProperty.call(a,c)&&b++;return b}function cs(a,b){for(const c in a)Object.prototype.hasOwnProperty.call(a,c)&&b(c,a[c])}function gO(a){for(const b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0}cM=class{constructor(b,a,c){a===void 0?a=0:a>b.length&&g(),c===void 0?c=b.length-a:c>b.length-a&&g(),this.segments=b,this.offset=a,this.len=c}get length(){return this.len}isEqual(a){return cM.comparator(this,a)===0}child(a){const b=this.segments.slice(this.offset,this.limit());return a instanceof cM?a.forEach(a=>{b.push(a)}):b.push(a),this.construct(b)}limit(){return this.offset+this.length}popFirst(a){return a=a===void 0?1:a,this.construct(this.segments,this.offset+a,this.length-a)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(a){return this.segments[this.offset+a]}isEmpty(){return this.length===0}isPrefixOf(a){if(a.length<this.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}isImmediateParentOf(a){if(this.length+1!==a.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}forEach(a){for(let b=this.offset,c=this.limit();b<c;b++)a(this.segments[b])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(a,b){const c=Math.min(a.length,b.length);for(let d=0;d<c;d++){const e=a.get(d),f=b.get(d);if(e<f)return-1;if(e>f)return 1}return a.length<b.length?-1:a.length>b.length?1:0}},q=class extends cM{construct(a,b,c){return new q(a,b,c)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...c){const a=[];for(const d of c){if(d.indexOf("//")>=0)throw new e(b.INVALID_ARGUMENT,`Invalid segment (${d}). Paths must not contain // in them.`);a.push(...d.split("/").filter(a=>a.length>0))}return new q(a)}static emptyPath(){return new q([])}},oa=/^[_a-zA-Z][_a-zA-Z0-9]*$/,J=class extends cM{construct(a,b,c){return new J(a,b,c)}static isValidIdentifier(a){return oa.test(a)}canonicalString(){return this.toArray().map(a=>(a=a.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),J.isValidIdentifier(a)||(a="`"+a+"`"),a)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new J(["__name__"])}static fromServerFormat(a){const g=[];let d="",c=0;const h=()=>{if(d.length===0)throw new e(b.INVALID_ARGUMENT,`Invalid field path (${a}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);g.push(d),d=""};let f=!1;for(;c<a.length;){const g=a[c];if(g==="\\"){if(c+1===a.length)throw new e(b.INVALID_ARGUMENT,"Path has trailing escape character: "+a);const f=a[c+1];if(f!=="\\"&&f!=="."&&f!=="`")throw new e(b.INVALID_ARGUMENT,"Path has invalid escape sequence: "+a);d+=f,c+=2}else g==="`"?(f=!f,c++):g!=="."||f?(d+=g,c++):(h(),c++)}if(h(),f)throw new e(b.INVALID_ARGUMENT,"Unterminated ` in path: "+a);return new J(g)}static emptyPath(){return new J([])}},n$=class{constructor(a){this.fields=a,a.sort(J.comparator)}covers(a){for(const b of this.fields)if(b.isPrefixOf(a))return!0;return!1}isEqual(a){return bv(this.fields,a.fields,(a,b)=>a.isEqual(b))}},D=class{constructor(a){this.binaryString=a}static fromBase64String(a){const b=atob(a);return new D(b)}static fromUint8Array(a){const b=function(a){let b="";for(let c=0;c<a.length;++c)b+=String.fromCharCode(a[c]);return b}(a);return new D(b)}[Symbol.iterator](){let a=0;return{next:()=>a<this.binaryString.length?{value:this.binaryString.charCodeAt(a++),done:!1}:{value:void 0,done:!0}}}toBase64(){return a=this.binaryString,btoa(a);var a}toUint8Array(){return function(a){const b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(a){return l(this.binaryString,a.binaryString)}isEqual(a){return this.binaryString===a.binaryString}},D.EMPTY_BYTE_STRING=new D(""),n_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function an(a){if(k(!!a),typeof a=="string"){let c=0;const b=n_.exec(a);if(k(!!b),b[1]){let a=b[1];a=(a+"000000000").substr(0,9),c=Number(a)}const d=new Date(a);return{seconds:Math.floor(d.getTime()/1e3),nanos:c}}return{seconds:u(a.seconds),nanos:u(a.nanos)}}function u(a){return typeof a=="number"?a:typeof a=="string"?Number(a):0}function aE(a){return typeof a=="string"?D.fromBase64String(a):D.fromUint8Array(a)}function jH(c){var a,b;return((b=(((a=c==null?void 0:c.mapValue)===null||a===void 0?void 0:a.fields)||{}).__type__)===null||b===void 0?void 0:b.stringValue)==="server_timestamp"}function g_(b){const a=b.mapValue.fields.__previous_value__;return jH(a)?g_(a):a}function bD(b){const a=an(b.mapValue.fields.__local_write_time__.timestampValue);return new A(a.seconds,a.nanos)}nZ=class{constructor(a,b,c,d,e,f,g,h){this.databaseId=a,this.appId=b,this.persistenceKey=c,this.host=d,this.ssl=e,this.forceLongPolling=f,this.autoDetectLongPolling=g,this.useFetchStreams=h}},aL=class{constructor(a,b){this.projectId=a,this.database=b||"(default)"}static empty(){return new aL("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(a){return a instanceof aL&&a.projectId===this.projectId&&a.database===this.database}};function cO(a){return a==null}function cd(a){return a===0&&1/a==-1/0}function nW(a){return typeof a=="number"&&Number.isInteger(a)&&!cd(a)&&a<=Number.MAX_SAFE_INTEGER&&a>=Number.MIN_SAFE_INTEGER}d=class{constructor(a){this.path=a}static fromPath(a){return new d(q.fromString(a))}static fromName(a){return new d(q.fromString(a).popFirst(5))}static empty(){return new d(q.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(a){return this.path.length>=2&&this.path.get(this.path.length-2)===a}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(a){return a!==null&&q.comparator(this.path,a.path)===0}toString(){return this.path.toString()}static comparator(a,b){return q.comparator(a.path,b.path)}static isDocumentKey(a){return a.length%2==0}static fromSegments(a){return new d(new q(a.slice()))}},ak={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},cQ={nullValue:"NULL_VALUE"};function aI(a){return"nullValue"in a?0:"booleanValue"in a?1:"integerValue"in a||"doubleValue"in a?2:"timestampValue"in a?3:"stringValue"in a?5:"bytesValue"in a?6:"referenceValue"in a?7:"geoPointValue"in a?8:"arrayValue"in a?9:"mapValue"in a?jH(a)?4:hw(a)?9007199254740991:10:g()}function aa(a,b){if(a===b)return!0;const c=aI(a);if(c!==aI(b))return!1;switch(c){case 0:case 9007199254740991:return!0;case 1:return a.booleanValue===b.booleanValue;case 4:return bD(a).isEqual(bD(b));case 3:return function(a,b){if(typeof a.timestampValue=="string"&&typeof b.timestampValue=="string"&&a.timestampValue.length===b.timestampValue.length)return a.timestampValue===b.timestampValue;const c=an(a.timestampValue),d=an(b.timestampValue);return c.seconds===d.seconds&&c.nanos===d.nanos}(a,b);case 5:return a.stringValue===b.stringValue;case 6:return function(a,b){return aE(a.bytesValue).isEqual(aE(b.bytesValue))}(a,b);case 7:return a.referenceValue===b.referenceValue;case 8:return function(a,b){return u(a.geoPointValue.latitude)===u(b.geoPointValue.latitude)&&u(a.geoPointValue.longitude)===u(b.geoPointValue.longitude)}(a,b);case 2:return function(a,b){if("integerValue"in a&&"integerValue"in b)return u(a.integerValue)===u(b.integerValue);if("doubleValue"in a&&"doubleValue"in b){const c=u(a.doubleValue),d=u(b.doubleValue);return c===d?cd(c)===cd(d):isNaN(c)&&isNaN(d)}return!1}(a,b);case 9:return bv(a.arrayValue.values||[],b.arrayValue.values||[],aa);case 10:return function(c,d){const a=c.mapValue.fields||{},b=d.mapValue.fields||{};if(gM(a)!==gM(b))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(b[c]===void 0||!aa(a[c],b[c])))return!1;return!0}(a,b);default:return g()}}function bW(a,b){return(a.values||[]).find(a=>aa(a,b))!==void 0}function av(a,b){if(a===b)return 0;const c=aI(a),d=aI(b);if(c!==d)return l(c,d);switch(c){case 0:case 9007199254740991:return 0;case 1:return l(a.booleanValue,b.booleanValue);case 2:return function(c,d){const a=u(c.integerValue||c.doubleValue),b=u(d.integerValue||d.doubleValue);return a<b?-1:a>b?1:a===b?0:isNaN(a)?isNaN(b)?0:-1:1}(a,b);case 3:return hm(a.timestampValue,b.timestampValue);case 4:return hm(bD(a),bD(b));case 5:return l(a.stringValue,b.stringValue);case 6:return function(a,b){const c=aE(a),d=aE(b);return c.compareTo(d)}(a.bytesValue,b.bytesValue);case 7:return function(c,d){const a=c.split("/"),b=d.split("/");for(let c=0;c<a.length&&c<b.length;c++){const d=l(a[c],b[c]);if(d!==0)return d}return l(a.length,b.length)}(a.referenceValue,b.referenceValue);case 8:return function(a,b){const c=l(u(a.latitude),u(b.latitude));return c!==0?c:l(u(a.longitude),u(b.longitude))}(a.geoPointValue,b.geoPointValue);case 9:return function(c,d){const a=c.values||[],b=d.values||[];for(let c=0;c<a.length&&c<b.length;++c){const d=av(a[c],b[c]);if(d)return d}return l(a.length,b.length)}(a.arrayValue,b.arrayValue);case 10:return function(c,d){if(c===ak.mapValue&&d===ak.mapValue)return 0;if(c===ak.mapValue)return 1;if(d===ak.mapValue)return-1;const e=c.fields||{},a=Object.keys(e),f=d.fields||{},b=Object.keys(f);a.sort(),b.sort();for(let c=0;c<a.length&&c<b.length;++c){const d=l(a[c],b[c]);if(d!==0)return d;const g=av(e[a[c]],f[b[c]]);if(g!==0)return g}return l(a.length,b.length)}(a.mapValue,b.mapValue);default:throw g()}}function hm(a,b){if(typeof a=="string"&&typeof b=="string"&&a.length===b.length)return l(a,b);const c=an(a),d=an(b),e=l(c.seconds,d.seconds);return e!==0?e:l(c.nanos,d.nanos)}function bc(a){return fG(a)}function fG(a){return"nullValue"in a?"null":"booleanValue"in a?""+a.booleanValue:"integerValue"in a?""+a.integerValue:"doubleValue"in a?""+a.doubleValue:"timestampValue"in a?function(b){const a=an(b);return`time(${a.seconds},${a.nanos})`}(a.timestampValue):"stringValue"in a?a.stringValue:"bytesValue"in a?aE(a.bytesValue).toBase64():"referenceValue"in a?(c=a.referenceValue,d.fromName(c).toString()):"geoPointValue"in a?`geo(${(b=a.geoPointValue).latitude},${b.longitude})`:"arrayValue"in a?function(c){let a="[",b=!0;for(const d of c.values||[])b?b=!1:a+=",",a+=fG(d);return a+"]"}(a.arrayValue):"mapValue"in a?function(b){const d=Object.keys(b.fields||{}).sort();let a="{",c=!0;for(const e of d)c?c=!1:a+=",",a+=`${e}:${fG(b.fields[e])}`;return a+"}"}(a.mapValue):g();var b,c}function bK(a,b){return{referenceValue:`projects/${a.projectId}/databases/${a.database}/documents/${b.path.canonicalString()}`}}function fD(a){return!!a&&"integerValue"in a}function bH(a){return!!a&&"arrayValue"in a}function hs(a){return!!a&&"nullValue"in a}function ht(a){return!!a&&"doubleValue"in a&&isNaN(Number(a.doubleValue))}function fz(a){return!!a&&"mapValue"in a}function bE(a){if(a.geoPointValue)return{geoPointValue:Object.assign({},a.geoPointValue)};if(a.timestampValue&&typeof a.timestampValue=="object")return{timestampValue:Object.assign({},a.timestampValue)};if(a.mapValue){const b={mapValue:{fields:{}}};return cs(a.mapValue.fields,(a,c)=>b.mapValue.fields[a]=bE(c)),b}if(a.arrayValue){const b={arrayValue:{values:[]}};for(let c=0;c<(a.arrayValue.values||[]).length;++c)b.arrayValue.values[c]=bE(a.arrayValue.values[c]);return b}return Object.assign({},a)}function hw(a){return(((a.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function nV(a){return"nullValue"in a?cQ:"booleanValue"in a?{booleanValue:!1}:"integerValue"in a||"doubleValue"in a?{doubleValue:NaN}:"timestampValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in a?{stringValue:""}:"bytesValue"in a?{bytesValue:""}:"referenceValue"in a?bK(aL.empty(),d.empty()):"geoPointValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in a?{arrayValue:{}}:"mapValue"in a?{mapValue:{}}:g()}function nS(a){return"nullValue"in a?{booleanValue:!1}:"booleanValue"in a?{doubleValue:NaN}:"integerValue"in a||"doubleValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in a?{stringValue:""}:"stringValue"in a?{bytesValue:""}:"bytesValue"in a?bK(aL.empty(),d.empty()):"referenceValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in a?{arrayValue:{}}:"arrayValue"in a?{mapValue:{}}:"mapValue"in a?ak:g()}function hz(a,b){const c=av(a.value,b.value);return c!==0?c:a.inclusive&&!b.inclusive?-1:!a.inclusive&&b.inclusive?1:0}function hA(a,b){const c=av(a.value,b.value);return c!==0?c:a.inclusive&&!b.inclusive?1:!a.inclusive&&b.inclusive?-1:0}$=class{constructor(a){this.value=a}static empty(){return new $({mapValue:{}})}field(a){if(a.isEmpty())return this.value;{let b=this.value;for(let c=0;c<a.length-1;++c)if(b=(b.mapValue.fields||{})[a.get(c)],!fz(b))return null;return b=(b.mapValue.fields||{})[a.lastSegment()],b||null}}set(a,b){this.getFieldsMap(a.popLast())[a.lastSegment()]=bE(b)}setAll(d){let a=J.emptyPath(),b={},c=[];d.forEach((e,d)=>{if(!a.isImmediateParentOf(d)){const e=this.getFieldsMap(a);this.applyChanges(e,b,c),b={},c=[],a=d.popLast()}e?b[d.lastSegment()]=bE(e):c.push(d.lastSegment())});const e=this.getFieldsMap(a);this.applyChanges(e,b,c)}delete(b){const a=this.field(b.popLast());fz(a)&&a.mapValue.fields&&delete a.mapValue.fields[b.lastSegment()]}isEqual(a){return aa(this.value,a.value)}getFieldsMap(b){let a=this.value;a.mapValue.fields||(a.mapValue={fields:{}});for(let d=0;d<b.length;++d){let c=a.mapValue.fields[b.get(d)];fz(c)&&c.mapValue.fields||(c={mapValue:{fields:{}}},a.mapValue.fields[b.get(d)]=c),a=c}return a.mapValue.fields}applyChanges(a,b,c){cs(b,(b,c)=>a[b]=c);for(const b of c)delete a[b]}clone(){return new $(bE(this.value))}},v=class{constructor(a,b,c,d,e,f){this.key=a,this.documentType=b,this.version=c,this.readTime=d,this.data=e,this.documentState=f}static newInvalidDocument(a){return new v(a,0,h.min(),h.min(),$.empty(),0)}static newFoundDocument(a,b,c){return new v(a,1,b,h.min(),c,0)}static newNoDocument(a,b){return new v(a,2,b,h.min(),$.empty(),0)}static newUnknownDocument(a,b){return new v(a,3,b,h.min(),$.empty(),2)}convertToFoundDocument(a,b){return this.version=a,this.documentType=1,this.data=b,this.documentState=0,this}convertToNoDocument(a){return this.version=a,this.documentType=2,this.data=$.empty(),this.documentState=0,this}convertToUnknownDocument(a){return this.version=a,this.documentType=3,this.data=$.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(a){return this.readTime=a,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(a){return a instanceof v&&this.key.isEqual(a.key)&&this.version.isEqual(a.version)&&this.documentType===a.documentType&&this.documentState===a.documentState&&this.data.isEqual(a.data)}mutableCopy(){return new v(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}},hD=class{constructor(a,b,c,d){this.indexId=a,this.collectionGroup=b,this.fields=c,this.indexState=d}};function fx(a){return a.fields.find(a=>a.kind===2)}function aO(a){return a.fields.filter(a=>a.kind!==2)}hD.UNKNOWN_ID=-1,nR=class{constructor(a,b){this.fieldPath=a,this.kind=b}},fw=class{constructor(a,b){this.sequenceNumber=a,this.offset=b}static empty(){return new fw(0,_.min())}};function nQ(a,e){const b=a.toTimestamp().seconds,c=a.toTimestamp().nanoseconds+1,f=h.fromTimestamp(c===1e9?new A(b+1,0):new A(b,c));return new _(f,d.empty(),e)}function nP(a){return new _(a.readTime,a.key,-1)}_=class{constructor(a,b,c){this.readTime=a,this.documentKey=b,this.largestBatchId=c}static min(){return new _(h.min(),d.empty(),-1)}static max(){return new _(h.max(),d.empty(),-1)}};function hL(b,c){let a=b.readTime.compareTo(c.readTime);return a!==0?a:(a=d.comparator(b.documentKey,c.documentKey),a!==0?a:l(b.largestBatchId,c.largestBatchId))}G=class{constructor(a,b){this.comparator=a,this.root=b||L.EMPTY}insert(a,b){return new G(this.comparator,this.root.insert(a,b,this.comparator).copy(null,null,L.BLACK,null,null))}remove(a){return new G(this.comparator,this.root.remove(a,this.comparator).copy(null,null,L.BLACK,null,null))}get(b){let a=this.root;for(;!a.isEmpty();){const c=this.comparator(b,a.key);if(c===0)return a.value;c<0?a=a.left:c>0&&(a=a.right)}return null}indexOf(c){let b=0,a=this.root;for(;!a.isEmpty();){const d=this.comparator(c,a.key);if(d===0)return b+a.left.size;d<0?a=a.left:(b+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(a){return this.root.inorderTraversal(a)}forEach(a){this.inorderTraversal((b,c)=>(a(b,c),!1))}toString(){const a=[];return this.inorderTraversal((b,c)=>(a.push(`${b}:${c}`),!1)),`{${a.join(", ")}}`}reverseTraversal(a){return this.root.reverseTraversal(a)}getIterator(){return new cT(this.root,null,this.comparator,!1)}getIteratorFrom(a){return new cT(this.root,a,this.comparator,!1)}getReverseIterator(){return new cT(this.root,null,this.comparator,!0)}getReverseIteratorFrom(a){return new cT(this.root,a,this.comparator,!0)}},cT=class{constructor(a,c,e,d){this.isReverse=d,this.nodeStack=[];let b=1;for(;!a.isEmpty();)if(b=c?e(a.key,c):1,c&&d&&(b*=-1),b<0)a=this.isReverse?a.left:a.right;else{if(b===0){this.nodeStack.push(a);break}this.nodeStack.push(a),a=this.isReverse?a.right:a.left}}getNext(){let a=this.nodeStack.pop();const b={key:a.key,value:a.value};if(this.isReverse)for(a=a.left;!a.isEmpty();)this.nodeStack.push(a),a=a.right;else for(a=a.right;!a.isEmpty();)this.nodeStack.push(a),a=a.left;return b}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const a=this.nodeStack[this.nodeStack.length-1];return{key:a.key,value:a.value}}},L=class{constructor(d,e,a,b,c){this.key=d,this.value=e,this.color=a!=null?a:L.RED,this.left=b!=null?b:L.EMPTY,this.right=c!=null?c:L.EMPTY,this.size=this.left.size+1+this.right.size}copy(a,b,c,d,e){return new L(a!=null?a:this.key,b!=null?b:this.value,c!=null?c:this.color,d!=null?d:this.left,e!=null?e:this.right)}isEmpty(){return!1}inorderTraversal(a){return this.left.inorderTraversal(a)||a(this.key,this.value)||this.right.inorderTraversal(a)}reverseTraversal(a){return this.right.reverseTraversal(a)||a(this.key,this.value)||this.left.reverseTraversal(a)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(b,c,d){let a=this;const e=d(b,a.key);return a=e<0?a.copy(null,null,null,a.left.insert(b,c,d),null):e===0?a.copy(null,c,null,null,null):a.copy(null,null,null,null,a.right.insert(b,c,d)),a.fixUp()}removeMin(){if(this.left.isEmpty())return L.EMPTY;let a=this;return a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.removeMin(),null),a.fixUp()}remove(b,c){let d,a=this;if(c(b,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(b,c),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),c(b,a.key)===0){if(a.right.isEmpty())return L.EMPTY;d=a.right.min(),a=a.copy(d.key,d.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(b,c))}return a.fixUp()}isRed(){return this.color}fixUp(){let a=this;return a.right.isRed()&&!a.left.isRed()&&(a=a.rotateLeft()),a.left.isRed()&&a.left.left.isRed()&&(a=a.rotateRight()),a.left.isRed()&&a.right.isRed()&&(a=a.colorFlip()),a}moveRedLeft(){let a=this.colorFlip();return a.right.left.isRed()&&(a=a.copy(null,null,null,null,a.right.rotateRight()),a=a.rotateLeft(),a=a.colorFlip()),a}moveRedRight(){let a=this.colorFlip();return a.left.left.isRed()&&(a=a.rotateRight(),a=a.colorFlip()),a}rotateLeft(){const a=this.copy(null,null,L.RED,null,this.right.left);return this.right.copy(null,null,this.color,a,null)}rotateRight(){const a=this.copy(null,null,L.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,a)}colorFlip(){const a=this.left.copy(null,null,!this.left.color,null,null),b=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,a,b)}checkMaxDepth(){const a=this.check();return Math.pow(2,a)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw g();if(this.right.isRed())throw g();const a=this.left.check();if(a!==this.right.check())throw g();return a+(this.isRed()?0:1)}},L.EMPTY=null,L.RED=!0,L.BLACK=!1,L.EMPTY=new class{constructor(){this.size=0}get key(){throw g()}get value(){throw g()}get color(){throw g()}get left(){throw g()}get right(){throw g()}copy(a,b,c,d,e){return this}insert(a,b,c){return new L(a,b)}remove(a,b){return this}isEmpty(){return!0}inorderTraversal(a){return!1}reverseTraversal(a){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}},s=class{constructor(a){this.comparator=a,this.data=new G(this.comparator)}has(a){return this.data.get(a)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(a){return this.data.indexOf(a)}forEach(a){this.data.inorderTraversal((b,c)=>(a(b),!1))}forEachInRange(a,c){const b=this.data.getIteratorFrom(a[0]);for(;b.hasNext();){const d=b.getNext();if(this.comparator(d.key,a[1])>=0)return;c(d.key)}}forEachWhile(c,b){let a;for(a=b!==void 0?this.data.getIteratorFrom(b):this.data.getIterator();a.hasNext();)if(!c(a.getNext().key))return}firstAfterOrEqual(b){const a=this.data.getIteratorFrom(b);return a.hasNext()?a.getNext().key:null}getIterator(){return new iO(this.data.getIterator())}getIteratorFrom(a){return new iO(this.data.getIteratorFrom(a))}add(a){return this.copy(this.data.remove(a).insert(a,!0))}delete(a){return this.has(a)?this.copy(this.data.remove(a)):this}isEmpty(){return this.data.isEmpty()}unionWith(b){let a=this;return a.size<b.size&&(a=b,b=this),b.forEach(b=>{a=a.add(b)}),a}isEqual(a){if(!(a instanceof s))return!1;if(this.size!==a.size)return!1;const b=this.data.getIterator(),c=a.data.getIterator();for(;b.hasNext();){const a=b.getNext().key,d=c.getNext().key;if(this.comparator(a,d)!==0)return!1}return!0}toArray(){const a=[];return this.forEach(b=>{a.push(b)}),a}toString(){const a=[];return this.forEach(b=>a.push(b)),"SortedSet("+a.toString()+")"}copy(b){const a=new s(this.comparator);return a.data=b,a}},iO=class{constructor(a){this.iter=a}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function bq(a){return a.hasNext()?a.getNext():void 0}nO=class{constructor(a,b=null,c=[],d=[],e=null,f=null,g=null){this.path=a,this.collectionGroup=b,this.orderBy=c,this.filters=d,this.limit=e,this.startAt=f,this.endAt=g,this.P=null}};function hT(a,b=null,c=[],d=[],e=null,f=null,g=null){return new nO(a,b,c,d,e,f,g)}function aA(b){const a=j(b);if(a.P===null){let b=a.path.canonicalString();a.collectionGroup!==null&&(b+="|cg:"+a.collectionGroup),b+="|f:",b+=a.filters.map(b=>{return(a=b).field.canonicalString()+a.op.toString()+bc(a.value);var a}).join(","),b+="|ob:",b+=a.orderBy.map(a=>function(a){return a.field.canonicalString()+a.dir}(a)).join(","),cO(a.limit)||(b+="|l:",b+=a.limit),a.startAt&&(b+="|lb:",b+=a.startAt.inclusive?"b:":"a:",b+=a.startAt.position.map(a=>bc(a)).join(",")),a.endAt&&(b+="|ub:",b+=a.endAt.inclusive?"a:":"b:",b+=a.endAt.position.map(a=>bc(a)).join(",")),a.P=b}return a.P}function nN(a){let b=a.path.canonicalString();return a.collectionGroup!==null&&(b+=" collectionGroup="+a.collectionGroup),a.filters.length>0&&(b+=`, filters: [${a.filters.map(b=>{return`${(a=b).field.canonicalString()} ${a.op} ${bc(a.value)}`;var a}).join(", ")}]`),cO(a.limit)||(b+=", limit: "+a.limit),a.orderBy.length>0&&(b+=`, orderBy: [${a.orderBy.map(a=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(a)).join(", ")}]`),a.startAt&&(b+=", startAt: ",b+=a.startAt.inclusive?"b:":"a:",b+=a.startAt.position.map(a=>bc(a)).join(",")),a.endAt&&(b+=", endAt: ",b+=a.endAt.inclusive?"a:":"b:",b+=a.endAt.position.map(a=>bc(a)).join(",")),`Target(${b})`}function bN(a,b){if(a.limit!==b.limit)return!1;if(a.orderBy.length!==b.orderBy.length)return!1;for(let c=0;c<a.orderBy.length;c++)if(!nv(a.orderBy[c],b.orderBy[c]))return!1;if(a.filters.length!==b.filters.length)return!1;for(let e=0;e<a.filters.length;e++)if(c=a.filters[e],d=b.filters[e],c.op!==d.op||!c.field.isEqual(d.field)||!aa(c.value,d.value))return!1;var c,d;return a.collectionGroup===b.collectionGroup&&!!a.path.isEqual(b.path)&&!!io(a.startAt,b.startAt)&&io(a.endAt,b.endAt)}function c$(a){return d.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}function dc(a,b){return a.filters.filter(a=>a instanceof K&&a.field.isEqual(b))}function hZ(d,e,c){let a=cQ,b=!0;for(const f of dc(d,e)){let c=cQ,g=!0;switch(f.op){case"<":case"<=":c=nV(f.value);break;case"==":case"in":case">=":c=f.value;break;case">":c=f.value,g=!1;break;case"!=":case"not-in":c=cQ}hz({value:a,inclusive:b},{value:c,inclusive:g})<0&&(a=c,b=g)}if(c!==null)for(let f=0;f<d.orderBy.length;++f)if(d.orderBy[f].field.isEqual(e)){const d=c.position[f];hz({value:a,inclusive:b},{value:d,inclusive:c.inclusive})<0&&(a=d,b=c.inclusive);break}return{value:a,inclusive:b}}function h_(d,e,c){let a=ak,b=!0;for(const f of dc(d,e)){let c=ak,g=!0;switch(f.op){case">=":case">":c=nS(f.value),g=!1;break;case"==":case"in":case"<=":c=f.value;break;case"<":c=f.value,g=!1;break;case"!=":case"not-in":c=ak}hA({value:a,inclusive:b},{value:c,inclusive:g})>0&&(a=c,b=g)}if(c!==null)for(let f=0;f<d.orderBy.length;++f)if(d.orderBy[f].field.isEqual(e)){const d=c.position[f];hA({value:a,inclusive:b},{value:d,inclusive:c.inclusive})>0&&(a=d,b=c.inclusive);break}return{value:a,inclusive:b}}K=class extends class{}{constructor(a,b,c){super(),this.field=a,this.op=b,this.value=c}static create(b,a,c){return b.isKeyField()?a==="in"||a==="not-in"?this.V(b,a,c):new nM(b,a,c):a==="array-contains"?new nE(b,c):a==="in"?new nB(b,c):a==="not-in"?new nA(b,c):a==="array-contains-any"?new nz(b,c):new K(b,a,c)}static V(a,c,b){return c==="in"?new nK(a,b):new nF(a,b)}matches(b){const a=b.data.field(this.field);return this.op==="!="?a!==null&&this.v(av(a,this.value)):a!==null&&aI(this.value)===aI(a)&&this.v(av(a,this.value))}v(a){switch(this.op){case"<":return a<0;case"<=":return a<=0;case"==":return a===0;case"!=":return a!==0;case">":return a>0;case">=":return a>=0;default:return g()}}S(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}},nM=class extends K{constructor(b,c,a){super(b,c,a),this.key=d.fromName(a.referenceValue)}matches(a){const b=d.comparator(a.key,this.key);return this.v(b)}},nK=class extends K{constructor(b,a){super(b,"in",a),this.keys=id("in",a)}matches(a){return this.keys.some(b=>b.isEqual(a.key))}},nF=class extends K{constructor(b,a){super(b,"not-in",a),this.keys=id("not-in",a)}matches(a){return!this.keys.some(b=>b.isEqual(a.key))}};function id(c,b){var a;return(((a=b.arrayValue)===null||a===void 0?void 0:a.values)||[]).map(a=>d.fromName(a.referenceValue))}nE=class extends K{constructor(a,b){super(a,"array-contains",b)}matches(b){const a=b.data.field(this.field);return bH(a)&&bW(a.arrayValue,this.value)}},nB=class extends K{constructor(a,b){super(a,"in",b)}matches(b){const a=b.data.field(this.field);return a!==null&&bW(this.value.arrayValue,a)}},nA=class extends K{constructor(a,b){super(a,"not-in",b)}matches(b){if(bW(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const a=b.data.field(this.field);return a!==null&&!bW(this.value.arrayValue,a)}},nz=class extends K{constructor(a,b){super(a,"array-contains-any",b)}matches(b){const a=b.data.field(this.field);return!(!bH(a)||!a.arrayValue.values)&&a.arrayValue.values.some(a=>bW(this.value.arrayValue,a))}},be=class{constructor(a,b){this.position=a,this.inclusive=b}},bU=class{constructor(a,b="asc"){this.field=a,this.dir=b}};function nv(a,b){return a.dir===b.dir&&a.field.isEqual(b.field)}function im(b,e,c){let a=0;for(let f=0;f<b.position.length;f++){const g=e[f],h=b.position[f];if(g.field.isKeyField()?a=d.comparator(d.fromName(h.referenceValue),c.key):a=av(h,c.data.field(g.field)),g.dir==="desc"&&(a*=-1),a!==0)break}return a}function io(a,b){if(a===null)return b===null;if(b===null)return!1;if(a.inclusive!==b.inclusive||a.position.length!==b.position.length)return!1;for(let c=0;c<a.position.length;c++)if(!aa(a.position[c],b.position[c]))return!1;return!0}bV=class{constructor(a,b=null,c=[],d=[],e=null,f="F",g=null,h=null){this.path=a,this.collectionGroup=b,this.explicitOrderBy=c,this.filters=d,this.limit=e,this.limitType=f,this.startAt=g,this.endAt=h,this.D=null,this.C=null,this.startAt,this.endAt}};function nu(a,b,c,d,e,f,g,h){return new bV(a,b,c,d,e,f,g,h)}function dk(a){return new bV(a)}function nt(a){return a.filters.length===0&&a.limit===null&&a.startAt==null&&a.endAt==null&&(a.explicitOrderBy.length===0||a.explicitOrderBy.length===1&&a.explicitOrderBy[0].field.isKeyField())}function it(a){return a.explicitOrderBy.length>0?a.explicitOrderBy[0].field:null}function iu(a){for(const b of a.filters)if(b.S())return b.field;return null}function iv(a){return a.collectionGroup!==null}function bY(b){const a=j(b);if(a.D===null){a.D=[];const b=iu(a),c=it(a);if(b!==null&&c===null)b.isKeyField()||a.D.push(new bU(b)),a.D.push(new bU(J.keyField(),"asc"));else{let b=!1;for(const c of a.explicitOrderBy)a.D.push(c),c.field.isKeyField()&&(b=!0);if(!b){const b=a.explicitOrderBy.length>0?a.explicitOrderBy[a.explicitOrderBy.length-1].dir:"asc";a.D.push(new bU(J.keyField(),b))}}}return a.D}function af(b){const a=j(b);if(!a.C)if(a.limitType==="F")a.C=hT(a.path,a.collectionGroup,bY(a),a.filters,a.limit,a.startAt,a.endAt);else{const b=[];for(const c of bY(a)){const d=c.dir==="desc"?"asc":"desc";b.push(new bU(c.field,d))}const c=a.endAt?new be(a.endAt.position,a.endAt.inclusive):null,d=a.startAt?new be(a.startAt.position,a.startAt.inclusive):null;a.C=hT(a.path,a.collectionGroup,b,a.filters,a.limit,c,d)}return a.C}function ns(a,b,c){return new bV(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),b,c,a.startAt,a.endAt)}function dm(a,b){return bN(af(a),af(b))&&a.limitType===b.limitType}function iA(a){return`${aA(af(a))}|lt:${a.limitType}`}function fc(a){return`Query(target=${nN(af(a))}; limitType=${a.limitType})`}function fb(b,a){return a.isFoundDocument()&&function(a,c){const b=c.key.path;return a.collectionGroup!==null?c.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(b):d.isDocumentKey(a.path)?a.path.isEqual(b):a.path.isImmediateParentOf(b)}(b,a)&&function(a,b){for(const c of a.explicitOrderBy)if(!c.field.isKeyField()&&b.data.field(c.field)===null)return!1;return!0}(b,a)&&function(a,b){for(const c of a.filters)if(!c.matches(b))return!1;return!0}(b,a)&&function(a,b){return!(a.startAt&&!function(a,c,d){const b=im(a,c,d);return a.inclusive?b<=0:b<0}(a.startAt,bY(a),b))&&(!(a.endAt&&!function(a,c,d){const b=im(a,c,d);return a.inclusive?b>=0:b>0}(a.endAt,bY(a),b)))}(b,a)}function nr(a){return a.collectionGroup||(a.path.length%2==1?a.path.lastSegment():a.path.get(a.path.length-2))}function iE(a){return(c,d)=>{let b=!1;for(const e of bY(a)){const f=nq(e,c,d);if(f!==0)return f;b=b||e.field.isKeyField()}return 0}}function nq(a,b,c){const e=a.field.isKeyField()?d.comparator(b.key,c.key):function(a,d,e){const b=d.data.field(a),c=e.data.field(a);return b!==null&&c!==null?av(b,c):g()}(a.field,b,c);switch(a.dir){case"asc":return e;case"desc":return-1*e;default:return g()}}function iG(b,a){if(b.N){if(isNaN(a))return{doubleValue:"NaN"};if(a===1/0)return{doubleValue:"Infinity"};if(a===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:cd(a)?"-0":a}}function iH(a){return{integerValue:""+a}}function np(b,a){return nW(a)?iH(a):iG(b,a)}dn=class{constructor(){this._=void 0}};function no(a,b,c){return a instanceof cg?function(a,b){const c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return b&&(c.fields.__previous_value__=b),{mapValue:c}}(c,b):a instanceof bi?iP(a,b):a instanceof bk?iR(a,b):function(a,d){const b=nm(a,d),c=iT(b)+iT(a.k);return fD(b)&&fD(a.k)?iH(c):iG(a.M,c)}(a,b)}function nn(a,b,c){return a instanceof bi?iP(a,b):a instanceof bk?iR(a,b):c}function nm(c,a){return c instanceof ch?fD(b=a)||function(a){return!!a&&"doubleValue"in a}(b)?a:{integerValue:0}:null;var b}cg=class extends dn{},bi=class extends dn{constructor(a){super(),this.elements=a}};function iP(b,c){const a=iU(c);for(const c of b.elements)a.some(a=>aa(a,c))||a.push(c);return{arrayValue:{values:a}}}bk=class extends dn{constructor(a){super(),this.elements=a}};function iR(b,c){let a=iU(c);for(const c of b.elements)a=a.filter(a=>!aa(a,c));return{arrayValue:{values:a}}}ch=class extends dn{constructor(a,b){super(),this.M=a,this.k=b}};function iT(a){return u(a.integerValue||a.doubleValue)}function iU(a){return bH(a)&&a.arrayValue.values?a.arrayValue.values.slice():[]}ng=class{constructor(a,b){this.field=a,this.transform=b}};function nf(a,b){return a.field.isEqual(b.field)&&function(a,b){return a instanceof bi&&b instanceof bi||a instanceof bk&&b instanceof bk?bv(a.elements,b.elements,aa):a instanceof ch&&b instanceof ch?aa(a.k,b.k):a instanceof cg&&b instanceof cg}(a.transform,b.transform)}ne=class{constructor(a,b){this.version=a,this.transformResults=b}},aJ=class{constructor(a,b){this.updateTime=a,this.exists=b}static none(){return new aJ}static exists(a){return new aJ(void 0,a)}static updateTime(a){return new aJ(a)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(a){return this.exists===a.exists&&(this.updateTime?!!a.updateTime&&this.updateTime.isEqual(a.updateTime):!a.updateTime)}};function dw(a,b){return a.updateTime!==void 0?b.isFoundDocument()&&b.version.isEqual(a.updateTime):a.exists===void 0||a.exists===b.isFoundDocument()}dz=class{};function nd(a,b,c){a instanceof dB?function(a,b,c){const d=a.value.clone(),e=jg(a.fieldTransforms,b,c.transformResults);d.setAll(e),b.convertToFoundDocument(c.version,d).setHasCommittedMutations()}(a,b,c):a instanceof dE?function(b,a,c){if(!dw(b.precondition,a))return void a.convertToUnknownDocument(c.version);const e=jg(b.fieldTransforms,a,c.transformResults),d=a.data;d.setAll(jf(b)),d.setAll(e),a.convertToFoundDocument(c.version,d).setHasCommittedMutations()}(a,b,c):function(c,a,b){a.convertToNoDocument(b.version).setHasCommittedMutations()}(0,b,c)}function eU(a,b,c){a instanceof dB?function(b,a,d){if(!dw(b.precondition,a))return;const c=b.value.clone(),e=jh(b.fieldTransforms,d,a);c.setAll(e),a.convertToFoundDocument(jc(a),c).setHasLocalMutations()}(a,b,c):a instanceof dE?function(b,a,d){if(!dw(b.precondition,a))return;const e=jh(b.fieldTransforms,d,a),c=a.data;c.setAll(jf(b)),c.setAll(e),a.convertToFoundDocument(jc(a),c).setHasLocalMutations()}(a,b,c):function(b,a){dw(b.precondition,a)&&a.convertToNoDocument(h.min())}(a,b)}function jb(a,b){return a.type===b.type&&!!a.key.isEqual(b.key)&&!!a.precondition.isEqual(b.precondition)&&!!function(a,b){return a===void 0&&b===void 0||!(!a||!b)&&bv(a,b,(a,b)=>nf(a,b))}(a.fieldTransforms,b.fieldTransforms)&&(a.type===0?a.value.isEqual(b.value):a.type!==1||a.data.isEqual(b.data)&&a.fieldMask.isEqual(b.fieldMask))}function jc(a){return a.isFoundDocument()?a.version:h.min()}dB=class extends dz{constructor(a,b,c,d=[]){super(),this.key=a,this.value=b,this.precondition=c,this.fieldTransforms=d,this.type=0}},dE=class extends dz{constructor(a,b,c,d,e=[]){super(),this.key=a,this.data=b,this.fieldMask=c,this.precondition=d,this.fieldTransforms=e,this.type=1}};function jf(a){const b=new Map;return a.fieldMask.fields.forEach(c=>{if(!c.isEmpty()){const d=a.data.field(c);b.set(c,d)}}),b}function jg(b,d,a){const c=new Map;k(b.length===a.length);for(let e=0;e<a.length;e++){const f=b[e],g=f.transform,h=d.data.field(f.field);c.set(f.field,nn(g,h,a[e]))}return c}function jh(b,c,d){const a=new Map;for(const e of b){const f=e.transform,g=d.data.field(e.field);a.set(e.field,no(f,g,c))}return a}ji=class extends dz{constructor(a,b){super(),this.key=a,this.precondition=b,this.type=2,this.fieldTransforms=[]}},jj=class extends dz{constructor(a,b){super(),this.key=a,this.precondition=b,this.type=3,this.fieldTransforms=[]}},m_=class{constructor(a){this.count=a}};function mY(a){switch(a){default:return g();case b.CANCELLED:case b.UNKNOWN:case b.DEADLINE_EXCEEDED:case b.RESOURCE_EXHAUSTED:case b.INTERNAL:case b.UNAVAILABLE:case b.UNAUTHENTICATED:return!1;case b.INVALID_ARGUMENT:case b.NOT_FOUND:case b.ALREADY_EXISTS:case b.PERMISSION_DENIED:case b.FAILED_PRECONDITION:case b.ABORTED:case b.OUT_OF_RANGE:case b.UNIMPLEMENTED:case b.DATA_LOSS:return!0}}function jo(a){if(a===void 0)return S("GRPC error has no .code"),b.UNKNOWN;switch(a){case w.OK:return b.OK;case w.CANCELLED:return b.CANCELLED;case w.UNKNOWN:return b.UNKNOWN;case w.DEADLINE_EXCEEDED:return b.DEADLINE_EXCEEDED;case w.RESOURCE_EXHAUSTED:return b.RESOURCE_EXHAUSTED;case w.INTERNAL:return b.INTERNAL;case w.UNAVAILABLE:return b.UNAVAILABLE;case w.UNAUTHENTICATED:return b.UNAUTHENTICATED;case w.INVALID_ARGUMENT:return b.INVALID_ARGUMENT;case w.NOT_FOUND:return b.NOT_FOUND;case w.ALREADY_EXISTS:return b.ALREADY_EXISTS;case w.PERMISSION_DENIED:return b.PERMISSION_DENIED;case w.FAILED_PRECONDITION:return b.FAILED_PRECONDITION;case w.ABORTED:return b.ABORTED;case w.OUT_OF_RANGE:return b.OUT_OF_RANGE;case w.UNIMPLEMENTED:return b.UNIMPLEMENTED;case w.DATA_LOSS:return b.DATA_LOSS;default:return g()}}(m=w||(w={}))[m.OK=0]="OK",m[m.CANCELLED=1]="CANCELLED",m[m.UNKNOWN=2]="UNKNOWN",m[m.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",m[m.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",m[m.NOT_FOUND=5]="NOT_FOUND",m[m.ALREADY_EXISTS=6]="ALREADY_EXISTS",m[m.PERMISSION_DENIED=7]="PERMISSION_DENIED",m[m.UNAUTHENTICATED=16]="UNAUTHENTICATED",m[m.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",m[m.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",m[m.ABORTED=10]="ABORTED",m[m.OUT_OF_RANGE=11]="OUT_OF_RANGE",m[m.UNIMPLEMENTED=12]="UNIMPLEMENTED",m[m.INTERNAL=13]="INTERNAL",m[m.UNAVAILABLE=14]="UNAVAILABLE",m[m.DATA_LOSS=15]="DATA_LOSS",am=class{constructor(a,b){this.mapKeyFn=a,this.equalsFn=b,this.inner={},this.innerSize=0}get(a){const c=this.mapKeyFn(a),b=this.inner[c];if(b!==void 0)for(const[c,d]of b)if(this.equalsFn(c,a))return d}has(a){return this.get(a)!==void 0}set(a,c){const d=this.mapKeyFn(a),b=this.inner[d];if(b===void 0)return this.inner[d]=[[a,c]],void this.innerSize++;for(let d=0;d<b.length;d++)if(this.equalsFn(b[d][0],a))return void(b[d]=[a,c]);b.push([a,c]),this.innerSize++}delete(b){const c=this.mapKeyFn(b),a=this.inner[c];if(a===void 0)return!1;for(let d=0;d<a.length;d++)if(this.equalsFn(a[d][0],b))return a.length===1?delete this.inner[c]:a.splice(d,1),this.innerSize--,!0;return!1}forEach(a){cs(this.inner,(c,b)=>{for(const[c,d]of b)a(c,d)})}isEmpty(){return gO(this.inner)}size(){return this.innerSize}},mX=new G(d.comparator);function Z(){return mX}mW=new G(d.comparator);function eO(...b){let a=mW;for(const c of b)a=a.insert(c.key,c);return a}function co(){return new am(a=>a.toString(),(a,b)=>a.isEqual(b))}mP=new G(d.comparator),mO=new s(d.comparator);function r(...b){let a=mO;for(const c of b)a=a.add(c);return a}mK=new s(l);function jz(){return mK}eK=class{constructor(a,b,c,d,e){this.snapshotVersion=a,this.targetChanges=b,this.targetMismatches=c,this.documentUpdates=d,this.resolvedLimboDocuments=e}static createSynthesizedRemoteEventForCurrentChange(a,c){const b=new Map;return b.set(a,dF.createSynthesizedTargetChangeForCurrentChange(a,c)),new eK(h.min(),b,jz(),Z(),r())}},dF=class{constructor(a,b,c,d,e){this.resumeToken=a,this.current=b,this.addedDocuments=c,this.modifiedDocuments=d,this.removedDocuments=e}static createSynthesizedTargetChangeForCurrentChange(b,a){return new dF(D.EMPTY_BYTE_STRING,a,r(),r(),r())}},dH=class{constructor(a,b,c,d){this.O=a,this.removedTargetIds=b,this.key=c,this.F=d}},jD=class{constructor(a,b){this.targetId=a,this.$=b}},jE=class{constructor(a,b,c=D.EMPTY_BYTE_STRING,d=null){this.state=a,this.targetIds=b,this.resumeToken=c,this.cause=d}},jF=class{constructor(){this.B=0,this.L=jI(),this.U=D.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}get current(){return this.q}get resumeToken(){return this.U}get G(){return this.B!==0}get j(){return this.K}W(a){a.approximateByteSize()>0&&(this.K=!0,this.U=a)}H(){let a=r(),b=r(),c=r();return this.L.forEach((d,e)=>{switch(e){case 0:a=a.add(d);break;case 2:b=b.add(d);break;case 1:c=c.add(d);break;default:g()}}),new dF(this.U,this.q,a,b,c)}J(){this.K=!1,this.L=jI()}Y(a,b){this.K=!0,this.L=this.L.insert(a,b)}X(a){this.K=!0,this.L=this.L.remove(a)}Z(){this.B+=1}tt(){this.B-=1}et(){this.K=!0,this.q=!0}},mJ=class{constructor(a){this.nt=a,this.st=new Map,this.it=Z(),this.rt=kn(),this.ot=new s(l)}ut(a){for(const b of a.O)a.F&&a.F.isFoundDocument()?this.at(b,a.F):this.ct(b,a.key,a.F);for(const b of a.removedTargetIds)this.ct(b,a.key,a.F)}ht(a){this.forEachTarget(a,c=>{const b=this.lt(c);switch(a.state){case 0:this.ft(c)&&b.W(a.resumeToken);break;case 1:b.tt(),b.G||b.J(),b.W(a.resumeToken);break;case 2:b.tt(),b.G||this.removeTarget(c);break;case 3:this.ft(c)&&(b.et(),b.W(a.resumeToken));break;case 4:this.ft(c)&&(this.dt(c),b.W(a.resumeToken));break;default:g()}})}forEachTarget(a,b){a.targetIds.length>0?a.targetIds.forEach(b):this.st.forEach((c,a)=>{this.ft(a)&&b(a)})}_t(c){const a=c.targetId,b=c.$.count,e=this.wt(a);if(e){const c=e.target;if(c$(c))if(b===0){const b=new d(c.path);this.ct(a,b,v.newNoDocument(b,h.min()))}else k(b===1);else this.gt(a)!==b&&(this.dt(a),this.ot=this.ot.add(a))}}yt(a){const c=new Map;this.st.forEach((b,e)=>{const f=this.wt(e);if(f){if(b.current&&c$(f.target)){const b=new d(f.target.path);this.it.get(b)!==null||this.It(e,b)||this.ct(e,b,v.newNoDocument(b,a))}b.j&&(c.set(e,b.H()),b.J())}});let b=r();this.rt.forEach((c,d)=>{let a=!0;d.forEachWhile(c=>{const b=this.wt(c);return!b||b.purpose===2||(a=!1,!1)}),a&&(b=b.add(c))}),this.it.forEach((c,b)=>b.setReadTime(a));const e=new eK(a,c,this.ot,this.it,b);return this.it=Z(),this.rt=kn(),this.ot=new s(l),e}at(b,a){if(!this.ft(b))return;const c=this.It(b,a.key)?2:0;this.lt(b).Y(a.key,c),this.it=this.it.insert(a.key,a),this.rt=this.rt.insert(a.key,this.Tt(a.key).add(b))}ct(b,a,c){if(!this.ft(b))return;const d=this.lt(b);this.It(b,a)?d.Y(a,1):d.X(a),this.rt=this.rt.insert(a,this.Tt(a).delete(b)),c&&(this.it=this.it.insert(a,c))}removeTarget(a){this.st.delete(a)}gt(a){const b=this.lt(a).H();return this.nt.getRemoteKeysForTarget(a).size+b.addedDocuments.size-b.removedDocuments.size}Z(a){this.lt(a).Z()}lt(b){let a=this.st.get(b);return a||(a=new jF,this.st.set(b,a)),a}Tt(b){let a=this.rt.get(b);return a||(a=new s(l),this.rt=this.rt.insert(b,a)),a}ft(a){const b=this.wt(a)!==null;return b||c("WatchChangeAggregator","Detected inactive target",a),b}wt(a){const b=this.st.get(a);return b&&b.G?null:this.nt.Et(a)}dt(a){this.st.set(a,new jF),this.nt.getRemoteKeysForTarget(a).forEach(b=>{this.ct(a,b,null)})}It(a,b){return this.nt.getRemoteKeysForTarget(a).has(b)}};function kn(){return new G(d.comparator)}function jI(){return new G(d.comparator)}mE=(()=>{const a={asc:"ASCENDING",desc:"DESCENDING"};return a})(),mC=(()=>{const a={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};return a})(),mB=class{constructor(a,b){this.databaseId=a,this.N=b}};function ct(b,a){return b.N?`${new Date(1e3*a.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+a.nanoseconds).slice(-9)}Z`:{seconds:""+a.seconds,nanos:a.nanoseconds}}function jN(b,a){return b.N?a.toBase64():a.toUint8Array()}function mz(a,b){return ct(a,b.toTimestamp())}function U(a){return k(!!a),h.fromTimestamp(function(b){const a=an(b);return new A(a.seconds,a.nanos)}(a))}function eG(a,b){return function(a){return new q(["projects",a.projectId,"databases",a.database])}(a).child("documents").child(b).canonicalString()}function jR(b){const a=q.fromString(b);return k(ko(a)),a}function dI(a,b){return eG(a.databaseId,b.path)}function aV(c,f){const a=jR(f);if(a.get(1)!==c.databaseId.projectId)throw new e(b.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+a.get(1)+" vs "+c.databaseId.projectId);if(a.get(3)!==c.databaseId.database)throw new e(b.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+a.get(3)+" vs "+c.databaseId.database);return new d(jX(a))}function eF(a,b){return eG(a.databaseId,b)}function jV(b){const a=jR(b);return a.length===4?q.emptyPath():jX(a)}function eE(a){return new q(["projects",a.databaseId.projectId,"databases",a.databaseId.database]).canonicalString()}function jX(a){return k(a.length>4&&a.get(4)==="documents"),a.popFirst(5)}function jY(a,b,c){return{name:dI(a,b),fields:c.value.mapValue.fields}}function my(g,b,c){const d=aV(g,b.name),e=U(b.updateTime),f=new $({mapValue:{fields:b.fields}}),a=v.newFoundDocument(d,e,f);return c&&a.setHasCommittedMutations(),c?a.setHasCommittedMutations():a}function mv(d,a){let c;if("targetChange"in a){a.targetChange;const h=function(a){return a==="NO_CHANGE"?0:a==="ADD"?1:a==="REMOVE"?2:a==="CURRENT"?3:a==="RESET"?4:g()}(a.targetChange.targetChangeType||"NO_CHANGE"),i=a.targetChange.targetIds||[],j=function(b,a){return b.N?(k(a===void 0||typeof a=="string"),D.fromBase64String(a||"")):(k(a===void 0||a instanceof Uint8Array),D.fromUint8Array(a||new Uint8Array))}(d,a.targetChange.resumeToken),f=a.targetChange.cause,l=f&&function(a){const c=a.code===void 0?b.UNKNOWN:jo(a.code);return new e(c,a.message||"")}(f);c=new jE(h,i,j,l||null)}else if("documentChange"in a){a.documentChange;const b=a.documentChange;b.document,b.document.name,b.document.updateTime;const f=aV(d,b.document.name),g=U(b.document.updateTime),h=new $({mapValue:{fields:b.document.fields}}),e=v.newFoundDocument(f,g,h),i=b.targetIds||[],j=b.removedTargetIds||[];c=new dH(i,j,e.key,e)}else if("documentDelete"in a){a.documentDelete;const b=a.documentDelete;b.document;const f=aV(d,b.document),g=b.readTime?U(b.readTime):h.min(),e=v.newNoDocument(f,g),i=b.removedTargetIds||[];c=new dH([],i,e.key,e)}else if("documentRemove"in a){a.documentRemove;const b=a.documentRemove;b.document;const e=aV(d,b.document),f=b.removedTargetIds||[];c=new dH([],f,e,null)}else{if(!("filter"in a))return g();{a.filter;const b=a.filter;b.targetId;const d=b.count||0,e=new m_(d),f=b.targetId;c=new jD(f,e)}}return c}function dl(c,a){let b;if(a instanceof dB)b={update:jY(c,a.key,a.value)};else if(a instanceof ji)b={delete:dI(c,a.key)};else if(a instanceof dE)b={update:jY(c,a.key,a.data),updateMask:mn(a.fieldMask)};else{if(!(a instanceof jj))return g();b={verify:dI(c,a.key)}}return a.fieldTransforms.length>0&&(b.updateTransforms=a.fieldTransforms.map(a=>function(c,b){const a=b.transform;if(a instanceof cg)return{fieldPath:b.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof bi)return{fieldPath:b.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof bk)return{fieldPath:b.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof ch)return{fieldPath:b.field.canonicalString(),increment:a.k};throw g()}(0,a))),a.precondition.isNone||(b.currentDocument=function(b,a){return a.updateTime!==void 0?{updateTime:mz(b,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:g()}(c,a.precondition)),b}function eD(b,a){const c=a.currentDocument?function(a){return a.updateTime!==void 0?aJ.updateTime(U(a.updateTime)):a.exists!==void 0?aJ.exists(a.exists):aJ.none()}(a.currentDocument):aJ.none(),d=a.updateTransforms?a.updateTransforms.map(a=>function(c,a){let b=null;if("setToServerValue"in a)k(a.setToServerValue==="REQUEST_TIME"),b=new cg;else if("appendMissingElements"in a){const c=a.appendMissingElements.values||[];b=new bi(c)}else if("removeAllFromArray"in a){const c=a.removeAllFromArray.values||[];b=new bk(c)}else"increment"in a?b=new ch(c,a.increment):g();const d=J.fromServerFormat(a.fieldPath);return new ng(d,b)}(b,a)):[];if(a.update){a.update.name;const e=aV(b,a.update.name),f=new $({mapValue:{fields:a.update.fields}});if(a.updateMask){const b=function(a){const b=a.fieldPaths||[];return new n$(b.map(a=>J.fromServerFormat(a)))}(a.updateMask);return new dE(e,f,b,c,d)}return new dB(e,f,c,d)}if(a.delete){const d=aV(b,a.delete);return new ji(d,c)}if(a.verify){const d=aV(b,a.verify);return new jj(d,c)}return g()}function mu(a,b){return a&&a.length>0?(k(b!==void 0),a.map(a=>function(a,c){let b=a.updateTime?U(a.updateTime):U(c);return b.isEqual(h.min())&&(b=U(c)),new ne(b,a.transformResults||[])}(a,b))):[]}function kc(a,b){return{documents:[eF(a,b.path)]}}function kd(c,a){const b={structuredQuery:{}},d=a.path;a.collectionGroup!==null?(b.parent=eF(c,d),b.structuredQuery.from=[{collectionId:a.collectionGroup,allDescendants:!0}]):(b.parent=eF(c,d.popLast()),b.structuredQuery.from=[{collectionId:d.lastSegment()}]);const e=function(b){if(b.length===0)return;const a=b.map(a=>function(a){if(a.op==="=="){{if(ht(a.value))return{unaryFilter:{field:bs(a.field),op:"IS_NAN"}};if(hs(a.value))return{unaryFilter:{field:bs(a.field),op:"IS_NULL"}}}}else if(a.op==="!="){if(ht(a.value))return{unaryFilter:{field:bs(a.field),op:"IS_NOT_NAN"}};if(hs(a.value))return{unaryFilter:{field:bs(a.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:bs(a.field),op:mr(a.op),value:a.value}}}(a));return a.length===1?a[0]:{compositeFilter:{op:"AND",filters:a}}}(a.filters);e&&(b.structuredQuery.where=e);const f=function(a){if(a.length===0)return;return a.map(a=>function(a){return{field:bs(a.field),direction:ms(a.dir)}}(a))}(a.orderBy);f&&(b.structuredQuery.orderBy=f);const g=function(b,a){return b.N||cO(a)?a:{value:a}}(c,a.limit);var h;return g!==null&&(b.structuredQuery.limit=g),a.startAt&&(b.structuredQuery.startAt={before:(h=a.startAt).inclusive,values:h.position}),a.endAt&&(b.structuredQuery.endAt=function(a){return{before:!a.inclusive,values:a.position}}(a.endAt)),b}function ke(c){let b=jV(c.parent);const a=c.structuredQuery,d=a.from?a.from.length:0;let e=null;if(d>0){k(d===1);const c=a.from[0];c.allDescendants?e=c.collectionId:b=b.child(c.collectionId)}let f=[];a.where&&(f=kg(a.where));let g=[];a.orderBy&&(g=a.orderBy.map(a=>function(a){return new bU(bt(a.field),function(a){switch(a){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(a.direction))}(a)));let h=null;a.limit&&(h=function(a){let b;return b=typeof a=="object"?a.value:a,cO(b)?null:b}(a.limit));let i=null;a.startAt&&(i=function(a){const b=!!a.before,c=a.values||[];return new be(c,b)}(a.startAt));let j=null;return a.endAt&&(j=function(a){const b=!a.before,c=a.values||[];return new be(c,b)}(a.endAt)),nu(b,e,g,f,h,"F",i,j)}function mt(c,b){const a=function(b,a){switch(a){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return g()}}(0,b.purpose);return a==null?null:{"goog-listen-tags":a}}function kg(a){return a?a.unaryFilter!==void 0?[mo(a)]:a.fieldFilter!==void 0?[mp(a)]:a.compositeFilter!==void 0?a.compositeFilter.filters.map(a=>kg(a)).reduce((a,b)=>a.concat(b)):g():[]}function ms(a){return mE[a]}function mr(a){return mC[a]}function bs(a){return{fieldPath:a.canonicalString()}}function bt(a){return J.fromServerFormat(a.fieldPath)}function mp(a){return K.create(bt(a.fieldFilter.field),function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return g()}}(a.fieldFilter.op),a.fieldFilter.value)}function mo(a){switch(a.unaryFilter.op){case"IS_NAN":const b=bt(a.unaryFilter.field);return K.create(b,"==",{doubleValue:NaN});case"IS_NULL":const c=bt(a.unaryFilter.field);return K.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=bt(a.unaryFilter.field);return K.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const e=bt(a.unaryFilter.field);return K.create(e,"!=",{nullValue:"NULL_VALUE"});default:return g()}}function mn(b){const a=[];return b.fields.forEach(b=>a.push(b.canonicalString())),{fieldPaths:a}}function ko(a){return a.length>=4&&a.get(0)==="projects"&&a.get(2)==="databases"}function N(b){let a="";for(let c=0;c<b.length;c++)a.length>0&&(a=kr(a)),a=mm(b.get(c),a);return kr(a)}function mm(b,c){let a=c;const d=b.length;for(let c=0;c<d;c++){const e=b.charAt(c);switch(e){case"\0":a+="";break;case"":a+="";break;default:a+=e}}return a}function kr(a){return a+""}function ac(a){const c=a.length;if(k(c>=2),c===2)return k(a.charAt(0)===""&&a.charAt(1)===""),q.emptyPath();const e=c-2,d=[];let b="";for(let h=0;h<c;){const f=a.indexOf("",h);switch((f<0||f>e)&&g(),a.charAt(f+1)){case"":const e=a.substring(h,f);let c;b.length===0?c=e:(b+=e,c=b,b=""),d.push(c);break;case"":b+=a.substring(h,f),b+="\0";break;case"":b+=a.substring(h,f+1);break;default:g()}h=f+2}return new q(d)}kt=["userId","batchId"];function dK(a,b){return[a,N(b)]}function kv(a,b,c){return[a,N(b),c]}ml={},mi=["prefixPath","collectionGroup","readTime","documentId"],mh=["prefixPath","collectionGroup","documentId"],mc=["collectionGroup","readTime","prefixPath","documentId"],mb=["canonicalId","targetId"],ma=["targetId","path"],l$=["path","targetId"],l_=["collectionId","parent"],lY=["indexId","uid"],lX=["uid","sequenceNumber"],lW=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],lV=["indexId","uid","orderedDocumentKey"],lU=["userId","collectionPath","documentId"],lT=["userId","collectionPath","largestBatchId"],lS=["userId","collectionGroup","largestBatchId"],kL=[...[...[...[...["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments"],"clientMetadata"],"remoteDocumentGlobal"],"collectionParents"],"bundles","namedQueries"],lR=[...kL,"documentOverlays"],kN=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],lQ=[...kN,"indexConfiguration","indexState","indexEntries"],kP="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",kQ=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(a){this.onCommittedListeners.push(a)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(a=>a())}},a=class{constructor(a){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,a(a=>{this.isDone=!0,this.result=a,this.nextCallback&&this.nextCallback(a)},a=>{this.isDone=!0,this.error=a,this.catchCallback&&this.catchCallback(a)})}catch(a){return this.next(void 0,a)}next(b,c){return this.callbackAttached&&g(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(c,this.error):this.wrapSuccess(b,this.result):new a((a,d)=>{this.nextCallback=c=>{this.wrapSuccess(b,c).next(a,d)},this.catchCallback=b=>{this.wrapFailure(c,b).next(a,d)}})}toPromise(){return new Promise((a,b)=>{this.next(a,b)})}wrapUserFunction(b){try{const c=b();return c instanceof a?c:a.resolve(c)}catch(b){return a.reject(b)}}wrapSuccess(b,c){return b?this.wrapUserFunction(()=>b(c)):a.resolve(c)}wrapFailure(b,c){return b?this.wrapUserFunction(()=>b(c)):a.reject(c)}static resolve(b){return new a((a,c)=>{a(b)})}static reject(b){return new a((c,a)=>{a(b)})}static waitFor(b){return new a((d,f)=>{let a=0,c=0,e=!1;b.forEach(b=>{++a,b.next(()=>{++c,e&&c===a&&d()},a=>f(a))}),e=!0,c===a&&d()})}static or(c){let b=a.resolve(!1);for(const d of c)b=b.next(b=>b?a.resolve(b):d());return b}static forEach(b,c){const a=[];return b.forEach((b,d)=>{a.push(c.call(this,b,d))}),this.waitFor(a)}},ev=class{constructor(a,b){this.action=a,this.transaction=b,this.aborted=!1,this.At=new ab,this.transaction.oncomplete=()=>{this.At.resolve()},this.transaction.onabort=()=>{b.error?this.At.reject(new cn(a,b.error)):this.At.resolve()},this.transaction.onerror=b=>{const c=eq(b.target.error);this.At.reject(new cn(a,c))}}static open(b,a,c,d){try{return new ev(a,b.transaction(d,c))}catch(b){throw new cn(a,b)}}get Rt(){return this.At.promise}abort(a){a&&this.At.reject(a),this.aborted||(c("SimpleDb","Aborting transaction:",a?a.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}bt(){const a=this.transaction;this.aborted||typeof a.commit!="function"||a.commit()}store(a){const b=this.transaction.objectStore(a);return new lO(b)}},al=class{constructor(a,b,c){this.name=a,this.version=b,this.Pt=c,al.Vt(az())===12.2&&S("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(a){return c("SimpleDb","Removing database:",a),aP(window.indexedDB.deleteDatabase(a)).toPromise()}static vt(){if(!kV())return!1;if(al.St())return!0;const a=az(),b=al.Vt(a),d=0<b&&b<10,c=al.Dt(a),e=0<c&&c<4.5;return!(a.indexOf("MSIE ")>0||a.indexOf("Trident/")>0||a.indexOf("Edge/")>0||d||e)}static St(){var a;return typeof process!="undefined"&&((a=process.env)===null||a===void 0?void 0:a.Ct)==="YES"}static xt(a,b){return a.store(b)}static Vt(b){const a=b.match(/i(?:phone|pad|pod) os ([\d_]+)/i),c=a?a[1].split("_").slice(0,2).join("."):"-1";return Number(c)}static Dt(b){const a=b.match(/Android ([\d.]+)/i),c=a?a[1].split(".").slice(0,2).join("."):"-1";return Number(c)}async Nt(a){return this.db||(c("SimpleDb","Opening database:",this.name),this.db=await new Promise((g,f)=>{const d=indexedDB.open(this.name,this.version);d.onsuccess=a=>{const b=a.target.result;g(b)},d.onblocked=()=>{f(new cn(a,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},d.onerror=d=>{const c=d.target.error;c.name==="VersionError"?f(new e(b.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):c.name==="InvalidStateError"?f(new e(b.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+c)):f(new cn(a,c))},d.onupgradeneeded=a=>{c("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',a.oldVersion);const b=a.target.result;this.Pt.kt(b,d.transaction,a.oldVersion,this.version).next(()=>{c("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.Mt&&(this.db.onversionchange=a=>this.Mt(a)),this.db}Ot(a){this.Mt=a,this.db&&(this.db.onversionchange=b=>a(b))}async runTransaction(b,e,f,g){const h=e==="readonly";let d=0;for(;;){++d;try{this.db=await this.Nt(b);const c=ev.open(this.db,b,h?"readonly":"readwrite",f),d=g(c).next(a=>(c.bt(),a)).catch(b=>(c.abort(b),a.reject(b))).toPromise();return d.catch(()=>{}),await c.Rt,d}catch(a){const b=a.name!=="FirebaseError"&&d<3;if(c("SimpleDb","Transaction failed with error:",a.message,"Retrying:",b),this.close(),!b)return Promise.reject(a)}}}close(){this.db&&this.db.close(),this.db=void 0}},lP=class{constructor(a){this.Ft=a,this.$t=!1,this.Bt=null}get isDone(){return this.$t}get Lt(){return this.Bt}set cursor(a){this.Ft=a}done(){this.$t=!0}Ut(a){this.Bt=a}delete(){return aP(this.Ft.delete())}},cn=class extends e{constructor(a,c){super(b.UNAVAILABLE,`IndexedDB transaction '${a}' failed: ${c}`),this.name="IndexedDbTransactionError"}};function aG(a){return a.name==="IndexedDbTransactionError"}lO=class{constructor(a){this.store=a}put(a,b){let d;return b!==void 0?(c("SimpleDb","PUT",this.store.name,a,b),d=this.store.put(b,a)):(c("SimpleDb","PUT",this.store.name,"<auto-key>",a),d=this.store.put(a)),aP(d)}add(a){return c("SimpleDb","ADD",this.store.name,a,a),aP(this.store.add(a))}get(a){return aP(this.store.get(a)).next(b=>(b===void 0&&(b=null),c("SimpleDb","GET",this.store.name,a,b),b))}delete(a){return c("SimpleDb","DELETE",this.store.name,a),aP(this.store.delete(a))}count(){return c("SimpleDb","COUNT",this.store.name),aP(this.store.count())}qt(c,d){const b=this.options(c,d);if(b.index||typeof this.store.getAll!="function"){const c=this.cursor(b),a=[];return this.Kt(c,(c,b)=>{a.push(b)}).next(()=>a)}{const c=this.store.getAll(b.range);return new a((a,b)=>{c.onerror=a=>{b(a.target.error)},c.onsuccess=b=>{a(b.target.result)}})}}Gt(d,b){const c=this.store.getAll(d,b===null?void 0:b);return new a((a,b)=>{c.onerror=a=>{b(a.target.error)},c.onsuccess=b=>{a(b.target.result)}})}Qt(b,d){c("SimpleDb","DELETE ALL",this.store.name);const a=this.options(b,d);a.jt=!1;const e=this.cursor(a);return this.Kt(e,(b,c,a)=>a.delete())}Wt(c,a){let b;a?b=c:(b={},a=c);const d=this.cursor(b);return this.Kt(d,a)}zt(c){const b=this.cursor({});return new a((a,d)=>{b.onerror=a=>{const b=eq(a.target.error);d(b)},b.onsuccess=d=>{const b=d.target.result;b?c(b.primaryKey,b.value).next(c=>{c?b.continue():a()}):a()}})}Kt(b,d){const c=[];return new a((e,f)=>{b.onerror=a=>{f(a.target.error)},b.onsuccess=h=>{const b=h.target.result;if(!b)return void e();const f=new lP(b),g=d(b.primaryKey,b.value,f);if(g instanceof a){const b=g.catch(b=>(f.done(),a.reject(b)));c.push(b)}f.isDone?e():f.Lt===null?b.continue():b.continue(f.Lt)}}).next(()=>a.waitFor(c))}options(a,b){let c;return a!==void 0&&(typeof a=="string"?c=a:b=a),{index:c,range:b}}cursor(a){let b="next";if(a.reverse&&(b="prev"),a.index){const c=this.store.index(a.index);return a.jt?c.openKeyCursor(a.range,b):c.openCursor(a.range,b)}return this.store.openCursor(a.range,b)}};function aP(b){return new a((a,c)=>{b.onsuccess=b=>{const c=b.target.result;a(c)},b.onerror=a=>{const b=eq(a.target.error);c(b)}})}kZ=!1;function eq(a){const b=al.Vt(az());if(b>=12.2&&b<13){const b="An internal error was encountered in the Indexed Database server";if(a.message.indexOf(b)>=0){const a=new e("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${b}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return kZ||(kZ=!0,setTimeout(()=>{throw a},0)),a}}return a}k$=class extends kQ{constructor(a,b){super(),this.Ht=a,this.currentSequenceNumber=b}};function B(a,b){const c=j(a);return al.xt(c.Ht,b)}en=class{constructor(a,b,c,d){this.batchId=a,this.localWriteTime=b,this.baseMutations=c,this.mutations=d}applyToRemoteDocument(a,b){const c=b.mutationResults;for(let b=0;b<this.mutations.length;b++){const d=this.mutations[b];d.key.isEqual(a.key)&&nd(d,a,c[b])}}applyToLocalView(a){for(const b of this.baseMutations)b.key.isEqual(a.key)&&eU(b,a,this.localWriteTime);for(const b of this.mutations)b.key.isEqual(a.key)&&eU(b,a,this.localWriteTime)}applyToLocalDocumentSet(a){this.mutations.forEach(d=>{const b=a.get(d.key),c=b;this.applyToLocalView(c),b.isValidDocument()||c.convertToNoDocument(h.min())})}keys(){return this.mutations.reduce((a,b)=>a.add(b.key),r())}isEqual(a){return this.batchId===a.batchId&&bv(this.mutations,a.mutations,(a,b)=>jb(a,b))&&bv(this.baseMutations,a.baseMutations,(a,b)=>jb(a,b))}},lc=class{constructor(a,b,c,d){this.batch=a,this.commitVersion=b,this.mutationResults=c,this.docVersions=d}static from(a,e,b){k(a.mutations.length===b.length);let c=mP;const d=a.mutations;for(let a=0;a<d.length;a++)c=c.insert(d[a].key,b[a].version);return new lc(a,e,b,c)}},ej=class{constructor(a,b){this.largestBatchId=a,this.mutation=b}getKey(){return this.mutation.key}isEqual(a){return a!==null&&this.mutation===a.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}},aZ=class{constructor(a,b,c,d,e=h.min(),f=h.min(),g=D.EMPTY_BYTE_STRING){this.target=a,this.targetId=b,this.purpose=c,this.sequenceNumber=d,this.snapshotVersion=e,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=g}withSequenceNumber(a){return new aZ(this.target,this.targetId,this.purpose,a,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(a,b){return new aZ(this.target,this.targetId,this.purpose,this.sequenceNumber,b,this.lastLimboFreeSnapshotVersion,a)}withLastLimboFreeSnapshotVersion(a){return new aZ(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,a,this.resumeToken)}},lf=class{constructor(a){this.Jt=a}};function lN(c,a){let b;if(a.document)b=my(c.Jt,a.document,!!a.hasCommittedMutations);else if(a.noDocument){const c=d.fromSegments(a.noDocument.path),e=aU(a.noDocument.readTime);b=v.newNoDocument(c,e),a.hasCommittedMutations&&b.setHasCommittedMutations()}else{if(!a.unknownDocument)return g();{const c=d.fromSegments(a.unknownDocument.path),e=aU(a.unknownDocument.version);b=v.newUnknownDocument(c,e)}}return a.readTime&&b.setReadTime(function(a){const b=new A(a[0],a[1]);return h.fromTimestamp(b)}(a.readTime)),b}function lh(d,a){const b=a.key,c={prefixPath:b.getCollectionPath().popLast().toArray(),collectionGroup:b.collectionGroup,documentId:b.path.lastSegment(),readTime:dV(a.readTime),hasCommittedMutations:a.hasCommittedMutations};if(a.isFoundDocument())c.document=function(b,a){return{name:dI(b,a.key),fields:a.data.value.mapValue.fields,updateTime:ct(b,a.version.toTimestamp())}}(d.Jt,a);else if(a.isNoDocument())c.noDocument={path:b.path.toArray(),readTime:aC(a.version)};else{if(!a.isUnknownDocument())return g();c.unknownDocument={path:b.path.toArray(),version:aC(a.version)}}return c}function dV(b){const a=b.toTimestamp();return[a.seconds,a.nanoseconds]}function aC(b){const a=b.toTimestamp();return{seconds:a.seconds,nanoseconds:a.nanoseconds}}function aU(a){const b=new A(a.seconds,a.nanoseconds);return h.fromTimestamp(b)}function bx(b,a){const c=(a.baseMutations||[]).map(a=>eD(b.Jt,a));for(let b=0;b<a.mutations.length-1;++b){const c=a.mutations[b];if(b+1<a.mutations.length&&a.mutations[b+1].transform!==void 0){const d=a.mutations[b+1];c.updateTransforms=d.transform.fieldTransforms,a.mutations.splice(b+1,1),++b}}const d=a.mutations.map(a=>eD(b.Jt,a)),e=A.fromMillis(a.localWriteTimeMs);return new en(a.batchId,e,c,d)}function bR(a){const d=aU(a.readTime),e=a.lastLimboFreeSnapshotVersion!==void 0?aU(a.lastLimboFreeSnapshotVersion):h.min();let b;var c;return a.query.documents!==void 0?(k((c=a.query).documents.length===1),b=af(dk(jV(c.documents[0])))):b=function(a){return af(ke(a))}(a.query),new aZ(b,a.targetId,0,a.lastListenSequenceNumber,d,e,D.fromBase64String(a.resumeToken))}function ln(b,a){const d=aC(a.snapshotVersion),e=aC(a.lastLimboFreeSnapshotVersion);let c;c=c$(a.target)?kc(b.Jt,a.target):kd(b.Jt,a.target);const f=a.resumeToken.toBase64();return{targetId:a.targetId,canonicalId:aA(a.target),readTime:d,resumeToken:f,lastListenSequenceNumber:a.sequenceNumber,lastLimboFreeSnapshotVersion:e,query:c}}function lo(a){const b=ke({parent:a.parent,structuredQuery:a.structuredQuery});return a.limitType==="LAST"?ns(b,b.limit,"L"):b}function ef(b,a){return new ej(a.largestBatchId,eD(b.Jt,a.overlayMutation))}function lq(b,a){const c=a.path.lastSegment();return[b,N(a.path.popLast()),c]}lM=class{getBundleMetadata(a,b){return ls(a).get(b).next(b=>{if(b)return{id:(a=b).bundleId,createTime:aU(a.createTime),version:a.version};var a})}saveBundleMetadata(b,c){return ls(b).put({bundleId:(a=c).id,createTime:aC(U(a.createTime)),version:a.version});var a}getNamedQuery(a,b){return lt(a).get(b).next(b=>{if(b)return{name:(a=b).name,query:lo(a.bundledQuery),readTime:aU(a.readTime)};var a})}saveNamedQuery(a,b){return lt(a).put(function(a){return{name:a.name,readTime:aC(U(a.readTime)),bundledQuery:a.bundledQuery}}(b))}};function ls(a){return B(a,"bundles")}function lt(a){return B(a,"namedQueries")}lu=class{constructor(a,b){this.M=a,this.userId=b}static Yt(a,b){const c=b.uid||"";return new lu(a,c)}getOverlay(a,b){return cb(a).get(lq(this.userId,b)).next(a=>a?ef(this.M,a):null)}saveOverlays(c,d,e){const b=[];return e.forEach((f,a)=>{const e=new ej(d,a);b.push(this.Xt(c,e))}),a.waitFor(b)}removeOverlaysForBatchId(e,f,b){const c=new Set;f.forEach(a=>c.add(N(a.getCollectionPath())));const d=[];return c.forEach(a=>{const c=IDBKeyRange.bound([this.userId,a,b],[this.userId,a,b+1],!1,!0);d.push(cb(e).Qt("collectionPathOverlayIndex",c))}),a.waitFor(d)}getOverlaysForCollection(c,d,e){const a=co(),b=N(d),f=IDBKeyRange.bound([this.userId,b,e],[this.userId,b,Number.POSITIVE_INFINITY],!0);return cb(c).qt("collectionPathOverlayIndex",f).next(b=>{for(const d of b){const c=ef(this.M,d);a.set(c.getKey(),c)}return a})}getOverlaysForCollectionGroup(d,b,e,f){const a=co();let c;const g=IDBKeyRange.bound([this.userId,b,e],[this.userId,b,Number.POSITIVE_INFINITY],!0);return cb(d).Wt({index:"collectionGroupOverlayIndex",range:g},(g,d,e)=>{const b=ef(this.M,d);a.size()<f||b.largestBatchId===c?(a.set(b.getKey(),b),c=b.largestBatchId):e.done()}).next(()=>a)}Xt(a,b){return cb(a).put(function(c,b,a){const[f,d,e]=lq(b,a.mutation.key);return{userId:b,collectionPath:d,documentId:e,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:dl(c.Jt,a.mutation)}}(this.M,this.userId,b))}};function cb(a){return B(a,"documentOverlays")}a_=class{constructor(){}Zt(b,a){this.te(b,a),a.ee()}te(b,a){if("nullValue"in b)this.ne(a,5);else if("booleanValue"in b)this.ne(a,10),a.se(b.booleanValue?1:0);else if("integerValue"in b)this.ne(a,15),a.se(u(b.integerValue));else if("doubleValue"in b){const c=u(b.doubleValue);isNaN(c)?this.ne(a,13):(this.ne(a,15),cd(c)?a.se(0):a.se(c))}else if("timestampValue"in b){const c=b.timestampValue;this.ne(a,20),typeof c=="string"?a.ie(c):(a.ie(`${c.seconds||""}`),a.se(c.nanos||0))}else if("stringValue"in b)this.re(b.stringValue,a),this.oe(a);else if("bytesValue"in b)this.ne(a,30),a.ue(aE(b.bytesValue)),this.oe(a);else if("referenceValue"in b)this.ae(b.referenceValue,a);else if("geoPointValue"in b){const c=b.geoPointValue;this.ne(a,45),a.se(c.latitude||0),a.se(c.longitude||0)}else"mapValue"in b?hw(b)?this.ne(a,Number.MAX_SAFE_INTEGER):(this.ce(b.mapValue,a),this.oe(a)):"arrayValue"in b?(this.he(b.arrayValue,a),this.oe(a)):g()}re(b,a){this.ne(a,25),this.le(b,a)}le(a,b){b.ie(a)}ce(c,a){const b=c.fields||{};this.ne(a,55);for(const c of Object.keys(b))this.re(c,a),this.te(b[c],a)}he(b,a){const c=b.values||[];this.ne(a,50);for(const b of c)this.te(b,a)}ae(b,a){this.ne(a,37),d.fromName(b).path.forEach(b=>{this.ne(a,60),this.le(b,a)})}ne(a,b){a.se(b)}oe(a){a.se(2)}},a_.fe=new a_;function lL(a){if(a===0)return 8;let b=0;return a>>4==0&&(b+=4,a<<=4),a>>6==0&&(b+=2,a<<=2),a>>7==0&&(b+=1),b}function ly(a){const b=64-function(b){let a=0;for(let c=0;c<8;++c){const d=lL(255&b[c]);if(a+=d,d!==8)break}return a}(a);return Math.ceil(b/8)}lJ=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}de(c){const b=c[Symbol.iterator]();let a=b.next();for(;!a.done;)this._e(a.value),a=b.next();this.we()}me(c){const b=c[Symbol.iterator]();let a=b.next();for(;!a.done;)this.ge(a.value),a=b.next();this.ye()}pe(a){for(const c of a){const b=c.charCodeAt(0);if(b<128)this._e(b);else if(b<2048)this._e(960|b>>>6),this._e(128|63&b);else if(c<"\uD800"||"\uDBFF"<c)this._e(480|b>>>12),this._e(128|63&b>>>6),this._e(128|63&b);else{const a=c.codePointAt(0);this._e(240|a>>>18),this._e(128|63&a>>>12),this._e(128|63&a>>>6),this._e(128|63&a)}}this.we()}Ie(a){for(const c of a){const b=c.charCodeAt(0);if(b<128)this.ge(b);else if(b<2048)this.ge(960|b>>>6),this.ge(128|63&b);else if(c<"\uD800"||"\uDBFF"<c)this.ge(480|b>>>12),this.ge(128|63&b>>>6),this.ge(128|63&b);else{const a=c.codePointAt(0);this.ge(240|a>>>18),this.ge(128|63&a>>>12),this.ge(128|63&a>>>6),this.ge(128|63&a)}}this.ye()}Te(c){const a=this.Ee(c),b=ly(a);this.Ae(1+b),this.buffer[this.position++]=255&b;for(let c=a.length-b;c<a.length;++c)this.buffer[this.position++]=255&a[c]}Re(c){const a=this.Ee(c),b=ly(a);this.Ae(1+b),this.buffer[this.position++]=~(255&b);for(let c=a.length-b;c<a.length;++c)this.buffer[this.position++]=~(255&a[c])}be(){this.Pe(255),this.Pe(255)}Ve(){this.ve(255),this.ve(255)}reset(){this.position=0}seed(a){this.Ae(a.length),this.buffer.set(a,this.position),this.position+=a.length}Se(){return this.buffer.slice(0,this.position)}Ee(c){const a=function(b){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,b,!1),new Uint8Array(a.buffer)}(c),b=(128&a[0])!=0;a[0]^=b?255:128;for(let c=1;c<a.length;++c)a[c]^=b?255:0;return a}_e(b){const a=255&b;a===0?(this.Pe(0),this.Pe(255)):a===255?(this.Pe(255),this.Pe(0)):this.Pe(a)}ge(a){const b=255&a;b===0?(this.ve(0),this.ve(255)):b===255?(this.ve(255),this.ve(0)):this.ve(a)}we(){this.Pe(0),this.Pe(1)}ye(){this.ve(0),this.ve(1)}Pe(a){this.Ae(1),this.buffer[this.position++]=a}ve(a){this.Ae(1),this.buffer[this.position++]=~a}Ae(d){const a=d+this.position;if(a<=this.buffer.length)return;let b=2*this.buffer.length;b<a&&(b=a);const c=new Uint8Array(b);c.set(this.buffer),this.buffer=c}},lI=class{constructor(a){this.De=a}ue(a){this.De.de(a)}ie(a){this.De.pe(a)}se(a){this.De.Te(a)}ee(){this.De.be()}},lG=class{constructor(a){this.De=a}ue(a){this.De.me(a)}ie(a){this.De.Ie(a)}se(a){this.De.Re(a)}ee(){this.De.Ve()}},cy=class{constructor(){this.De=new lJ,this.Ce=new lI(this.De),this.xe=new lG(this.De)}seed(a){this.De.seed(a)}Ne(a){return a===0?this.Ce:this.xe}Se(){return this.De.Se()}reset(){this.De.reset()}},bd=class{constructor(a,b,c,d){this.indexId=a,this.documentKey=b,this.arrayValue=c,this.directionalValue=d}ke(){const a=this.directionalValue.length,c=a===0||this.directionalValue[a-1]===255?a+1:a,b=new Uint8Array(c);return b.set(this.directionalValue,0),c!==a?b.set([0],this.directionalValue.length):++b[b.length-1],new bd(this.indexId,this.documentKey,this.arrayValue,b)}};function a$(b,c){let a=b.indexId-c.indexId;return a!==0?a:(a=lB(b.arrayValue,c.arrayValue),a!==0?a:(a=lB(b.directionalValue,c.directionalValue),a!==0?a:d.comparator(b.documentKey,c.documentKey)))}function lB(a,b){for(let c=0;c<a.length&&c<b.length;++c){const d=a[c]-b[c];if(d!==0)return d}return a.length-b.length}tf=class{constructor(a){this.collectionId=a.collectionGroup!=null?a.collectionGroup:a.path.lastSegment(),this.Me=a.orderBy,this.Oe=[];for(const c of a.filters){const b=c;b.S()?this.Fe=b:this.Oe.push(b)}}$e(d){const e=fx(d);if(e!==void 0&&!this.Be(e))return!1;const b=aO(d);let a=0,c=0;for(;a<b.length&&this.Be(b[a]);++a);if(a===b.length)return!0;if(this.Fe!==void 0){const d=b[a];if(!this.Le(this.Fe,d)||!this.Ue(this.Me[c++],d))return!1;++a}for(;a<b.length;++a){const d=b[a];if(c>=this.Me.length||!this.Ue(this.Me[c++],d))return!1}return!0}Be(a){for(const b of this.Oe)if(this.Le(b,a))return!0;return!1}Le(a,b){if(a===void 0||!a.field.isEqual(b.fieldPath))return!1;const c=a.op==="array-contains"||a.op==="array-contains-any";return b.kind===2===c}Ue(a,b){return!!a.field.isEqual(b.fieldPath)&&(b.kind===0&&a.dir==="asc"||b.kind===1&&a.dir==="desc")}},lH=class{constructor(){this.qe=new ee}addToCollectionParentIndex(c,b){return this.qe.add(b),a.resolve()}getCollectionParents(c,b){return a.resolve(this.qe.getEntries(b))}addFieldIndex(b,c){return a.resolve()}deleteFieldIndex(b,c){return a.resolve()}getDocumentsMatchingTarget(b,c){return a.resolve(null)}getIndexType(b,c){return a.resolve(0)}getFieldIndexes(b,c){return a.resolve([])}getNextCollectionGroupToUpdate(b){return a.resolve(null)}getMinOffset(b,c){return a.resolve(_.min())}updateCollectionGroup(b,c,d){return a.resolve()}updateIndexEntries(b,c){return a.resolve()}},ee=class{constructor(){this.index={}}add(a){const b=a.lastSegment(),c=a.popLast(),d=this.index[b]||new s(q.comparator),e=!d.has(c);return this.index[b]=d.add(c),e}has(a){const c=a.lastSegment(),d=a.popLast(),b=this.index[c];return b&&b.has(d)}getEntries(a){return(this.index[a]||new s(q.comparator)).toArray()}},dZ=new Uint8Array(0),lK=class{constructor(a,b){this.user=a,this.databaseId=b,this.Ke=new ee,this.Ge=new am(a=>aA(a),(a,b)=>bN(a,b)),this.uid=a.uid||""}addToCollectionParentIndex(c,b){if(!this.Ke.has(b)){const a=b.lastSegment(),d=b.popLast();c.addOnCommittedListener(()=>{this.Ke.add(b)});const e={collectionId:a,parent:N(d)};return lx(c).put(e)}return a.resolve()}getCollectionParents(c,a){const b=[],d=IDBKeyRange.bound([a,""],[gJ(a),""],!1,!0);return lx(c).qt(d).next(c=>{for(const d of c){if(d.collectionId!==a)break;b.push(ac(d.parent))}return b})}addFieldIndex(b,c){const d=eb(b),a=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])}}(c);return delete a.indexId,d.add(a).next()}deleteFieldIndex(b,a){const c=eb(b),d=dT(b),e=bT(b);return c.delete(a.indexId).next(()=>d.delete(IDBKeyRange.bound([a.indexId],[a.indexId+1],!1,!0))).next(()=>e.delete(IDBKeyRange.bound([a.indexId],[a.indexId+1],!1,!0)))}getDocumentsMatchingTarget(f,b){const h=bT(f);let e=!0;const g=new Map;return a.forEach(this.Qe(b),a=>this.je(f,a).next(b=>{e&&(e=!!b),g.set(a,b)})).next(()=>{if(e){let e=r();const f=[];return a.forEach(g,(g,i)=>{var j;c("IndexedDbIndexManager",`Using index ${j=g,`id=${j.indexId}|cg=${j.collectionGroup}|f=${j.fields.map(a=>`${a.fieldPath}:${a.kind}`).join(",")}`} to execute ${aA(b)}`);const m=function(b,c){const a=fx(c);if(a===void 0)return null;for(const c of dc(b,a.fieldPath))switch(c.op){case"array-contains-any":return c.value.arrayValue.values||[];case"array-contains":return[c.value]}return null}(i,g),n=function(b,c){const a=new Map;for(const d of aO(c))for(const c of dc(b,d.fieldPath))switch(c.op){case"==":case"in":a.set(d.fieldPath.canonicalString(),c.value);break;case"not-in":case"!=":return a.set(d.fieldPath.canonicalString(),c.value),Array.from(a.values())}return null}(i,g),k=function(a,d){const c=[];let b=!0;for(const e of aO(d)){const f=e.kind===0?hZ(a,e.fieldPath,a.startAt):h_(a,e.fieldPath,a.startAt);c.push(f.value),b&&(b=f.inclusive)}return new be(c,b)}(i,g),l=function(a,d){const c=[];let b=!0;for(const e of aO(d)){const f=e.kind===0?h_(a,e.fieldPath,a.endAt):hZ(a,e.fieldPath,a.endAt);c.push(f.value),b&&(b=f.inclusive)}return new be(c,b)}(i,g),o=this.We(g,i,k),p=this.We(g,i,l),q=this.ze(g,i,n),r=this.He(g.indexId,m,o,k.inclusive,p,l.inclusive,q);return a.forEach(r,a=>h.Gt(a,b.limit).next(a=>{a.forEach(b=>{const a=d.fromSegments(b.documentKey);e.has(a)||(e=e.add(a),f.push(a))})}))}).next(()=>f)}return a.resolve(null)})}Qe(b){let a=this.Ge.get(b);return a||(a=[b],this.Ge.set(b,a),a)}He(b,a,g,j,e,h,i){const f=(a!=null?a.length:1)*Math.max(g.length,e.length),c=f/(a!=null?a.length:1),d=[];for(let k=0;k<f;++k){const l=a?this.Je(a[k/c]):dZ,m=this.Ye(b,l,g[k%c],j),n=this.Xe(b,l,e[k%c],h),o=i.map(a=>this.Ye(b,l,a,!0));d.push(...this.createRange(m,n,o))}return d}Ye(b,c,e,f){const a=new bd(b,d.empty(),c,e);return f?a:a.ke()}Xe(b,c,e,f){const a=new bd(b,d.empty(),c,e);return f?a.ke():a}je(b,a){const c=new tf(a),d=a.collectionGroup!=null?a.collectionGroup:a.path.lastSegment();return this.getFieldIndexes(b,d).next(b=>{let a=null;for(const d of b)c.$e(d)&&(!a||d.fields.length>a.fields.length)&&(a=d);return a})}getIndexType(c,d){let b=2;return a.forEach(this.Qe(d),a=>this.je(c,a).next(c=>{c?b!==0&&c.fields.length<function(b){let a=new s(J.comparator),c=!1;for(const e of b.filters){const d=e;d.field.isKeyField()||(d.op==="array-contains"||d.op==="array-contains-any"?c=!0:a=a.add(d.field))}for(const c of b.orderBy)c.field.isKeyField()||(a=a.add(c.field));return a.size+(c?1:0)}(a)&&(b=1):b=0})).next(()=>b)}Ze(b,c){const a=new cy;for(const d of aO(b)){const e=c.data.field(d.fieldPath);if(e==null)return null;const f=a.Ne(d.kind);a_.fe.Zt(e,f)}return a.Se()}Je(b){const a=new cy;return a_.fe.Zt(b,a.Ne(0)),a.Se()}tn(b,c){const a=new cy;return a_.fe.Zt(bK(this.databaseId,c),a.Ne(function(b){const a=aO(b);return a.length===0?0:a[a.length-1].kind}(b))),a.Se()}ze(c,d,b){if(b===null)return[];let a=[];a.push(new cy);let e=0;for(const f of aO(c)){const g=b[e++];for(const b of a)if(this.en(d,f.fieldPath)&&bH(g))a=this.nn(a,f,g);else{const a=b.Ne(f.kind);a_.fe.Zt(g,a)}}return this.sn(a)}We(a,b,c){return this.ze(a,b,c.position)}sn(a){const b=[];for(let c=0;c<a.length;++c)b[c]=a[c].Se();return b}nn(b,c,d){const e=[...b],a=[];for(const b of d.arrayValue.values||[])for(const f of e){const d=new cy;d.seed(f.Se()),a_.fe.Zt(b,d.Ne(c.kind)),a.push(d)}return a}en(a,b){return!!a.filters.find(a=>a instanceof K&&a.field.isEqual(b)&&(a.op==="in"||a.op==="not-in"))}getFieldIndexes(c,b){const e=eb(c),f=dT(c);return(b?e.qt("collectionGroupIndex",IDBKeyRange.bound(b,b)):e.qt()).next(c=>{const b=[];return a.forEach(c,a=>f.get([a.indexId,this.uid]).next(c=>{b.push(function(b,a){const c=a?new fw(a.sequenceNumber,new _(aU(a.readTime),new d(ac(a.documentKey)),a.largestBatchId)):fw.empty(),e=b.fields.map(([a,b])=>new nR(J.fromServerFormat(a),b));return new hD(b.indexId,b.collectionGroup,e,c)}(a,c))})).next(()=>b)})}getNextCollectionGroupToUpdate(a){return this.getFieldIndexes(a).next(a=>a.length===0?null:(a.sort((a,b)=>{const c=a.indexState.sequenceNumber-b.indexState.sequenceNumber;return c!==0?c:l(a.collectionGroup,b.collectionGroup)}),a[0].collectionGroup))}updateCollectionGroup(b,c,d){const e=eb(b),f=dT(b);return this.rn(b).next(b=>e.qt("collectionGroupIndex",IDBKeyRange.bound(c,c)).next(c=>a.forEach(c,a=>f.put(function(b,c,d,a){return{indexId:b,uid:c.uid||"",sequenceNumber:d,readTime:aC(a.readTime),documentKey:N(a.documentKey.path),largestBatchId:a.largestBatchId}}(a.indexId,this.user,b,d)))))}updateIndexEntries(b,d){const c=new Map;return a.forEach(d,(d,e)=>{const f=c.get(d.collectionGroup);return(f?a.resolve(f):this.getFieldIndexes(b,d.collectionGroup)).next(f=>(c.set(d.collectionGroup,f),a.forEach(f,c=>this.on(b,d,c).next(d=>{const f=this.un(e,c);return d.isEqual(f)?a.resolve():this.an(b,e,c,d,f)}))))})}cn(c,b,d,a){return bT(c).put({indexId:a.indexId,uid:this.uid,arrayValue:a.arrayValue,directionalValue:a.directionalValue,orderedDocumentKey:this.tn(d,b.key),documentKey:b.key.path.toArray()})}hn(c,b,d,a){return bT(c).delete([a.indexId,this.uid,a.arrayValue,a.directionalValue,this.tn(d,b.key),b.key.path.toArray()])}on(d,c,a){const e=bT(d);let b=new s(a$);return e.Wt({index:"documentKeyIndex",range:IDBKeyRange.only([a.indexId,this.uid,this.tn(a,c)])},(e,d)=>{b=b.add(new bd(a.indexId,c,d.arrayValue,d.directionalValue))}).next(()=>b)}un(b,c){let a=new s(a$);const d=this.Ze(c,b);if(d==null)return a;const e=fx(c);if(e!=null){{const f=b.data.field(e.fieldPath);if(bH(f))for(const e of f.arrayValue.values||[])a=a.add(new bd(c.indexId,b.key,this.Je(e),d))}}else a=a.add(new bd(c.indexId,b.key,dZ,d));return a}an(e,b,f,g,h){c("IndexedDbIndexManager","Updating index entries for document '%s'",b.key);const d=[];return function(g,h,i,e,f){const d=g.getIterator(),c=h.getIterator();let a=bq(d),b=bq(c);for(;a||b;){let g=!1,h=!1;if(a&&b){const c=i(a,b);c<0?h=!0:c>0&&(g=!0)}else a!=null?h=!0:g=!0;g?(e(b),b=bq(c)):h?(f(a),a=bq(d)):(a=bq(d),b=bq(c))}}(g,h,a$,a=>{d.push(this.cn(e,b,f,a))},a=>{d.push(this.hn(e,b,f,a))}),a.waitFor(d)}rn(b){let a=1;return dT(b).Wt({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(d,b,c)=>{c.done(),a=b.sequenceNumber+1}).next(()=>a)}createRange(b,d,c){c=c.sort((a,b)=>a$(a,b)).filter((b,a,c)=>!a||a$(b,c[a-1])!==0);const a=[];a.push(b);for(const e of c){const f=a$(e,b),g=a$(e,d);if(f===0)a[0]=b.ke();else if(f>0&&g<0)a.push(e),a.push(e.ke());else if(g>0)break}a.push(d);const e=[];for(let b=0;b<a.length;b+=2)e.push(IDBKeyRange.bound([a[b].indexId,this.uid,a[b].arrayValue,a[b].directionalValue,dZ,[]],[a[b+1].indexId,this.uid,a[b+1].arrayValue,a[b+1].directionalValue,dZ,[]]));return e}getMinOffset(c,d){let b;return a.forEach(this.Qe(d),a=>this.je(c,a).next(a=>{a?(!b||hL(a.indexState.offset,b)<0)&&(b=a.indexState.offset):b=_.min()})).next(()=>b)}};function lx(a){return B(a,"collectionParents")}function bT(a){return B(a,"indexEntries")}function eb(a){return B(a,"indexConfiguration")}function dT(a){return B(a,"indexState")}kU={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},V=class{constructor(a,b,c){this.cacheSizeCollectionThreshold=a,this.percentileToCollect=b,this.maximumSequenceNumbersToCollect=c}static withCacheSize(a){return new V(a,V.DEFAULT_COLLECTION_PERCENTILE,V.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function kM(d,i,b){const l=d.store("mutations"),g=d.store("documentMutations"),c=[],h=IDBKeyRange.only(b.batchId);let e=0;const j=l.Wt({range:h},(b,c,a)=>(e++,a.delete()));c.push(j.next(()=>{k(e===1)}));const f=[];for(const a of b.mutations){const d=kv(i,a.key.path,b.batchId);c.push(g.delete(d)),f.push(a.key)}return a.waitFor(c).next(()=>f)}function dS(a){if(!a)return 0;let b;if(a.document)b=a.document;else if(a.unknownDocument)b=a.unknownDocument;else{if(!a.noDocument)throw g();b=a.noDocument}return JSON.stringify(b).length}V.DEFAULT_COLLECTION_PERCENTILE=10,V.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,V.DEFAULT=new V(41943040,V.DEFAULT_COLLECTION_PERCENTILE,V.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),V.DISABLED=new V(-1,0,0),kJ=class{constructor(a,b,c,d){this.userId=a,this.M=b,this.indexManager=c,this.referenceDelegate=d,this.ln={}}static Yt(a,b,c,d){k(a.uid!=="");const e=a.isAuthenticated()?a.uid:"";return new kJ(e,b,c,d)}checkEmpty(b){let a=!0;const c=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return au(b).Wt({index:"userMutationsIndex",range:c},(c,d,b)=>{a=!1,b.done()}).next(()=>a)}addMutationBatch(b,e,f,c){const g=bB(b),d=au(b);return d.add({}).next(h=>{k(typeof h=="number");const j=new en(h,e,f,c),n=function(b,c,a){const d=a.baseMutations.map(a=>dl(b.Jt,a)),e=a.mutations.map(a=>dl(b.Jt,a));return{userId:c,batchId:a.batchId,localWriteTimeMs:a.localWriteTime.toMillis(),baseMutations:d,mutations:e}}(this.M,this.userId,j),i=[];let m=new s((a,b)=>l(a.canonicalString(),b.canonicalString()));for(const a of c){const b=kv(this.userId,a.key.path,h);m=m.add(a.key.path.popLast()),i.push(d.put(n)),i.push(g.put(b,ml))}return m.forEach(a=>{i.push(this.indexManager.addToCollectionParentIndex(b,a))}),b.addOnCommittedListener(()=>{this.ln[h]=j.keys()}),a.waitFor(i).next(()=>j)})}lookupMutationBatch(a,b){return au(a).get(b).next(a=>a?(k(a.userId===this.userId),bx(this.M,a)):null)}fn(c,b){return this.ln[b]?a.resolve(this.ln[b]):this.lookupMutationBatch(c,b).next(a=>{if(a){const c=a.keys();return this.ln[b]=c,c}return null})}getNextMutationBatchAfterBatchId(c,d){const a=d+1,e=IDBKeyRange.lowerBound([this.userId,a]);let b=null;return au(c).Wt({index:"userMutationsIndex",range:e},(e,c,d)=>{c.userId===this.userId&&(k(c.batchId>=a),b=bx(this.M,c)),d.done()}).next(()=>b)}getHighestUnacknowledgedBatchId(b){const c=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let a=-1;return au(b).Wt({index:"userMutationsIndex",range:c,reverse:!0},(d,b,c)=>{a=b.batchId,c.done()}).next(()=>a)}getAllMutationBatches(a){const b=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return au(a).qt("userMutationsIndex",b).next(a=>a.map(a=>bx(this.M,a)))}getAllMutationBatchesAffectingDocumentKey(a,b){const d=dK(this.userId,b.path),e=IDBKeyRange.lowerBound(d),c=[];return bB(a).Wt({range:e},(d,l,e)=>{const[f,h,i]=d,j=ac(h);if(f===this.userId&&b.path.isEqual(j))return au(a).get(i).next(a=>{if(!a)throw g();k(a.userId===this.userId),c.push(bx(this.M,a))});e.done()}).next(()=>c)}getAllMutationBatchesAffectingDocumentKeys(c,e){let b=new s(l);const d=[];return e.forEach(a=>{const e=dK(this.userId,a.path),f=IDBKeyRange.lowerBound(e),g=bB(c).Wt({range:f},(c,i,d)=>{const[e,f,g]=c,h=ac(f);e===this.userId&&a.path.isEqual(h)?b=b.add(g):d.done()});d.push(g)}),a.waitFor(d).next(()=>this.dn(c,b))}getAllMutationBatchesAffectingQuery(c,d){const b=d.path,e=b.length+1,f=dK(this.userId,b),g=IDBKeyRange.lowerBound(f);let a=new s(l);return bB(c).Wt({range:g},(i,j,d)=>{const[f,g,h]=i,c=ac(g);f===this.userId&&b.isPrefixOf(c)?c.length===e&&(a=a.add(h)):d.done()}).next(()=>this.dn(c,a))}dn(d,e){const b=[],c=[];return e.forEach(a=>{c.push(au(d).get(a).next(a=>{if(a===null)throw g();k(a.userId===this.userId),b.push(bx(this.M,a))}))}),a.waitFor(c).next(()=>b)}removeMutationBatch(b,c){return kM(b.Ht,this.userId,c).next(d=>(b.addOnCommittedListener(()=>{this._n(c.batchId)}),a.forEach(d,a=>this.referenceDelegate.markPotentiallyOrphaned(b,a))))}_n(a){delete this.ln[a]}performConsistencyCheck(b){return this.checkEmpty(b).next(d=>{if(!d)return a.resolve();const e=IDBKeyRange.lowerBound([this.userId]),c=[];return bB(b).Wt({range:e},(a,d,b)=>{if(a[0]===this.userId){const b=ac(a[1]);c.push(b)}else b.done()}).next(()=>{k(c.length===0)})})}containsKey(a,b){return kI(a,this.userId,b)}wn(a){return kF(a).get(this.userId).next(a=>a||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function kI(g,b,d){const c=dK(b,d.path),e=c[1],f=IDBKeyRange.lowerBound(c);let a=!1;return bB(g).Wt({range:f,jt:!0},(c,h,d)=>{const[f,g,i]=c;f===b&&g===e&&(a=!0),d.done()}).next(()=>a)}function au(a){return B(a,"mutations")}function bB(a){return B(a,"documentMutations")}function kF(a){return B(a,"mutationQueues")}bz=class{constructor(a){this.mn=a}next(){return this.mn+=2,this.mn}static gn(){return new bz(0)}static yn(){return new bz(-1)}},lZ=class{constructor(a,b){this.referenceDelegate=a,this.M=b}allocateTargetId(a){return this.pn(a).next(b=>{const c=new bz(b.highestTargetId);return b.highestTargetId=c.next(),this.In(a,b).next(()=>b.highestTargetId)})}getLastRemoteSnapshotVersion(a){return this.pn(a).next(a=>h.fromTimestamp(new A(a.lastRemoteSnapshotVersion.seconds,a.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(a){return this.pn(a).next(a=>a.highestListenSequenceNumber)}setTargetsMetadata(b,a,c){return this.pn(b).next(d=>(d.highestListenSequenceNumber=a,c&&(d.lastRemoteSnapshotVersion=c.toTimestamp()),a>d.highestListenSequenceNumber&&(d.highestListenSequenceNumber=a),this.In(b,d)))}addTargetData(a,b){return this.Tn(a,b).next(()=>this.pn(a).next(c=>(c.targetCount+=1,this.En(b,c),this.In(a,c))))}updateTargetData(a,b){return this.Tn(a,b)}removeTargetData(a,b){return this.removeMatchingKeysForTargetId(a,b.targetId).next(()=>by(a).delete(b.targetId)).next(()=>this.pn(a)).next(b=>(k(b.targetCount>0),b.targetCount-=1,this.In(a,b)))}removeTargets(b,e,f){let c=0;const d=[];return by(b).Wt((h,g)=>{const a=bR(g);a.sequenceNumber<=e&&f.get(a.targetId)===null&&(c++,d.push(this.removeTargetData(b,a)))}).next(()=>a.waitFor(d)).next(()=>c)}forEachTarget(a,b){return by(a).Wt((d,a)=>{const c=bR(a);b(c)})}pn(a){return kC(a).get("targetGlobalKey").next(a=>(k(a!==null),a))}In(a,b){return kC(a).put("targetGlobalKey",b)}Tn(a,b){return by(a).put(ln(this.M,b))}En(a,b){let c=!1;return a.targetId>b.highestTargetId&&(b.highestTargetId=a.targetId,c=!0),a.sequenceNumber>b.highestListenSequenceNumber&&(b.highestListenSequenceNumber=a.sequenceNumber,c=!0),c}getTargetCount(a){return this.pn(a).next(a=>a.targetCount)}getTargetData(d,a){const b=aA(a),e=IDBKeyRange.bound([b,Number.NEGATIVE_INFINITY],[b,Number.POSITIVE_INFINITY]);let c=null;return by(d).Wt({range:e,index:"queryTargetsIndex"},(f,d,e)=>{const b=bR(d);bN(a,b.target)&&(c=b,e.done())}).next(()=>c)}addMatchingKeys(c,e,d){const b=[],f=aq(c);return e.forEach(a=>{const e=N(a.path);b.push(f.put({targetId:d,path:e})),b.push(this.referenceDelegate.addReference(c,d,a))}),a.waitFor(b)}removeMatchingKeys(b,d,c){const e=aq(b);return a.forEach(d,d=>{const f=N(d.path);return a.waitFor([e.delete([c,f]),this.referenceDelegate.removeReference(b,c,d)])})}removeMatchingKeysForTargetId(b,a){const c=aq(b),d=IDBKeyRange.bound([a],[a+1],!1,!0);return c.delete(d)}getMatchingKeysForTargetId(c,b){const e=IDBKeyRange.bound([b],[b+1],!1,!0),f=aq(c);let a=r();return f.Wt({range:e,jt:!0},(b,f,g)=>{const c=ac(b[1]),e=new d(c);a=a.add(e)}).next(()=>a)}containsKey(c,d){const a=N(d.path),e=IDBKeyRange.bound([a],[gJ(a)],!1,!0);let b=0;return aq(c).Wt({index:"documentTargetsIndex",jt:!0,range:e},([a,d],e,c)=>{a!==0&&(b++,c.done())}).next(()=>b>0)}Et(a,b){return by(a).get(b).next(a=>a?bR(a):null)}};function by(a){return B(a,"targets")}function kC(a){return B(a,"targetGlobal")}function aq(a){return B(a,"targetDocuments")}async function bw(a){if(a.code!==b.FAILED_PRECONDITION||a.message!==kP)throw a;c("LocalStore","Unexpectedly lost primary lease")}function kz([b,c],[d,e]){const a=l(b,d);return a===0?l(c,e):a}md=class{constructor(a){this.An=a,this.buffer=new s(kz),this.Rn=0}bn(){return++this.Rn}Pn(b){const a=[b,this.bn()];if(this.buffer.size<this.An)this.buffer=this.buffer.add(a);else{const b=this.buffer.last();kz(a,b)<0&&(this.buffer=this.buffer.delete(b).add(a))}}get maxValue(){return this.buffer.last()[0]}},me=class{constructor(a,b){this.garbageCollector=a,this.asyncQueue=b,this.Vn=!1,this.vn=null}start(a){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Sn(a)}stop(){this.vn&&(this.vn.cancel(),this.vn=null)}get started(){return this.vn!==null}Sn(a){const b=this.Vn?3e5:6e4;c("LruGarbageCollector",`Garbage collection scheduled in ${b}ms`),this.vn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",b,async()=>{this.vn=null,this.Vn=!0;try{await a.collectGarbage(this.garbageCollector)}catch(a){aG(a)?c("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",a):await bw(a)}await this.Sn(a)})}},mf=class{constructor(a,b){this.Dn=a,this.params=b}calculateTargetCount(a,b){return this.Dn.Cn(a).next(a=>Math.floor(b/100*a))}nthSequenceNumber(c,d){if(d===0)return a.resolve(X.A);const b=new md(d);return this.Dn.forEachTarget(c,a=>b.Pn(a.sequenceNumber)).next(()=>this.Dn.xn(c,a=>b.Pn(a))).next(()=>b.maxValue)}removeTargets(a,b,c){return this.Dn.removeTargets(a,b,c)}removeOrphanedDocuments(a,b){return this.Dn.removeOrphanedDocuments(a,b)}collect(b,d){return this.params.cacheSizeCollectionThreshold===-1?(c("LruGarbageCollector","Garbage collection skipped; disabled"),a.resolve(kU)):this.getCacheSize(b).next(a=>a<this.params.cacheSizeCollectionThreshold?(c("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),kU):this.Nn(b,d))}getCacheSize(a){return this.Dn.getCacheSize(a)}Nn(d,l){let f,b,g,h,i,e,j;const k=Date.now();return this.calculateTargetCount(d,this.params.percentileToCollect).next(a=>(a>this.params.maximumSequenceNumbersToCollect?(c("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${a}`),b=this.params.maximumSequenceNumbersToCollect):b=a,h=Date.now(),this.nthSequenceNumber(d,b))).next(a=>(f=a,i=Date.now(),this.removeTargets(d,f,l))).next(a=>(g=a,e=Date.now(),this.removeOrphanedDocuments(d,f))).next(d=>(j=Date.now(),ed()<=n.DEBUG&&c("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${h-k}ms
	Determined least recently used ${b} in `+(i-h)+`ms
	Removed ${g} targets in `+(e-i)+`ms
	Removed ${d} documents in `+(j-e)+`ms
Total Duration: ${j-k}ms`),a.resolve({didRun:!0,sequenceNumbersCollected:b,targetsRemoved:g,documentsRemoved:d})))}},mg=class{constructor(a,b){this.db=a,this.garbageCollector=function(a,b){return new mf(a,b)}(this,b)}Cn(a){const b=this.kn(a);return this.db.getTargetCache().getTargetCount(a).next(a=>b.next(b=>a+b))}kn(b){let a=0;return this.xn(b,b=>{a++}).next(()=>a)}forEachTarget(a,b){return this.db.getTargetCache().forEachTarget(a,b)}xn(a,b){return this.Mn(a,(c,a)=>b(a))}addReference(a,c,b){return dM(a,b)}removeReference(a,c,b){return dM(a,b)}removeTargets(a,b,c){return this.db.getTargetCache().removeTargets(a,b,c)}markPotentiallyOrphaned(a,b){return dM(a,b)}On(b,c){return function(b,d){let c=!1;return kF(b).zt(e=>kI(b,e,d).next(b=>(b&&(c=!0),a.resolve(!b)))).next(()=>c)}(b,c)}removeOrphanedDocuments(b,f){const c=this.db.getRemoteDocumentCache().newChangeBuffer(),d=[];let e=0;return this.Mn(b,(a,g)=>{if(g<=f){const f=this.On(b,a).next(d=>{if(!d)return e++,c.getEntry(b,a).next(()=>(c.removeEntry(a,h.min()),aq(b).delete([0,N(a.path)])))});d.push(f)}}).next(()=>a.waitFor(d)).next(()=>c.apply(b)).next(()=>e)}removeTarget(a,b){const c=b.withSequenceNumber(a.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(a,c)}updateLimboDocument(a,b){return dM(a,b)}Mn(e,c){const f=aq(e);let b,a=X.A;return f.Wt({index:"documentTargetsIndex"},([e,h],{path:f,sequenceNumber:g})=>{e===0?(a!==X.A&&c(new d(ac(b)),a),a=g,b=f):a=X.A}).next(()=>{a!==X.A&&c(new d(ac(b)),a)})}getCacheSize(a){return this.db.getRemoteDocumentCache().getSize(a)}};function dM(a,b){return aq(a).put(function(a,b){return{targetId:0,path:N(a.path),sequenceNumber:b}}(b,a.currentSequenceNumber))}kx=class{constructor(){this.changes=new am(a=>a.toString(),(a,b)=>a.isEqual(b)),this.changesApplied=!1}addEntry(a){this.assertNotApplied(),this.changes.set(a.key,a)}removeEntry(a,b){this.assertNotApplied(),this.changes.set(a,v.newInvalidDocument(a).setReadTime(b))}getEntry(d,b){this.assertNotApplied();const c=this.changes.get(b);return c!==void 0?a.resolve(c):this.getFromCache(d,b)}getEntries(a,b){return this.getAllFromCache(a,b)}apply(a){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(a)}assertNotApplied(){}},mj=class{constructor(a){this.M=a}setIndexManager(a){this.indexManager=a}addEntry(a,c,b){return aB(a).put(b)}removeEntry(a,b,c){return aB(a).delete(function(b,c){const a=b.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],dV(c),a[a.length-1]]}(b,c))}updateMetadata(a,b){return this.getMetadata(a).next(c=>(c.byteSize+=b,this.Fn(a,c)))}getEntry(c,a){let b=v.newInvalidDocument(a);return aB(c).Wt({index:"documentKeyIndex",range:IDBKeyRange.only(ci(a))},(d,c)=>{b=this.$n(a,c)}).next(()=>b)}Bn(c,a){let b={size:0,document:v.newInvalidDocument(a)};return aB(c).Wt({index:"documentKeyIndex",range:IDBKeyRange.only(ci(a))},(d,c)=>{b={document:this.$n(a,c),size:dS(c)}}).next(()=>b)}getEntries(b,c){let a=Z();return this.Ln(b,c,(b,c)=>{const d=this.$n(b,c);a=a.insert(b,d)}).next(()=>a)}Un(c,e){let a=Z(),b=new G(d.comparator);return this.Ln(c,e,(c,d)=>{const e=this.$n(c,d);a=a.insert(c,e),b=b.insert(c,dS(d))}).next(()=>({documents:a,qn:b}))}Ln(i,g,f){if(g.isEmpty())return a.resolve();let e=new s(kl);g.forEach(a=>e=e.add(a));const h=IDBKeyRange.bound(ci(e.first()),ci(e.last())),c=e.getIterator();let b=c.getNext();return aB(i).Wt({index:"documentKeyIndex",range:h},(h,a,e)=>{const g=d.fromSegments([...a.prefixPath,a.collectionGroup,a.documentId]);for(;b&&kl(b,g)<0;)f(b,null),b=c.getNext();b&&b.isEqual(g)&&(f(b,a),b=c.hasNext()?c.getNext():null),b?e.Ut(ci(b)):e.done()}).next(()=>{for(;b;)f(b,null),b=c.hasNext()?c.getNext():null})}getAllFromCollection(c,a,b){const e=[a.popLast().toArray(),a.lastSegment(),dV(b.readTime),b.documentKey.path.isEmpty()?"":b.documentKey.path.lastSegment()],f=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return aB(c).qt(IDBKeyRange.bound(e,f,!0)).next(b=>{let a=Z();for(const c of b){const e=this.$n(d.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);a=a.insert(e.key,e)}return a})}getAllFromCollectionGroup(c,b,e,f){let a=Z();const g=km(b,e),h=km(b,_.max());return aB(c).Wt({index:"collectionGroupIndex",range:IDBKeyRange.bound(g,h,!0)},(g,b,e)=>{const c=this.$n(d.fromSegments(b.prefixPath.concat(b.collectionGroup,b.documentId)),b);a=a.insert(c.key,c),a.size===f&&e.done()}).next(()=>a)}newChangeBuffer(a){return new mk(this,!!a&&a.trackRemovals)}getSize(a){return this.getMetadata(a).next(a=>a.byteSize)}getMetadata(a){return kw(a).get("remoteDocumentGlobalKey").next(a=>(k(!!a),a))}Fn(a,b){return kw(a).put("remoteDocumentGlobalKey",b)}$n(b,a){if(a){const b=lN(this.M,a);if(!(b.isNoDocument()&&b.version.isEqual(h.min())))return b}return v.newInvalidDocument(b)}},mk=class extends kx{constructor(a,b){super(),this.Kn=a,this.trackRemovals=b,this.Gn=new am(a=>a.toString(),(a,b)=>a.isEqual(b))}applyChanges(c){const b=[];let d=0,e=new s((a,b)=>l(a.canonicalString(),b.canonicalString()));return this.changes.forEach((a,f)=>{const g=this.Gn.get(a);if(b.push(this.Kn.removeEntry(c,a,g.readTime)),f.isValidDocument()){const h=lh(this.Kn.M,f);e=e.add(a.path.popLast());const i=dS(h);d+=i-g.size,b.push(this.Kn.addEntry(c,a,h))}else if(d-=g.size,this.trackRemovals){const d=lh(this.Kn.M,f.convertToNoDocument(h.min()));b.push(this.Kn.addEntry(c,a,d))}}),e.forEach(a=>{b.push(this.Kn.indexManager.addToCollectionParentIndex(c,a))}),b.push(this.Kn.updateMetadata(c,d)),a.waitFor(b)}getFromCache(b,a){return this.Kn.Bn(b,a).next(b=>(this.Gn.set(a,{size:b.size,readTime:b.document.readTime}),b.document))}getAllFromCache(a,b){return this.Kn.Un(a,b).next(({documents:a,qn:b})=>(b.forEach((b,c)=>{this.Gn.set(b,{size:c,readTime:a.get(b).readTime})}),a))}};function kw(a){return B(a,"remoteDocumentGlobal")}function aB(a){return B(a,"remoteDocumentsV14")}function ci(b){const a=b.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],a[a.length-1]]}function km(c,b){const a=b.documentKey.path.toArray();return[c,dV(b.readTime),a.slice(0,a.length-2),a.length>0?a[a.length-1]:""]}function kl(d,e){const a=d.path.toArray(),b=e.path.toArray();let c=0;for(let d=0;d<a.length-2&&d<b.length-2;++d)if(c=l(a[d],b[d]),c)return c;return c=l(a.length,b.length),c||(c=l(a[a.length-2],b[b.length-2]),c||l(a[a.length-1],b[b.length-1]))}mq=class{constructor(a){this.M=a}kt(c,g,d,e){const f=new ev("createOrUpgrade",g);d<1&&e>=1&&(function(a){a.createObjectStore("owner")}(c),function(a){a.createObjectStore("mutationQueues",{keyPath:"userId"}),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",kt,{unique:!0}),a.createObjectStore("documentMutations")}(c),ki(c),function(a){a.createObjectStore("remoteDocuments")}(c));let b=a.resolve();return d<3&&e>=3&&(d!==0&&(!function(a){a.deleteObjectStore("targetDocuments"),a.deleteObjectStore("targets"),a.deleteObjectStore("targetGlobal")}(c),ki(c)),b=b.next(()=>function(a){const b=a.store("targetGlobal"),c={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:h.min().toTimestamp(),targetCount:0};return b.put("targetGlobalKey",c)}(f))),d<4&&e>=4&&(d!==0&&(b=b.next(()=>function(b,c){return c.store("mutations").qt().next(d=>{b.deleteObjectStore("mutations"),b.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",kt,{unique:!0});const e=c.store("mutations"),f=d.map(a=>e.put(a));return a.waitFor(f)})}(c,f))),b=b.next(()=>{!function(a){a.createObjectStore("clientMetadata",{keyPath:"clientId"})}(c)})),d<5&&e>=5&&(b=b.next(()=>this.Qn(f))),d<6&&e>=6&&(b=b.next(()=>(function(a){a.createObjectStore("remoteDocumentGlobal")}(c),this.jn(f)))),d<7&&e>=7&&(b=b.next(()=>this.Wn(f))),d<8&&e>=8&&(b=b.next(()=>this.zn(c,f))),d<9&&e>=9&&(b=b.next(()=>{!function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")}(c)})),d<10&&e>=10&&(b=b.next(()=>this.Hn(f))),d<11&&e>=11&&(b=b.next(()=>{!function(a){a.createObjectStore("bundles",{keyPath:"bundleId"})}(c),function(a){a.createObjectStore("namedQueries",{keyPath:"name"})}(c)})),d<12&&e>=12&&(b=b.next(()=>{!function(b){const a=b.createObjectStore("documentOverlays",{keyPath:lU});a.createIndex("collectionPathOverlayIndex",lT,{unique:!1}),a.createIndex("collectionGroupOverlayIndex",lS,{unique:!1})}(c)})),d<13&&e>=13&&(b=b.next(()=>function(b){const a=b.createObjectStore("remoteDocumentsV14",{keyPath:mi});a.createIndex("documentKeyIndex",mh),a.createIndex("collectionGroupIndex",mc)}(c)).next(()=>this.Jn(c,f)).next(()=>c.deleteObjectStore("remoteDocuments"))),d<14&&e>=14&&(b=b.next(()=>{!function(a){a.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),a.createObjectStore("indexState",{keyPath:lY}).createIndex("sequenceNumberIndex",lX,{unique:!1}),a.createObjectStore("indexEntries",{keyPath:lW}).createIndex("documentKeyIndex",lV,{unique:!1})}(c)})),b}jn(a){let b=0;return a.store("remoteDocuments").Wt((c,a)=>{b+=dS(a)}).next(()=>{const c={byteSize:b};return a.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",c)})}Qn(b){const c=b.store("mutationQueues"),d=b.store("mutations");return c.qt().next(c=>a.forEach(c,c=>{const e=IDBKeyRange.bound([c.userId,-1],[c.userId,c.lastAcknowledgedBatchId]);return d.qt("userMutationsIndex",e).next(d=>a.forEach(d,a=>{k(a.userId===c.userId);const d=bx(this.M,a);return kM(b,c.userId,d).next(()=>{})}))}))}Wn(b){const c=b.store("targetDocuments"),d=b.store("remoteDocuments");return b.store("targetGlobal").get("targetGlobalKey").next(e=>{const b=[];return d.Wt((f,h)=>{const d=new q(f),g=function(a){return[0,N(a)]}(d);b.push(c.get(g).next(b=>b?a.resolve():(a=>c.put({targetId:0,path:N(a),sequenceNumber:e.highestListenSequenceNumber}))(d)))}).next(()=>a.waitFor(b))})}zn(c,a){c.createObjectStore("collectionParents",{keyPath:l_});const d=a.store("collectionParents"),e=new ee,b=a=>{if(e.add(a)){const b=a.lastSegment(),c=a.popLast();return d.put({collectionId:b,parent:N(c)})}};return a.store("remoteDocuments").Wt({jt:!0},(a,d)=>{const c=new q(a);return b(c.popLast())}).next(()=>a.store("documentMutations").Wt({jt:!0},([d,a,e],f)=>{const c=ac(a);return b(c.popLast())}))}Hn(b){const a=b.store("targets");return a.Wt((e,b)=>{const c=bR(b),d=ln(this.M,c);return a.put(d)})}Jn(f,b){const e=b.store("remoteDocuments"),c=[];return e.Wt((j,e)=>{const h=b.store("remoteDocumentsV14"),f=(a=e,a.document?new d(q.fromString(a.document.name).popFirst(5)):a.noDocument?d.fromSegments(a.noDocument.path):a.unknownDocument?d.fromSegments(a.unknownDocument.path):g()).path.toArray();var a;const i={prefixPath:f.slice(0,f.length-2),collectionGroup:f[f.length-2],documentId:f[f.length-1],readTime:e.readTime||[0,0],unknownDocument:e.unknownDocument,noDocument:e.noDocument,document:e.document,hasCommittedMutations:!!e.hasCommittedMutations};c.push(h.put(i))}).next(()=>a.waitFor(c))}};function ki(a){a.createObjectStore("targetDocuments",{keyPath:ma}).createIndex("documentTargetsIndex",l$,{unique:!0}),a.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",mb,{unique:!0}),a.createObjectStore("targetGlobal")}eC="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",kf=class{constructor(d,a,f,l,g,h,i,j,k,c,m=13){if(this.allowTabSynchronization=d,this.persistenceKey=a,this.clientId=f,this.Yn=g,this.window=h,this.document=i,this.Xn=k,this.Zn=c,this.ts=m,this.es=null,this.ns=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ss=null,this.inForeground=!1,this.rs=null,this.os=null,this.us=Number.NEGATIVE_INFINITY,this.cs=a=>Promise.resolve(),!kf.vt())throw new e(b.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new mg(this,l),this.hs=a+"main",this.M=new lf(j),this.ls=new al(this.hs,this.ts,new mq(this.M)),this.fs=new lZ(this.referenceDelegate,this.M),this.ds=function(a){return new mj(a)}(this.M),this._s=new lM,this.window&&this.window.localStorage?this.ws=this.window.localStorage:(this.ws=null,c===!1&&S("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.gs().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new e(b.FAILED_PRECONDITION,eC);return this.ys(),this.ps(),this.Is(),this.runTransaction("getHighestListenSequenceNumber","readonly",a=>this.fs.getHighestSequenceNumber(a))}).then(a=>{this.es=new X(a,this.Xn)}).then(()=>{this.ns=!0}).catch(a=>(this.ls&&this.ls.close(),Promise.reject(a)))}Ts(a){return this.cs=async b=>{if(this.started)return a(b)},a(this.isPrimary)}setDatabaseDeletedListener(a){this.ls.Ot(async b=>{b.newVersion===null&&await a()})}setNetworkEnabled(a){this.networkEnabled!==a&&(this.networkEnabled=a,this.Yn.enqueueAndForget(async()=>{this.started&&await this.gs()}))}gs(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",a=>dJ(a).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Es(a).next(a=>{a||(this.isPrimary=!1,this.Yn.enqueueRetryable(()=>this.cs(!1)))})}).next(()=>this.As(a)).next(b=>this.isPrimary&&!b?this.Rs(a).next(()=>!1):!!b&&this.bs(a).next(()=>!0))).catch(a=>{if(aG(a))return c("IndexedDbPersistence","Failed to extend owner lease: ",a),this.isPrimary;if(!this.allowTabSynchronization)throw a;return c("IndexedDbPersistence","Releasing owner lease after error during lease refresh",a),!1}).then(a=>{this.isPrimary!==a&&this.Yn.enqueueRetryable(()=>this.cs(a)),this.isPrimary=a})}Es(b){return cx(b).get("owner").next(b=>a.resolve(this.Ps(b)))}Vs(a){return dJ(a).delete(this.clientId)}async vs(){if(this.isPrimary&&!this.Ss(this.us,18e5)){this.us=Date.now();const b=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",c=>{const b=B(c,"clientMetadata");return b.qt().next(c=>{const e=this.Ds(c,18e5),d=c.filter(a=>e.indexOf(a)===-1);return a.forEach(d,a=>b.delete(a.clientId)).next(()=>d)})}).catch(()=>[]);if(this.ws)for(const a of b)this.ws.removeItem(this.Cs(a.clientId))}}Is(){this.os=this.Yn.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.gs().then(()=>this.vs()).then(()=>this.Is()))}Ps(a){return!!a&&a.ownerId===this.clientId}As(d){return this.Zn?a.resolve(!0):cx(d).get("owner").next(a=>{if(a!==null&&this.Ss(a.leaseTimestampMs,5e3)&&!this.xs(a.ownerId)){if(this.Ps(a)&&this.networkEnabled)return!0;if(!this.Ps(a)){if(!a.allowTabSynchronization)throw new e(b.FAILED_PRECONDITION,eC);return!1}}return!(!this.networkEnabled||!this.inForeground)||dJ(d).qt().next(a=>this.Ds(a,5e3).find(a=>{if(this.clientId!==a.clientId){const b=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,d=this.networkEnabled===a.networkEnabled;if(b||c&&d)return!0}return!1})===void 0)}).next(a=>(this.isPrimary!==a&&c("IndexedDbPersistence",`Client ${a?"is":"is not"} eligible for a primary lease.`),a))}async shutdown(){this.ns=!1,this.Ns(),this.os&&(this.os.cancel(),this.os=null),this.ks(),this.Ms(),await this.ls.runTransaction("shutdown","readwrite",["owner","clientMetadata"],b=>{const a=new k$(b,X.A);return this.Rs(a).next(()=>this.Vs(a))}),this.ls.close(),this.Os()}Ds(a,b){return a.filter(a=>this.Ss(a.updateTimeMs,b)&&!this.xs(a.clientId))}Fs(){return this.runTransaction("getActiveClients","readonly",a=>dJ(a).qt().next(a=>this.Ds(a,18e5).map(a=>a.clientId)))}get started(){return this.ns}getMutationQueue(a,b){return kJ.Yt(a,this.M,b,this.referenceDelegate)}getTargetCache(){return this.fs}getRemoteDocumentCache(){return this.ds}getIndexManager(a){return new lK(a,this.M.Jt.databaseId)}getDocumentOverlayCache(a){return lu.Yt(this.M,a)}getBundleCache(){return this._s}runTransaction(f,h,i){c("IndexedDbPersistence","Starting transaction:",f);const j=h==="readonly"?"readonly":"readwrite",k=(d=this.ts)===14?lQ:d===13?kN:d===12?lR:d===11?kL:void g();var d;let a;return this.ls.runTransaction(f,j,k,c=>(a=new k$(c,this.es?this.es.next():X.A),h==="readwrite-primary"?this.Es(a).next(b=>!!b||this.As(a)).next(c=>{if(!c)throw S(`Failed to obtain primary lease for action '${f}'.`),this.isPrimary=!1,this.Yn.enqueueRetryable(()=>this.cs(!1)),new e(b.FAILED_PRECONDITION,kP);return i(a)}).next(b=>this.bs(a).next(()=>b)):this.$s(a).next(()=>i(a)))).then(b=>(a.raiseOnCommittedEvent(),b))}$s(a){return cx(a).get("owner").next(a=>{if(a!==null&&this.Ss(a.leaseTimestampMs,5e3)&&!this.xs(a.ownerId)&&!this.Ps(a)&&!(this.Zn||this.allowTabSynchronization&&a.allowTabSynchronization))throw new e(b.FAILED_PRECONDITION,eC)})}bs(a){const b={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return cx(a).put("owner",b)}static vt(){return al.vt()}Rs(d){const b=cx(d);return b.get("owner").next(d=>this.Ps(d)?(c("IndexedDbPersistence","Releasing primary lease."),b.delete("owner")):a.resolve())}Ss(a,c){const b=Date.now();return!(a<b-c)&&(!(a>b)||(S(`Detected an update time that is in the future: ${a} > ${b}`),!1))}ys(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.rs=()=>{this.Yn.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.gs()))},this.document.addEventListener("visibilitychange",this.rs),this.inForeground=this.document.visibilityState==="visible")}ks(){this.rs&&(this.document.removeEventListener("visibilitychange",this.rs),this.rs=null)}ps(){var a;typeof((a=this.window)===null||a===void 0?void 0:a.addEventListener)=="function"&&(this.ss=()=>{this.Ns(),tn()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Yn.enterRestrictedMode(!0),this.Yn.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ss))}Ms(){this.ss&&(this.window.removeEventListener("pagehide",this.ss),this.ss=null)}xs(b){var a;try{const d=((a=this.ws)===null||a===void 0?void 0:a.getItem(this.Cs(b)))!==null;return c("IndexedDbPersistence",`Client '${b}' ${d?"is":"is not"} zombied in LocalStorage`),d}catch(a){return S("IndexedDbPersistence","Failed to get zombied client id.",a),!1}}Ns(){if(this.ws)try{this.ws.setItem(this.Cs(this.clientId),String(Date.now()))}catch(a){S("Failed to set zombie client id.",a)}}Os(){if(this.ws)try{this.ws.removeItem(this.Cs(this.clientId))}catch(a){}}Cs(a){return`firestore_zombie_${this.persistenceKey}_${a}`}};function cx(a){return B(a,"owner")}function dJ(a){return B(a,"clientMetadata")}function mw(a,c){let b=a.projectId;return a.isDefaultDatabase||(b+="."+a.database),"firestore/"+c+"/"+b+"/"}mx=class{constructor(a,b,c){this.ds=a,this.Bs=b,this.indexManager=c}Ls(a,b){return this.Bs.getAllMutationBatchesAffectingDocumentKey(a,b).next(c=>this.Us(a,b,c))}Us(a,b,c){return this.ds.getEntry(a,b).next(a=>{for(const b of c)b.applyToLocalView(a);return a})}qs(a,b){a.forEach((c,a)=>{for(const c of b)c.applyToLocalView(a)})}Ks(a,b){return this.ds.getEntries(a,b).next(b=>this.Gs(a,b).next(()=>b))}Gs(b,a){return this.Bs.getAllMutationBatchesAffectingDocumentKeys(b,a).next(b=>this.qs(a,b))}Qs(b,a,c){return function(a){return d.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(a)?this.js(b,a.path):iv(a)?this.Ws(b,a,c):this.zs(b,a,c)}js(a,b){return this.Ls(a,new d(b)).next(a=>{let b=eO();return a.isFoundDocument()&&(b=b.insert(a.key,a)),b})}Ws(c,d,f){const e=d.collectionGroup;let b=eO();return this.indexManager.getCollectionParents(c,e).next(g=>a.forEach(g,a=>{const g=function(a,b){return new bV(b,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}(d,a.child(e));return this.zs(c,g,f).next(a=>{a.forEach((a,c)=>{b=b.insert(a,c)})})}).next(()=>b))}zs(c,b,d){let a;return this.ds.getAllFromCollection(c,b.path,d).next(d=>(a=d,this.Bs.getAllMutationBatchesAffectingQuery(c,b))).next(b=>{for(const c of b)for(const e of c.mutations){const d=e.key;let b=a.get(d);b==null&&(b=v.newInvalidDocument(d),a=a.insert(d,b)),eU(e,b,c.localWriteTime),b.isFoundDocument()||(a=a.remove(d))}}).next(()=>(a.forEach((c,d)=>{fb(b,d)||(a=a.remove(c))}),a))}},jZ=class{constructor(a,b,c,d){this.targetId=a,this.fromCache=b,this.Hs=c,this.Js=d}static Ys(d,c){let a=r(),b=r();for(const d of c.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:b=b.add(d.doc.key)}return new jZ(d,c.fromCache,a,b)}},jO=class{constructor(){this.Xs=!1}initialize(a,b){this.Zs=a,this.indexManager=b,this.Xs=!0}Qs(a,b,c,d){return this.ti(a,b).next(e=>e||this.ei(a,b,d,c)).next(c=>c||this.ni(a,b))}ti(b,c){return a.resolve(null)}ei(b,a,e,d){return nt(a)||d.isEqual(h.min())?this.ni(b,a):this.Zs.Ks(b,e).next(g=>{const f=this.si(a,g);return this.ii(a,f,e,d)?this.ni(b,a):(ed()<=n.DEBUG&&c("QueryEngine","Re-using previous result from %s to execute query: %s",d.toString(),fc(a)),this.ri(b,f,a,nQ(d,-1)))})}si(b,c){let a=new s(iE(b));return c.forEach((d,c)=>{fb(b,c)&&(a=a.add(c))}),a}ii(c,a,d,e){if(c.limit===null)return!1;if(d.size!==a.size)return!0;const b=c.limitType==="F"?a.last():a.first();return!!b&&(b.hasPendingWrites||b.version.compareTo(e)>0)}ni(b,a){return ed()<=n.DEBUG&&c("QueryEngine","Using full collection scan to execute query:",fc(a)),this.Zs.Qs(b,a,_.min())}ri(a,b,c,d){return this.Zs.Qs(a,c,d).next(a=>(b.forEach(b=>{a=a.insert(b.key,b)}),a))}},mA=class{constructor(a,b,c,d){this.persistence=a,this.oi=b,this.M=d,this.ui=new G(l),this.ai=new am(a=>aA(a),bN),this.ci=new Map,this.hi=a.getRemoteDocumentCache(),this.fs=a.getTargetCache(),this._s=a.getBundleCache(),this.li(c)}li(a){this.indexManager=this.persistence.getIndexManager(a),this.Bs=this.persistence.getMutationQueue(a,this.indexManager),this.fi=new mx(this.hi,this.Bs,this.indexManager),this.hi.setIndexManager(this.indexManager),this.oi.initialize(this.fi,this.indexManager)}collectGarbage(a){return this.persistence.runTransaction("Collect garbage","readwrite-primary",b=>a.collect(b,this.ui))}};function jL(a,b,c,d){return new mA(a,b,c,d)}async function jK(b,c){const a=j(b);return await a.persistence.runTransaction("Handle user change","readonly",b=>{let d;return a.Bs.getAllMutationBatches(b).next(e=>(d=e,a.li(c),a.Bs.getAllMutationBatches(b))).next(g=>{const e=[],f=[];let c=r();for(const a of d){e.push(a.batchId);for(const b of a.mutations)c=c.add(b.key)}for(const a of g){f.push(a.batchId);for(const b of a.mutations)c=c.add(b.key)}return a.fi.Ks(b,c).next(a=>({di:a,removedBatchIds:e,addedBatchIds:f}))})})}function mD(d,c){const b=j(d);return b.persistence.runTransaction("Acknowledge batch","readwrite-primary",d=>{const f=c.batch.keys(),e=b.hi.newChangeBuffer({trackRemovals:!0});return function(h,e,b,f){const d=b.batch,g=d.keys();let c=a.resolve();return g.forEach(a=>{c=c.next(()=>f.getEntry(e,a)).next(c=>{const e=b.docVersions.get(a);k(e!==null),c.version.compareTo(e)<0&&(d.applyToRemoteDocument(c,b),c.isValidDocument()&&(c.setReadTime(b.commitVersion),f.addEntry(c)))})}),c.next(()=>h.Bs.removeMutationBatch(e,d))}(b,d,c,e).next(()=>e.apply(d)).next(()=>b.Bs.performConsistencyCheck(d)).next(()=>b.fi.Ks(d,f))})}function jJ(b){const a=j(b);return a.persistence.runTransaction("Get last remote snapshot version","readonly",b=>a.fs.getLastRemoteSnapshotVersion(b))}function mF(f,c){const b=j(f),e=c.snapshotVersion;let d=b.ui;return b.persistence.runTransaction("Apply remote event","readwrite-primary",f=>{const j=b.hi.newChangeBuffer({trackRemovals:!0});d=b.ui;const g=[];c.targetChanges.forEach((i,j)=>{const k=d.get(j);if(!k)return;g.push(b.fs.removeMatchingKeys(f,i.removedDocuments,j).next(()=>b.fs.addMatchingKeys(f,i.addedDocuments,j)));let a=k.withSequenceNumber(f.currentSequenceNumber);c.targetMismatches.has(j)?a=a.withResumeToken(D.EMPTY_BYTE_STRING,h.min()).withLastLimboFreeSnapshotVersion(h.min()):i.resumeToken.approximateByteSize()>0&&(a=a.withResumeToken(i.resumeToken,e)),d=d.insert(j,a),function(b,c,a){return b.resumeToken.approximateByteSize()===0||(c.snapshotVersion.toMicroseconds()-b.snapshotVersion.toMicroseconds()>=3e8||a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size>0)}(k,a,i)&&g.push(b.fs.updateTargetData(f,a))});let i=Z();if(c.documentUpdates.forEach(a=>{c.resolvedLimboDocuments.has(a)&&g.push(b.persistence.referenceDelegate.updateLimboDocument(f,a))}),g.push(mG(f,j,c.documentUpdates).next(a=>{i=a})),!e.isEqual(h.min())){const a=b.fs.getLastRemoteSnapshotVersion(f).next(a=>b.fs.setTargetsMetadata(f,f.currentSequenceNumber,e));g.push(a)}return a.waitFor(g).next(()=>j.apply(f)).next(()=>b.fi.Gs(f,i)).next(()=>i)}).then(a=>(b.ui=d,a))}function mG(e,a,d){let b=r();return d.forEach(a=>b=b.add(a)),a.getEntries(e,b).next(e=>{let b=Z();return d.forEach((f,d)=>{const g=e.get(f);d.isNoDocument()&&d.version.isEqual(h.min())?(a.removeEntry(f,d.readTime),b=b.insert(f,d)):!g.isValidDocument()||d.version.compareTo(g.version)>0||d.version.compareTo(g.version)===0&&g.hasPendingWrites?(a.addEntry(d),b=b.insert(f,d)):c("LocalStore","Ignoring outdated watch update for ",f,". Current version:",g.version," Watch version:",d.version)}),b})}function mH(c,a){const b=j(c);return b.persistence.runTransaction("Get next mutation batch","readonly",c=>(a===void 0&&(a=-1),b.Bs.getNextMutationBatchAfterBatchId(c,a)))}function mI(d,c){const b=j(d);return b.persistence.runTransaction("Allocate target","readwrite",e=>{let d;return b.fs.getTargetData(e,c).next(f=>f?(d=f,a.resolve(d)):b.fs.allocateTargetId(e).next(a=>(d=new aZ(c,a,0,e.currentSequenceNumber),b.fs.addTargetData(e,d).next(()=>d))))}).then(a=>{const d=b.ui.get(a.targetId);return(d===null||a.snapshotVersion.compareTo(d.snapshotVersion)>0)&&(b.ui=b.ui.insert(a.targetId,a),b.ai.set(c,a.targetId)),a})}async function eI(f,b,d){const a=j(f),e=a.ui.get(b),g=d?"readwrite":"readwrite-primary";try{d||await a.persistence.runTransaction("Release target",g,b=>a.persistence.referenceDelegate.removeTarget(b,e))}catch(a){if(!aG(a))throw a;c("LocalStore",`Failed to update sequence numbers for target ${b}: ${a}`)}a.ui=a.ui.remove(b),a.ai.delete(e.target)}function jy(g,c,e){const b=j(g);let f=h.min(),d=r();return b.persistence.runTransaction("Execute query","readonly",g=>function(e,f,c){const b=j(e),d=b.ai.get(c);return d!==void 0?a.resolve(b.ui.get(d)):b.fs.getTargetData(f,c)}(b,g,af(c)).next(a=>{if(a)return f=a.lastLimboFreeSnapshotVersion,b.fs.getMatchingKeysForTargetId(g,a.targetId).next(a=>{d=a})}).next(()=>b.oi.Qs(g,c,e?f:h.min(),e?d:r())).next(a=>(mL(b,nr(c),a),{documents:a,_i:d})))}function mL(b,c,d){let a=h.min();d.forEach((c,b)=>{b.readTime.compareTo(a)>0&&(a=b.readTime)}),b.ci.set(c,a)}mM=class{constructor(a){this.M=a,this.yi=new Map,this.pi=new Map}getBundleMetadata(c,b){return a.resolve(this.yi.get(b))}saveBundleMetadata(d,c){var b;return this.yi.set(c.id,{id:(b=c).id,version:b.version,createTime:U(b.createTime)}),a.resolve()}getNamedQuery(c,b){return a.resolve(this.pi.get(b))}saveNamedQuery(c,b){return this.pi.set(b.name,function(a){return{name:a.name,query:lo(a.bundledQuery),readTime:U(a.readTime)}}(b)),a.resolve()}},mN=class{constructor(){this.overlays=new G(d.comparator),this.Ii=new Map}getOverlay(c,b){return a.resolve(this.overlays.get(b))}saveOverlays(b,c,d){return d.forEach((d,a)=>{this.Xt(b,c,a)}),a.resolve()}removeOverlaysForBatchId(d,e,b){const c=this.Ii.get(b);return c!==void 0&&(c.forEach(a=>this.overlays=this.overlays.remove(a)),this.Ii.delete(b)),a.resolve()}getOverlaysForCollection(i,b,f){const e=co(),g=b.length+1,h=new d(b.child("")),c=this.overlays.getIteratorFrom(h);for(;c.hasNext();){const a=c.getNext().value,d=a.getKey();if(!b.isPrefixOf(d.path))break;d.path.length===g&&a.largestBatchId>f&&e.set(a.getKey(),a)}return a.resolve(e)}getOverlaysForCollectionGroup(i,h,f,g){let b=new G((a,b)=>a-b);const e=this.overlays.getIterator();for(;e.hasNext();){const a=e.getNext().value;if(a.getKey().getCollectionGroup()===h&&a.largestBatchId>f){let c=b.get(a.largestBatchId);c===null&&(c=co(),b=b.insert(a.largestBatchId,c)),c.set(a.getKey(),a)}}const c=co(),d=b.getIterator();for(;d.hasNext();)if(d.getNext().value.forEach((a,b)=>c.set(a,b)),c.size()>=g)break;return a.resolve(c)}Xt(e,b,a){if(a===null)return;const d=this.overlays.get(a.key);if(d!==null){const b=this.Ii.get(d.largestBatchId).delete(a.key);this.Ii.set(d.largestBatchId,b)}this.overlays=this.overlays.insert(a.key,new ej(b,a));let c=this.Ii.get(b);c===void 0&&(c=r(),this.Ii.set(b,c)),this.Ii.set(b,c.add(a.key))}},eL=class{constructor(){this.Ti=new s(y.Ei),this.Ai=new s(y.Ri)}isEmpty(){return this.Ti.isEmpty()}addReference(b,c){const a=new y(b,c);this.Ti=this.Ti.add(a),this.Ai=this.Ai.add(a)}bi(a,b){a.forEach(a=>this.addReference(a,b))}removeReference(a,b){this.Pi(new y(a,b))}Vi(a,b){a.forEach(a=>this.removeReference(a,b))}vi(a){const b=new d(new q([])),e=new y(b,a),f=new y(b,a+1),c=[];return this.Ai.forEachInRange([e,f],a=>{this.Pi(a),c.push(a.key)}),c}Si(){this.Ti.forEach(a=>this.Pi(a))}Pi(a){this.Ti=this.Ti.delete(a),this.Ai=this.Ai.delete(a)}Di(b){const c=new d(new q([])),e=new y(c,b),f=new y(c,b+1);let a=r();return this.Ai.forEachInRange([e,f],b=>{a=a.add(b.key)}),a}containsKey(a){const c=new y(a,0),b=this.Ti.firstAfterOrEqual(c);return b!==null&&a.isEqual(b.key)}},y=class{constructor(a,b){this.key=a,this.Ci=b}static Ei(a,b){return d.comparator(a.key,b.key)||l(a.Ci,b.Ci)}static Ri(a,b){return l(a.Ci,b.Ci)||d.comparator(a.key,b.key)}},mQ=class{constructor(a,b){this.indexManager=a,this.referenceDelegate=b,this.Bs=[],this.xi=1,this.Ni=new s(y.Ei)}checkEmpty(b){return a.resolve(this.Bs.length===0)}addMutationBatch(e,f,g,b){const c=this.xi;this.xi++,this.Bs.length>0&&this.Bs[this.Bs.length-1];const d=new en(c,f,g,b);this.Bs.push(d);for(const a of b)this.Ni=this.Ni.add(new y(a.key,c)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return a.resolve(d)}lookupMutationBatch(c,b){return a.resolve(this.ki(b))}getNextMutationBatchAfterBatchId(f,d){const e=d+1,b=this.Mi(e),c=b<0?0:b;return a.resolve(this.Bs.length>c?this.Bs[c]:null)}getHighestUnacknowledgedBatchId(){return a.resolve(this.Bs.length===0?-1:this.xi-1)}getAllMutationBatches(b){return a.resolve(this.Bs.slice())}getAllMutationBatchesAffectingDocumentKey(f,b){const d=new y(b,0),e=new y(b,Number.POSITIVE_INFINITY),c=[];return this.Ni.forEachInRange([d,e],a=>{const b=this.ki(a.Ci);c.push(b)}),a.resolve(c)}getAllMutationBatchesAffectingDocumentKeys(d,c){let b=new s(l);return c.forEach(a=>{const c=new y(a,0),d=new y(a,Number.POSITIVE_INFINITY);this.Ni.forEachInRange([c,d],a=>{b=b.add(a.Ci)})}),a.resolve(this.Oi(b))}getAllMutationBatchesAffectingQuery(i,f){const e=f.path,g=e.length+1;let b=e;d.isDocumentKey(b)||(b=b.child(""));const h=new y(new d(b),0);let c=new s(l);return this.Ni.forEachWhile(a=>{const b=a.key.path;return!!e.isPrefixOf(b)&&(b.length===g&&(c=c.add(a.Ci)),!0)},h),a.resolve(this.Oi(c))}Oi(b){const a=[];return b.forEach(c=>{const b=this.ki(c);b!==null&&a.push(b)}),a}removeMutationBatch(d,b){k(this.Fi(b.batchId,"removed")===0),this.Bs.shift();let c=this.Ni;return a.forEach(b.mutations,a=>{const e=new y(a.key,b.batchId);return c=c.delete(e),this.referenceDelegate.markPotentiallyOrphaned(d,a.key)}).next(()=>{this.Ni=c})}_n(a){}containsKey(e,b){const d=new y(b,0),c=this.Ni.firstAfterOrEqual(d);return a.resolve(b.isEqual(c&&c.key))}performConsistencyCheck(b){return this.Bs.length,a.resolve()}Fi(a,b){return this.Mi(a)}Mi(a){return this.Bs.length===0?0:a-this.Bs[0].batchId}ki(b){const a=this.Mi(b);return a<0||a>=this.Bs.length?null:this.Bs[a]}},mR=class{constructor(a){this.$i=a,this.docs=new G(d.comparator),this.size=0}setIndexManager(a){this.indexManager=a}addEntry(e,a){const b=a.key,c=this.docs.get(b),f=c?c.size:0,d=this.$i(a);return this.docs=this.docs.insert(b,{document:a.mutableCopy(),size:d}),this.size+=d-f,this.indexManager.addToCollectionParentIndex(e,b.path.popLast())}removeEntry(a){const b=this.docs.get(a);b&&(this.docs=this.docs.remove(a),this.size-=b.size)}getEntry(d,b){const c=this.docs.get(b);return a.resolve(c?c.document.mutableCopy():v.newInvalidDocument(b))}getEntries(d,c){let b=Z();return c.forEach(a=>{const c=this.docs.get(a);b=b.insert(a,c?c.document.mutableCopy():v.newInvalidDocument(a))}),a.resolve(b)}getAllFromCollection(h,b,f){let c=Z();const g=new d(b.child("")),e=this.docs.getIteratorFrom(g);for(;e.hasNext();){const{key:d,value:{document:a}}=e.getNext();if(!b.isPrefixOf(d.path))break;d.path.length>b.length+1||hL(nP(a),f)<=0||(c=c.insert(a.key,a.mutableCopy()))}return a.resolve(c)}getAllFromCollectionGroup(a,b,c,d){g()}Bi(c,b){return a.forEach(this.docs,a=>b(a))}newChangeBuffer(a){return new mS(this)}getSize(b){return a.resolve(this.size)}},mS=class extends kx{constructor(a){super(),this.Kn=a}applyChanges(c){const b=[];return this.changes.forEach((d,a)=>{a.isValidDocument()?b.push(this.Kn.addEntry(c,a)):this.Kn.removeEntry(d)}),a.waitFor(b)}getFromCache(a,b){return this.Kn.getEntry(a,b)}getAllFromCache(a,b){return this.Kn.getEntries(a,b)}},mT=class{constructor(a){this.persistence=a,this.Li=new am(a=>aA(a),bN),this.lastRemoteSnapshotVersion=h.min(),this.highestTargetId=0,this.Ui=0,this.qi=new eL,this.targetCount=0,this.Ki=bz.gn()}forEachTarget(c,b){return this.Li.forEach((c,a)=>b(a)),a.resolve()}getLastRemoteSnapshotVersion(b){return a.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(b){return a.resolve(this.Ui)}allocateTargetId(b){return this.highestTargetId=this.Ki.next(),a.resolve(this.highestTargetId)}setTargetsMetadata(d,b,c){return c&&(this.lastRemoteSnapshotVersion=c),b>this.Ui&&(this.Ui=b),a.resolve()}Tn(a){this.Li.set(a.target,a);const b=a.targetId;b>this.highestTargetId&&(this.Ki=new bz(b),this.highestTargetId=b),a.sequenceNumber>this.Ui&&(this.Ui=a.sequenceNumber)}addTargetData(c,b){return this.Tn(b),this.targetCount+=1,a.resolve()}updateTargetData(c,b){return this.Tn(b),a.resolve()}removeTargetData(c,b){return this.Li.delete(b.target),this.qi.vi(b.targetId),this.targetCount-=1,a.resolve()}removeTargets(d,e,f){let b=0;const c=[];return this.Li.forEach((g,a)=>{a.sequenceNumber<=e&&f.get(a.targetId)===null&&(this.Li.delete(g),c.push(this.removeMatchingKeysForTargetId(d,a.targetId)),b++)}),a.waitFor(c).next(()=>b)}getTargetCount(b){return a.resolve(this.targetCount)}getTargetData(d,b){const c=this.Li.get(b)||null;return a.resolve(c)}addMatchingKeys(d,b,c){return this.qi.bi(b,c),a.resolve()}removeMatchingKeys(e,b,f){this.qi.Vi(b,f);const c=this.persistence.referenceDelegate,d=[];return c&&b.forEach(a=>{d.push(c.markPotentiallyOrphaned(e,a))}),a.waitFor(d)}removeMatchingKeysForTargetId(c,b){return this.qi.vi(b),a.resolve()}getMatchingKeysForTargetId(d,b){const c=this.qi.Di(b);return a.resolve(c)}containsKey(c,b){return a.resolve(this.qi.containsKey(b))}},mU=class{constructor(a,b){this.Gi={},this.overlays={},this.es=new X(0),this.ns=!1,this.ns=!0,this.referenceDelegate=a(this),this.fs=new mT(this),this.indexManager=new lH,this.ds=function(a){return new mR(a)}(a=>this.referenceDelegate.Qi(a)),this.M=new lf(b),this._s=new mM(this.M)}start(){return Promise.resolve()}shutdown(){return this.ns=!1,Promise.resolve()}get started(){return this.ns}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(a){return this.indexManager}getDocumentOverlayCache(b){let a=this.overlays[b.toKey()];return a||(a=new mN,this.overlays[b.toKey()]=a),a}getMutationQueue(b,c){let a=this.Gi[b.toKey()];return a||(a=new mQ(c,this.referenceDelegate),this.Gi[b.toKey()]=a),a}getTargetCache(){return this.fs}getRemoteDocumentCache(){return this.ds}getBundleCache(){return this._s}runTransaction(b,e,d){c("MemoryPersistence","Starting transaction:",b);const a=new mV(this.es.next());return this.referenceDelegate.ji(),d(a).next(b=>this.referenceDelegate.Wi(a).next(()=>b)).toPromise().then(b=>(a.raiseOnCommittedEvent(),b))}zi(b,c){return a.or(Object.values(this.Gi).map(a=>()=>a.containsKey(b,c)))}},mV=class extends kQ{constructor(a){super(),this.currentSequenceNumber=a}},js=class{constructor(a){this.persistence=a,this.Hi=new eL,this.Ji=null}static Yi(a){return new js(a)}get Xi(){if(this.Ji)return this.Ji;throw g()}addReference(d,c,b){return this.Hi.addReference(b,c),this.Xi.delete(b.toString()),a.resolve()}removeReference(d,c,b){return this.Hi.removeReference(b,c),this.Xi.add(b.toString()),a.resolve()}markPotentiallyOrphaned(c,b){return this.Xi.add(b.toString()),a.resolve()}removeTarget(b,a){this.Hi.vi(a.targetId).forEach(a=>this.Xi.add(a.toString()));const c=this.persistence.getTargetCache();return c.getMatchingKeysForTargetId(b,a.targetId).next(a=>{a.forEach(a=>this.Xi.add(a.toString()))}).next(()=>c.removeTargetData(b,a))}ji(){this.Ji=new Set}Wi(b){const c=this.persistence.getRemoteDocumentCache().newChangeBuffer();return a.forEach(this.Xi,e=>{const a=d.fromPath(e);return this.Zi(b,a).next(b=>{b||c.removeEntry(a,h.min())})}).next(()=>(this.Ji=null,c.apply(b)))}updateLimboDocument(b,a){return this.Zi(b,a).next(b=>{b?this.Xi.delete(a.toString()):this.Xi.add(a.toString())})}Qi(a){return 0}Zi(c,b){return a.or([()=>a.resolve(this.Hi.containsKey(b)),()=>this.persistence.getTargetCache().containsKey(c,b),()=>this.persistence.zi(c,b)])}},jq=class{constructor(){this.activeTargetIds=jz()}nr(a){this.activeTargetIds=this.activeTargetIds.add(a)}sr(a){this.activeTargetIds=this.activeTargetIds.delete(a)}er(){const a={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(a)}},jn=class{constructor(){this.Ur=new jq,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(a){}updateMutationState(a,b,c){}addLocalQueryTarget(a){return this.Ur.nr(a),this.qr[a]||"not-current"}updateQueryState(a,b,c){this.qr[a]=b}removeLocalQueryTarget(a){this.Ur.sr(a)}isLocalQueryTarget(a){return this.Ur.activeTargetIds.has(a)}clearQueryState(a){delete this.qr[a]}getAllActiveQueryTargets(){return this.Ur.activeTargetIds}isActiveQueryTarget(a){return this.Ur.activeTargetIds.has(a)}start(){return this.Ur=new jq,Promise.resolve()}handleUserChange(a,b,c){}setOnlineState(a){}shutdown(){}writeSequenceNumber(a){}notifyBundleLoaded(a){}},mZ=class{Kr(a){}shutdown(){}},jk=class{constructor(){this.Gr=()=>this.Qr(),this.jr=()=>this.Wr(),this.zr=[],this.Hr()}Kr(a){this.zr.push(a)}shutdown(){window.removeEventListener("online",this.Gr),window.removeEventListener("offline",this.jr)}Hr(){window.addEventListener("online",this.Gr),window.addEventListener("offline",this.jr)}Qr(){c("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const a of this.zr)a(0)}Wr(){c("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const a of this.zr)a(1)}static vt(){return typeof window!="undefined"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}},m$={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},na=class{constructor(a){this.Jr=a.Jr,this.Yr=a.Yr}Xr(a){this.Zr=a}eo(a){this.no=a}onMessage(a){this.so=a}close(){this.Yr()}send(a){this.Jr(a)}io(){this.Zr()}ro(a){this.no(a)}oo(a){this.so(a)}},nb=class extends class{constructor(a){this.databaseInfo=a,this.databaseId=a.databaseId;const b=a.ssl?"https":"http";this.uo=b+"://"+a.host,this.ao="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}co(a,f,b,g,h){const d=this.ho(a,f);c("RestConnection","Sending: ",d,b);const e={};return this.lo(e,g,h),this.fo(a,d,e,b).then(a=>(c("RestConnection","Received: ",a),a),c=>{throw gp("RestConnection",`${a} failed with error: `,c,"url: ",d,"request:",b),c})}_o(a,b,c,d,e){return this.co(a,b,c,d,e)}lo(a,b,c){a["X-Goog-Api-Client"]="gl-js/ fire/"+bu,a["Content-Type"]="text/plain",this.databaseInfo.appId&&(a["X-Firebase-GMPID"]=this.databaseInfo.appId),b&&b.headers.forEach((b,c)=>a[c]=b),c&&c.headers.forEach((b,c)=>a[c]=b)}ho(a,b){const c=m$[a];return`${this.uo}/v1/${b}:${c}`}}{constructor(a){super(a),this.forceLongPolling=a.forceLongPolling,this.autoDetectLongPolling=a.autoDetectLongPolling,this.useFetchStreams=a.useFetchStreams}fo(a,d,f,h){return new Promise((k,j)=>{const i=new oA;i.listenOnce(oF.COMPLETE,()=>{try{switch(i.getLastErrorCode()){case gb.NO_ERROR:const d=i.getResponseJson();c("Connection","XHR received:",JSON.stringify(d)),k(d);break;case gb.TIMEOUT:c("Connection",'RPC "'+a+'" timed out'),j(new e(b.DEADLINE_EXCEEDED,"Request time out"));break;case gb.HTTP_ERROR:const f=i.getStatus();if(c("Connection",'RPC "'+a+'" failed with status:',f,"response text:",i.getResponseText()),f>0){const a=i.getResponseJson().error;if(a&&a.status&&a.message){const c=function(c){const a=c.toLowerCase().replace(/_/g,"-");return Object.values(b).indexOf(a)>=0?a:b.UNKNOWN}(a.status);j(new e(c,a.message))}else j(new e(b.UNKNOWN,"Server responded with status "+i.getStatus()))}else j(new e(b.UNAVAILABLE,"Connection failed."));break;default:g()}}finally{c("Connection",'RPC "'+a+'" completed.')}});const l=JSON.stringify(h);i.send(d,"POST",l,f,15)})}wo(q,p,o){const n=[this.uo,"/","google.firestore.v1.Firestore","/",q,"/channel"],m=oJ(),l=oG(),g={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(g.xmlHttpFactory=new oC({})),this.lo(g.initMessageHeaders,p,o),tP()||tD()||tB()||tA()||tx()||tK()||(g.httpHeadersOverwriteParam="$httpHeaders");const i=n.join("");c("Connection","Creating WebChannel: "+i,g);const d=m.createWebChannel(i,g);let j=!1,a=!1;const f=new na({Jr:b=>{a?c("Connection","Not sending because WebChannel is closed:",b):(j||(c("Connection","Opening WebChannel transport."),d.open(),j=!0),c("Connection","WebChannel sending:",b),d.send(b))},Yr:()=>d.close()}),h=(a,b,c)=>{a.listen(b,a=>{try{c(a)}catch(a){setTimeout(()=>{throw a},0)}})};return h(d,cV.EventType.OPEN,()=>{a||c("Connection","WebChannel transport opened.")}),h(d,cV.EventType.CLOSE,()=>{a||(a=!0,c("Connection","WebChannel transport closed"),f.ro())}),h(d,cV.EventType.ERROR,c=>{a||(a=!0,gp("Connection","WebChannel transport errored:",c),f.ro(new e(b.UNAVAILABLE,"The operation could not be completed")))}),h(d,cV.EventType.MESSAGE,h=>{var g;if(!a){const j=h.data[0];k(!!j);const l=j,i=l.error||((g=l[0])===null||g===void 0?void 0:g.error);if(i){c("Connection","WebChannel received error:",i);const h=i.status;let g=function(b){const a=w[b];if(a!==void 0)return jo(a)}(h),j=i.message;g===void 0&&(g=b.INTERNAL,j="Unknown error status: "+h+" with message "+i.message),a=!0,f.ro(new e(g,j)),d.close()}else c("Connection","WebChannel received:",j),f.oo(j)}}),h(l,oD.STAT_EVENT,a=>{a.stat===gr.PROXY?c("Connection","Detected buffering proxy"):a.stat===gr.NOPROXY&&c("Connection","Detected no buffering proxy")}),setTimeout(()=>{f.io()},0),f}};function nc(){return typeof window!="undefined"?window:null}function dA(){return typeof document!="undefined"?document:null}function du(a){return new mB(a,!0)}iW=class{constructor(a,b,c=1e3,d=1.5,e=6e4){this.Yn=a,this.timerId=b,this.mo=c,this.yo=d,this.po=e,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const b=Math.floor(this.Io+this.bo()),d=Math.max(0,Date.now()-this.Eo),a=Math.max(0,b-d);a>0&&c("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.Io} ms, delay with jitter: ${b} ms, last attempt: ${d} ms ago)`),this.To=this.Yn.enqueueAfterDelay(this.timerId,a,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){this.To!==null&&(this.To.skipDelay(),this.To=null)}cancel(){this.To!==null&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}},iV=class{constructor(a,b,c,d,e,f,g,h){this.Yn=a,this.Vo=c,this.vo=d,this.So=e,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=g,this.listener=h,this.state=0,this.Do=0,this.Co=null,this.xo=null,this.stream=null,this.No=new iW(a,b)}ko(){return this.state===1||this.state===5||this.Mo()}Mo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Oo()}async stop(){this.ko()&&await this.close(0)}Fo(){this.state=0,this.No.reset()}$o(){this.Mo()&&this.Co===null&&(this.Co=this.Yn.enqueueAfterDelay(this.Vo,6e4,()=>this.Bo()))}Lo(a){this.Uo(),this.stream.send(a)}async Bo(){if(this.Mo())return this.close(0)}Uo(){this.Co&&(this.Co.cancel(),this.Co=null)}qo(){this.xo&&(this.xo.cancel(),this.xo=null)}async close(c,a){this.Uo(),this.qo(),this.No.cancel(),this.Do++,c!==4?this.No.reset():a&&a.code===b.RESOURCE_EXHAUSTED?(S(a.toString()),S("Using maximum backoff delay to prevent overloading the backend."),this.No.Ao()):a&&a.code===b.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Ko(),this.stream.close(),this.stream=null),this.state=c,await this.listener.eo(a)}Ko(){}auth(){this.state=1;const a=this.Go(this.Do),c=this.Do;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,b])=>{this.Do===c&&this.Qo(a,b)},c=>{a(()=>{const a=new e(b.UNKNOWN,"Fetching auth token failed: "+c.message);return this.jo(a)})})}Qo(b,c){const a=this.Go(this.Do);this.stream=this.Wo(b,c),this.stream.Xr(()=>{a(()=>(this.state=2,this.xo=this.Yn.enqueueAfterDelay(this.vo,1e4,()=>(this.Mo()&&(this.state=3),Promise.resolve())),this.listener.Xr()))}),this.stream.eo(b=>{a(()=>this.jo(b))}),this.stream.onMessage(b=>{a(()=>this.onMessage(b))})}Oo(){this.state=5,this.No.Ro(async()=>{this.state=0,this.start()})}jo(a){return c("PersistentStream",`close with error: ${a}`),this.stream=null,this.close(4,a)}Go(a){return b=>{this.Yn.enqueueAndForget(()=>this.Do===a?b():(c("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},nh=class extends iV{constructor(a,b,c,d,e,f){super(a,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",b,c,d,f),this.M=e}Wo(a,b){return this.So.wo("Listen",a,b)}onMessage(a){this.No.reset();const b=mv(this.M,a),c=function(b){if(!("targetChange"in b))return h.min();const a=b.targetChange;return a.targetIds&&a.targetIds.length?h.min():a.readTime?U(a.readTime):h.min()}(a);return this.listener.zo(b,c)}Ho(b){const a={};a.database=eE(this.M),a.addTarget=function(c,a){let b;const d=a.target;return b=c$(d)?{documents:kc(c,d)}:{query:kd(c,d)},b.targetId=a.targetId,a.resumeToken.approximateByteSize()>0?b.resumeToken=jN(c,a.resumeToken):a.snapshotVersion.compareTo(h.min())>0&&(b.readTime=ct(c,a.snapshotVersion.toTimestamp())),b}(this.M,b);const c=mt(this.M,b);c&&(a.labels=c),this.Lo(a)}Jo(b){const a={};a.database=eE(this.M),a.removeTarget=b,this.Lo(a)}},ni=class extends iV{constructor(a,b,c,d,e,f){super(a,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",b,c,d,f),this.M=e,this.Yo=!1}get Xo(){return this.Yo}start(){this.Yo=!1,this.lastStreamToken=void 0,super.start()}Ko(){this.Yo&&this.Zo([])}Wo(a,b){return this.So.wo("Write",a,b)}onMessage(a){if(k(!!a.streamToken),this.lastStreamToken=a.streamToken,this.Yo){this.No.reset();const b=mu(a.writeResults,a.commitTime),c=U(a.commitTime);return this.listener.tu(c,b)}return k(!a.writeResults||a.writeResults.length===0),this.Yo=!0,this.listener.eu()}nu(){const a={};a.database=eE(this.M),this.Lo(a)}Zo(a){const b={streamToken:this.lastStreamToken,writes:a.map(a=>dl(this.M,a))};this.Lo(b)}},nj=class extends class{}{constructor(a,b,c,d){super(),this.authCredentials=a,this.appCheckCredentials=b,this.So=c,this.M=d,this.su=!1}iu(){if(this.su)throw new e(b.FAILED_PRECONDITION,"The client has already been terminated.")}co(a,c,d){return this.iu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([b,e])=>this.So.co(a,c,d,b,e)).catch(a=>{throw a.name==="FirebaseError"?(a.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new e(b.UNKNOWN,a.toString())})}_o(a,c,d){return this.iu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([b,e])=>this.So._o(a,c,d,b,e)).catch(a=>{throw a.name==="FirebaseError"?(a.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new e(b.UNKNOWN,a.toString())})}terminate(){this.su=!0}},nk=class{constructor(a,b){this.asyncQueue=a,this.onlineStateHandler=b,this.state="Unknown",this.ru=0,this.ou=null,this.uu=!0}au(){this.ru===0&&(this.cu("Unknown"),this.ou=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ou=null,this.hu("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}lu(a){this.state==="Online"?this.cu("Unknown"):(this.ru++,this.ru>=1&&(this.fu(),this.hu(`Connection failed 1 times. Most recent error: ${a.toString()}`),this.cu("Offline")))}set(a){this.fu(),this.ru=0,a==="Online"&&(this.uu=!1),this.cu(a)}cu(a){a!==this.state&&(this.state=a,this.onlineStateHandler(a))}hu(b){const a=`Could not reach Cloud Firestore backend. ${b}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.uu?(S(a),this.uu=!1):c("OnlineStateTracker",a)}fu(){this.ou!==null&&(this.ou.cancel(),this.ou=null)}},nl=class{constructor(b,d,a,e,f){this.localStore=b,this.datastore=d,this.asyncQueue=a,this.remoteSyncer={},this.du=[],this._u=new Map,this.wu=new Set,this.mu=[],this.gu=f,this.gu.Kr(b=>{a.enqueueAndForget(async()=>{aK(this)&&(c("RemoteStore","Restarting streams for network reachability change."),await async function(b){const a=j(b);a.wu.add(4),await ca(a),a.yu.set("Unknown"),a.wu.delete(4),await ds(a)}(this))})}),this.yu=new nk(a,e)}};async function ds(a){if(aK(a))for(const b of a.mu)await b(!0)}async function ca(a){for(const b of a.mu)await b(!1)}function iK(c,b){const a=j(c);a._u.has(b.targetId)||(a._u.set(b.targetId,b),fj(a)?fd(a):bb(a).Mo()&&fa(a,b))}function iI(d,c){const a=j(d),b=bb(a);a._u.delete(c),b.Mo()&&iD(a,c),a._u.size===0&&(b.Mo()?b.$o():aK(a)&&a.yu.set("Unknown"))}function fa(a,b){a.pu.Z(b.targetId),bb(a).Ho(b)}function iD(a,b){a.pu.Z(b),bb(a).Jo(b)}function fd(a){a.pu=new mJ({getRemoteKeysForTarget:b=>a.remoteSyncer.getRemoteKeysForTarget(b),Et:b=>a._u.get(b)||null}),bb(a).start(),a.yu.au()}function fj(a){return aK(a)&&!bb(a).ko()&&a._u.size>0}function aK(a){return j(a).wu.size===0}function il(a){a.pu=void 0}async function nw(a){a._u.forEach((b,c)=>{fa(a,b)})}async function nx(a,b){il(a),fj(a)?(a.yu.lu(b),fd(a)):a.yu.set("Unknown")}async function ny(b,a,d){if(b.yu.set("Online"),a instanceof jE&&a.state===2&&a.cause)try{await async function(a,b){const c=b.cause;for(const d of b.targetIds)a._u.has(d)&&(await a.remoteSyncer.rejectListen(d,c),a._u.delete(d),a.pu.removeTarget(d))}(b,a)}catch(d){c("RemoteStore","Failed to remove targets %s: %s ",a.targetIds.join(","),d),await dj(b,d)}else if(a instanceof dH?b.pu.ut(a):a instanceof jD?b.pu._t(a):b.pu.ht(a),!d.isEqual(h.min()))try{const a=await jJ(b.localStore);d.compareTo(a)>=0&&await function(a,c){const b=a.pu.yt(c);return b.targetChanges.forEach((b,d)=>{if(b.resumeToken.approximateByteSize()>0){const e=a._u.get(d);e&&a._u.set(d,e.withResumeToken(b.resumeToken,c))}}),b.targetMismatches.forEach(c=>{const b=a._u.get(c);if(!b)return;a._u.set(c,b.withResumeToken(D.EMPTY_BYTE_STRING,b.snapshotVersion)),iD(a,c);const d=new aZ(b.target,c,1,b.sequenceNumber);fa(a,d)}),a.remoteSyncer.applyRemoteEvent(b)}(b,d)}catch(a){c("RemoteStore","Failed to raise snapshot:",a),await dj(b,a)}}async function dj(a,d,b){if(!aG(d))throw d;a.wu.add(1),await ca(a),a.yu.set("Offline"),b||(b=()=>jJ(a.localStore)),a.asyncQueue.enqueueRetryable(async()=>{c("RemoteStore","Retrying IndexedDB access"),await b(),a.wu.delete(1),await ds(a)})}function ih(b,a){return a().catch(c=>dj(b,c,a))}async function cN(c){const a=j(c),d=ax(a);let b=a.du.length>0?a.du[a.du.length-1].batchId:-1;for(;nC(a);)try{const c=await mH(a.localStore,b);if(c===null){a.du.length===0&&d.$o();break}b=c.batchId,nD(a,c)}catch(b){await dj(a,b)}ie(a)&&ic(a)}function nC(a){return aK(a)&&a.du.length<10}function nD(b,c){b.du.push(c);const a=ax(b);a.Mo()&&a.Xo&&a.Zo(c.mutations)}function ie(a){return aK(a)&&!ax(a).ko()&&a.du.length>0}function ic(a){ax(a).start()}async function nG(a){ax(a).nu()}async function nH(a){const b=ax(a);for(const c of a.du)b.Zo(c.mutations)}async function nI(a,b,c){const d=a.du.shift(),e=lc.from(d,b,c);await ih(a,()=>a.remoteSyncer.applySuccessfulWrite(e)),await cN(a)}async function nJ(a,c){c&&ax(a).Xo&&await async function(a,d){if(c=d.code,mY(c)&&c!==b.ABORTED){const b=a.du.shift();ax(a).Fo(),await ih(a,()=>a.remoteSyncer.rejectFailedWrite(b.batchId,d)),await cN(a)}var c}(a,c),ie(a)&&ic(a)}async function ib(b,d){const a=j(b);a.asyncQueue.verifyOperationInProgress(),c("RemoteStore","RemoteStore received new credentials");const e=aK(a);a.wu.add(3),await ca(a),e&&a.yu.set("Unknown"),await a.remoteSyncer.handleCredentialChange(d),a.wu.delete(3),await ds(a)}async function nL(c,b){const a=j(c);b?(a.wu.delete(2),await ds(a)):b||(a.wu.add(2),await ca(a),a.yu.set("Unknown"))}function bb(a){return a.Iu||(a.Iu=function(b,c,d){const a=j(b);return a.iu(),new nh(c,a.So,a.authCredentials,a.appCheckCredentials,a.M,d)}(a.datastore,a.asyncQueue,{Xr:nw.bind(null,a),eo:nx.bind(null,a),zo:ny.bind(null,a)}),a.mu.push(async b=>{b?(a.Iu.Fo(),fj(a)?fd(a):a.yu.set("Unknown")):(await a.Iu.stop(),il(a))})),a.Iu}function ax(a){return a.Tu||(a.Tu=function(b,c,d){const a=j(b);return a.iu(),new ni(c,a.So,a.authCredentials,a.appCheckCredentials,a.M,d)}(a.datastore,a.asyncQueue,{Xr:nG.bind(null,a),eo:nJ.bind(null,a),eu:nH.bind(null,a),tu:nI.bind(null,a)}),a.mu.push(async b=>{b?(a.Tu.Fo(),await cN(a)):(await a.Tu.stop(),a.du.length>0&&(c("RemoteStore",`Stopping write stream with ${a.du.length} pending writes`),a.du=[]))})),a.Tu}hS=class{constructor(a,b,c,d,e){this.asyncQueue=a,this.timerId=b,this.targetTimeMs=c,this.op=d,this.removalCallback=e,this.deferred=new ab,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}static createAndSchedule(g,c,b,d,e){const f=Date.now()+b,a=new hS(g,c,f,d,e);return a.start(b),a}start(a){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),a)}skipDelay(){return this.handleDelayElapsed()}cancel(a){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new e(b.CANCELLED,"Operation cancelled"+(a?": "+a:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(a=>this.deferred.resolve(a))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function hJ(a,c){if(S("AsyncQueue",`${c}: ${a}`),aG(a))return new e(b.UNAVAILABLE,`${c}: ${a}`);throw a}bG=class{constructor(a){this.comparator=a?(b,c)=>a(b,c)||d.comparator(b.key,c.key):(a,b)=>d.comparator(a.key,b.key),this.keyedMap=eO(),this.sortedSet=new G(this.comparator)}static emptySet(a){return new bG(a.comparator)}has(a){return this.keyedMap.get(a)!=null}get(a){return this.keyedMap.get(a)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(b){const a=this.keyedMap.get(b);return a?this.sortedSet.indexOf(a):-1}get size(){return this.sortedSet.size}forEach(a){this.sortedSet.inorderTraversal((b,c)=>(a(b),!1))}add(a){const b=this.delete(a.key);return b.copy(b.keyedMap.insert(a.key,a),b.sortedSet.insert(a,null))}delete(a){const b=this.get(a);return b?this.copy(this.keyedMap.remove(a),this.sortedSet.remove(b)):this}isEqual(a){if(!(a instanceof bG))return!1;if(this.size!==a.size)return!1;const b=this.sortedSet.getIterator(),c=a.sortedSet.getIterator();for(;b.hasNext();){const a=b.getNext().key,d=c.getNext().key;if(!a.isEqual(d))return!1}return!0}toString(){const a=[];return this.forEach(b=>{a.push(b.toString())}),a.length===0?"DocumentSet ()":"DocumentSet (\n  "+a.join("  \n")+"\n)"}copy(b,c){const a=new bG;return a.comparator=this.comparator,a.keyedMap=b,a.sortedSet=c,a}},hG=class{constructor(){this.Eu=new G(d.comparator)}track(a){const c=a.doc.key,b=this.Eu.get(c);b?a.type!==0&&b.type===3?this.Eu=this.Eu.insert(c,a):a.type===3&&b.type!==1?this.Eu=this.Eu.insert(c,{type:b.type,doc:a.doc}):a.type===2&&b.type===2?this.Eu=this.Eu.insert(c,{type:2,doc:a.doc}):a.type===2&&b.type===0?this.Eu=this.Eu.insert(c,{type:0,doc:a.doc}):a.type===1&&b.type===0?this.Eu=this.Eu.remove(c):a.type===1&&b.type===2?this.Eu=this.Eu.insert(c,{type:1,doc:b.doc}):a.type===0&&b.type===1?this.Eu=this.Eu.insert(c,{type:2,doc:a.doc}):g():this.Eu=this.Eu.insert(c,a)}Au(){const a=[];return this.Eu.inorderTraversal((c,b)=>{a.push(b)}),a}},bQ=class{constructor(a,b,c,d,e,f,g,h){this.query=a,this.docs=b,this.oldDocs=c,this.docChanges=d,this.mutatedKeys=e,this.fromCache=f,this.syncStateChanged=g,this.excludesMetadataChanges=h}static fromInitialDocuments(c,a,d,e){const b=[];return a.forEach(a=>{b.push({type:0,doc:a})}),new bQ(c,a,bG.emptySet(a),b,d,e,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(a){if(!(this.fromCache===a.fromCache&&this.syncStateChanged===a.syncStateChanged&&this.mutatedKeys.isEqual(a.mutatedKeys)&&dm(this.query,a.query)&&this.docs.isEqual(a.docs)&&this.oldDocs.isEqual(a.oldDocs)))return!1;const b=this.docChanges,c=a.docChanges;if(b.length!==c.length)return!1;for(let a=0;a<b.length;a++)if(b[a].type!==c[a].type||!b[a].doc.isEqual(c[a].doc))return!1;return!0}},nT=class{constructor(){this.Ru=void 0,this.listeners=[]}},nU=class{constructor(){this.queries=new am(a=>iA(a),dm),this.onlineState="Unknown",this.bu=new Set}};async function hx(f,b){const c=j(f),d=b.query;let e=!1,a=c.queries.get(d);if(a||(e=!0,a=new nT),e)try{a.Ru=await c.onListen(d)}catch(a){const c=hJ(a,`Initialization of query '${fc(b.query)}' failed`);return void b.onError(c)}c.queries.set(d,a),a.listeners.push(b),b.Pu(c.onlineState),a.Ru&&b.Vu(a.Ru)&&fQ(c)}async function he(f,d){const b=j(f),c=d.query;let e=!1;const a=b.queries.get(c);if(a){const b=a.listeners.indexOf(d);b>=0&&(a.listeners.splice(b,1),e=a.listeners.length===0)}if(e)return b.queries.delete(c),b.onUnlisten(c)}function nX(c,d){const a=j(c);let b=!1;for(const c of d){const f=c.query,e=a.queries.get(f);if(e){for(const a of e.listeners)a.Vu(c)&&(b=!0);e.Ru=c}}b&&fQ(a)}function nY(d,a,e){const b=j(d),c=b.queries.get(a);if(c)for(const a of c.listeners)a.onError(e);b.queries.delete(a)}function fQ(a){a.bu.forEach(a=>{a.next()})}gV=class{constructor(a,b,c){this.query=a,this.vu=b,this.Su=!1,this.Du=null,this.onlineState="Unknown",this.options=c||{}}Vu(a){if(!this.options.includeMetadataChanges){const b=[];for(const c of a.docChanges)c.type!==3&&b.push(c);a=new bQ(a.query,a.docs,a.oldDocs,b,a.mutatedKeys,a.fromCache,a.syncStateChanged,!0)}let b=!1;return this.Su?this.Cu(a)&&(this.vu.next(a),b=!0):this.xu(a,this.onlineState)&&(this.Nu(a),b=!0),this.Du=a,b}onError(a){this.vu.error(a)}Pu(a){this.onlineState=a;let b=!1;return this.Du&&!this.Su&&this.xu(this.Du,a)&&(this.Nu(this.Du),b=!0),b}xu(a,b){if(!a.fromCache)return!0;const c=b!=="Offline";return(!this.options.ku||!c)&&(!a.docs.isEmpty()||b==="Offline")}Cu(a){if(a.docChanges.length>0)return!0;const b=this.Du&&this.Du.hasPendingWrites!==a.hasPendingWrites;return!(!a.syncStateChanged&&!b)&&this.options.includeMetadataChanges===!0}Nu(a){a=bQ.fromInitialDocuments(a.query,a.docs,a.mutatedKeys,a.fromCache),this.Su=!0,this.vu.next(a)}},gT=class{constructor(a){this.key=a}},gR=class{constructor(a){this.key=a}},ob=class{constructor(a,b){this.query=a,this.Uu=b,this.qu=null,this.current=!1,this.Ku=r(),this.mutatedKeys=r(),this.Gu=iE(a),this.Qu=new bG(this.Gu)}get ju(){return this.Uu}Wu(i,c){const d=c?c.zu:new hG,e=c?c.Qu:this.Qu;let b=c?c.mutatedKeys:this.mutatedKeys,a=e,f=!1;const g=this.query.limitType==="F"&&e.size===this.query.limit?e.last():null,h=this.query.limitType==="L"&&e.size===this.query.limit?e.first():null;if(i.inorderTraversal((j,l)=>{const i=e.get(j),c=fb(this.query,l)?l:null,n=!!i&&this.mutatedKeys.has(i.key),m=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations);let k=!1;i&&c?i.data.isEqual(c.data)?n!==m&&(d.track({type:3,doc:c}),k=!0):this.Hu(i,c)||(d.track({type:2,doc:c}),k=!0,(g&&this.Gu(c,g)>0||h&&this.Gu(c,h)<0)&&(f=!0)):!i&&c?(d.track({type:0,doc:c}),k=!0):i&&!c&&(d.track({type:1,doc:i}),k=!0,(g||h)&&(f=!0)),k&&(c?(a=a.add(c),b=m?b.add(j):b.delete(j)):(a=a.delete(j),b=b.delete(j)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const c=this.query.limitType==="F"?a.last():a.first();a=a.delete(c.key),b=b.delete(c.key),d.track({type:1,doc:c})}return{Qu:a,zu:d,ii:f,mutatedKeys:b}}Hu(b,a){return b.hasLocalMutations&&a.hasCommittedMutations&&!a.hasLocalMutations}applyChanges(a,i,f){const h=this.Qu;this.Qu=a.Qu,this.mutatedKeys=a.mutatedKeys;const b=a.zu.Au();b.sort((a,b)=>function(b,c){const a=a=>{switch(a){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return g()}};return a(b)-a(c)}(a.type,b.type)||this.Gu(a.doc,b.doc)),this.Ju(f);const e=i?this.Yu():[],c=this.Ku.size===0&&this.current?1:0,d=c!==this.qu;return this.qu=c,b.length!==0||d?{snapshot:new bQ(this.query,a.Qu,h,b,a.mutatedKeys,c===0,d,!1),Xu:e}:{Xu:e}}Pu(a){return this.current&&a==="Offline"?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new hG,mutatedKeys:this.mutatedKeys,ii:!1},!1)):{Xu:[]}}Zu(a){return!this.Uu.has(a)&&!!this.Qu.has(a)&&!this.Qu.get(a).hasLocalMutations}Ju(a){a&&(a.addedDocuments.forEach(a=>this.Uu=this.Uu.add(a)),a.modifiedDocuments.forEach(a=>{}),a.removedDocuments.forEach(a=>this.Uu=this.Uu.delete(a)),this.current=a.current)}Yu(){if(!this.current)return[];const b=this.Ku;this.Ku=r(),this.Qu.forEach(a=>{this.Zu(a.key)&&(this.Ku=this.Ku.add(a.key))});const a=[];return b.forEach(b=>{this.Ku.has(b)||a.push(new gR(b))}),this.Ku.forEach(c=>{b.has(c)||a.push(new gT(c))}),a}ta(a){this.Uu=a._i,this.Ku=r();const b=this.Wu(a.documents);return this.applyChanges(b,!0)}ea(){return bQ.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,this.qu===0)}},oc=class{constructor(a,b,c){this.query=a,this.targetId=b,this.view=c}},od=class{constructor(a){this.key=a,this.na=!1}},oe=class{constructor(a,b,c,e,f,g){this.localStore=a,this.remoteStore=b,this.eventManager=c,this.sharedClientState=e,this.currentUser=f,this.maxConcurrentLimboResolutions=g,this.sa={},this.ia=new am(a=>iA(a),dm),this.ra=new Map,this.oa=new Set,this.ua=new G(d.comparator),this.aa=new Map,this.ca=new eL,this.ha={},this.la=new Map,this.fa=bz.yn(),this.onlineState="Unknown",this.da=void 0}get isPrimaryClient(){return this.da===!0}};async function og(f,c){const a=oy(f);let b,d;const e=a.ia.get(c);if(e)b=e.targetId,a.sharedClientState.addLocalQueryTarget(b),d=e.view.ea();else{const e=await mI(a.localStore,af(c));a.isPrimaryClient&&iK(a.remoteStore,e);const f=a.sharedClientState.addLocalQueryTarget(e.targetId);b=e.targetId,d=await oh(a,c,b,f==="current")}return d}async function oh(a,b,c,g){a._a=(b,c,d)=>async function(c,a,f,d){let b=a.view.Wu(f);b.ii&&(b=await jy(c.localStore,a.query,!1).then(({documents:c})=>a.view.Wu(c,b)));const g=d&&d.targetChanges.get(a.targetId),e=a.view.applyChanges(b,c.isPrimaryClient,g);return gz(c,a.targetId,e.Xu),e.snapshot}(a,b,c,d);const e=await jy(a.localStore,b,!0),d=new ob(b,e._i),h=d.Wu(e.documents),i=dF.createSynthesizedTargetChangeForCurrentChange(c,g&&a.onlineState!=="Offline"),f=d.applyChanges(h,a.isPrimaryClient,i);gz(a,c,f.Xu);const j=new oc(b,c,d);return a.ia.set(b,j),a.ra.has(c)?a.ra.get(c).push(b):a.ra.set(c,[b]),f.snapshot}async function oi(e,c){const a=j(e),b=a.ia.get(c),d=a.ra.get(b.targetId);if(d.length>1)return a.ra.set(b.targetId,d.filter(a=>!dm(a,c))),void a.ia.delete(c);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(b.targetId),a.sharedClientState.isActiveQueryTarget(b.targetId)||await eI(a.localStore,b.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(b.targetId),iI(a.remoteStore,b.targetId),f_(a,b.targetId)}).catch(bw)):(f_(a,b.targetId),await eI(a.localStore,b.targetId,!0))}async function gG(c,a){const b=j(c);try{const c=await mF(b.localStore,a);a.targetChanges.forEach((a,d)=>{const c=b.aa.get(d);c&&(k(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1),a.addedDocuments.size>0?c.na=!0:a.modifiedDocuments.size>0?k(c.na):a.removedDocuments.size>0&&(k(c.na),c.na=!1))}),await cG(b,c,a)}catch(a){await bw(a)}}function gF(d,b,c){const a=j(d);if(a.isPrimaryClient&&c===0||!a.isPrimaryClient&&c===1){const c=[];a.ia.forEach((e,d)=>{const a=d.view.Pu(b);a.snapshot&&c.push(a.snapshot)}),function(d,b){const a=j(d);a.onlineState=b;let c=!1;a.queries.forEach((d,a)=>{for(const d of a.listeners)d.Pu(b)&&(c=!0)}),c&&fQ(a)}(a.eventManager,b),c.length&&a.sa.zo(c),a.onlineState=b,a.isPrimaryClient&&a.sharedClientState.setOnlineState(b)}}async function ol(g,b,e){const a=j(g);a.sharedClientState.updateQueryState(b,"rejected",e);const f=a.aa.get(b),c=f&&f.key;if(c){let e=new G(d.comparator);e=e.insert(c,v.newNoDocument(c,h.min()));const f=r().add(c),g=new eK(h.min(),new Map,new s(l),e,f);await gG(a,g),a.ua=a.ua.remove(c),a.aa.delete(b),f$(a)}else await eI(a.localStore,b,!1).then(()=>f_(a,b,e)).catch(bw)}async function om(d,c){const a=j(d),b=c.batch.batchId;try{const d=await mD(a.localStore,c);gC(a,b,null),gD(a,b),a.sharedClientState.updateMutationState(b,"acknowledged"),await cG(a,d)}catch(a){await bw(a)}}async function on(d,b,c){const a=j(d);try{const d=await function(b,c){const a=j(b);return a.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let d;return a.Bs.lookupMutationBatch(b,c).next(c=>(k(c!==null),d=c.keys(),a.Bs.removeMutationBatch(b,c))).next(()=>a.Bs.performConsistencyCheck(b)).next(()=>a.fi.Ks(b,d))})}(a.localStore,b);gC(a,b,c),gD(a,b),a.sharedClientState.updateMutationState(b,"rejected",c),await cG(a,d)}catch(a){await bw(a)}}function gD(a,b){(a.la.get(b)||[]).forEach(a=>{a.resolve()}),a.la.delete(b)}function gC(e,c,d){const b=j(e);let a=b.ha[b.currentUser.toKey()];if(a){const e=a.get(c);e&&(d?e.reject(d):e.resolve(),a=a.remove(c)),b.ha[b.currentUser.toKey()]=a}}function f_(a,b,c=null){a.sharedClientState.removeLocalQueryTarget(b);for(const d of a.ra.get(b))a.ia.delete(d),c&&a.sa.wa(d,c);a.ra.delete(b),a.isPrimaryClient&&a.ca.vi(b).forEach(b=>{a.ca.containsKey(b)||gA(a,b)})}function gA(a,b){a.oa.delete(b.path.canonicalString());const c=a.ua.get(b);c!==null&&(iI(a.remoteStore,c),a.ua=a.ua.remove(b),a.aa.delete(c),f$(a))}function gz(a,b,d){for(const e of d)e instanceof gT?(a.ca.addReference(e.key,b),ot(a,e)):e instanceof gR?(c("SyncEngine","Document no longer in limbo: "+e.key),a.ca.removeReference(e.key,b),a.ca.containsKey(e.key)||gA(a,e.key)):g()}function ot(a,e){const b=e.key,d=b.path.canonicalString();a.ua.get(b)||a.oa.has(d)||(c("SyncEngine","New document in limbo: "+b),a.oa.add(d),f$(a))}function f$(a){for(;a.oa.size>0&&a.ua.size<a.maxConcurrentLimboResolutions;){const e=a.oa.values().next().value;a.oa.delete(e);const b=new d(q.fromString(e)),c=a.fa.next();a.aa.set(c,new od(b)),a.ua=a.ua.insert(b,c),iK(a.remoteStore,new aZ(af(dk(b.path)),c,2,X.A))}}async function cG(i,g,h){const b=j(i),e=[],f=[],d=[];b.ia.isEmpty()||(b.ia.forEach((c,a)=>{d.push(b._a(a,g,h).then(c=>{if(c){b.isPrimaryClient&&b.sharedClientState.updateQueryState(a.targetId,c.fromCache?"not-current":"current"),e.push(c);const d=jZ.Ys(a.targetId,c);f.push(d)}}))}),await Promise.all(d),b.sa.zo(e),await async function(e,d){const b=j(e);try{await b.persistence.runTransaction("notifyLocalViewChanges","readwrite",c=>a.forEach(d,d=>a.forEach(d.Hs,a=>b.persistence.referenceDelegate.addReference(c,d.targetId,a)).next(()=>a.forEach(d.Js,a=>b.persistence.referenceDelegate.removeReference(c,d.targetId,a)))))}catch(a){if(!aG(a))throw a;c("LocalStore","Failed to update sequence numbers: "+a)}for(const a of d){const c=a.targetId;if(!a.fromCache){const a=b.ui.get(c),d=a.snapshotVersion,e=a.withLastLimboFreeSnapshotVersion(d);b.ui=b.ui.insert(c,e)}}}(b.localStore,f))}async function ow(f,d){const a=j(f);if(!a.currentUser.isEqual(d)){c("SyncEngine","User change. New user:",d.toKey());const f=await jK(a.localStore,d);a.currentUser=d,function(a,c){a.la.forEach(a=>{a.forEach(a=>{a.reject(new e(b.CANCELLED,c))})}),a.la.clear()}(a,"'waitForPendingWrites' promise is rejected due to a user change."),a.sharedClientState.handleUserChange(d,f.removedBatchIds,f.addedBatchIds),await cG(a,f.di)}}function ox(d,c){const a=j(d),b=a.aa.get(c);if(b&&b.na)return r().add(b.key);{let b=r();const d=a.ra.get(c);if(!d)return b;for(const c of d){const e=a.ia.get(c);b=b.unionWith(e.view.ju)}return b}}function oy(b){const a=j(b);return a.remoteStore.remoteSyncer.applyRemoteEvent=gG.bind(null,a),a.remoteStore.remoteSyncer.getRemoteKeysForTarget=ox.bind(null,a),a.remoteStore.remoteSyncer.rejectListen=ol.bind(null,a),a.sa.zo=nX.bind(null,a.eventManager),a.sa.wa=nY.bind(null,a.eventManager),a}function oz(b){const a=j(b);return a.remoteStore.remoteSyncer.applySuccessfulWrite=om.bind(null,a),a.remoteStore.remoteSyncer.rejectFailedWrite=on.bind(null,a),a}go=class{constructor(){this.synchronizeTabs=!1}async initialize(a){this.M=du(a.databaseInfo.databaseId),this.sharedClientState=this.ga(a),this.persistence=this.ya(a),await this.persistence.start(),this.gcScheduler=this.pa(a),this.localStore=this.Ia(a)}pa(a){return null}Ia(a){return jL(this.persistence,new jO,a.initialUser,this.M)}ya(a){return new mU(js.Yi,this.M)}ga(a){return new jn}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}},oB=class extends go{constructor(a,b,c){super(),this.Ta=a,this.cacheSizeBytes=b,this.forceOwnership=c,this.synchronizeTabs=!1}async initialize(a){await super.initialize(a),await this.Ta.initialize(this,a),await oz(this.Ta.syncEngine),await cN(this.Ta.remoteStore),await this.persistence.Ts(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve()))}Ia(a){return jL(this.persistence,new jO,a.initialUser,this.M)}pa(a){const b=this.persistence.referenceDelegate.garbageCollector;return new me(b,a.asyncQueue)}ya(a){const b=mw(a.databaseInfo.databaseId,a.databaseInfo.persistenceKey),c=this.cacheSizeBytes!==void 0?V.withCacheSize(this.cacheSizeBytes):V.DEFAULT;return new kf(this.synchronizeTabs,b,a.clientId,c,a.asyncQueue,nc(),dA(),this.M,this.sharedClientState,!!this.forceOwnership)}ga(a){return new jn}},gq=class{async initialize(b,a){this.localStore||(this.localStore=b.localStore,this.sharedClientState=b.sharedClientState,this.datastore=this.createDatastore(a),this.remoteStore=this.createRemoteStore(a),this.eventManager=this.createEventManager(a),this.syncEngine=this.createSyncEngine(a,!b.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>gF(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=ow.bind(null,this.syncEngine),await nL(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(a){return new nU}createDatastore(a){const c=du(a.databaseInfo.databaseId),d=(b=a.databaseInfo,new nb(b));var b;return function(a,b,c,d){return new nj(a,b,c,d)}(a.authCredentials,a.appCheckCredentials,d,c)}createRemoteStore(f){return a=this.localStore,b=this.datastore,c=f.asyncQueue,d=a=>gF(this.syncEngine,a,0),e=jk.vt()?new jk:new mZ,new nl(a,b,c,d,e);var a,b,c,d,e}createSyncEngine(a,b){return function(b,h,c,d,e,f,g){const a=new oe(b,h,c,d,e,f);return g&&(a.da=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,a.initialUser,a.maxConcurrentLimboResolutions,b)}terminate(){return async function(b){const a=j(b);c("RemoteStore","RemoteStore shutting down."),a.wu.add(5),await ca(a),a.gu.shutdown(),a.yu.set("Unknown")}(this.remoteStore)}},gs=class{constructor(a){this.observer=a,this.muted=!1}next(a){this.observer.next&&this.Ea(this.observer.next,a)}error(a){this.observer.error?this.Ea(this.observer.error,a):console.error("Uncaught Error in snapshot listener:",a)}Aa(){this.muted=!0}Ea(a,b){this.muted||setTimeout(()=>{this.muted||a(b)},0)}},oE=class{constructor(b,d,a,e){this.authCredentials=b,this.appCheckCredentials=d,this.asyncQueue=a,this.databaseInfo=e,this.user=R.UNAUTHENTICATED,this.clientId=oj.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(a,async a=>{c("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(a,a=>(c("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(a){this.authCredentialListener=a}setAppCheckTokenChangeListener(a){this.appCheckCredentialListener=a}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new e(b.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const a=new ab;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),a.resolve()}catch(b){const c=hJ(b,"Failed to shutdown persistence");a.reject(c)}}),a.promise}};async function gt(a,b){a.asyncQueue.verifyOperationInProgress(),c("FirestoreClient","Initializing OfflineComponentProvider");const d=await a.getConfiguration();await b.initialize(d);let e=d.initialUser;a.setCredentialChangeListener(async a=>{e.isEqual(a)||(await jK(b.localStore,a),e=a)}),b.persistence.setDatabaseDeletedListener(()=>a.terminate()),a.offlineComponents=b}async function gv(a,b){a.asyncQueue.verifyOperationInProgress();const d=await oH(a);c("FirestoreClient","Initializing OnlineComponentProvider");const e=await a.getConfiguration();await b.initialize(d,e),a.setCredentialChangeListener(a=>ib(b.remoteStore,a)),a.setAppCheckTokenChangeListener((c,a)=>ib(b.remoteStore,a)),a.onlineComponents=b}async function oH(a){return a.offlineComponents||(c("FirestoreClient","Using default OfflineComponentProvider"),await gt(a,new go)),a.offlineComponents}async function oI(a){return a.onlineComponents||(c("FirestoreClient","Using default OnlineComponentProvider"),await gv(a,new gq)),a.onlineComponents}async function gy(c){const a=await oI(c),b=a.eventManager;return b.onListen=og.bind(null,a.syncEngine),b.onUnlisten=oi.bind(null,a.syncEngine),b}function oK(a,d,f={}){const c=new ab;return a.asyncQueue.enqueueAndForget(async()=>function(c,h,d,f,a){const i=new gs({next:i=>{h.enqueueAndForget(()=>he(c,g));const j=i.docs.has(d);!j&&i.fromCache?a.reject(new e(b.UNAVAILABLE,"Failed to get document because the client is offline.")):j&&i.fromCache&&f&&f.source==="server"?a.reject(new e(b.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):a.resolve(i)},error:b=>a.reject(b)}),g=new gV(dk(d.path),i,{includeMetadataChanges:!0,ku:!0});return hx(c,g)}(await gy(a),a.asyncQueue,d,f,c)),c.promise}function oL(a,d,f={}){const c=new ab;return a.asyncQueue.enqueueAndForget(async()=>function(c,f,g,h,a){const i=new gs({next:g=>{f.enqueueAndForget(()=>he(c,d)),g.fromCache&&h.source==="server"?a.reject(new e(b.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):a.resolve(g)},error:b=>a.reject(b)}),d=new gV(g,i,{includeMetadataChanges:!0,ku:!0});return hx(c,d)}(await gy(a),a.asyncQueue,d,f,c)),c.promise}ho=new Map;function oN(a,c,d){if(!d)throw new e(b.INVALID_ARGUMENT,`Function ${a}() cannot be called with an empty ${c}.`)}function oO(a,c,d,f){if(c===!0&&f===!0)throw new e(b.INVALID_ARGUMENT,`${a} and ${d} cannot be used together.`)}function hE(a){if(d.isDocumentKey(a))throw new e(b.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${a} has ${a.length}.`)}function ec(a){if(a===void 0)return"undefined";if(a===null)return"null";if(typeof a=="string")return a.length>20&&(a=`${a.substring(0,20)}...`),JSON.stringify(a);if(typeof a=="number"||typeof a=="boolean")return""+a;if(typeof a=="object"){if(a instanceof Array)return"an array";{const b=function(a){return a.constructor?a.constructor.name:null}(a);return b?`a custom ${b} object`:"an object"}}return typeof a=="function"?"a function":g()}function bX(a,c){if("_delegate"in a&&(a=a._delegate),!(a instanceof c)){if(c.name===a.constructor.name)throw new e(b.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const d=ec(a);throw new e(b.INVALID_ARGUMENT,`Expected type '${c.name}', but it was: ${d}`)}}return a}ia=class{constructor(a){var c;if(a.host===void 0){if(a.ssl!==void 0)throw new e(b.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=a.host,this.ssl=(c=a.ssl)===null||c===void 0||c;if(this.credentials=a.credentials,this.ignoreUndefinedProperties=!!a.ignoreUndefinedProperties,a.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(a.cacheSizeBytes!==-1&&a.cacheSizeBytes<1048576)throw new e(b.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=a.cacheSizeBytes}this.experimentalForceLongPolling=!!a.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!a.experimentalAutoDetectLongPolling,this.useFetchStreams=!!a.useFetchStreams,oO("experimentalForceLongPolling",a.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",a.experimentalAutoDetectLongPolling)}isEqual(a){return this.host===a.host&&this.ssl===a.ssl&&this.credentials===a.credentials&&this.cacheSizeBytes===a.cacheSizeBytes&&this.experimentalForceLongPolling===a.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===a.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===a.ignoreUndefinedProperties&&this.useFetchStreams===a.useFetchStreams}},ii=class{constructor(a,c,d){this._authCredentials=c,this._appCheckCredentials=d,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ia({}),this._settingsFrozen=!1,a instanceof aL?this._databaseId=a:(this._app=a,this._databaseId=function(a){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new e(b.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new aL(a.options.projectId)}(a))}get app(){if(!this._app)throw new e(b.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(a){if(this._settingsFrozen)throw new e(b.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ia(a),a.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new ou;switch(a.type){case"gapi":const c=a.client;return k(!(typeof c!="object"||c===null||!c.auth||!c.auth.getAuthHeaderValueForFirstParty)),new oq(c,a.sessionIndex||"0",a.iamToken||null);case"provider":return a.client;default:throw new e(b.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(a.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(a){const b=ho.get(a);b&&(c("ComponentProvider","Removing Datastore"),ho.delete(a),b.terminate())}(this),Promise.resolve()}},ah=class{constructor(a,b,c){this.converter=b,this._key=c,this.type="document",this.firestore=a}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new cF(this.firestore,this.converter,this._key.path.popLast())}withConverter(a){return new ah(this.firestore,a,this._key)}},dv=class{constructor(a,b,c){this.converter=b,this._query=c,this.type="query",this.firestore=a}withConverter(a){return new dv(this.firestore,a,this._query)}},cF=class extends dv{constructor(b,c,a){super(b,c,dk(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const a=this._path.popLast();return a.isEmpty()?null:new ah(this.firestore,null,new d(a))}withConverter(a){return new cF(this.firestore,a,this._path)}};function lF(a,c,...d){if(a=dO(a),oN("collection","path",c),a instanceof ii){const b=q.fromString(c,...d);return hE(b),new cF(a,null,b)}{if(!(a instanceof ah||a instanceof cF))throw new e(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const f=a._path.child(q.fromString(c,...d));return hE(f),new cF(a.firestore,null,f)}}oY=class{constructor(){this.Fa=Promise.resolve(),this.$a=[],this.Ba=!1,this.La=[],this.Ua=null,this.qa=!1,this.Ka=!1,this.Ga=[],this.No=new iW(this,"async_queue_retry"),this.Qa=()=>{const a=dA();a&&c("AsyncQueue","Visibility state changed to "+a.visibilityState),this.No.Po()};const a=dA();a&&typeof a.addEventListener=="function"&&a.addEventListener("visibilitychange",this.Qa)}get isShuttingDown(){return this.Ba}enqueueAndForget(a){this.enqueue(a)}enqueueAndForgetEvenWhileRestricted(a){this.ja(),this.Wa(a)}enterRestrictedMode(a){if(!this.Ba){this.Ba=!0,this.Ka=a||!1;const b=dA();b&&typeof b.removeEventListener=="function"&&b.removeEventListener("visibilitychange",this.Qa)}}enqueue(b){if(this.ja(),this.Ba)return new Promise(()=>{});const a=new ab;return this.Wa(()=>this.Ba&&this.Ka?Promise.resolve():(b().then(a.resolve,a.reject),a.promise)).then(()=>a.promise)}enqueueRetryable(a){this.enqueueAndForget(()=>(this.$a.push(a),this.za()))}async za(){if(this.$a.length!==0){try{await this.$a[0](),this.$a.shift(),this.No.reset()}catch(a){if(!aG(a))throw a;c("AsyncQueue","Operation failed with retryable error: "+a)}this.$a.length>0&&this.No.Ro(()=>this.za())}}Wa(b){const a=this.Fa.then(()=>(this.qa=!0,b().catch(a=>{this.Ua=a,this.qa=!1;const b=function(a){let b=a.message||"";return a.stack&&(b=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),b}(a);throw S("INTERNAL UNHANDLED ERROR: ",b),a}).then(a=>(this.qa=!1,a))));return this.Fa=a,a}enqueueAfterDelay(a,b,d){this.ja(),this.Ga.indexOf(a)>-1&&(b=0);const c=hS.createAndSchedule(this,a,b,d,a=>this.Ha(a));return this.La.push(c),c}ja(){this.Ua&&g()}verifyOperationInProgress(){}async Ja(){let a;do a=this.Fa,await a;while(a!==this.Fa)}Ya(a){for(const b of this.La)if(b.timerId===a)return!0;return!1}Xa(a){return this.Ja().then(()=>{this.La.sort((a,b)=>a.targetTimeMs-b.targetTimeMs);for(const b of this.La)if(b.skipDelay(),a!=="all"&&b.timerId===a)break;return this.Ja()})}Za(a){this.Ga.push(a)}Ha(a){const b=this.La.indexOf(a);this.La.splice(b,1)}},dx=class extends ii{constructor(a,b,c){super(a,b,c),this.type="firestore",this._queue=new oY,this._persistenceKey="name"in a?a.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||jl(this),this._firestoreClient.terminate()}};function o_(a=qG()){return qO(a,"firestore").getImmediate()}function eT(a){return a._firestoreClient||jl(a),a._firestoreClient.verifyNotTerminated(),a._firestoreClient}function jl(a){var b;const c=a._freezeSettings(),d=function(b,c,d,a){return new nZ(b,c,d,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams)}(a._databaseId,((b=a._app)===null||b===void 0?void 0:b.options.appId)||"",a._persistenceKey,c);a._firestoreClient=new oE(a._authCredentials,a._appCheckCredentials,a._queue,d)}function pb(a,b){pd(a=bX(a,dx));const d=eT(a),e=a._freezeSettings(),c=new gq;return pc(d,c,new oB(c,e.cacheSizeBytes,b==null?void 0:b.forceOwnership))}function pc(a,d,e){const c=new ab;return a.asyncQueue.enqueue(async()=>{try{await gt(a,e),await gv(a,d),c.resolve()}catch(a){if(!function(a){return a.name==="FirebaseError"?a.code===b.FAILED_PRECONDITION||a.code===b.UNIMPLEMENTED:!(typeof DOMException!="undefined"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11}(a))throw a;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+a),c.reject(a)}}).then(()=>c.promise)}function pd(a){if(a._initialized||a._terminated)throw new e(b.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}jm=class{constructor(...a){for(let c=0;c<a.length;++c)if(a[c].length===0)throw new e(b.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new J(a)}isEqual(a){return this._internalPath.isEqual(a._internalPath)}},cq=class{constructor(a){this._byteString=a}static fromBase64String(a){try{return new cq(D.fromBase64String(a))}catch(a){throw new e(b.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+a)}}static fromUint8Array(a){return new cq(D.fromUint8Array(a))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(a){return this._byteString.isEqual(a._byteString)}},jG=class{constructor(a){this._methodName=a}},eH=class{constructor(a,c){if(!isFinite(a)||a<-90||a>90)throw new e(b.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+a);if(!isFinite(c)||c<-180||c>180)throw new e(b.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+c);this._lat=a,this._long=c}get latitude(){return this._lat}get longitude(){return this._long}isEqual(a){return this._lat===a._lat&&this._long===a._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(a){return l(this._lat,a._lat)||l(this._long,a._long)}},pi=/^__.*__$/;function jQ(a){switch(a){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw g()}}jW=class{constructor(b,c,d,e,a,f){this.settings=b,this.databaseId=c,this.M=d,this.ignoreUndefinedProperties=e,a===void 0&&this.tc(),this.fieldTransforms=a||[],this.fieldMask=f||[]}get path(){return this.settings.path}get ec(){return this.settings.ec}nc(a){return new jW(Object.assign(Object.assign({},this.settings),a),this.databaseId,this.M,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}sc(b){var a;const d=(a=this.path)===null||a===void 0?void 0:a.child(b),c=this.nc({path:d,ic:!1});return c.rc(b),c}oc(c){var a;const d=(a=this.path)===null||a===void 0?void 0:a.child(c),b=this.nc({path:d,ic:!1});return b.tc(),b}uc(a){return this.nc({path:void 0,ic:!0})}ac(a){return er(a,this.settings.methodName,this.settings.cc||!1,this.path,this.settings.hc)}contains(a){return this.fieldMask.find(b=>a.isPrefixOf(b))!==void 0||this.fieldTransforms.find(b=>a.isPrefixOf(b.field))!==void 0}tc(){if(this.path)for(let a=0;a<this.path.length;a++)this.rc(this.path.get(a))}rc(a){if(a.length===0)throw this.ac("Document fields must not be empty");if(jQ(this.ec)&&pi.test(a))throw this.ac('Document fields cannot begin and end with "__"')}},pl=class{constructor(a,b,c){this.databaseId=a,this.ignoreUndefinedProperties=b,this.M=c||du(a)}lc(a,b,c,d=!1){return new jW({ec:a,methodName:b,hc:c,path:J.emptyPath(),ic:!1,cc:d},this.databaseId,this.M,this.ignoreUndefinedProperties)}};function pm(a){const b=a._freezeSettings(),c=du(a._databaseId);return new pl(a._databaseId,!!b.ignoreUndefinedProperties,c)}function pn(a,b,c,d=!1){return eB(c,a.lc(d?4:3,b))}function eB(b,a){if(kk(b=dO(b)))return pr("Unsupported field value:",a,b),pp(b,a);if(b instanceof jG)return function(b,a){if(!jQ(a.ec))throw a.ac(`${b._methodName}() can only be used with update() and set()`);if(!a.path)throw a.ac(`${b._methodName}() is not currently supported inside arrays`);const c=b._toFieldTransform(a);c&&a.fieldTransforms.push(c)}(b,a),null;if(b===void 0&&a.ignoreUndefinedProperties)return null;if(a.path&&a.fieldMask.push(a.path),b instanceof Array){if(a.settings.ic&&a.ec!==4)throw a.ac("Nested arrays are not supported");return function(c,d){const a=[];let b=0;for(const f of c){let e=eB(f,d.uc(b));e==null&&(e={nullValue:"NULL_VALUE"}),a.push(e),b++}return{arrayValue:{values:a}}}(b,a)}return function(a,b){if((a=dO(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return np(b.M,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const c=A.fromDate(a);return{timestampValue:ct(b.M,c)}}if(a instanceof A){const c=new A(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:ct(b.M,c)}}if(a instanceof eH)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof cq)return{bytesValue:jN(b.M,a._byteString)};if(a instanceof ah){const c=b.databaseId,d=a.firestore._databaseId;if(!d.isEqual(c))throw b.ac(`Document reference is for database ${d.projectId}/${d.database} but should be for database ${c.projectId}/${c.database}`);return{referenceValue:eG(a.firestore._databaseId||b.databaseId,a._key.path)}}throw b.ac(`Unsupported field value: ${ec(a)}`)}(b,a)}function pp(b,a){const c={};return gO(b)?a.path&&a.path.length>0&&a.fieldMask.push(a.path):cs(b,(b,e)=>{const d=eB(e,a.sc(b));d!=null&&(c[b]=d)}),{mapValue:{fields:c}}}function kk(a){return!(typeof a!="object"||a===null||a instanceof Array||a instanceof Date||a instanceof A||a instanceof eH||a instanceof cq||a instanceof ah||a instanceof jG)}function pr(b,c,a){if(!kk(a)||!function(a){return typeof a=="object"&&a!==null&&(Object.getPrototypeOf(a)===Object.prototype||Object.getPrototypeOf(a)===null)}(a)){const d=ec(a);throw d==="an object"?c.ac(b+" a custom object"):c.ac(b+" "+d)}}ps=new RegExp("[~\\*/\\[\\]]");function pt(b,a,c){if(a.search(ps)>=0)throw er(`Invalid field path (${a}). Paths must not contain '~', '*', '/', '[', or ']'`,b,!1,void 0,c);try{return new jm(...a.split("."))._internalPath}catch(d){throw er(`Invalid field path (${a}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,b,!1,void 0,c)}}function er(i,j,k,d,g){const h=d&&!d.isEmpty(),f=g!==void 0;let c=`Function ${j}() called with invalid data`;k&&(c+=" (via `toFirestore()`)"),c+=". ";let a="";return(h||f)&&(a+=" (found",h&&(a+=` in field ${d}`),f&&(a+=` in document ${g}`),a+=")"),new e(b.INVALID_ARGUMENT,c+i+a)}k_=class{constructor(a,b,c,d,e){this._firestore=a,this._userDataWriter=b,this._key=c,this._document=d,this._converter=e}get id(){return this._key.path.lastSegment()}get ref(){return new ah(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const a=new pw(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(a)}return this._userDataWriter.convertValue(this._document.data.value)}}get(a){if(this._document){const b=this._document.data.field(el("DocumentSnapshot.get",a));if(b!==null)return this._userDataWriter.convertValue(b)}}},pw=class extends k_{data(){return super.data()}};function el(b,a){return typeof a=="string"?pt(b,a):a instanceof jm?a._internalPath:a._delegate._internalPath}cE=class{constructor(a,b){this.hasPendingWrites=a,this.fromCache=b}isEqual(a){return this.hasPendingWrites===a.hasPendingWrites&&this.fromCache===a.fromCache}},ld=class extends k_{constructor(a,b,c,d,e,f){super(a,b,c,d,f),this._firestore=a,this._firestoreImpl=a,this.metadata=e}exists(){return super.exists()}data(a={}){if(this._document){if(this._converter){const b=new dD(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(b,a)}return this._userDataWriter.convertValue(this._document.data.value,a.serverTimestamps)}}get(a,b={}){if(this._document){const c=this._document.data.field(el("DocumentSnapshot.get",a));if(c!==null)return this._userDataWriter.convertValue(c,b.serverTimestamps)}}},dD=class extends ld{data(a={}){return super.data(a)}},pB=class{constructor(b,c,d,a){this._firestore=b,this._userDataWriter=c,this._snapshot=a,this.metadata=new cE(a.hasPendingWrites,a.fromCache),this.query=d}get docs(){const a=[];return this.forEach(b=>a.push(b)),a}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(a,b){this._snapshot.docs.forEach(c=>{a.call(b,new dD(this._firestore,this._userDataWriter,c.key,c,new cE(this._snapshot.mutatedKeys.has(c.key),this._snapshot.fromCache),this.query.converter))})}docChanges(c={}){const a=!!c.includeMetadataChanges;if(a&&this._snapshot.excludesMetadataChanges)throw new e(b.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===a||(this._cachedChanges=function(a,b){if(a._snapshot.oldDocs.isEmpty()){let b=0;return a._snapshot.docChanges.map(c=>({type:"added",doc:new dD(a._firestore,a._userDataWriter,c.doc.key,c.doc,new cE(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter),oldIndex:-1,newIndex:b++}))}{let c=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(a=>b||a.type!==3).map(b=>{const f=new dD(a._firestore,a._userDataWriter,b.doc.key,b.doc,new cE(a._snapshot.mutatedKeys.has(b.doc.key),a._snapshot.fromCache),a.query.converter);let d=-1,e=-1;return b.type!==0&&(d=c.indexOf(b.doc.key),c=c.delete(b.doc.key)),b.type!==1&&(c=c.add(b.doc),e=c.indexOf(b.doc.key)),{type:pC(b.type),doc:f,oldIndex:d,newIndex:e}})}}(this,a),this._cachedChangesIncludeMetadataChanges=a),this._cachedChanges}};function pC(a){switch(a){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return g()}}function pD(a){if(a.limitType==="L"&&a.explicitOrderBy.length===0)throw new e(b.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}pE=class{};function pF(a,...b){for(const c of b)a=c._apply(a);return a}pG=class extends pE{constructor(a,b,c){super(),this._c=a,this.wc=b,this.mc=c,this.type="where"}_apply(a){const c=pm(a.firestore),d=function(f,j,k,h,i,a,c){let d;if(i.isKeyField()){if(a==="array-contains"||a==="array-contains-any")throw new e(b.INVALID_ARGUMENT,`Invalid Query. You can't perform '${a}' queries on documentId().`);if(a==="in"||a==="not-in"){jw(c,a);const b=[];for(const a of c)b.push(jA(h,f,a));d={arrayValue:{values:b}}}else d=jA(h,f,c)}else a!=="in"&&a!=="not-in"&&a!=="array-contains-any"||jw(c,a),d=pn(k,j,c,a==="in"||a==="not-in");const g=K.create(i,a,d);return function(c,a){if(a.S()){const d=iu(c);if(d!==null&&!d.isEqual(a.field))throw new e(b.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${d.toString()}' and '${a.field.toString()}'`);const f=it(c);f!==null&&pK(c,a.field,f)}const d=function(a,b){for(const c of a.filters)if(b.indexOf(c.op)>=0)return c.op;return null}(c,function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(a.op));if(d!==null)throw d===a.op?new e(b.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${a.op.toString()}' filter.`):new e(b.INVALID_ARGUMENT,`Invalid query. You cannot use '${a.op.toString()}' filters with '${d.toString()}' filters.`)}(f,g),g}(a._query,"where",c,a.firestore._databaseId,this._c,this.wc,this.mc);return new dv(a.firestore,a.converter,function(a,b){const c=a.filters.concat([b]);return new bV(a.path,a.collectionGroup,a.explicitOrderBy.slice(),c,a.limit,a.limitType,a.startAt,a.endAt)}(a._query,d))}};function pH(a,b,c){const d=b,e=el("where",a);return new pG(e,d,c)}function jA(c,f,a){if(typeof(a=dO(a))=="string"){if(a==="")throw new e(b.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!iv(f)&&a.indexOf("/")!==-1)throw new e(b.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${a}' contains a '/' character.`);const g=f.path.child(q.fromString(a));if(!d.isDocumentKey(g))throw new e(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${g}' is not because it has an odd number of segments (${g.length}).`);return bK(c,new d(g))}if(a instanceof ah)return bK(c,a._key);throw new e(b.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ec(a)}.`)}function jw(a,c){if(!Array.isArray(a)||a.length===0)throw new e(b.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${c.toString()}' filters.`);if(a.length>10)throw new e(b.INVALID_ARGUMENT,`Invalid Query. '${c.toString()}' filters support a maximum of 10 elements in the value array.`)}function pK(d,a,c){if(!c.isEqual(a))throw new e(b.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${a.toString()}' and so you must also use '${a.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${c.toString()}' instead.`)}pL=class{convertValue(a,b="none"){switch(aI(a)){case 0:return null;case 1:return a.booleanValue;case 2:return u(a.integerValue||a.doubleValue);case 3:return this.convertTimestamp(a.timestampValue);case 4:return this.convertServerTimestamp(a,b);case 5:return a.stringValue;case 6:return this.convertBytes(aE(a.bytesValue));case 7:return this.convertReference(a.referenceValue);case 8:return this.convertGeoPoint(a.geoPointValue);case 9:return this.convertArray(a.arrayValue,b);case 10:return this.convertObject(a.mapValue,b);default:throw g()}}convertObject(b,c){const a={};return cs(b.fields,(b,d)=>{a[b]=this.convertValue(d,c)}),a}convertGeoPoint(a){return new eH(u(a.latitude),u(a.longitude))}convertArray(a,b){return(a.values||[]).map(a=>this.convertValue(a,b))}convertServerTimestamp(a,b){switch(b){case"previous":const c=g_(a);return c==null?null:this.convertValue(c,b);case"estimate":return this.convertTimestamp(bD(a));default:return null}}convertTimestamp(b){const a=an(b);return new A(a.seconds,a.nanos)}convertDocumentKey(f,b){const a=q.fromString(f);k(ko(a));const c=new aL(a.get(1),a.get(3)),e=new d(a.popFirst(5));return c.isEqual(b)||S(`Document ${e} contains a document reference within a different database (${c.projectId}/${c.database}) which is not supported. It will be treated as a reference in the current database (${b.projectId}/${b.database}) instead.`),e}};function pM(a){a=bX(a,ah);const b=bX(a.firestore,dx);return oK(eT(b),a._key).then(c=>pP(b,a,c))}jp=class extends pL{constructor(a){super(),this.firestore=a}convertBytes(a){return new cq(a)}convertReference(a){const b=this.convertDocumentKey(a,this.firestore._databaseId);return new ah(this.firestore,null,b)}};function iB(a){a=bX(a,dv);const b=bX(a.firestore,dx),c=eT(b),d=new jp(b);return pD(a._query),oL(c,a._query).then(c=>new pB(b,d,a,c))}function pP(c,a,b){const d=b.docs.get(a._key),e=new jp(c);return new ld(c,e,a._key,d,new cE(b.hasPendingWrites,b.fromCache),a.converter)}!function(a,b=!0){!function(a){bu=a}(qK),cZ(new cB("firestore",(a,{options:c})=>{const e=a.getProvider("app").getImmediate(),d=new dx(e,new os(a.getProvider("auth-internal")),new oo(a.getProvider("app-check-internal")));return c=Object.assign({useFetchStreams:b},c),d._setSettings(c),d},"PUBLIC")),bl(gm,"3.4.9",a),bl(gm,"3.4.9","esm2017")}();function fi(a,b,c={}){const d=new CustomEvent(b,{bubbles:!0,composed:!0,detail:c});a.dispatchEvent(d)}pR={apiKey:"AIzaSyAg0cVb-NI8UNGGmXxIe9vxk1fVTcMA2VQ",authDomain:"dnd-project-b2aa4.firebaseapp.com",databaseURL:"https://dnd-project-b2aa4-default-rtdb.firebaseio.com",projectId:"dnd-project-b2aa4",storageBucket:"dnd-project-b2aa4.appspot.com",messagingSenderId:"1031136765027",appId:"1:1031136765027:web:8b106f77f9f22ba7cc8456"},qI(pR),fo=o_(),pb(fo).catch(a=>{console.log(a),a.code==="failed-precondition"||a.code==="unimplemented"}),dh={},pU=async()=>{const a=lF(fo,"items"),b=pF(a,pH("image","!=",null)),c=await iB(b);c.forEach(a=>{dh[a.id]=a.data()});const d=await iB(lF(fo,"campaigns"));d.forEach(async b=>{const a=b.data();console.log("campaign"," => ",a),a.inventories.forEach(async a=>{const b=await pM(a);console.log("inventory",b.data())})}),fi(window,"ITEMS")},pU(),fv=window.ShadowRoot&&(window.ShadyCSS===void 0||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,fC=Symbol(),hp=new Map,gI=class{constructor(a,b){if(this._$cssResult$=!0,b!==fC)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=a}get styleSheet(){let a=hp.get(this.cssText);return fv&&a===void 0&&(hp.set(this.cssText,a=new CSSStyleSheet),a.replaceSync(this.cssText)),a}toString(){return this.cssText}},bJ=a=>new gI(typeof a=="string"?a:a+"",fC),br=(a,...b)=>{const c=a.length===1?a[0]:b.reduce((b,c,d)=>b+(a=>{if(a._$cssResult$===!0)return a.cssText;if(typeof a=="number")return a;throw Error("Value passed to 'css' function must be a 'css' function result: "+a+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(c)+a[d+1],a[0]);return new gI(c,fC)},p$=(a,b)=>{fv?a.adoptedStyleSheets=b.map(a=>a instanceof CSSStyleSheet?a:a.styleSheet):b.forEach(d=>{const b=document.createElement("style"),c=window.litNonce;c!==void 0&&b.setAttribute("nonce",c),b.textContent=d.cssText,a.appendChild(b)})},gu=fv?a=>a:a=>a instanceof CSSStyleSheet?(b=>{let a="";for(const c of b.cssRules)a+=c.cssText;return bJ(a)})(a):a,gw=window.trustedTypes,qd=gw?gw.emptyScript:"",gx=window.reactiveElementPolyfillSupport,fX={toAttribute(a,b){switch(b){case Boolean:a=a?qd:null;break;case Object:case Array:a=a==null?a:JSON.stringify(a)}return a},fromAttribute(a,c){let b=a;switch(c){case Boolean:b=a!==null;break;case Number:b=a===null?null:Number(a);break;case Object:case Array:try{b=JSON.parse(a)}catch(a){b=null}}return b}},gK=(a,b)=>b!==a&&(b==b||a==a),fV={attribute:!0,type:String,converter:fX,reflect:!1,hasChanged:gK},bo=class extends HTMLElement{constructor(){super(),this._$Et=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Ei=null,this.o()}static addInitializer(b){var a;(a=this.l)!==null&&a!==void 0||(this.l=[]),this.l.push(b)}static get observedAttributes(){this.finalize();const a=[];return this.elementProperties.forEach((d,c)=>{const b=this._$Eh(c,d);b!==void 0&&(this._$Eu.set(b,c),a.push(b))}),a}static createProperty(a,b=fV){if(b.state&&(b.attribute=!1),this.finalize(),this.elementProperties.set(a,b),!b.noAccessor&&!this.prototype.hasOwnProperty(a)){const d=typeof a=="symbol"?Symbol():"__"+a,c=this.getPropertyDescriptor(a,d,b);c!==void 0&&Object.defineProperty(this.prototype,a,c)}}static getPropertyDescriptor(a,b,c){return{get(){return this[b]},set(d){const e=this[a];this[b]=d,this.requestUpdate(a,e,c)},configurable:!0,enumerable:!0}}static getPropertyOptions(a){return this.elementProperties.get(a)||fV}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const a=Object.getPrototypeOf(this);if(a.finalize(),this.elementProperties=new Map(a.elementProperties),this._$Eu=new Map,this.hasOwnProperty("properties")){const a=this.properties,b=[...Object.getOwnPropertyNames(a),...Object.getOwnPropertySymbols(a)];for(const c of b)this.createProperty(c,a[c])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(a){const b=[];if(Array.isArray(a)){const c=new Set(a.flat(1/0).reverse());for(const a of c)b.unshift(gu(a))}else a!==void 0&&b.push(gu(a));return b}static _$Eh(b,c){const a=c.attribute;return a===!1?void 0:typeof a=="string"?a:typeof b=="string"?b.toLowerCase():void 0}o(){var a;this._$Ep=new Promise(a=>this.enableUpdating=a),this._$AL=new Map,this._$Em(),this.requestUpdate(),(a=this.constructor.l)===null||a===void 0||a.forEach(a=>a(this))}addController(a){var b,c;((b=this._$Eg)!==null&&b!==void 0?b:this._$Eg=[]).push(a),this.renderRoot!==void 0&&this.isConnected&&((c=a.hostConnected)===null||c===void 0||c.call(a))}removeController(b){var a;(a=this._$Eg)===null||a===void 0||a.splice(this._$Eg.indexOf(b)>>>0,1)}_$Em(){this.constructor.elementProperties.forEach((b,a)=>{this.hasOwnProperty(a)&&(this._$Et.set(a,this[a]),delete this[a])})}createRenderRoot(){var a;const b=(a=this.shadowRoot)!==null&&a!==void 0?a:this.attachShadow(this.constructor.shadowRootOptions);return p$(b,this.constructor.elementStyles),b}connectedCallback(){var a;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(a=this._$Eg)===null||a===void 0||a.forEach(b=>{var a;return(a=b.hostConnected)===null||a===void 0?void 0:a.call(b)})}enableUpdating(a){}disconnectedCallback(){var a;(a=this._$Eg)===null||a===void 0||a.forEach(b=>{var a;return(a=b.hostDisconnected)===null||a===void 0?void 0:a.call(b)})}attributeChangedCallback(a,c,b){this._$AK(a,b)}_$ES(e,f,a=fV){var b,c;const d=this.constructor._$Eh(e,a);if(d!==void 0&&a.reflect===!0){const g=((c=(b=a.converter)===null||b===void 0?void 0:b.toAttribute)!==null&&c!==void 0?c:fX.toAttribute)(f,a.type);this._$Ei=e,g==null?this.removeAttribute(d):this.setAttribute(d,g),this._$Ei=null}}_$AK(g,f){var b,c,d;const e=this.constructor,a=e._$Eu.get(g);if(a!==void 0&&this._$Ei!==a){const h=e.getPropertyOptions(a),g=h.converter,i=(d=(c=(b=g)===null||b===void 0?void 0:b.fromAttribute)!==null&&c!==void 0?c:typeof g=="function"?g:null)!==null&&d!==void 0?d:fX.fromAttribute;this._$Ei=a,this[a]=i(f,h.type),this._$Ei=null}}requestUpdate(a,c,b){let d=!0;a!==void 0&&(((b=b||this.constructor.getPropertyOptions(a)).hasChanged||gK)(this[a],c)?(this._$AL.has(a)||this._$AL.set(a,c),b.reflect===!0&&this._$Ei!==a&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(a,b))):d=!1),!this.isUpdatePending&&d&&(this._$Ep=this._$E_())}async _$E_(){this.isUpdatePending=!0;try{await this._$Ep}catch(a){Promise.reject(a)}const a=this.scheduleUpdate();return a!=null&&await a,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var c;if(!this.isUpdatePending)return;this.hasUpdated,this._$Et&&(this._$Et.forEach((a,b)=>this[b]=a),this._$Et=void 0);let a=!1;const b=this._$AL;try{a=this.shouldUpdate(b),a?(this.willUpdate(b),(c=this._$Eg)===null||c===void 0||c.forEach(b=>{var a;return(a=b.hostUpdate)===null||a===void 0?void 0:a.call(b)}),this.update(b)):this._$EU()}catch(b){throw a=!1,this._$EU(),b}a&&this._$AE(b)}willUpdate(a){}_$AE(b){var a;(a=this._$Eg)===null||a===void 0||a.forEach(b=>{var a;return(a=b.hostUpdated)===null||a===void 0?void 0:a.call(b)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(b)),this.updated(b)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Ep}shouldUpdate(a){return!0}update(a){this._$EC!==void 0&&(this._$EC.forEach((b,a)=>this._$ES(a,this[a],b)),this._$EC=void 0),this._$EU()}updated(a){}firstUpdated(a){}},bo.finalized=!0,bo.elementProperties=new Map,bo.elementStyles=[],bo.shadowRootOptions={mode:"open"},gx==null||gx({ReactiveElement:bo}),((ga=globalThis.reactiveElementVersions)!==null&&ga!==void 0?ga:globalThis.reactiveElementVersions=[]).push("1.3.2"),bg=globalThis.trustedTypes,hk=bg?bg.createPolicy("lit-html",{createHTML:a=>a}):void 0,at=`lit$${(Math.random()+"").slice(9)}$`,hl="?"+at,qo=`<${hl}>`,ba=document,bO=(a="")=>ba.createComment(a),bM=a=>a===null||typeof a!="object"&&typeof a!="function",hv=Array.isArray,qt=b=>{var a;return hv(b)||typeof((a=b)===null||a===void 0?void 0:a[Symbol.iterator])=="function"},cw=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,hy=/-->/g,hB=/>/g,aS=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,hF=/'/g,hK=/"/g,hM=/^(?:script|style|textarea|title)$/i,hN=a=>(b,...c)=>({_$litType$:a,strings:b,values:c}),o=hN(1),ui=hN(2),aQ=Symbol.for("lit-noChange"),p=Symbol.for("lit-nothing"),hV=new WeakMap,qH=(g,e,a)=>{var c,d;const f=(c=a==null?void 0:a.renderBefore)!==null&&c!==void 0?c:e;let b=f._$litPart$;if(b===void 0){const c=(d=a==null?void 0:a.renderBefore)!==null&&d!==void 0?d:null;f._$litPart$=b=new cW(e.insertBefore(bO(),c),c,void 0,a!=null?a:{})}return b._$AI(g),b},bj=ba.createTreeWalker(ba,129,null,!1),qJ=(b,e)=>{const f=b.length-1,d=[];let c,g=e===2?"<svg>":"",a=cw;for(let j=0;j<f;j++){const i=b[j];let l,e,h=-1,k=0;for(;k<i.length&&(a.lastIndex=k,e=a.exec(i),e!==null);)k=a.lastIndex,a===cw?e[1]==="!--"?a=hy:e[1]!==void 0?a=hB:e[2]!==void 0?(hM.test(e[2])&&(c=RegExp("</"+e[2],"g")),a=aS):e[3]!==void 0&&(a=aS):a===aS?e[0]===">"?(a=c!=null?c:cw,h=-1):e[1]===void 0?h=-2:(h=a.lastIndex-e[2].length,l=e[1],a=e[3]===void 0?aS:e[3]==='"'?hK:hF):a===hK||a===hF?a=aS:a===hy||a===hB?a=cw:(a=aS,c=void 0);const m=a===aS&&b[j+1].startsWith("/>")?" ":"";g+=a===cw?i+qo:h>=0?(d.push(l),i.slice(0,h)+"$lit$"+i.slice(h)+at+m):i+at+(h===-2?(d.push(void 0),j):m)}const h=g+(b[f]||"<?>")+(e===2?"</svg>":"");if(!Array.isArray(b)||!b.hasOwnProperty("raw"))throw Error("invalid template strings array");return[hk!==void 0?hk.createHTML(h):h,d]},cU=class{constructor({strings:d,_$litType$:e},f){let a;this.parts=[];let c=0,g=0;const h=d.length-1,b=this.parts,[i,j]=qJ(d,e);if(this.el=cU.createElement(i,f),bj.currentNode=this.el.content,e===2){const a=this.el.content,b=a.firstChild;b.remove(),a.append(...b.childNodes)}for(;(a=bj.nextNode())!==null&&b.length<h;){if(a.nodeType===1){{if(a.hasAttributes()){const d=[];for(const e of a.getAttributeNames())if(e.endsWith("$lit$")||e.startsWith(at)){const f=j[g++];if(d.push(e),f!==void 0){const e=a.getAttribute(f.toLowerCase()+"$lit$").split(at),d=/([.?@])?(.*)/.exec(f);b.push({type:1,index:c,name:d[2],strings:e,ctor:d[1]==="."?qP:d[1]==="?"?qR:d[1]==="@"?qS:cX})}else b.push({type:6,index:c})}for(const b of d)a.removeAttribute(b)}if(hM.test(a.tagName)){const d=a.textContent.split(at),e=d.length-1;if(e>0){a.textContent=bg?bg.emptyScript:"";for(let f=0;f<e;f++)a.append(d[f],bO()),bj.nextNode(),b.push({type:2,index:++c});a.append(d[e],bO())}}}}else if(a.nodeType===8)if(a.data===hl)b.push({type:2,index:c});else{let d=-1;for(;(d=a.data.indexOf(at,d+1))!==-1;)b.push({type:7,index:c}),d+=at.length-1}c++}}static createElement(b,c){const a=ba.createElement("template");return a.innerHTML=b,a}};function bh(d,b,e=d,c){var f,g,h,j;if(b===aQ)return b;let a=c!==void 0?(f=e._$Cl)===null||f===void 0?void 0:f[c]:e._$Cu;const i=bM(b)?void 0:b._$litDirective$;return(a==null?void 0:a.constructor)!==i&&((g=a==null?void 0:a._$AO)===null||g===void 0||g.call(a,!1),i===void 0?a=void 0:(a=new i(d),a._$AT(d,e,c)),c!==void 0?((h=(j=e)._$Cl)!==null&&h!==void 0?h:j._$Cl=[])[c]=a:e._$Cu=a),a!==void 0&&(b=bh(d,a._$AS(d,b.values),a,c)),b}qM=class{constructor(a,b){this.v=[],this._$AN=void 0,this._$AD=a,this._$AM=b}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}p(b){var d;const{el:{content:i},parts:f}=this._$AD,g=((d=b==null?void 0:b.creationScope)!==null&&d!==void 0?d:ba).importNode(i,!0);bj.currentNode=g;let c=bj.nextNode(),e=0,h=0,a=f[0];for(;a!==void 0;){if(e===a.index){let d;a.type===2?d=new cW(c,c.nextSibling,this,b):a.type===1?d=new a.ctor(c,a.name,a.strings,this,b):a.type===6&&(d=new qT(c,this,b)),this.v.push(d),a=f[++h]}e!==(a==null?void 0:a.index)&&(c=bj.nextNode(),e++)}return g}m(b){let a=0;for(const c of this.v)c!==void 0&&(c.strings!==void 0?(c._$AI(b,c,a),a+=c.strings.length-2):c._$AI(b[a])),a++}},cW=class{constructor(c,d,e,a){var b;this.type=2,this._$AH=p,this._$AN=void 0,this._$AA=c,this._$AB=d,this._$AM=e,this.options=a,this._$Cg=(b=a==null?void 0:a.isConnected)===null||b===void 0||b}get _$AU(){var a,b;return(b=(a=this._$AM)===null||a===void 0?void 0:a._$AU)!==null&&b!==void 0?b:this._$Cg}get parentNode(){let a=this._$AA.parentNode;const b=this._$AM;return b!==void 0&&a.nodeType===11&&(a=b.parentNode),a}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(a,b=this){a=bh(this,a,b),bM(a)?a===p||a==null||a===""?(this._$AH!==p&&this._$AR(),this._$AH=p):a!==this._$AH&&a!==aQ&&this.$(a):a._$litType$!==void 0?this.T(a):a.nodeType!==void 0?this.k(a):qt(a)?this.S(a):this.$(a)}M(a,b=this._$AB){return this._$AA.parentNode.insertBefore(a,b)}k(a){this._$AH!==a&&(this._$AR(),this._$AH=this.M(a))}$(a){this._$AH!==p&&bM(this._$AH)?this._$AA.nextSibling.data=a:this.k(ba.createTextNode(a)),this._$AH=a}T(c){var b;const{values:d,_$litType$:a}=c,e=typeof a=="number"?this._$AC(c):(a.el===void 0&&(a.el=cU.createElement(a.h,this.options)),a);if(((b=this._$AH)===null||b===void 0?void 0:b._$AD)===e)this._$AH.m(d);else{const a=new qM(e,this),b=a.p(this.options);a.m(d),this.k(b),this._$AH=a}}_$AC(a){let b=hV.get(a.strings);return b===void 0&&hV.set(a.strings,b=new cU(a)),b}S(d){hv(this._$AH)||(this._$AH=[],this._$AR());const b=this._$AH;let c,a=0;for(const e of d)a===b.length?b.push(c=new cW(this.M(bO()),this.M(bO()),this,this.options)):c=b[a],c._$AI(e),a++;a<b.length&&(this._$AR(c&&c._$AB.nextSibling,a),b.length=a)}_$AR(a=this._$AA.nextSibling,c){var b;for((b=this._$AP)===null||b===void 0||b.call(this,!1,!0,c);a&&a!==this._$AB;){const d=a.nextSibling;a.remove(),a=d}}setConnected(b){var a;this._$AM===void 0&&(this._$Cg=b,(a=this._$AP)===null||a===void 0||a.call(this,b))}},cX=class{constructor(b,c,a,d,e){this.type=1,this._$AH=p,this._$AN=void 0,this.element=b,this.name=c,this._$AM=d,this.options=e,a.length>2||a[0]!==""||a[1]!==""?(this._$AH=Array(a.length-1).fill(new String),this.strings=a):this._$AH=p}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(a,d=this,e,f){const c=this.strings;let b=!1;if(c===void 0)a=bh(this,a,d,0),b=!bM(a)||a!==this._$AH&&a!==aQ,b&&(this._$AH=a);else{const h=a;let f,g;for(a=c[0],f=0;f<c.length-1;f++)g=bh(this,h[e+f],d,f),g===aQ&&(g=this._$AH[f]),b||(b=!bM(g)||g!==this._$AH[f]),g===p?a=p:a!==p&&(a+=(g!=null?g:"")+c[f+1]),this._$AH[f]=g}b&&!f&&this.C(a)}C(a){a===p?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,a!=null?a:"")}},qP=class extends cX{constructor(){super(...arguments),this.type=3}C(a){this.element[this.name]=a===p?void 0:a}},qQ=bg?bg.emptyScript:"",qR=class extends cX{constructor(){super(...arguments),this.type=4}C(a){a&&a!==p?this.element.setAttribute(this.name,qQ):this.element.removeAttribute(this.name)}},qS=class extends cX{constructor(a,b,c,d,e){super(a,b,c,d,e),this.type=5}_$AI(a,e=this){var c;if((a=(c=bh(this,a,e,0))!==null&&c!==void 0?c:p)===aQ)return;const b=this._$AH,d=a===p&&b!==p||a.capture!==b.capture||a.once!==b.once||a.passive!==b.passive,f=a!==p&&(b===p||d);d&&this.element.removeEventListener(this.name,this,b),f&&this.element.addEventListener(this.name,this,a),this._$AH=a}handleEvent(c){var a,b;typeof this._$AH=="function"?this._$AH.call((b=(a=this.options)===null||a===void 0?void 0:a.host)!==null&&b!==void 0?b:this.element,c):this._$AH.handleEvent(c)}},qT=class{constructor(a,b,c){this.element=a,this.type=6,this._$AN=void 0,this._$AM=b,this.options=c}get _$AU(){return this._$AM._$AU}_$AI(a){bh(this,a)}},hW=window.litHtmlPolyfillSupport,hW==null||hW(cU,cW),((fT=globalThis.litHtmlVersions)!==null&&fT!==void 0?fT:globalThis.litHtmlVersions=[]).push("2.2.3"),aw=class extends bo{constructor(){super(...arguments),this.renderOptions={host:this},this._$Dt=void 0}createRenderRoot(){var a,b;const c=super.createRenderRoot();return(a=(b=this.renderOptions).renderBefore)!==null&&a!==void 0||(b.renderBefore=c.firstChild),c}update(a){const b=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(a),this._$Dt=qH(b,this.renderRoot,this.renderOptions)}connectedCallback(){var a;super.connectedCallback(),(a=this._$Dt)===null||a===void 0||a.setConnected(!0)}disconnectedCallback(){var a;super.disconnectedCallback(),(a=this._$Dt)===null||a===void 0||a.setConnected(!1)}render(){return aQ}},aw.finalized=!0,aw._$litElement$=!0,(fq=globalThis.litElementHydrateSupport)===null||fq===void 0||fq.call(globalThis,{LitElement:aw}),ig=globalThis.litElementPolyfillSupport,ig==null||ig({LitElement:aw}),((fn=globalThis.litElementVersions)!==null&&fn!==void 0?fn:globalThis.litElementVersions=[]).push("3.2.0"),df=a=>b=>typeof b=="function"?((b,a)=>(window.customElements.define(b,a),a))(a,b):((a,b)=>{const{kind:c,elements:d}=b;return{kind:c,elements:d,finisher(b){window.customElements.define(a,b)}}})(a,b),q_=(b,a)=>a.kind==="method"&&a.descriptor&&!("value"in a.descriptor)?{...a,finisher(c){c.createProperty(a.key,b)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:a.key,initializer(){typeof a.initializer=="function"&&(this[a.key]=a.initializer.call(this))},finisher(c){c.createProperty(a.key,b)}};function ap(a){return(b,c)=>c!==void 0?((a,b,c)=>{b.constructor.createProperty(c,a)})(a,b,c):q_(a,b)}function dg(a){return ap({...a,state:!0})}uh=((fm=window.HTMLSlotElement)===null||fm===void 0?void 0:fm.prototype.assignedElements)!=null?(a,b)=>a.assignedElements(b):(a,b)=>a.assignedNodes(b).filter(a=>a.nodeType===Node.ELEMENT_NODE),Y=class{constructor(a){this.values=[],this.delimiter=":",this.hasValue(a)&&this.addValue(a)}toString(){return this.values.join(this.delimiter)}hasValue(a){return typeof a!="undefined"&&a!==null&&a!==""}addValue(a){return Array.isArray(a)?this.values=this.values.concat(a):this.values.push(a),this.values=this.values.filter(a=>this.hasValue(a)),this}setDelimiter(a){return this.delimiter=a,this}},re=class extends Error{constructor(a="Unsupported"){super(a)}};function fl(a){return new re(a)}function rg(){return this._qualifierModel||{error:fl(`unsupported qualifier ${this.constructor.name}`)}}rh=class{constructor(){this._qualifierModel={}}toJson(){return rg.apply(this)}},H=class extends rh{constructor(b,a){super(),this.delimiter="_",this.key=b,a instanceof Y?this.qualifierValue=a:(this.qualifierValue=new Y,this.qualifierValue.addValue(a))}toString(){const{key:a,delimiter:b,qualifierValue:c}=this;return`${a}${b}${c.toString()}`}addValue(a){return this.qualifierValue.addValue(a),this}},W=class extends H{constructor(c,a){let b;a?b=new Y([c,`${a}`]).setDelimiter(":"):b=c,super("fl",b),this.flagValue=a}toString(){return super.toString().replace(/\./,"%2E")}getFlagValue(){return this.flagValue}};function rk(b,c){const a=Array.from(b.entries());return c.forEach(b=>{a.push(["fl",b])}),a.sort().map(a=>a[1])}function rl(){const a=this._actionModel&&Object.keys(this._actionModel).length;return a?this._actionModel:{error:fl(`unsupported action ${this.constructor.name}`)}}rm=class{constructor(){this._actionModel={}}toJson(){return rl.apply(this)}},bF=class extends rm{constructor(){super(...arguments),this.qualifiers=new Map,this.flags=[],this.delimiter=",",this.actionTag=""}prepareQualifiers(){}getActionTag(){return this.actionTag}setActionTag(a){return this.actionTag=a,this}toString(){return this.prepareQualifiers(),rk(this.qualifiers,this.flags).join(this.delimiter)}addQualifier(a){if(typeof a=="string"){const[b,c]=a.toLowerCase().split("_");b==="fl"?this.flags.push(new W(c)):this.qualifiers.set(b,new H(b,c))}else this.qualifiers.set(a.key,a);return this}addFlag(a){return typeof a=="string"?this.flags.push(new W(a)):a instanceof W&&this.flags.push(a),this}addValueToQualifier(a,b){return this.qualifiers.get(a).addValue(b),this}};function ik(b){const a=b.toString();if(a.match(/[A-Z]/gi))return a;if(a.length>1&&a[0]==="0")return a;const c=!isNaN(parseFloat(a))&&a.indexOf(":")===-1;return c&&a.indexOf(".")===-1?`${a}.0`:a}rp=class extends Y{};function rq(){return new W("ignore_aspect_ratio")}function rr(){return new W("lossy")}function rs(){return new W("preserve_transparency")}function rt(a){return new W("progressive",a)}function ru(){return new W("region_relative")}function rv(){return new W("relative")}function aM(a){const b={};return Object.keys(a).forEach(c=>{b[a[c]]=c}),b}ip=["cname","secureDistribution","privateCdn","signUrl","longUrlSignature","shorten","useRootPath","secure","forceVersion","analytics"],iq={"=":"eq","!=":"ne","<":"lt",">":"gt","<=":"lte",">=":"gte","&&":"and","||":"or","*":"mul","/":"div","+":"add","-":"sub","^":"pow"},ir={aspect_ratio:"ar",aspectRatio:"ar",current_page:"cp",currentPage:"cp",duration:"du",face_count:"fc",faceCount:"fc",height:"h",initial_aspect_ratio:"iar",initial_height:"ih",initial_width:"iw",initialAspectRatio:"iar",initialHeight:"ih",initialWidth:"iw",initial_duration:"idu",initialDuration:"idu",page_count:"pc",page_x:"px",page_y:"py",pageCount:"pc",pageX:"px",pageY:"py",tags:"tags",width:"w",trimmed_aspect_ratio:"tar",current_public_id:"cpi",initial_density:"idn",page_names:"pgnames"},iw={limitFit:"limit",limitFill:"lfill",minimumFit:"mfit",thumbnail:"thumb",limitPad:"lpad",minimumPad:"mpad"},rB={colorSpace:"cs",dpr:"dpr",density:"dn",defaultImage:"d",format:"f",quality:"q"},rC={redEye:"redeye",advancedRedEye:"adv_redeye",oilPaint:"oil_paint",unsharpMask:"unsharp_mask",makeTransparent:"make_transparent"},oX={autoBest:"auto:best",autoEco:"auto:eco",autoGood:"auto:good",autoLow:"auto:low",jpegminiHigh:"jpegmini:1",jpegminiMedium:"jpegmini:2",jpegminiBest:"jpegmini:0"},rE={fullHd:"full_hd",fullHdWifi:"full_hd_wifi",fullHdLean:"full_hd_lean",hdLean:"hd_lean"},rF={444:"CHROMA_444",420:"CHROMA_420"},rG={noCmyk:"no_cmyk",keepCmyk:"keep_cmyk",tinySrgb:"tinysrgb",srgbTrueColor:"srgb:truecolor"},ug=aM(rF),uf=aM(rG),rJ=aM(iw),rK=aM(rB),ue=aM(rC),ud=aM(oX),uc=aM(rE),rO=class extends bF{constructor(a,b,c){super(),this._actionModel={dimensions:{}},this._actionModel.actionType=rJ[a]||a,this.addQualifier(new H("c",a)),b&&this.width(b),c&&this.height(c)}height(a){return this._actionModel.dimensions.height=a,this.addQualifier(new H("h",a))}width(a){return this._actionModel.dimensions.width=a,this.addQualifier(new H("w",a))}aspectRatio(a){if(a instanceof rp)return this._actionModel.dimensions.aspectRatio=`${a}`,this.addQualifier(new H("ar",a));if(typeof a=="number"||typeof a=="string")return this._actionModel.dimensions.aspectRatio=ik(a),this.addQualifier(new H("ar",ik(a)));if(a instanceof W)return this._actionModel.dimensions.aspectRatio=`${a.qualifierValue}`,this.addFlag(a)}relative(){return this._actionModel.relative=!0,this.addFlag(rv())}regionRelative(){return this._actionModel.regionRelative=!0,this.addFlag(ru())}static fromJson(d){const{actionType:c,dimensions:e,relative:j,regionRelative:f}=d,{aspectRatio:b,width:g,height:h}=e,i=iw[c]||c,a=new this(i,g,h);return b&&a.aspectRatio(b==="ignore_aspect_ratio"?rq():b),j&&a.relative(),f&&a.regionRelative(),a}},fg=class extends H{constructor(a){super("g",new Y(a))}},g$=class extends fg{constructor(){super("auto")}autoFocus(...a){return this.addValue(a),this}},iz=class extends fg{constructor(a){super(a)}fallbackGravity(a){return this.addValue(a.qualifierValue),this}},rS=class extends fg{constructor(a){super(a)}};function iJ(...a){const b=[...a];return new iz(b)}function iL(){return new g$}dq=class extends Y{constructor(a){super(),this.name=a}toString(){return this.name}};function rW(){return new dq("ocr_text")}function rX(a){return a&&`${a}`.split(":")[0]==="auto"}function rY(a){const b=eZ(a);return["north","center","east","west","south","north_west","south_east","south_west","north_east"].includes(b)}function eZ(a){return`${a}`.replace("g_","")}function r_(a){return{compass:eZ(a),gravityType:"direction"}}function r$(a){return eZ(a)==="ocr_text"}function sa(){return{gravityType:"ocr"}}function sb(a){return`${a.qualifierValue}`.split(":")[0]==="auto"}function sc(c){const d=c.toString(),a=d.split("_"),b={object:a[0]};return a.length>1&&(a[1]==="avoid"?b.avoid=!0:b.weight=+a[1]),b}function iS(a){let b;const c=a==="auto"?new g$:a;`${a}`.startsWith("auto:")?b=`${a}`.split(":").filter(a=>a!=="auto"):b=c.qualifierValue.values.filter(a=>a!=="auto");const d=b.map(sc);return{gravityType:"auto",autoFocus:d}}function se(b){const c=`${b}`.split(":").includes("auto"),a=b.qualifierValue.values,e=c?a.slice(0,a.length-1):a,d={gravityType:"object",focusOnObjects:e.map(a=>`${a}`)};if(c){const b=a[a.length-1].values.slice(1),c=iL().autoFocus(...b);d.fallbackGravity=iS(c)}return d}function sf(a){const b=a.split(":"),c=b.map(a=>new dq(a));return new iz(c)}function sg(a){return rY(a)?r_(a):r$(a)?sa():rX(a)||sb(a)?iS(a):se(typeof a=="string"?sf(a):a)}iZ=class extends Y{constructor(a,b){super(),this._weight=b,this.focusOn=a,this.shouldAvoid=!1}static focusOn(a,b){return new iZ(a,b)}shouldAddWeight(){return typeof this._weight=="number"||typeof this._weight=="string"||this.shouldAvoid}getName(){return this.focusOn.name}getWeight(){return this.shouldAvoid?"avoid":this._weight}toString(){return this.shouldAddWeight()?`${this.getName()}_${this.getWeight()}`:`${this.getName()}`}weight(a){return this._weight=a,this}avoid(){return this.shouldAvoid=!0,this}},si=class extends Y{constructor(a){super(),this.val=a}toString(){return this.val}};function sj(a){return a.gravityType==="direction"}function sk(a){return a.gravityType==="ocr"}function sl(a){return a.gravityType==="auto"}function sm(c){const{object:d,weight:a,avoid:e}=c,b=new iZ(new dq(d));return(a||a===0)&&b.weight(a),e&&b.avoid(),b}function i_(a){const b=a.autoFocus||[],c=b.map(sm);return iL().autoFocus(...c)}function so(a){const c=(a.focusOnObjects||[]).map(a=>new dq(a)),b=iJ(...c);if(a.fallbackGravity){const c=i_(a.fallbackGravity);b.fallbackGravity(c)}return b}function sp(a){return sj(a)?new rS(new si(a.compass)):sk(a)?iJ(rW()):sl(a)?i_(a):so(a)}eV=class extends rO{gravity(a){this._actionModel.gravity=sg(a);const b=typeof a=="string"?new H("g",a):a;return this.addQualifier(b)}static fromJson(a){const b=super.fromJson.apply(this,[a]);return a.gravity&&b.gravity(sp(a.gravity)),b}},dC=class extends H{constructor(a){super("b"),a&&this.addValue(a)}},ss=class extends dC{intensity(a){return this.intensityLevel=a,this}brightness(a){return this.brightnessLevel=a,this}toString(){return`
    b_blurred
    ${this.intensityLevel?`:${this.intensityLevel}`:""}
    ${this.brightnessLevel?`:${this.brightnessLevel}`:""}
    `.replace(/\s+/g,"")}},je=ss;function eR(a){return a&&a.match(/^#/)?`rgb:${a.substr(1)}`:a}eP=class extends dC{constructor(){super(),this._palette=[]}contrast(){return this._contrast=!0,this}palette(...a){return this._palette=a.map(a=>eR(a)),this}},jr=class extends eP{toString(){return`
    b_auto:border
    ${this._contrast?"_contrast":""}
    ${this._palette.length?`:palette_${this._palette.join("_")}`:""}
    `.replace(/\s+/g,"")}},jM=class extends eP{gradientColors(a){return this._gradientColors=a,this}gradientDirection(a){return this._gradientDirection=a,this}},jP=class extends jM{toString(){return`
    b_auto:border_gradient
    ${this._contrast?"_contrast":""}
    ${this._gradientColors?`:${this._gradientColors}`:""}
    ${this._gradientDirection?`:${this._gradientDirection}`:""}
    ${this._palette.length?`:palette_${this._palette.join("_")}`:""}
    `.replace(/\s+/g,"")}},j_=class extends jM{toString(){return`
    b_auto:predominant_gradient
    ${this._contrast?"_contrast":""}
    ${this._gradientColors?`:${this._gradientColors}`:""}
    ${this._gradientDirection?`:${this._gradientDirection}`:""}
    ${this._palette.length?`:palette_${this._palette.join("_")}`:""}
    `.replace(/\s+/g,"")}},kb=class extends eP{toString(){return`
    b_auto:predominant
    ${this._contrast?"_contrast":""}
    ${this._palette.length?`:palette_${this._palette.join("_")}`:""}
    `.replace(/\s+/g,"")}};function kj(a){return`${a}`.replace("b_","")}function sC(){return{backgroundType:"auto"}}function sD(d){const{intensityLevel:a,brightnessLevel:b}=d,c={backgroundType:"blurred"};return(a||a===0)&&(c.intensity=a),(b||b===0)&&(c.brightness=b),c}function eA(b){const d=b._contrast,c=b._palette,a={backgroundType:""};return d&&(a.contrast=!0),c&&(a.palette=c),a}function sF(a){return Object.assign(Object.assign({},eA(a)),{backgroundType:"border"})}function kp(a){const c=a._gradientColors,d=`${a._gradientDirection}`,b=eA(a);return c&&(b.gradientColors=c),d&&(b.gradientDirection=d),b}function sH(a){return Object.assign(Object.assign({},kp(a)),{backgroundType:"borderGradient"})}function sI(a){return{backgroundType:"color",color:kj(a)}}function sJ(a){return Object.assign(Object.assign({},eA(a)),{backgroundType:"predominant"})}function sK(a){return Object.assign(Object.assign({},kp(a)),{backgroundType:"predominantGradient"})}function sL(a){return kj(a)==="auto"?sC():a instanceof je?sD(a):a instanceof jr?sF(a):a instanceof jP?sH(a):a instanceof kb?sJ(a):a instanceof j_?sK(a):sI(a)}sM=class extends Y{constructor(a){super(a),this.val=a}getValue(){return this.val}},sN=class extends Y{constructor(a){super(),this.value=a}toString(){return this.value}};function sO(a){const b=Object.keys(iq).map(a=>`\\s${a.replace(/(\*|\+|\^|\|)/g,"\\$1")}\\s`),c=b.join("|"),d=new RegExp(`(${c})`,"g"),e=a.toString().replace(d,a=>`_${iq[a.trim()]}_`),f=Object.keys(ir),g=f.join("|"),h=new RegExp(`(\\$_*[^_ ]+)|${g}`,"g"),i=e.replace(h,a=>a.startsWith("$")?a:ir[a]||a),j=i.replace(/\s/g,"_");return new sN(j)}function kq(){return new jr}function ks(){return new dC("auto")}function ku(){return new jP}function ky(){return new j_}function kA(){return new kb}function kB(a){return new dC(eR(a))}function sV(){return new je}sW={auto:ks,border:kq,borderGradient:ku,predominantGradient:ky,predominant:kA,color:kB,blurred:sV};function sX(d){const{brightness:a,intensity:b}=d,c=sW.blurred();return(a||a==0)&&c.brightness(a),(b||b==0)&&c.intensity(b),c}function kG(a,e){const{gradientColors:b,gradientDirection:c,contrast:f,palette:d}=e;return f&&a.contrast(),d&&a.palette(...d),b&&a.gradientColors(+b),c&&a.gradientDirection(c),a}function lD(a,c){const{contrast:d,palette:b}=c;return d&&a.contrast(),b&&a.palette(...b),a}function s_(a){const{backgroundType:b}=a;switch(b){case"auto":return ks();case"blurred":return sX(a);case"border":return lD(kq(),a);case"borderGradient":return kG(ku(),a);case"predominant":return lD(kA(),a);case"predominantGradient":return kG(ky(),a);default:return kB(a.color)}}s$=class extends eV{background(a){return this._actionModel.background=sL(a),this.addQualifier(a)}offsetX(a){return this._actionModel.x=a,this.addQualifier(new H("x",a))}offsetY(a){return this._actionModel.y=a,this.addQualifier(new H("y",a))}static fromJson(a){const b=super.fromJson.apply(this,[a]);return a.background&&b.background(s_(a.background)),a.x&&b.offsetX(a.x),a.y&&b.offsetY(a.y),a.zoom&&b.zoom(a.zoom),b}},ta=class extends eV{zoom(a){return this._actionModel.zoom=a,this.addQualifier(new H("z",a))}static fromJson(a){const b=super.fromJson.apply(this,[a]);return a.zoom&&b.zoom(a.zoom),b}},tb=class extends eV{x(a){return this._actionModel.x=a,this.addQualifier(new H("x",a))}y(a){return this._actionModel.y=a,this.addQualifier(new H("y",a))}static fromJson(a){const b=super.fromJson.apply(this,[a]);return a.x&&b.x(a.x),a.y&&b.y(a.y),b}};function tc(a,b){return new tb("fill",a,b)}function td(a,b){return new s$("pad",a,b)}function te(a,b){return new ta("thumb",a,b)}function ub(a){return!(typeof a!="object"||a instanceof Array)}tg=class{filterOutNonSupportedKeys(a,c){const b=Object.create({});return ub(a)?(Object.keys(a).forEach(d=>{c.indexOf(d)>=0?b[d]=a[d]:console.warn("Warning - unsupported key provided to configuration: ",d)}),b):Object.create({})}},th=tg,kR=class extends th{constructor(a){super();const b=this.filterOutNonSupportedKeys(a,ip);Object.assign(this,{secure:!0},b)}extend(a){const b=this.filterOutNonSupportedKeys(a,ip);return new kR(Object.assign({},this,b))}setCname(a){return this.cname=a,this}setSecureDistribution(a){return this.secureDistribution=a,this}setPrivateCdn(a){return this.privateCdn=a,this}setSignUrl(a){return this.signUrl=a,this}setLongUrlSignature(a){return this.longUrlSignature=a,this}setShorten(a){return this.shorten=a,this}setUseRootPath(a){return this.useRootPath=a,this}setSecure(a){return this.secure=a,this}setForceVersion(a){return this.forceVersion=a,this}},tj=kR,tk=class extends bF{constructor(a){super(),this.addQualifier(new H("b",new Y(a).setDelimiter("_")))}},kT=class{constructor(a){this.raw=a}toString(){return this.raw}toJson(){return{error:fl(`unsupported action ${this.constructor.name}`)}}};function tm(b){const a=b;return"error"in a&&!!a.error}ck=class{constructor(){this.actions=[]}addAction(a){let b;if(typeof a=="string"){if(a.indexOf("/")>=0)throw"addAction cannot accept a string with a forward slash in it - /, use .addTransformation() instead";b=new kT(a)}else b=a;return this.actions.push(b),this}addTransformation(a){return a instanceof ck?this.actions=this.actions.concat(a.actions):this.actions.push(new kT(a)),this}toString(){return this.actions.map(a=>a.toString()).filter(a=>a).join("/")}animated(a){return this.addAction(a)}border(a){return this.addAction(a)}reshape(a){return this.addAction(a)}resize(a){return this.addAction(a)}quality(a){return this.addAction(a)}roundCorners(a){return this.addAction(a)}overlay(a){return this.addAction(a)}underlay(a){return a.setLayerType("u"),this.addAction(a)}addVariable(a){return this.addAction(a)}conditional(a){return this.addAction(a)}effect(a){return this.addAction(a)}adjust(a){return this.addAction(a)}rotate(a){return this.addAction(a)}namedTransformation(a){return this.addAction(a)}delivery(a){return this.addAction(a)}backgroundColor(a){return this.addAction(new tk(eR(a)))}psdTools(a){return this.addAction(a)}extract(a){return this.addAction(a)}addFlag(a){const b=new bF;let c=a;return typeof a=="string"&&(c=new W(a)),b.addQualifier(c),this.addAction(b)}customFunction(a){return this.addAction(a)}transcode(a){return this.addAction(a)}videoEdit(a){return this.addAction(a)}toJson(){const a=[];for(const c of this.actions){const b=c.toJson();if(tm(b))return b;a.push(b)}return{actions:a}}},to=class extends ck{},tp=class extends ck{};function tq(a){return a.match(/^https?:\//)}function tr(a){return a.indexOf("/")<0}function ts(a){return a.match(/^v[0-9]+/)}function tt(c,d){const a=d.secure,f=d.privateCdn,e=d.cname,b=d.secureDistribution;return!a&&!e?`http://res.cloudinary.com/${c}`:a&&!b&&f?`https://${c}-res.cloudinary.com`:a&&!b?`https://res.cloudinary.com/${c}`:a&&b&&f?`https://${b}`:a&&b?`https://${b}/${c}`:!a&&e?`http://${e}/${c}`:"ERROR"}function tu(a){return a||"image"}function tv(a){return a||"upload"}function tw(a,b,c){const d=c!==!1;return b?`v${b}`:ts(a)||tq(a)||tr(a)?"":d?"v1":""}function eu(c,e,d){let a=e>>0,b=String(typeof d!="undefined"?d:" ");return c.length>a?String(c):(a=a-c.length,a>b.length&&(b+=ty(b,a/b.length)),b.slice(0,a)+String(c))}function ty(c,d){let a=d,b="";while(a>0)b+=c,a--;return b}tz="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",kX={},kY=0,tz.split("").forEach(b=>{let a=kY.toString(2);a=eu(a,6,"0"),kX[a]=b,kY++});function tC(a){if(a.split(".").length<2)throw new Error("invalid semVer, must have at least two segments");return a.split(".").reverse().map(a=>{const b=+a;if(isNaN(b)||b<0)throw"Invalid version number provided";return eu(a,2,"0")}).join(".")}function la(c){let b="";const d=c.split(".").length,e=d*6,f=tC(c),g=parseInt(f.split(".").join(""));let a=g.toString(2);if(a=eu(a,e,"0"),a.length%6!==0)throw"Version must be smaller than 43.21.26)";return a.match(/.{1,6}/g).forEach(a=>{b+=kX[a]}),b}function tE(a){const b={sdkSemver:a.sdkSemver,techVersion:a.techVersion,sdkCode:a.sdkCode,feature:"0"};return a.accessibility&&(b.feature="D"),a.lazyload&&(b.feature="C"),a.responsive&&(b.feature="A"),a.placeholder&&(b.feature="B"),b}tF="1.8.0";function tG(){const a="0.0.0";if(typeof window!="undefined")return a;try{return process.versions.node||a}catch(b){return a}}function tH(a){const b={techVersion:tG(),sdkCode:"T",sdkSemver:tF.split("-")[0],responsive:!1,placeholder:!1,lazyload:!1,accessibility:!1};return a?Object.assign(Object.assign({},b),a):b}function tI(b){const c=tH(b),a=tE(c);try{const b=tJ(a.techVersion),c=la(a.sdkSemver),d=la(b),e=a.feature,f=a.sdkCode,g="A";return`${g}${f}${c}${d}${e}`}catch(a){return"E"}}function tJ(b){const a=b.split(".");return`${a[0]}.${a[1]}`}le={"image/upload":"images","image/private":"private_images","image/authenticated":"authenticated_images","raw/upload":"files","video/upload":"videos"},tL=class{constructor(a,b={},c){this.setPublicID(a),this.setCloudConfig(b),this.setURLConfig(c)}setURLConfig(a){return this.urlConfig=new tj(a),this}setCloudConfig(a){return this.cloudName=a.cloudName,this.apiKey=a.apiKey,this.apiSecret=a.apiSecret,this.authToken=a.authToken,this}setPublicID(a){return this.publicID=a?a.toString():"",this}setDeliveryType(a){return this.deliveryType=a,this}setSuffix(a){return this.suffix=a,this}setSignature(a){return this.signature=a,this}setVersion(a){return a&&(this.version=a),this}setAssetType(a){return a&&(this.assetType=a),this}sign(){return this}toURL(a={}){return this.createCloudinaryURL(null,a.trackedAnalytics)}validateAssetForURLCreation(){if(typeof this.cloudName=="undefined")throw"You must supply a cloudName when initializing the asset";const a=this.suffix&&this.suffix.indexOf(".")>=0,b=this.suffix&&this.suffix.indexOf("/")>=0;if(a||b)throw"`suffix`` should not include . or /"}getResourceType(){const b=tu(this.assetType),c=tv(this.deliveryType),e=!!this.suffix,a=`${b}/${c}`,d=le[`${b}/${c}`],f=this.urlConfig.useRootPath,g=this.urlConfig.shorten;if(f){if(a==="image/upload")return"";throw new Error(`useRootPath can only be used with assetType: 'image' and deliveryType: 'upload'. Provided: ${a} instead`)}if(g&&a==="image/upload")return"iu";if(e){if(d)return d;throw new Error(`URL Suffix only supported for ${Object.keys(le).join(", ")}, Provided: ${a} instead`)}return a}getSignature(){return this.signature?`s--${this.signature}--`:""}createCloudinaryURL(a,h){if(!this.publicID)return"";this.validateAssetForURLCreation();const e=tt(this.cloudName,this.urlConfig),f=a?a.toString():"",g=tw(this.publicID,this.version,this.urlConfig.forceVersion),c=this.publicID.replace(/,/g,"%2C"),d=[e,this.getResourceType(),this.getSignature(),f,g,c,this.suffix].filter(a=>a).join("/");if(typeof a=="string")return d;const b=encodeURI(d).replace(/\?/g,"%3F").replace(/=/g,"%3D");return this.urlConfig.analytics!==!1&&!c.includes("?")?`${b}?_a=${tI(h)}`:b}},tM=class extends bF{constructor(c,a,d){super(),this._actionModel={};let b;a instanceof sM?b=a.getValue():b=a,this._actionModel.actionType=rK[c],this._actionModel[d]=b,this.addQualifier(new H(c,a))}},tN=class extends W{constructor(a){super("progressive",a)}},lg=class extends tM{constructor(a,b){super(a,b,"formatType")}lossy(){return this._actionModel.lossy=!0,this.addFlag(rr()),this}progressive(a){return a instanceof tN?(this._actionModel.progressive={mode:a.getFlagValue()},this.addFlag(a)):(this._actionModel.progressive={mode:a},this.addFlag(rt(a))),this}preserveTransparency(){return this._actionModel.preserveTransparency=!0,this.addFlag(rs()),this}static fromJson(d){const{formatType:c,lossy:e,progressive:b,preserveTransparency:f}=d;let a;return c?a=new this("f",c):a=new this("f"),b&&(b.mode?a.progressive(b.mode):a.progressive()),e&&a.lossy(),f&&a.preserveTransparency(),a}},li=class extends tL{constructor(a,b,c,d){super(a,b,c),this.transformation=d}animated(a){return this.transformation.animated(a),this}border(a){return this.transformation.border(a),this}reshape(a){return this.transformation.reshape(a),this}resize(a){return this.transformation.resize(a),this}quality(a){return this.addAction(new lg("q",a)),this}format(a){return this.addAction(new lg("f",a)),this}roundCorners(a){return this.transformation.roundCorners(a),this}overlay(a){return this.transformation.overlay(a),this}addVariable(a){return this.transformation.addVariable(a),this}conditional(a){return this.transformation.conditional(a),this}effect(a){return this.transformation.effect(a),this}adjust(a){return this.transformation.adjust(a),this}rotate(a){return this.transformation.rotate(a),this}namedTransformation(a){return this.transformation.namedTransformation(a),this}delivery(a){return this.transformation.delivery(a),this}backgroundColor(a){return this.transformation.backgroundColor(a),this}psdTools(a){return this.transformation.psdTools(a),this}extract(a){return this.transformation.extract(a),this}addFlag(a){return this.transformation.addFlag(a),this}customFunction(a){return this.transformation.customFunction(a),this}addAction(a){return this.transformation.addAction(a),this}addTransformation(a){return this.transformation.addTransformation(a),this}toString(){return this.transformation.toString()}underlay(a){return this.transformation.underlay(a),this}toURL(a={}){return this.createCloudinaryURL(this.transformation,a===null||a===void 0?void 0:a.trackedAnalytics)}},tQ=class extends li{constructor(a,b,c){super(a,b,c,new to)}},tR=class extends li{constructor(a,b,c){super(a,b,c,new tp),this.assetType="video"}transcode(a){return this.transformation.transcode(a),this}videoEdit(a){return this.transformation.videoEdit(a),this}},tS=class{constructor(a){a&&(this.cloudinaryConfig=a)}image(a){return new tQ(a,this.cloudinaryConfig.cloud,this.cloudinaryConfig.url)}video(a){return new tR(a,this.cloudinaryConfig.cloud,this.cloudinaryConfig.url)}setConfig(a){return this.cloudinaryConfig=a,this}getConfig(){return this.cloudinaryConfig}extendConfig(){}},lj=new tS({cloud:{cloudName:"timbomckay"},url:{secure:!0}}),ll=Math.round(window.devicePixelRatio*60),bA=class extends aw{connectedCallback(){super.connectedCallback(),this.setAttribute("tabindex","0"),this.addEventListener("dragstart",()=>{this.classList.add("dragging")}),this.addEventListener("dragend",()=>{this.classList.remove("dragging")}),this.addEventListener("dragenter",()=>{this.classList.add("hovering")}),this.addEventListener("dragleave",()=>{this.classList.remove("hovering")}),this.addEventListener("drop",()=>{this.classList.remove("hovering")})}render(){if(this.uid==null)return p;const{details:a}=this;if(this.title=a.name,a.rarity&&(this.rarity=a.rarity),a.image){const c=Object.keys(a.sources).shift(),d=a.name.replace(/\s/g,"_").replace(/,/g,"").replace(/\(/g,"").replace(/\)/g,"").replace(/'/g,""),b=lj.image(`items/${c}/${d}`);return b.format("auto").resize(te().width(ll).height(ll)),o`<img src="${b.toURL()}" alt="${a.name}" crossorigin="anonymous" />`}return a.extends&&fi(this,"click"),o`${a.name}`}},bA.styles=br`
    * { box-sizing: border-box; }
  
    :host {
      aspect-ratio: 1/1;
      border-color: #78350f;
      border-style: solid;
      border-width: 1px;
      font-size: 0.75rem;
      line-height: 1;
      overflow: hidden;
      padding: 0.25rem;
      position: relative;
    }
    :host(.hovering) {
      background-color: red;
    }
    :host(.dragging) {
      background-color: yellow;
      transform: scale(1.15);
    }

    img {
      height: auto;
      width: auto;
      max-width: 100%;
      transform: scale(1.75);
      pointer-events: none;
    }

    :host([rarity])::before {      
      background-color: var(--rarity, transparent);
      content: "";
      display: block;
      height: 1rem;
      position: absolute;
      right: 0px;
      top: 0px;
      transform-origin: top;
      transform: rotate(45deg) translate(50%, -100%);
      width: 1rem;
      z-index: 1;
    }

    :host([rarity="common"]) { --rarity: #94A3B8; }
    :host([rarity="uncommon"]) { --rarity: #84CC16; }
    :host([rarity="rare"]) { --rarity: #3B82F6; }
    :host([rarity="very rare"]) { --rarity: #7C3AED; }
    :host([rarity="legendary"]) { --rarity: #FCD34D; }
    :host([rarity="artifact"]) { --rarity: #DC2626; }
  `,M([ap()],bA.prototype,"uid",2),M([ap({type:String,reflect:!0})],bA.prototype,"rarity",2),M([ap({type:Object,attribute:!1,hasChanged(a,b){return JSON.stringify(a)!==JSON.stringify(b)}})],bA.prototype,"details",2),bA=M([df("wc-item")],bA),tW={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},tX=a=>(...b)=>({_$litDirective$:a,values:b}),tY=class{constructor(a){}get _$AU(){return this._$AM._$AU}_$AT(a,b,c){this._$Ct=a,this._$AM=b,this._$Ci=c}_$AS(a,b){return this.update(a,b)}update(b,a){return this.render(...a)}},eg=class extends tY{constructor(a){if(super(a),this.it=p,a.type!==tW.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(a){if(a===p||a==null)return this.ft=void 0,this.it=a;if(a===aQ)return a;if(typeof a!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(a===this.it)return this.ft;this.it=a;const b=[a];return b.raw=b,this.ft={_$litType$:this.constructor.resultType,strings:b,values:[]}}},eg.directiveName="unsafeHTML",eg.resultType=1,lv=tX(eg),pW=class extends bF{constructor(a,b){super(),this._actionModel={actionType:"ifCondition"},this.exp=a,this.ifTx=b,this._actionModel.expression=a,this._actionModel.transformation=b}otherwise(a){return this.elseTx=a,this._actionModel.otherwise=a,this}toString(){return[`if_${sO(this.exp)}`,`${this.ifTx}`,this.elseTx&&`if_else/${this.elseTx}`,`if_end`].filter(a=>a).join("/")}static fromJson(c){const{expression:d,transformation:e,otherwise:a}=c,b=new this(d,e);return a&&b.otherwise(a),b}};function ua(a,b){return new pW(a,b)}dX=rM(t_()),rN={AI:"Acquisitions Incorporated",AL:"Adventurers' League",AWM:"Adventure with Muk",AZfyT:"A Zib for your Thoughts",AitFR:"Adventures in the Forgotten Realms",BGDIA:"Baldur's Gate: Descent Into Avernus",CM:"Candlekeep Mysteries",CoS:"Curse of Strahd",DC:"Divine Contention",DIP:"Dragon of Icespire Peak",DMG:"Dungeon Master's Guide",DoD:"Domains of Delight",EEPC:"Elemental Evil Player's Companion",EET:"Elemental Evil: Trinkets",EFR:"Eberron: Forgotten Relics",EGW:"Explorer's Guide to Wildemount",ERLW:"Eberron: Rising from the Last War",ESK:"Essentials Kit",FTD:"Fizban's Treasury of Dragons",GGR:"Guildmasters' Guide to Ravnica",GoS:"Ghosts of Saltmarsh",HEROES_FEAST:"Heroes' Feast",HftT:"Hunt for the Thessalhydra",HoL:"The House of Lament",HotDQ:"Hoard of the Dragon Queen",IDRotF:"Icewind Dale: Rime of the Frostmaiden",IMR:"Infernal Machine Rebuild",KKW:"Krenko's Way",LLK:"Lost Laboratory of Kwalish",LMoP:"Lost Mine of Phandelver",LR:"Locathah Rising",MFF:"Mordenkainen's Fiendish Folio",MM:"Monster Manual",MOT:"Mythic Odysseys of Theros",MTF:"Mordenkainen's Tome of Foes",MaBJoV:"Minsc and Boo's Journal of Villainy",NRH:"NERDS Restoring Harmony",OGA:"One Grung Above",OoW:"The Orrery of the Wanderer",OotA:"Out of the Abyss",PHB:"Player's Handbook",PotA:"Princes of the Apocalypse",RMBRE:"The Lost Dungeon of Rickedness: Big Rick Energy",RMR:"Dungeons & Dragons vs. Rick and Morty: Basic Rules",RoT:"The Rise of Tiamat",RoTOS:"The Rise of Tiamat Online Supplement",RtG:"Return to Glory",SAC:"Sage Advice Compendium",SADS:"Sapphire Anniversary Dice Set",SCAG:"Sword Coast Adventurer's Guide",SCC:"Strixhaven: A Curriculum of Chaos",SCC_ARiR:"A Reckoning in Ruins",SCC_CK:"Campus Kerfuffle",SCC_HfMT:"Hunt for Mage Tower",SCC_TMM:"The Magister's Masquerade",SCREEN:"Dungeon Master's Screen",SCREEN_WILDERNESS_KIT:"Dungeon Master's Screen: Wilderness Kit",SDW:"Sleeping Dragon's Wake",SKT:"Storm King's Thunder",SLW:"Storm Lord's Wrath",TCE:"Tasha's Cauldron of Everything",TLK:"The Lost Kenku",TTP:"The Tortle Package",TftYP:"Tales from the Yawning Portal",ToA:"Tomb of Annihilation",ToD:"Tyranny of Dragons",VGM:"Volo's Guide to Monsters",VRGR:"Van Richten's Guide to Ravenloft",WBtW:"The Wild Beyond the Witchlight",WDH:"Waterdeep: Dragon Heist",WDMM:"Waterdeep: Dungeon of the Mad Mage",XGE:"Xanathar's Guide to Everything",XMtS:"X Marks the Spot"},dY=Math.round(window.devicePixelRatio*480),cm=class extends aw{constructor(){super(...arguments),this.uid=null}imageTemplate(){const{details:a}=this;if(!a.image)return p;const c=Object.keys(a.sources).shift(),d=a.name.replace(/\s/g,"_").replace(/,/g,"").replace(/\(/g,"").replace(/\)/g,"").replace(/'/g,""),b=lj.image(`items/${c}/${d}`);return b.format("auto").conditional(ua("aspect_ratio > 1.2",(new ck).resize(tc().width(dY).height(dY*.5625))).otherwise((new ck).resize(td().width(dY).height(dY*.5)))),o`<div class="image-container">
      <img src="${b.toURL()}" alt="${a.name}" width="2" height="1" crossorigin="anonymous" />
    </div>`}attunementTemplate(a){if(!a)return p;const b=o`<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 20 20" height="20" viewBox="0 0 20 20" width="20"><g><rect fill="none" height="20" width="20"/></g><g><path d="M18,10l-1.77-2.03l0.25-2.69l-2.63-0.6l-1.37-2.32L10,3.43L7.53,2.36L6.15,4.68L3.53,5.28l0.25,2.69L2,10l1.77,2.03 l-0.25,2.69l2.63,0.6l1.37,2.32L10,16.56l2.47,1.07l1.37-2.32l2.63-0.6l-0.25-2.69L18,10z M8.59,13.07l-2.12-2.12l0.71-0.71 l1.41,1.41l4.24-4.24l0.71,0.71L8.59,13.07z"/></g></svg>`,c=o`<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M23 12l-2.44-2.78.34-3.68-3.61-.82-1.89-3.18L12 3 8.6 1.54 6.71 4.72l-3.61.81.34 3.68L1 12l2.44 2.78-.34 3.69 3.61.82 1.89 3.18L12 21l3.4 1.46 1.89-3.18 3.61-.82-.34-3.68L23 12zm-10 5h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>`;return o`<span class="attunement icon" data-tooltip="requires attunement${a.length?` ${a}`:""}">
      ${b}
    </span>`}damageTemplate(a){if(!a)return p;const{roll:b,type:c,versatile:d}=a;return o`
      <span class="icon">
        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0zm21.02 19c0 1.1-.9 2-2 2h-14c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v14z" fill="none"/><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM7.5 18c-.83 0-1.5-.67-1.5-1.5S6.67 15 7.5 15s1.5.67 1.5 1.5S8.33 18 7.5 18zm0-9C6.67 9 6 8.33 6 7.5S6.67 6 7.5 6 9 6.67 9 7.5 8.33 9 7.5 9zm4.5 4.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4.5 4.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm0-9c-.83 0-1.5-.67-1.5-1.5S15.67 6 16.5 6s1.5.67 1.5 1.5S17.33 9 16.5 9z"/></svg>
      </span>
      ${[b,d].filter(a=>!!a).join("/")} ${c}
      <span style="margin-right: auto;"></span>`}chargeTemplate(a){if(!a)return p;const b=()=>o`<span class="icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M11 21h-1l1-7H7.5c-.58 0-.57-.32-.38-.66.19-.34.05-.08.07-.12C8.48 10.94 10.42 7.54 13 3h1l-1 7h3.5c.49 0 .56.33.47.51l-.07.15C12.96 17.55 11 21 11 21z"/></svg>
    </span>`;return a>8?o`<span class="charges">
        ${b()}<span>*${a}</span>
      </span>`:o`<span class="charges">${Array.from(Array(a)).map(()=>b())}</span>`}rarityTemplate(a){return!a||a==="varies"?p:o`<span data-rarity="${a}"></span>`}closeButtonTemplate(){const a=o`<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>`;return o`<button style="line-height: 0;" type="button" @click="${()=>{fi(this,"close")}}">${a}</button>`}menuButtonTemplate(){const a=o`<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>`;return o`<details>
      <summary style="line-height: 0;">${a}</summary>
      <div>
        <i>Menu in Progress</i>
      </div>
    </details>`}processEntries(a){return o`${a==null?p:a.map(a=>this.processEntry(a))}`}processEntry(a,b){if(typeof a=="string")switch(b){case"li":return o`<li>${lv(a)}</li>`;default:return o`<p>${lv(a)}</p>`}if(Array.isArray(a))return o`Array: <pre>${JSON.stringify(a,null,2)}</pre>`;switch(a.type){case"list":return o`<ul class=${a.style}>${a.items.map(a=>o`${this.processEntry(a,"li")}`)}</ul>`;default:return o`<pre>${JSON.stringify(a,null,2)}</pre>`}}render(){if(!this.uid)return p;const{attunement:f,charges:k,damage:j,entries:i,image:m,name:g,properties:a,range:n,rarity:d,sources:c,srd:l,tier:b,type:h,...e}=this.details;return o`
      ${this.imageTemplate()}
      <div class="title">
        ${g}
        <div>
          ${this.attunementTemplate(f)}
        </div>
        ${this.rarityTemplate(d)}
      </div>
      <div class="content">
        <div class="content-inner">
          <div class="info">
            <i>${h} ${b?`(${b})`:""} ${d}</i>
            <div style="display: flex; align-items: center; gap: 0.5rem; flex-shrink: 0;">
              ${this.chargeTemplate(k)}
              ${a?o`<div>${a.map((a,b)=>o`<span class="property" style="z-index: -${b};">${a}</span>`)}</div>`:""}
            </div>
          </div>
          ${Object.keys(e).length?o`<pre>${JSON.stringify(e,null,2)}</pre>`:""}
          ${this.processEntries(i)}
          <div>
            <i class="sources">
              ${c?Object.keys(c).map(a=>rN[a]).join(" \u2022\xA0"):""}
            </i>
          </div>
        </div>
      </div>
      <div class="footer">
        ${this.damageTemplate(j)}
        ${this.menuButtonTemplate()}
        ${this.closeButtonTemplate()}
      </div>
    `}},cm.styles=br`
    * { box-sizing: border-box; }

    :host {
      border-color: ${bJ(dX.primary[800])};
      border-style: solid;
      border-width: 0 0 1px 0;
      display: block;
    }

    :host([uid=""]) {
      display: none;
    }

    .image-container {
      padding: 0;
      position: relative;
    }

    img {
      display: block;
      height: auto;
      line-height: 0;
      margin-left: auto;
      margin-right: auto;
      max-width: 100%;
      mix-blend-mode: multiply;
      width: 100%;
    }
    
    .content {
      padding: 0 0.5rem;
    }

    .content-inner {
      border-color: ${bJ(dX.yellow[600])};
      border-style: solid;
      border-width: 1px 0;
      font-size: 0.85em;
      padding: 0.5rem 0;
      line-height: 1.25;
      max-height: 50vh;
      overflow: auto;
    }

    .title, .info {
      align-items: center;
      display: flex;
      gap: 1rem;
      justify-content: space-between;
    }

    .title {
      color: ${bJ(dX.primary[600])};
      font-size: 1.125rem;
      line-height: 1;
      font-weight: 600;
      padding: 0.5rem;
      position: relative;
    }

    .title .attunement {
      flex-shrink: 0;
      color: ${bJ(dX.primary[900])};
      color: black;
      opacity: 0.325;
    }

    .icon {
      display: inline-block;
      line-height: 0;
    }
    
    .icon > svg {
      display: block;
      fill: currentColor;
      height: 1em;
      max-height: 100%;
      max-width: 100%;
      width: 1em;
    }

    b { line-height: 1; }

    ul { padding-left: 1.25rem; }

    li, p {
      margin-top: 0.5em;
    }

    ul.none {
      padding-left: 0;
      list-style-none;
    }

    .charges {
      line-height: 1;
      display: inline-flex;
    }

    .charges > .icon {
      margin-left: -0.5em;
    }

    .sources {
      font-size: 0.9em;
      margin-top: 1rem;
      display: block;
    }

    .property {
      background-color: black;
      border-radius: 9999px;
      border: 1px solid white;
      color: white;
      display: inline-grid;
      font-family: sans-serif;
      font-size: 12px;
      font-weight: bold;
      height: 1rem;
      line-height: 1;
      margin-left: -0.325rem;
      padding: 0 0.325rem;
      place-content: center;
      position: relative;
      text-align: center;
    }

    .footer {
      display: flex;
      align-items: center;
      padding: 0.5rem;
      gap: 0.25rem;
      justify-content: flex-end;
      font-size: 0.85em;
    }

    button {
      border: 0;
      background-color: transparent;
      background-image: none;
      cursor: pointer;
      color: inherit;
      line-height: inherit;
      padding: 0;
    }

    details {
      position: relative;
    }

    summary {
      cursor: pointer;
      list-style: none;
    }

    ::-webkit-details-marker {
      display: none;
    }

    details > div {
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 2px;
      bottom: 100%;
      filter: drop-shadow(1px 2px 2px rgba(0, 0, 0, 0.125));
      padding: 0.5rem;
      position: absolute;
      right: -0.25rem;
      width: 14ch;
    }

    span[data-rarity] {
      background-color: var(--rarity, transparent);
      box-shadow: 0 0 0 2px white;
      content: "";
      display: block;
      font-size: 0.45rem;
      height: 1em;
      left: 50%;
      position: absolute;
      top: 100%;
      transform: translate(-50%, -50%) rotate(-45deg);
      width: 1em;
      z-index: 1;
    }

    span[data-rarity="common"] { --rarity: #94A3B8; }
    span[data-rarity="uncommon"] { --rarity: #84CC16; }
    span[data-rarity="rare"] { --rarity: #3B82F6; }
    span[data-rarity="very rare"] { --rarity: #7C3AED; }
    span[data-rarity="legendary"] { --rarity: #FCD34D; }
    span[data-rarity="artifact"] { --rarity: #DC2626; }

    pre {
      background-color: whitesmoke;
      border: 1px solid #ccc;
      padding: 0.5rem;
      border-radius: 0.5rem;
      overflow: auto;
      font-size: 0.75rem;
    }
  `,M([ap()],cm.prototype,"uid",2),M([ap({type:Object,attribute:!1,hasChanged(a,b){return JSON.stringify(a)!==JSON.stringify(b)}})],cm.prototype,"details",2),cm=M([df("wc-item-details")],cm),aY=class extends aw{constructor(){super(...arguments),this.list=[],this.uid="--uid--",this.isDropTarget=!1,this.active=""}connectedCallback(){super.connectedCallback(),this.addEventListener("dragenter",a=>a.preventDefault()),this.addEventListener("dragover",a=>{a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"})}render(){return o`
      <div class="title">${this.uid}</div>
      <wc-item-details
        uid="${this.active}"
        .details="${dh[this.active]}"
        @close="${()=>{this.active=""}}"
      ></wc-item-details>
      <div class="container ${this.isDropTarget?"highlight":""}">
        ${this.list.map((a,b)=>o`<wc-item
          uid="${a}"
          .index="${b}"
          .details="${dh[a]}"
          draggable="true"
          @click="${()=>{this.active=a}}"
        ></wc-item>`)}
      </div>
    `}},aY.styles=[br`
      * { box-sizing: border-box; }

      .title {
        background-color: rgb(254, 243, 199);
        font-size: 0.9rem;
        padding: 0 0.25rem;
        text-align: center;
        position: sticky;
        top: 4.5rem;
        z-index: 9;
      }
      .container {
        padding: 0.5rem;
        display: grid;
        gap: 0.25rem;
        grid-template-columns: repeat(auto-fill, minmax(2.5rem, 1fr));
      }
      .highlight {
        background-color: yellow;
      }
    `,br`@media (min-width: 48rem) {
      .container {
        padding: 0.25rem;
      }

      .title {
        top: 2.5rem;
      }
    }`],M([ap({type:Array,attribute:!1,hasChanged(a,b){return JSON.stringify(a)!==JSON.stringify(b)}})],aY.prototype,"list",2),M([ap()],aY.prototype,"uid",2),M([dg()],aY.prototype,"isDropTarget",2),M([dg()],aY.prototype,"active",2),aY=M([df("wc-item-list")],aY);function ag(){const a=Object.keys(dh);return a[Math.floor(Math.random()*a.length)]}function ad(){return Array.from(Array(Math.floor(Math.random()*24+7)),()=>ag())}qD=()=>({"ch-uid-123":{name:"Tenebrae",inventory:{Attuned:[ag(),ag()],Inventory:ad(),Backpack:ad(),"Bag of Holding":ad()}},"ch-uid-321":{name:"Cyan",inventory:{Attuned:[ag(),ag(),ag()],Inventory:ad(),Backpack:ad(),"Astral Scarf":ad()}},"ch-uid-aaa":{name:"Chris...?",inventory:{Attuned:[ag()],Inventory:ad(),Backpack:ad()}},"ch-uid-abc":{name:"DOMO",inventory:{Attuned:[ag(),ag()],Inventory:ad(),Backpack:ad()}}}),bZ=class extends aw{constructor(){super(...arguments),this.data=null,this.dragging={}}handleDrag(a,b,c){const{index:d,uid:e}=c.composedPath().shift();this.dragging={ch:a,list:b,index:d,uid:e}}handleDrop(c,d,e){e.preventDefault();const a=JSON.parse(JSON.stringify(this.data)),{ch:f,list:g,index:h,uid:i}=this.dragging;let{index:b}=e.composedPath().shift();b==null&&(b=a[c].inventory[d].length),a[f].inventory[g].splice(h,1),a[c].inventory[d].splice(b,0,i),this.data=a,this.dragging={}}setData(){this.data=qD()}connectedCallback(){super.connectedCallback(),window.addEventListener("ITEMS",()=>this.setData())}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("ITEMS",()=>this.setData())}render(){return this.data==null?p:o`${Object.entries(this.data).map(([a,b])=>o`<div class="character">
        <div class="name">${b.name}</div>
        ${Object.entries(b.inventory).map(([b,c])=>o`<wc-item-list
            .list="${c}"
            @drop="${c=>this.handleDrop(a,b,c)}"
            @dragstart="${c=>this.handleDrag(a,b,c)}"
            uid="${b}"
          ></wc-item-list>`)}
      </div>`)}`}},bZ.styles=[br`
      * { box-sizing: border-box; }

      :host {
        min-height: calc(100vh - 5rem);
      }
      .character {
        border-width: 0 0 1px 0;
        border-color: #78350f;
        border-style: solid;
        list-style: none;
      }
      .name {
        text-align: center;
        padding: 0.5rem;
        position: sticky;
        top: 2rem;
        z-index: 10;
        background-color: white;
        height: 2.5rem;
      }
    `,br`@media (min-width: 48rem) {
      :host {
        display: flex;
        flex-direction: row;
        gap: 1rem;
        height: calc(100vh - 4rem);
      }
      .character {
        border-width: 1px;
        flex: 1 0 32ch;
        overflow: auto;
      }
      .name {
        top: 0;
      }
    }`],M([dg()],bZ.prototype,"data",2),M([dg()],bZ.prototype,"dragging",2),bZ=M([df("wc-inventory")],bZ)})()