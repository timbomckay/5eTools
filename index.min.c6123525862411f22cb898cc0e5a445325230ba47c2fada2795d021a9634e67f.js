(()=>{var oq=Object.create,cA=Object.defineProperty,kP=Object.getOwnPropertyDescriptor,kO=Object.getOwnPropertyNames,oY=Object.getPrototypeOf,px=Object.prototype.hasOwnProperty,p$=a=>cA(a,"__esModule",{value:!0}),kM=(b,a)=>function(){return a||(0,b[kO(b)[0]])((a={exports:{}}).exports,a),a.exports},qa=(b,a,d,c)=>{if(a&&typeof a=="object"||typeof a=="function")for(let e of kO(a))!px.call(b,e)&&(d||e!=="default")&&cA(b,e,{get:()=>a[e],enumerable:!(c=kP(a,e))||c.enumerable});return b},qe=(a,b)=>qa(p$(cA(a!=null?oq(oY(a)):{},"default",!b&&a&&a.__esModule?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a),O=(g,b,e,c)=>{for(var a=c>1?void 0:c?kP(b,e):b,f=g.length-1,d;f>=0;f--)(d=g[f])&&(a=(c?d(b,e,a):d(a))||a);return c&&a&&cA(b,e,a),a},ss=kM({"node_modules/tailwindcss/colors.js"(c,b){var a=!1;b.exports={black:"#000",white:"#fff",rose:{50:"#fff1f2",100:"#ffe4e6",200:"#fecdd3",300:"#fda4af",400:"#fb7185",500:"#f43f5e",600:"#e11d48",700:"#be123c",800:"#9f1239",900:"#881337"},pink:{50:"#fdf2f8",100:"#fce7f3",200:"#fbcfe8",300:"#f9a8d4",400:"#f472b6",500:"#ec4899",600:"#db2777",700:"#be185d",800:"#9d174d",900:"#831843"},fuchsia:{50:"#fdf4ff",100:"#fae8ff",200:"#f5d0fe",300:"#f0abfc",400:"#e879f9",500:"#d946ef",600:"#c026d3",700:"#a21caf",800:"#86198f",900:"#701a75"},purple:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7e22ce",800:"#6b21a8",900:"#581c87"},violet:{50:"#f5f3ff",100:"#ede9fe",200:"#ddd6fe",300:"#c4b5fd",400:"#a78bfa",500:"#8b5cf6",600:"#7c3aed",700:"#6d28d9",800:"#5b21b6",900:"#4c1d95"},indigo:{50:"#eef2ff",100:"#e0e7ff",200:"#c7d2fe",300:"#a5b4fc",400:"#818cf8",500:"#6366f1",600:"#4f46e5",700:"#4338ca",800:"#3730a3",900:"#312e81"},blue:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a"},get lightBlue(){return a||(console.log("warn - As of Tailwind CSS v2.2, `lightBlue` has been renamed to `sky`."),console.log("warn - Please update your color palette to eliminate this warning."),a=!0),{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e"}},sky:{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e"},cyan:{50:"#ecfeff",100:"#cffafe",200:"#a5f3fc",300:"#67e8f9",400:"#22d3ee",500:"#06b6d4",600:"#0891b2",700:"#0e7490",800:"#155e75",900:"#164e63"},teal:{50:"#f0fdfa",100:"#ccfbf1",200:"#99f6e4",300:"#5eead4",400:"#2dd4bf",500:"#14b8a6",600:"#0d9488",700:"#0f766e",800:"#115e59",900:"#134e4a"},emerald:{50:"#ecfdf5",100:"#d1fae5",200:"#a7f3d0",300:"#6ee7b7",400:"#34d399",500:"#10b981",600:"#059669",700:"#047857",800:"#065f46",900:"#064e3b"},green:{50:"#f0fdf4",100:"#dcfce7",200:"#bbf7d0",300:"#86efac",400:"#4ade80",500:"#22c55e",600:"#16a34a",700:"#15803d",800:"#166534",900:"#14532d"},lime:{50:"#f7fee7",100:"#ecfccb",200:"#d9f99d",300:"#bef264",400:"#a3e635",500:"#84cc16",600:"#65a30d",700:"#4d7c0f",800:"#3f6212",900:"#365314"},yellow:{50:"#fefce8",100:"#fef9c3",200:"#fef08a",300:"#fde047",400:"#facc15",500:"#eab308",600:"#ca8a04",700:"#a16207",800:"#854d0e",900:"#713f12"},amber:{50:"#fffbeb",100:"#fef3c7",200:"#fde68a",300:"#fcd34d",400:"#fbbf24",500:"#f59e0b",600:"#d97706",700:"#b45309",800:"#92400e",900:"#78350f"},orange:{50:"#fff7ed",100:"#ffedd5",200:"#fed7aa",300:"#fdba74",400:"#fb923c",500:"#f97316",600:"#ea580c",700:"#c2410c",800:"#9a3412",900:"#7c2d12"},red:{50:"#fef2f2",100:"#fee2e2",200:"#fecaca",300:"#fca5a5",400:"#f87171",500:"#ef4444",600:"#dc2626",700:"#b91c1c",800:"#991b1b",900:"#7f1d1d"},warmGray:{50:"#fafaf9",100:"#f5f5f4",200:"#e7e5e4",300:"#d6d3d1",400:"#a8a29e",500:"#78716c",600:"#57534e",700:"#44403c",800:"#292524",900:"#1c1917"},trueGray:{50:"#fafafa",100:"#f5f5f5",200:"#e5e5e5",300:"#d4d4d4",400:"#a3a3a3",500:"#737373",600:"#525252",700:"#404040",800:"#262626",900:"#171717"},gray:{50:"#fafafa",100:"#f4f4f5",200:"#e4e4e7",300:"#d4d4d8",400:"#a1a1aa",500:"#71717a",600:"#52525b",700:"#3f3f46",800:"#27272a",900:"#18181b"},coolGray:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"},blueGray:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"}}}}),sp=kM({"ns-hugo:/home/runner/work/5eTools/5eTools/assets/colors.js"(c,a){var b=ss();a.exports={...b,primary:{50:"#faf3f3",100:"#f5e7e7",200:"#e7c2c3",300:"#d89d9f",400:"#ba5456",500:"#9d0a0e",600:"#8d090d",700:"#76080b",800:"#5e0608",900:"#4d0507"}}}}),so=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}wrapCallback(a){return(b,c)=>{b?this.reject(b):this.resolve(c),typeof a=="function"&&(this.promise.catch(()=>{}),a.length===1?a(b):a(b,c))}}},rO,fB,kt,rC,sA,cN,aG,ro,ri,rh,n,rg,rf,re,qX,jR,qV,fj,jO,fi,qR,qQ,qP,qO,qN,qM,qL,qK,qI,qH,qE,qz,qv,qp,ql,qk,qj,qi,qh,qg,qd,pV,pU,pT,pS,jo,pR,dh,eT,pE,dm,pD,pA,pu,ps,pr,aq,e,eB,h,eu,pp,ph,pg,jj,jh,jd,Q,dY,ea,jb,pb,by,i$,en,iW,o$,dV,dx,dv,dt,o_,ey,eA,oX,oW,oV,bR,oU,fq,fR,fz,fI,oP,il,oN,fN,eJ,ii,oI,ib,aL,hY,cW,hO,bW,eY,oD,eU,di,ht,hj,ov,ot,os,or,oo,om,ep,og,gJ,ob,oa,nP,nO,fl,nK,nI,gb,nE,cU,nD,f_,U,bi,aF,a,d,ad,nB,nA,nz,ny,nu,nt,nr,ac,no,M,k,cL,q,nn,S,nm,D,nl,g,ae,z,nj,T,ne,nd,m$,mY,mX,mV,mU,el,bU,bS,dH,bG,bq,aY,bQ,mC,mt,aK,c_,cX,bY,hT,hU,mr,w,l,N,cG,K,v,ic,mn,mm,mj,mh,mg,fJ,cQ,cR,is,it,iu,mf,me,md,mb,lI,$,ax,s,I,lH,lG,u,ag,W,H,Z,aW,an,bC,bp,lF,jB,jC,b,fd,ay,lz,cf,ly,jL,jN,fm,jQ,aS,jS,lw,lr,ft,lp,ki,Y,km,bB,lo,ln,lg,lf,lc,bd,kE,lb,kY,kW,fL,kN,kR,kS,iF,kU,le,fD,A,lh,li,lj,lk,ll,lm,ky,ks,kg,lq,ke,ls,lt,lu,jJ,jG,lA,lB,lC,lD,lE,iv,cq,ij,cw,mk,ml,hV,hK,hG,mu,mv,mw,mx,gX,mT,gT,gS,mW,nc,dB,gM,gm,gd,ar,cT,cy,nq,cD,fV,ck,fX,fH,nC,ga,nF,nM,ge,nQ,ci,gG,ds,nV,nY,n_,od,gK,ok,ej,dR,on,d$,d_,hg,hh,bL,br,ou,hi,eg,hl,oy,hm,eq,hw,eE,be,fx,bh,h_,at,ie,oJ,bo,cu,cr,ik,oO,co,ip,iq,aV,iH,iI,iJ,iL,o,sy,aX,p,iQ,pa,bx,pc,dK,pf,dO,dI,pi,pj,pk,pl,pm,jl,es,et,au,jm,dp,pt,eF,sx,af,pz,pC,G,aa,pH,cm,pK,jq,jr,js,jt,pW,pX,pY,pZ,p_,sw,sv,qb,qc,sz,su,qf,ju,jv,jw,db,jA,fa,cZ,qJ,jE,fg,jF,jH,jI,jK,jM,rb,rc,rl,rq,rr,rs,rx,ry,ko,rA,rB,kr,bI,rF,rG,rQ,kv,kw,rW,kA,sa,sb,sc,kC,kD,sf,sg,sh,kF,kI,ba,sl,sm,sn,fG,kJ,sq,cF,rz,cE,cl,aH,nH,bE;function aP(){return typeof navigator!="undefined"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function sk(){return typeof window!="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(aP())}function sj(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(a){return!1}}function si(){const a=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof a=="object"&&a.id!==void 0}function se(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function sd(){return aP().indexOf("Electron/")>=0}function r$(){const a=aP();return a.indexOf("MSIE ")>=0||a.indexOf("Trident/")>=0}function rU(){return aP().indexOf("MSAppHost/")>=0}function rS(){return!sj()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function rR(){return typeof indexedDB=="object"}rO="FirebaseError",fB=class extends Error{constructor(a,b,c){super(b),this.code=a,this.customData=c,this.name=rO,Object.setPrototypeOf(this,fB.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,kt.prototype.create)}},kt=class{constructor(a,b,c){this.service=a,this.serviceName=b,this.errors=c}create(a,...e){const b=e[0]||{},c=`${this.service}/${a}`,d=this.errors[a],f=d?rE(d,b):"Error",g=`${this.serviceName}: ${f} (${c}).`,h=new fB(c,g,b);return h}};function rE(a,b){return a.replace(rC,(d,a)=>{const c=b[a];return c!=null?String(c):`<${a}?>`})}rC=/\{\$([^}]+)}/g;function fy(a,b){if(a===b)return!0;const c=Object.keys(a),d=Object.keys(b);for(const e of c){if(!d.includes(e))return!1;const f=a[e],g=b[e];if(kp(f)&&kp(g)){if(!fy(f,g))return!1}else if(f!==g)return!1}for(const a of d)if(!c.includes(a))return!1;return!0}function kp(a){return a!==null&&typeof a=="object"}sA=4*60*60*1e3;function cM(a){return a&&a._delegate?a._delegate:a}cN=class{constructor(a,b,c){this.name=a,this.instanceFactory=b,this.type=c,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(a){return this.instantiationMode=a,this}setMultipleInstances(a){return this.multipleInstances=a,this}setServiceProps(a){return this.serviceProps=a,this}setInstanceCreatedCallback(a){return this.onInstanceCreated=a,this}},aG="[DEFAULT]",ro=class{constructor(a,b){this.name=a,this.container=b,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(b){const a=this.normalizeInstanceIdentifier(b);if(!this.instancesDeferred.has(a)){const b=new so;if(this.instancesDeferred.set(a,b),this.isInitialized(a)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:a});c&&b.resolve(c)}catch(a){}}return this.instancesDeferred.get(a).promise}getImmediate(a){var b;const c=this.normalizeInstanceIdentifier(a===null||a===void 0?void 0:a.identifier),d=!!((b=a===null||a===void 0?void 0:a.optional)!==null&&b!==void 0)&&b;if(this.isInitialized(c)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:c})}catch(a){if(d)return null;throw a}else{if(d)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(a){if(a.name!==this.name)throw Error(`Mismatching Component ${a.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=a,!this.shouldAutoInitialize())return;if(rj(a))try{this.getOrInitializeService({instanceIdentifier:aG})}catch(a){}for(const[a,b]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(a);try{const a=this.getOrInitializeService({instanceIdentifier:c});b.resolve(a)}catch(a){}}}clearInstance(a=aG){this.instancesDeferred.delete(a),this.instancesOptions.delete(a),this.instances.delete(a)}async delete(){const a=Array.from(this.instances.values());await Promise.all([...a.filter(a=>"INTERNAL"in a).map(a=>a.INTERNAL.delete()),...a.filter(a=>"_delete"in a).map(a=>a._delete())])}isComponentSet(){return this.component!=null}isInitialized(a=aG){return this.instances.has(a)}getOptions(a=aG){return this.instancesOptions.get(a)||{}}initialize(b={}){const{options:d={}}=b,a=this.normalizeInstanceIdentifier(b.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:a,options:d});for(const[b,d]of this.instancesDeferred.entries()){const e=this.normalizeInstanceIdentifier(b);a===e&&d.resolve(c)}return c}onInit(b,f){var c;const a=this.normalizeInstanceIdentifier(f),d=(c=this.onInitCallbacks.get(a))!==null&&c!==void 0?c:new Set;d.add(b),this.onInitCallbacks.set(a,d);const e=this.instances.get(a);return e&&b(e,a),()=>{d.delete(b)}}invokeOnInitCallbacks(c,a){const b=this.onInitCallbacks.get(a);if(!b)return;for(const d of b)try{d(c,a)}catch(a){}}getOrInitializeService({instanceIdentifier:a,options:c={}}){let b=this.instances.get(a);if(!b&&this.component)if(b=this.component.instanceFactory(this.container,{instanceIdentifier:rn(a),options:c}),this.instances.set(a,b),this.instancesOptions.set(a,c),this.invokeOnInitCallbacks(b,a),this.component.onInstanceCreated)try{this.component.onInstanceCreated(this.container,a,b)}catch(a){}return b||null}normalizeInstanceIdentifier(a=aG){return this.component?this.component.multipleInstances?a:aG:a}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function rn(a){return a===aG?void 0:a}function rj(a){return a.instantiationMode==="EAGER"}ri=class{constructor(a){this.name=a,this.providers=new Map}addComponent(a){const b=this.getProvider(a.name);if(b.isComponentSet())throw new Error(`Component ${a.name} has already been registered with ${this.name}`);b.setComponent(a)}addOrOverwriteComponent(a){const b=this.getProvider(a.name);b.isComponentSet()&&this.providers.delete(a.name),this.addComponent(a)}getProvider(a){if(this.providers.has(a))return this.providers.get(a);const b=new ro(a,this);return this.providers.set(a,b),b}getProviders(){return Array.from(this.providers.values())}},rh=[],function(a){a[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT"}(n||(n={})),rg={debug:n.DEBUG,verbose:n.VERBOSE,info:n.INFO,warn:n.WARN,error:n.ERROR,silent:n.SILENT},rf=n.INFO,re={[n.DEBUG]:"log",[n.VERBOSE]:"log",[n.INFO]:"info",[n.WARN]:"warn",[n.ERROR]:"error"},qX=(b,a,...d)=>{if(a<b.logLevel)return;const e=(new Date).toISOString(),c=re[a];if(c)console[c](`[${e}]  ${b.name}:`,...d);else throw new Error(`Attempted to log a message with an invalid logType (value: ${a})`)},jR=class{constructor(a){this.name=a,this._logLevel=rf,this._logHandler=qX,this._userLogHandler=null,rh.push(this)}get logLevel(){return this._logLevel}set logLevel(a){if(!(a in n))throw new TypeError(`Invalid value "${a}" assigned to \`logLevel\``);this._logLevel=a}setLogLevel(a){this._logLevel=typeof a=="string"?rg[a]:a}get logHandler(){return this._logHandler}set logHandler(a){if(typeof a!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=a}get userLogHandler(){return this._userLogHandler}set userLogHandler(a){this._userLogHandler=a}debug(...a){this._userLogHandler&&this._userLogHandler(this,n.DEBUG,...a),this._logHandler(this,n.DEBUG,...a)}log(...a){this._userLogHandler&&this._userLogHandler(this,n.VERBOSE,...a),this._logHandler(this,n.VERBOSE,...a)}info(...a){this._userLogHandler&&this._userLogHandler(this,n.INFO,...a),this._logHandler(this,n.INFO,...a)}warn(...a){this._userLogHandler&&this._userLogHandler(this,n.WARN,...a),this._logHandler(this,n.WARN,...a)}error(...a){this._userLogHandler&&this._userLogHandler(this,n.ERROR,...a),this._logHandler(this,n.ERROR,...a)}},qV=class{constructor(a){this.container=a}getPlatformInfoString(){const a=this.container.getProviders();return a.map(a=>{if(qS(a)){const b=a.getImmediate();return`${b.library}/${b.version}`}return null}).filter(a=>a).join(" ")}};function qS(b){const a=b.getComponent();return(a===null||a===void 0?void 0:a.type)==="VERSION"}fj="@firebase/app",jO="0.7.16",fi=new jR("@firebase/app"),qR="@firebase/app-compat",qQ="@firebase/analytics-compat",qP="@firebase/analytics",qO="@firebase/app-check-compat",qN="@firebase/app-check",qM="@firebase/auth",qL="@firebase/auth-compat",qK="@firebase/database",qI="@firebase/database-compat",qH="@firebase/functions",qE="@firebase/functions-compat",qz="@firebase/installations",qv="@firebase/installations-compat",qp="@firebase/messaging",ql="@firebase/messaging-compat",qk="@firebase/performance",qj="@firebase/performance-compat",qi="@firebase/remote-config",qh="@firebase/remote-config-compat",qg="@firebase/storage",qd="@firebase/storage-compat",pV="@firebase/firestore",pU="@firebase/firestore-compat",pT="firebase",pS="9.6.6",jo="[DEFAULT]",pR={[fj]:"fire-core",[qR]:"fire-core-compat",[qP]:"fire-analytics",[qQ]:"fire-analytics-compat",[qN]:"fire-app-check",[qO]:"fire-app-check-compat",[qM]:"fire-auth",[qL]:"fire-auth-compat",[qK]:"fire-rtdb",[qI]:"fire-rtdb-compat",[qH]:"fire-fn",[qE]:"fire-fn-compat",[qz]:"fire-iid",[qv]:"fire-iid-compat",[qp]:"fire-fcm",[ql]:"fire-fcm-compat",[qk]:"fire-perf",[qj]:"fire-perf-compat",[qi]:"fire-rc",[qh]:"fire-rc-compat",[qg]:"fire-gcs",[qd]:"fire-gcs-compat",[pV]:"fire-fst",[pU]:"fire-fst-compat","fire-js":"fire-js",[pT]:"fire-js-all"},dh=new Map,eT=new Map;function pJ(a,b){try{a.container.addComponent(b)}catch(c){fi.debug(`Component ${b.name} failed to register with FirebaseApp ${a.name}`,c)}}function eS(a){const b=a.name;if(eT.has(b))return fi.debug(`There were multiple attempts to register component ${b}.`),!1;eT.set(b,a);for(const b of dh.values())pJ(b,a);return!0}function pI(a,b){return a.container.getProvider(b)}pE={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function."},dm=new kt("app","Firebase",pE),pD=class{constructor(b,a,c){this._isDeleted=!1,this._options=Object.assign({},b),this._config=Object.assign({},a),this._name=a.name,this._automaticDataCollectionEnabled=a.automaticDataCollectionEnabled,this._container=c,this.container.addComponent(new cN("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(a){this.checkDestroyed(),this._automaticDataCollectionEnabled=a}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(a){this._isDeleted=a}checkDestroyed(){if(this.isDeleted)throw dm.create("app-deleted",{appName:this._name})}},pA=pS;function py(e,b={}){if(typeof b!="object"){const a=b;b={name:a}}const d=Object.assign({name:jo,automaticDataCollectionEnabled:!1},b),a=d.name;if(typeof a!="string"||!a)throw dm.create("bad-app-name",{appName:String(a)});const c=dh.get(a);if(c){if(fy(e,c.options)&&fy(d,c.config))return c;throw dm.create("duplicate-app",{appName:a})}const f=new ri(a);for(const a of eT.values())f.addComponent(a);const g=new pD(e,d,f);return dh.set(a,g),g}function pw(a=jo){const b=dh.get(a);if(!b)throw dm.create("no-app",{appName:a});return b}function bf(g,b,f){var d;let a=(d=pR[g])!==null&&d!==void 0?d:g;f&&(a+=`-${f}`);const e=a.match(/\s|\//),c=b.match(/\s|\//);if(e||c){const d=[`Unable to register library "${a}" with version "${b}":`];e&&d.push(`library name "${a}" contains illegal characters (whitespace or "/")`),e&&c&&d.push("and"),c&&d.push(`version name "${b}" contains illegal characters (whitespace or "/")`),fi.warn(d.join(" "));return}eS(new cN(`${a}-version`,()=>({library:a,version:b}),"VERSION"))}function pv(a){eS(new cN("platform-logger",a=>new qV(a),"PRIVATE")),bf(fj,jO,a),bf(fj,jO,"esm2017"),bf("fire-js","")}pv(""),pu="firebase",ps="9.6.6",bf(pu,ps,"app"),pr=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},aq={},eB=eB||{},h=pr||self;function dq(){}function ez(b){var a=typeof b;return a=a!="object"?a:b?Array.isArray(b)?"array":a:"null",a=="array"||a=="object"&&typeof b.length=="number"}function cb(a){var b=typeof a;return b=="object"&&a!=null||b=="function"}function pq(a){return Object.prototype.hasOwnProperty.call(a,eu)&&a[eu]||(a[eu]=++pp)}eu="closure_uid_"+(1e9*Math.random()>>>0),pp=0;function po(a,b,c){return a.call.apply(a.bind,arguments)}function pn(a,b,d){if(!a)throw Error();if(2<arguments.length){var c=Array.prototype.slice.call(arguments,2);return function(){var d=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(d,c),a.apply(b,d)}}return function(){return a.apply(b,arguments)}}function E(a,b,c){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?E=po:E=pn,E.apply(null,arguments)}function dA(a,c){var b=Array.prototype.slice.call(arguments,1);return function(){var c=b.slice();return c.push.apply(c,arguments),a.apply(this,c)}}function F(a,b){function c(){}c.prototype=b.prototype,a.Z=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.Vb=function(d,e,f){for(var c=Array(arguments.length-2),a=2;a<arguments.length;a++)c[a-2]=arguments[a];return b.prototype[e].apply(d,c)}}function aw(){this.s=this.s,this.o=this.o}ph=0,pg={},aw.prototype.s=!1,aw.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),ph!=0)){var a=pq(this);delete pg[a]}},aw.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()},jj=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if(typeof a=="string")return typeof b!="string"||b.length!=1?-1:a.indexOf(b,0);for(let c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},jh=Array.prototype.forEach?function(a,b,c){Array.prototype.forEach.call(a,b,c)}:function(a,c,d){const e=a.length,b=typeof a=="string"?a.split(""):a;for(let f=0;f<e;f++)f in b&&c.call(d,b[f],f,a)};function pe(a){a:{var b=nT;const d=a.length,c=typeof a=="string"?a.split(""):a;for(let e=0;e<d;e++)if(e in c&&b.call(void 0,c[e],e,a)){b=e;break a}b=-1}return 0>b?null:typeof a=="string"?a.charAt(b):a[b]}function jg(a){return Array.prototype.concat.apply([],arguments)}function dZ(b){const a=b.length;if(0<a){const c=Array(a);for(let d=0;d<a;d++)c[d]=b[d];return c}return[]}function cz(a){return/^[\s\xa0]*$/.test(a)}jd=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};function L(a,b){return a.indexOf(b)!=-1}function dX(a,b){return a<b?-1:a>b?1:0}a:{dY=h.navigator;if(dY){ea=dY.userAgent;if(ea){Q=ea;break a}}Q=""}function eb(a,b,c){for(const d in a)b.call(c,a[d],d,a)}function jc(a){const b={};for(const c in a)b[c]=a[c];return b}jb="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ja(c,d){let a,b;for(let d=1;d<arguments.length;d++){b=arguments[d];for(a in b)c[a]=b[a];for(let d=0;d<jb.length;d++)a=jb[d],Object.prototype.hasOwnProperty.call(b,a)&&(c[a]=b[a])}}function eh(a){return eh[" "](a),a}eh[" "]=dq;function pd(b){var a=o_;return Object.prototype.hasOwnProperty.call(a,9)?a[9]:a[9]=b(9)}pb=L(Q,"Opera"),by=L(Q,"Trident")||L(Q,"MSIE"),i$=L(Q,"Edge"),en=i$||by,iW=L(Q,"Gecko")&&!(L(Q.toLowerCase(),"webkit")&&!L(Q,"Edge"))&&!(L(Q,"Trident")||L(Q,"MSIE"))&&!L(Q,"Edge"),o$=L(Q.toLowerCase(),"webkit")&&!L(Q,"Edge");function iP(){var a=h.document;return a?a.documentMode:void 0}a:{dx="",dv=function(){var a=Q;if(iW)return/rv:([^\);]+)(\)|;)/.exec(a);if(i$)return/Edge\/([\d\.]+)/.exec(a);if(by)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(o$)return/WebKit\/(\S+)/.exec(a);if(pb)return/(?:Version)[ \/]?(\S+)/.exec(a)}();dv&&(dx=dv?dv[1]:"");if(by){dt=iP();if(dt!=null&&dt>parseFloat(dx)){dV=String(dt);break a}}dV=dx}o_={};function oZ(){return pd(function(){let c=0;const d=jd(String(dV)).split("."),e=jd("9").split("."),f=Math.max(d.length,e.length);for(let g=0;c==0&&g<f;g++){var a=d[g]||"",b=e[g]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],b=/(\d*)(\D*)(.*)/.exec(b)||["","","",""],a[0].length==0&&b[0].length==0)break;c=dX(a[1].length==0?0:parseInt(a[1],10),b[1].length==0?0:parseInt(b[1],10))||dX(a[2].length==0,b[2].length==0)||dX(a[2],b[2]),a=a[3],b=b[3]}while(c==0)}return 0<=c})}h.document&&by?(eA=iP(),ey=eA||parseInt(dV,10)||void 0):ey=void 0,oX=ey,oW=function(){if(!h.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{h.addEventListener("test",dq,b),h.removeEventListener("test",dq,b)}catch(a){}return a}();function J(a,b){this.type=a,this.g=this.target=b,this.defaultPrevented=!1}J.prototype.h=function(){this.defaultPrevented=!0};function bP(a,c){var d,b,e;if(J.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){if(d=this.type=a.type,b=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null,this.target=a.target||a.srcElement,this.g=c,c=a.relatedTarget){if(iW){a:{try{eh(c.nodeName),e=!0;break a}catch(a){}e=!1}e||(c=null)}}else d=="mouseover"?c=a.fromElement:d=="mouseout"&&(c=a.toElement);this.relatedTarget=c,b?(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:oV[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&bP.Z.h.call(this)}}F(bP,J),oV={2:"touch",3:"pen",4:"mouse"},bP.prototype.h=function(){bP.Z.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1},bR="closure_listenable_"+(1e6*Math.random()|0),oU=0;function oT(a,b,c,d,e){this.listener=a,this.proxy=null,this.src=b,this.type=c,this.capture=!!d,this.ia=e,this.key=++oU,this.ca=this.fa=!1}function dg(a){a.ca=!0,a.listener=null,a.proxy=null,a.src=null,a.ia=null}function de(a){this.src=a,this.g={},this.h=0}de.prototype.add=function(b,a,d,e,f){var c=b.toString(),g;return b=this.g[c],b||(b=this.g[c]=[],this.h++),g=fp(b,a,e,f),-1<g?(a=b[g],d||(a.fa=!1)):(a=new oT(a,this.src,c,!!e,f),a.fa=d,b.push(a)),a};function fb(a,c){var b=c.type,d,e,f;b in a.g&&(d=a.g[b],e=jj(d,c),(f=0<=e)&&Array.prototype.splice.call(d,e,1),f&&(dg(c),a.g[b].length==0&&(delete a.g[b],a.h--)))}function fp(c,d,e,f){for(var a=0,b;a<c.length;++a)if(b=c[a],!b.ca&&b.listener==d&&b.capture==!!e&&b.ia==f)return a;return-1}fq="closure_lm_"+(1e6*Math.random()|0),fR={};function iE(b,c,d,a,e){if(a&&a.once)return iz(b,c,d,a,e);if(Array.isArray(c)){for(var f=0;f<c.length;f++)iE(b,c[f],d,a,e);return null}return d=fE(d),b&&b[bR]?b.N(c,d,cb(a)?!!a.capture:!!a,e):iB(b,c,d,!1,a,e)}function iB(a,e,c,b,d,h){if(!e)throw Error("Invalid event type");var g=cb(d)?!!d.capture:!!d,f=fv(a);if(f||(a[fq]=f=new de(a)),c=f.add(e,c,b,g,h),c.proxy)return c;if(b=oS(),c.proxy=b,b.src=a,b.listener=c,a.addEventListener)oW||(d=g),d===void 0&&(d=!1),a.addEventListener(e.toString(),b,d);else if(a.attachEvent)a.attachEvent(ir(e.toString()),b);else if(a.addListener&&a.removeListener)a.addListener(b);else throw Error("addEventListener and attachEvent are unavailable.");return c}function oS(){function a(c){return b.call(a.src,a.listener,c)}var b=oR;return a}function iz(a,b,c,d,e){if(Array.isArray(b)){for(var f=0;f<b.length;f++)iz(a,b[f],c,d,e);return null}return c=fE(c),a&&a[bR]?a.O(b,c,cb(d)?!!d.capture:!!d,e):iB(a,b,c,!0,d,e)}function iy(a,b,c,e,f){if(Array.isArray(b))for(var d=0;d<b.length;d++)iy(a,b[d],c,e,f);else e=cb(e)?!!e.capture:!!e,c=fE(c),a&&a[bR]?(a=a.i,b=String(b).toString(),b in a.g&&(d=a.g[b],c=fp(d,c,e,f),-1<c&&(dg(d[c]),Array.prototype.splice.call(d,c,1),d.length==0&&(delete a.g[b],a.h--)))):a&&(a=fv(a))&&(b=a.g[b.toString()],a=-1,b&&(a=fp(b,c,e,f)),(c=-1<a?b[a]:null)&&fs(c))}function fs(b){var a,c,d;typeof b!="number"&&b&&!b.ca&&(a=b.src,a&&a[bR]?fb(a.i,b):(c=b.type,d=b.proxy,a.removeEventListener?a.removeEventListener(c,d,b.capture):a.detachEvent?a.detachEvent(ir(c),d):a.addListener&&a.removeListener&&a.removeListener(d),(c=fv(a))?(fb(c,b),c.h==0&&(c.src=null,a[fq]=null)):dg(b)))}function ir(a){return a in fR?fR[a]:fR[a]="on"+a}function oR(a,b){if(a.ca)a=!0;else{b=new bP(b,this);var c=a.listener,d=a.ia||a.src;a.fa&&fs(a),a=c.call(d,b)}return a}function fv(a){return a=a[fq],a instanceof de?a:null}fz="__closure_events_fn_"+(1e9*Math.random()>>>0);function fE(a){return typeof a=="function"?a:(a[fz]||(a[fz]=function(b){return a.handleEvent(b)}),a[fz])}function B(){aw.call(this),this.i=new de(this),this.P=this,this.I=null}F(B,aw),B.prototype[bR]=!0,B.prototype.removeEventListener=function(a,b,c,d){iy(this,a,b,c,d)};function C(e,a){var d,b=e.I,c,f,g;if(b)for(d=[];b;b=b.I)d.push(b);if(e=e.P,b=a.type||a,typeof a=="string"?a=new J(a,e):a instanceof J?a.target=a.target||e:(c=a,a=new J(b,e),ja(a,c)),c=!0,d)for(f=d.length-1;0<=f;f--)g=a.g=d[f],c=cJ(g,b,!0,a)&&c;if(g=a.g=e,c=cJ(g,b,!0,a)&&c,c=cJ(g,b,!1,a)&&c,d)for(f=0;f<d.length;f++)g=a.g=d[f],c=cJ(g,b,!1,a)&&c}B.prototype.M=function(){var a,b,d,c;if(B.Z.M.call(this),this.i){a=this.i;for(b in a.g){for(d=a.g[b],c=0;c<d.length;c++)dg(d[c]);delete a.g[b],a.h--}}this.I=null},B.prototype.N=function(a,b,c,d){return this.i.add(String(a),b,!1,c,d)},B.prototype.O=function(a,b,c,d){return this.i.add(String(a),b,!0,c,d)};function cJ(g,b,i,f){var c,d,a,h,e;if(b=g.i.g[String(b)],!b)return!0;b=b.concat();for(c=!0,d=0;d<b.length;++d)a=b[d],a&&!a.ca&&a.capture==i&&(h=a.listener,e=a.ia||a.src,a.fa&&fb(g.i,a),c=h.call(e,f)!==!1&&c);return c&&!f.defaultPrevented}fI=h.JSON.stringify;function oQ(){var a=ii;let b=null;return a.g&&(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null),b}oP=class{constructor(){this.h=this.g=null}add(b,c){const a=il.get();a.set(b,c),this.h?this.h.next=a:this.g=a,this.h=a}},il=new class{constructor(a,b){this.i=a,this.j=b,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}(()=>new oN,a=>a.reset()),oN=class{constructor(){this.next=this.g=this.h=null}set(a,b){this.h=a,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}};function oM(a){h.setTimeout(()=>{throw a},0)}function fK(a,b){fN||sr(),eJ||(fN(),eJ=!0),ii.add(a,b)}function sr(){var a=h.Promise.resolve(void 0);fN=function(){a.then(oK)}}eJ=!1,ii=new oP;function oK(){for(var a,b;a=oQ();){try{a.h.call(a.g)}catch(a){oM(a)}b=il,b.j(a),100>b.h&&(b.h++,a.next=b.g,b.g=a)}eJ=!1}function cC(a,b){B.call(this),this.h=a||1,this.g=b||h,this.j=E(this.kb,this),this.l=Date.now()}F(cC,B),e=cC.prototype,e.da=!1,e.S=null,e.kb=function(){if(this.da){var a=Date.now()-this.l;0<a&&a<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-a):(this.S&&(this.g.clearTimeout(this.S),this.S=null),C(this,"tick"),this.da&&(fQ(this),this.start()))}},e.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function fQ(a){a.da=!1,a.S&&(a.g.clearTimeout(a.S),a.S=null)}e.M=function(){cC.Z.M.call(this),fQ(this),delete this.g};function fP(a,b,c){if(typeof a=="function")c&&(a=E(a,c));else if(a&&typeof a.handleEvent=="function")a=E(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(b)?-1:h.setTimeout(a,b||0)}function ih(a){a.g=fP(()=>{a.g=null,a.i&&(a.i=!1,ih(a))},a.j);const b=a.h;a.h=null,a.m.apply(null,b)}oI=class extends aw{constructor(a,b){super(),this.m=a,this.j=b,this.h=null,this.i=!1,this.g=null}l(a){this.h=arguments,this.g?this.i=!0:ih(this)}M(){super.M(),this.g&&(h.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function ct(a){aw.call(this),this.h=a,this.g={}}F(ct,aw),ib=[];function ia(b,e,a,f){var c,d;Array.isArray(a)||(a&&(ib[0]=a.toString()),a=ib);for(c=0;c<a.length;c++){if(d=iE(e,a[c],f||b.handleEvent,!1,b.h||b),!d)break;b.g[d.key]=d}}function h$(a){eb(a.g,function(a,b){this.g.hasOwnProperty(b)&&fs(a)},a),a.g={}}ct.prototype.M=function(){ct.Z.M.call(this),h$(this)},ct.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function cH(){this.g=!0}cH.prototype.Aa=function(){this.g=!1};function oH(b,c,d,e,f,a){b.info(function(){var g,k,i,h,j,l;if(b.g)if(a){{g="";for(k=a.split("&"),i=0;i<k.length;i++)h=k[i].split("="),1<h.length&&(j=h[0],h=h[1],l=j.split("_"),g=2<=l.length&&l[1]=="type"?g+(j+"="+h+"&"):g+(j+"=redacted&"))}}else g=null;else g=a;return"XMLHTTP REQ ("+e+") [attempt "+f+"]: "+c+"\n"+d+"\n"+g})}function oG(a,b,c,d,e,f,g){a.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+e+"]: "+b+"\n"+c+"\n"+f+" "+g})}function bl(a,c,d,b){a.info(function(){return"XMLHTTP TEXT ("+c+"): "+oE(a,d)+(b?" "+b:"")})}function oF(a,b){a.info(function(){return"TIMEOUT: "+b})}cH.prototype.info=function(){};function oE(a,d){var b,g,c,e,f;if(!a.g)return d;if(!d)return null;try{if(b=JSON.parse(d),b)for(a=0;a<b.length;a++)if(Array.isArray(b[a]))if(g=b[a],!(2>g.length))if(c=g[1],Array.isArray(c)&&!(1>c.length))if(e=c[0],e!="noop"&&e!="stop"&&e!="close")for(f=1;f<c.length;f++)c[f]="";return fI(b)}catch(a){return d}}aL={},hY=null;function cP(){return hY=hY||new B}aL.Ma="serverreachability";function hX(a){J.call(this,aL.Ma,a)}F(hX,J);function ce(b){const a=cP();C(a,new hX(a,b))}aL.STAT_EVENT="statevent";function hW(a,b){J.call(this,aL.STAT_EVENT,a),this.stat=b}F(hW,J);function P(b){const a=cP();C(a,new hW(a,b))}aL.Na="timingevent";function hP(a,b){J.call(this,aL.Na,a),this.size=b}F(hP,J);function bX(a,b){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return h.setTimeout(function(){a()},b)}cW={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},hO={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function fe(){}fe.prototype.h=null;function hL(a){return a.h||(a.h=a.i())}function hJ(){}bW={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function e$(){J.call(this,"d")}F(e$,J);function eZ(){J.call(this,"c")}F(eZ,J);function dd(){}F(dd,fe),dd.prototype.g=function(){return new XMLHttpRequest},dd.prototype.i=function(){return{}},eY=new dd;function bV(a,b,c,d){this.l=a,this.j=b,this.m=c,this.X=d||1,this.V=new ct(this),this.P=oD,a=en?125:void 0,this.W=new cC(a),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new hI}function hI(){this.i=null,this.g="",this.h=!1}oD=45e3,eU={},di={},e=bV.prototype,e.setTimeout=function(a){this.P=a};function eP(a,b,c){a.K=1,a.v=dJ(al(b)),a.s=c,a.U=!0,hH(a,null)}function hH(a,b){a.F=Date.now(),bN(a),a.A=al(a.v);var d=a.A,c=a.X;Array.isArray(c)||(c=[String(c)]),hb(d.h,"t",c),a.C=0,d=a.l.H,a.h=new hI,a.g=gk(a.l,d?b:null,!a.s),0<a.O&&(a.L=new oI(E(a.Ia,a,a.g),a.O)),ia(a.V,a.g,"readystatechange",a.gb),b=a.H?jc(a.H):{},a.s?(a.u||(a.u="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.s,b)):(a.u="GET",a.g.ea(a.A,a.u,null,b)),ce(1),oH(a.j,a.u,a.A,a.m,a.X,a.s)}e.gb=function(a){a=a.target;const b=this.L;b&&ap(a)==3?b.l():this.Ia(a)},e.Ia=function(f){var a,b,d,e,k,c,g,i,j;try{if(f==this.g)a:{const l=ap(this.g);a=this.g.Da();const m=this.g.ba();if(!(3>l)&&(l!=3||en||this.g&&(this.h.h||this.g.ga()||gA(this.g)))){this.I||l!=4||a==7||(a==8||0>=m?ce(3):ce(2));dr(this);b=this.g.ba();this.N=b;b:if(hB(this)){d=gA(this.g);f="";e=d.length,k=ap(this.g)==4;if(!this.h.i){if(typeof TextDecoder=="undefined"){aI(this);bK(this);c="";break b}this.h.i=new h.TextDecoder}for(a=0;a<e;a++)this.h.h=!0,f+=this.h.i.decode(d[a],{stream:k&&a==e-1});d.splice(0,e);this.h.g+=f;this.C=0;c=this.h.g}else c=this.g.ga();this.i=b==200;oG(this.j,this.u,this.A,this.m,this.X,l,b);if(this.i){if(this.$&&!this.J){b:{if(this.g){g,i=this.g;if((g=i.g?i.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!cz(g)){j=g;break b}}j=null}if(b=j)bl(this.j,this.m,b,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,ex(this,b);else{this.i=!1;this.o=3;P(12);aI(this);bK(this);break a}}this.U?(hz(this,l,c),en&&this.i&&l==3&&(ia(this.V,this.W,"tick",this.fb),this.W.start())):(bl(this.j,this.m,c,null),ex(this,c));l==4&&aI(this);this.i&&!this.I&&(l==4?gp(this.l,this):(this.i=!1,bN(this)))}else b==400&&0<c.indexOf("Unknown SID")?(this.o=3,P(12)):(this.o=0,P(13)),aI(this),bK(this)}}}catch(a){}finally{}};function hB(a){return!!a.g&&a.u=="GET"&&a.K!=2&&a.l.Ba}function hz(a,b,c){let e=!0,d;for(;!a.I&&a.C<c.length;){if(d=oC(a,c),d==di){b==4&&(a.o=4,P(14),e=!1),bl(a.j,a.m,null,"[Incomplete Response]");break}if(d==eU){a.o=4,P(15),bl(a.j,a.m,c,"[Invalid Chunk]"),e=!1;break}bl(a.j,a.m,d,null),ex(a,d)}hB(a)&&d!=di&&d!=eU&&(a.h.g="",a.C=0),b!=4||c.length!=0||a.h.h||(a.o=1,P(16),e=!1),a.i=a.i&&e,e?0<c.length&&!a.aa&&(a.aa=!0,b=a.l,b.g==a&&b.$&&!b.L&&(b.h.info("Great, no buffering proxy detected. Bytes received: "+c.length),eW(b),b.L=!0,P(11))):(bl(a.j,a.m,c,"[Invalid Chunked Response]"),aI(a),bK(a))}e.fb=function(){if(this.g){var a=ap(this.g),b=this.g.ga();this.C<b.length&&(dr(this),hz(this,a,b),this.i&&a!=4&&bN(this))}};function oC(d,b){var a=d.C,c=b.indexOf("\n",a);return c==-1?di:(a=Number(b.substring(a,c)),isNaN(a))?eU:(c+=1,c+a>b.length)?di:(b=b.substr(c,a),d.C=c+a,b)}e.cancel=function(){this.I=!0,aI(this)};function bN(a){a.Y=Date.now()+a.P,hx(a,a.P)}function hx(a,b){if(a.B!=null)throw Error("WatchDog timer not null");a.B=bX(E(a.eb,a),b)}function dr(a){a.B&&(h.clearTimeout(a.B),a.B=null)}e.eb=function(){this.B=null;const a=Date.now();0<=a-this.Y?(oF(this.j,this.A),this.K!=2&&(ce(3),P(17)),aI(this),this.o=2,bK(this)):hx(this,this.Y-a)};function bK(a){a.l.G==0||a.I||gp(a.l,a)}function aI(a){dr(a);var b=a.L;b&&typeof b.na=="function"&&b.na(),a.L=null,fQ(a.W),h$(a.V),a.g&&(b=a.g,a.g=null,b.abort(),b.na())}function ex(c,e){var a,b,f,d,g,h,i;try{if(a=c.l,a.G!=0&&(a.g==c||ee(a.i,c)))if(a.I=c.N,!c.J&&ee(a.i,c)&&a.G==3){try{b=a.Ca.g.parse(e)}catch(a){b=null}if(Array.isArray(b)&&b.length==3){{if(f=b,f[0]==0){a:{if(!a.u){if(a.g)if(a.g.F+3e3<c.F)dc(a),dl(a);else break a;eV(a);P(18)}}}else a.ta=f[1],0<a.ta-a.U&&37500>f[2]&&a.N&&a.A==0&&!a.v&&(a.v=bX(E(a.ab,a),6e3));if(1>=g_(a.i)&&a.ka){try{a.ka()}catch(a){}a.ka=void 0}}}else aE(a,11)}else if((c.J||a.g==c)&&dc(a),!cz(e))for(f=a.Ca.g.parse(e),e=0;e<f.length;e++){let j=f[e];if(a.U=j[0],j=j[1],a.G==2)if(j[0]=="c"){a.J=j[1],a.la=j[2];const k=j[3];k!=null&&(a.ma=k,a.h.info("VER="+a.ma));const l=j[4];l!=null&&(a.za=l,a.h.info("SVER="+a.za));const f=j[5];f!=null&&typeof f=="number"&&0<f&&(b=1.5*f,a.K=b,a.h.info("backChannelRequestTimeoutMs_="+b)),b=a;const e=c.g;if(e){const a=e.g?e.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(a&&(d=b.i,!d.g&&(L(a,"spdy")||L(a,"quic")||L(a,"h2"))&&(d.j=d.l,d.g=new Set,d.h&&(ef(d,d.h),d.h=null))),b.D){const a=e.g?e.g.getResponseHeader("X-HTTP-Session-Id"):null;a&&(b.sa=a,t(b.F,b.D,a))}}a.G=3,a.j&&a.j.xa(),a.$&&(a.O=Date.now()-c.F,a.h.info("Handshake RTT: "+a.O+"ms")),b=a,g=c,b.oa=gl(b,b.H?b.la:null,b.W),g.J?(gW(b.i,g),h=g,i=b.K,i&&h.setTimeout(i),h.B&&(dr(h),bN(h)),b.g=g):gq(b),0<a.l.length&&dj(a)}else j[0]!="stop"&&j[0]!="close"||aE(a,7);else a.G==3&&(j[0]=="stop"||j[0]=="close"?j[0]=="stop"?aE(a,7):eL(a):j[0]!="noop"&&a.j&&a.j.wa(j),a.A=0)}ce(4)}catch(a){}}function oB(a){if(a.R&&typeof a.R=="function")return a.R();if(typeof a=="string")return a.split("");if(ez(a)){for(var b=[],d=a.length,c=0;c<d;c++)b.push(a[c]);return b}b=[],d=0;for(c in a)b[d++]=a[c];return b}function ew(a,f){var b,d,c,e;if(a.forEach&&typeof a.forEach=="function")a.forEach(f,void 0);else if(ez(a)||typeof a=="string")jh(a,f,void 0);else{if(a.T&&typeof a.T=="function")b=a.T();else if(a.R&&typeof a.R=="function")b=void 0;else if(ez(a)||typeof a=="string"){b=[];for(d=a.length,c=0;c<d;c++)b.push(c)}else for(c in b=[],d=0,a)b[d++]=c;d=oB(a),c=d.length;for(e=0;e<c;e++)f.call(void 0,d[e],b&&b[e],a)}}function bw(c,d){var b,a;if(this.h={},this.g=[],this.i=0,b=arguments.length,1<b){if(b%2)throw Error("Uneven number of arguments");for(a=0;a<b;a+=2)this.set(arguments[a],arguments[a+1])}else if(c)if(c instanceof bw)for(b=c.T(),a=0;a<b.length;a++)this.set(b[a],c.get(b[a]));else for(a in c)this.set(a,c[a])}e=bw.prototype,e.R=function(){ev(this);for(var b=[],a=0;a<this.g.length;a++)b.push(this.h[this.g[a]]);return b},e.T=function(){return ev(this),this.g.concat()};function ev(a){var b,d,c,e;if(a.i!=a.g.length){for(b=0,d=0;b<a.g.length;)c=a.g[b],aM(a.h,c)&&(a.g[d++]=c),b++;a.g.length=d}if(a.i!=a.g.length){e={};for(d=b=0;b<a.g.length;)c=a.g[b],aM(e,c)||(a.g[d++]=c,e[c]=1),b++;a.g.length=d}}e.get=function(a,b){return aM(this.h,a)?this.h[a]:b},e.set=function(a,b){aM(this.h,a)||(this.i++,this.g.push(a)),this.h[a]=b},e.forEach=function(d,e){for(var b=this.T(),a=0,c,f;a<b.length;a++)c=b[a],f=this.get(c),d.call(e,f,c,this)};function aM(a,b){return Object.prototype.hasOwnProperty.call(a,b)}ht=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function oA(a,f){var b,c,d,e;if(a){a=a.split("&");for(b=0;b<a.length;b++)c=a[b].indexOf("="),d=null,0<=c?(e=a[b].substring(0,c),d=a[b].substring(c+1)):e=a[b],f(e,d?decodeURIComponent(d.replace(/\+/g," ")):"")}}function aU(b,c){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,b instanceof aU){this.g=c!==void 0?c:b.g,dE(this,b.j),this.s=b.s,dF(this,b.i),dG(this,b.m),this.l=b.l,c=b.h;var a=new bM;a.i=c.i,c.g&&(a.g=new bw(c.g),a.h=c.h),hs(this,a),this.o=b.o}else b&&(a=String(b).match(ht))?(this.g=!!c,dE(this,a[1]||"",!0),this.s=bJ(a[2]||""),dF(this,a[3]||"",!0),dG(this,a[4]),this.l=bJ(a[5]||"",!0),hs(this,a[6]||"",!0),this.o=bJ(a[7]||"")):(this.g=!!c,this.h=new bM(null,this.g))}aU.prototype.toString=function(){var b=[],c=this.j,a;return c&&b.push(bH(c,hj,!0),":"),a=this.i,(a||c=="file")&&(b.push("//"),(c=this.s)&&b.push(bH(c,hj,!0),"@"),b.push(encodeURIComponent(String(a)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a=this.m,a!=null&&b.push(":",String(a))),(a=this.l)&&(this.i&&a.charAt(0)!="/"&&b.push("/"),b.push(bH(a,a.charAt(0)=="/"?ot:ov,!0))),(a=this.h.toString())&&b.push("?",a),(a=this.o)&&b.push("#",bH(a,or)),b.join("")};function al(a){return new aU(a)}function dE(a,b,c){a.j=c?bJ(b,!0):b,a.j&&(a.j=a.j.replace(/:$/,""))}function dF(b,a,c){b.i=c?bJ(a,!0):a}function dG(b,a){if(a){if(a=Number(a),isNaN(a)||0>a)throw Error("Bad port number "+a);b.m=a}else b.m=null}function hs(a,b,c){b instanceof bM?(a.h=b,op(a.h,a.g)):(c||(b=bH(b,os)),a.h=new bM(b,a.g))}function t(a,b,c){a.h.set(b,c)}function dJ(a){return t(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function oz(a){return a instanceof aU?al(a):new aU(a,void 0)}function ox(b,c,d,e){var a=new aU(null,void 0);return b&&dE(a,b),c&&dF(a,c),d&&dG(a,d),e&&(a.l=e),a}function bJ(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function bH(a,b,c){return typeof a=="string"?(a=encodeURI(a).replace(b,ow),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function ow(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}hj=/[#\/\?@]/g,ov=/[#\?:]/g,ot=/[#\?]/g,os=/[#\?@]/g,or=/#/g;function bM(a,b){this.h=this.g=null,this.i=a||null,this.j=!!b}function aC(a){a.g||(a.g=new bw,a.h=0,a.i&&oA(a.i,function(b,c){a.add(decodeURIComponent(b.replace(/\+/g," ")),c)}))}e=bM.prototype,e.add=function(a,c){aC(this),this.i=null,a=bj(this,a);var b=this.g.get(a);return b||this.g.set(a,b=[]),b.push(c),this.h+=1,this};function kT(a,b){aC(a),b=bj(a,b),aM(a.g.h,b)&&(a.i=null,a.h-=a.g.get(b).length,a=a.g,aM(a.h,b)&&(delete a.h[b],a.i--,a.g.length>2*a.i&&ev(a)))}function hc(a,b){return aC(a),b=bj(a,b),aM(a.g.h,b)}e.forEach=function(a,b){aC(this),this.g.forEach(function(c,d){jh(c,function(c){a.call(b,c,d,this)},this)},this)},e.T=function(){var e,b,c,a,f,d;aC(this);for(e=this.g.R(),b=this.g.T(),c=[],a=0;a<b.length;a++)for(f=e[a],d=0;d<f.length;d++)c.push(b[a]);return c},e.R=function(a){var b,c;if(aC(this),b=[],typeof a=="string")hc(this,a)&&(b=jg(b,this.g.get(bj(this,a))));else{a=this.g.R();for(c=0;c<a.length;c++)b=jg(b,a[c])}return b},e.set=function(a,b){return aC(this),this.i=null,a=bj(this,a),hc(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[b]),this.h+=1,this},e.get=function(a,b){return a?(a=this.R(a),0<a.length?String(a[0]):b):b};function hb(a,c,b){kT(a,c),0<b.length&&(a.i=null,a.g.set(bj(a,c),dZ(b)),a.h+=b.length)}e.toString=function(){var d,e,c,a,g,b,f;if(this.i)return this.i;if(!this.g)return"";for(d=[],e=this.g.T(),c=0;c<e.length;c++){a=e[c],g=encodeURIComponent(String(a)),a=this.R(a);for(b=0;b<a.length;b++)f=g,a[b]!==""&&(f+="="+encodeURIComponent(String(a[b]))),d.push(f)}return this.i=d.join("&")};function bj(b,a){return a=String(a),b.j&&(a=a.toLowerCase()),a}function op(a,b){b&&!a.j&&(aC(a),a.i=null,a.g.forEach(function(c,a){var b=a.toLowerCase();a!=b&&(kT(this,a),hb(this,b,c))},a)),a.j=b}oo=class{constructor(a,b){this.h=a,this.g=b}};function ha(a){this.l=a||om,h.PerformanceNavigationTiming?(a=h.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(h.g&&h.g.Ea&&h.g.Ea()&&h.g.Ea().Zb),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}om=10;function g$(a){return!!a.h||(!!a.g&&a.g.size>=a.j)}function g_(a){return a.h?1:a.g?a.g.size:0}function ee(a,b){return a.h?a.h==b:!!a.g&&a.g.has(b)}function ef(a,b){a.g?a.g.add(b):a.h=b}function gW(a,b){a.h&&a.h==b?a.h=null:a.g&&a.g.has(b)&&a.g.delete(b)}ha.prototype.cancel=function(){if(this.i=gV(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const a of this.g.values())a.cancel();this.g.clear()}};function gV(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let b=a.i;for(const c of a.g.values())b=b.concat(c.D);return b}return dZ(a.i)}function ei(){}ei.prototype.stringify=function(a){return h.JSON.stringify(a,void 0)},ei.prototype.parse=function(a){return h.JSON.parse(a,void 0)};function ol(){this.g=new ei}function oj(c,a,d){const b=d||"";try{ew(c,function(c,e){let d=c;cb(c)&&(d=fI(c)),a.push(b+e+"="+encodeURIComponent(d))})}catch(c){throw a.push(b+"type="+encodeURIComponent("_badmap")),c}}function oh(c,a){const b=new cH;if(h.Image){const d=new Image;d.onload=dA(dL,b,d,"TestLoadImage: loaded",!0,a),d.onerror=dA(dL,b,d,"TestLoadImage: error",!1,a),d.onabort=dA(dL,b,d,"TestLoadImage: abort",!1,a),d.ontimeout=dA(dL,b,d,"TestLoadImage: timeout",!1,a),h.setTimeout(function(){d.ontimeout&&d.ontimeout()},1e4),d.src=c}else a(!1)}function dL(d,a,e,b,c){try{a.onload=null,a.onerror=null,a.onabort=null,a.ontimeout=null,c(b)}catch(a){}}function bZ(a){this.l=a.$b||null,this.j=a.ib||!1}F(bZ,fe),bZ.prototype.g=function(){return new dC(this.l,this.j)},bZ.prototype.i=function(a){return function(){return a}}({});function dC(a,b){B.call(this),this.D=a,this.u=b,this.m=void 0,this.readyState=ep,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}F(dC,B),ep=0,e=dC.prototype,e.open=function(a,b){if(this.readyState!=ep)throw this.abort(),Error("Error reopening a connection");this.C=a,this.B=b,this.readyState=1,ca(this)},e.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const b={headers:this.v,method:this.C,credentials:this.m,cache:void 0};a&&(b.body=a),(this.D||h).fetch(new Request(this.B,b)).then(this.Va.bind(this),this.ha.bind(this))},e.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,b_(this)),this.readyState=ep},e.Va=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,ca(this)),this.g&&(this.readyState=3,ca(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(typeof h.ReadableStream!="undefined"&&"body"in a){if(this.j=a.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;gN(this)}else a.text().then(this.Ua.bind(this),this.ha.bind(this))};function gN(a){a.j.read().then(a.Sa.bind(a)).catch(a.ha.bind(a))}e.Sa=function(a){if(this.g){if(this.u&&a.value)this.response.push(a.value);else if(!this.u){var b=a.value?a.value:new Uint8Array(0);(b=this.A.decode(b,{stream:!a.done}))&&(this.response=this.responseText+=b)}a.done?b_(this):ca(this),this.readyState==3&&gN(this)}},e.Ua=function(a){this.g&&(this.response=this.responseText=a,b_(this))},e.Ta=function(a){this.g&&(this.response=a,b_(this))},e.ha=function(){this.g&&b_(this)};function b_(a){a.readyState=4,a.l=null,a.j=null,a.A=null,ca(a)}e.setRequestHeader=function(a,b){this.v.append(a,b)},e.getResponseHeader=function(a){return this.h?this.h.get(a.toLowerCase())||"":""},e.getAllResponseHeaders=function(){if(!this.h)return"";const b=[],c=this.h.entries();for(var a=c.next();!a.done;)a=a.value,b.push(a[0]+": "+a[1]),a=c.next();return b.join("\r\n")};function ca(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(dC.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}}),og=h.JSON.parse;function y(a){B.call(this),this.headers=new bw,this.u=a||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=gJ,this.K=this.L=!1}F(y,B),gJ="",ob=/^https?$/i,oa=["POST","PUT"],e=y.prototype,e.ea=function(a,b,e,c){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+a);b=b?b.toUpperCase():"GET",this.H=a,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():eY.g(),this.C=this.u?hL(this.u):hL(eY),this.g.onreadystatechange=E(this.Fa,this);try{this.F=!0,this.g.open(b,String(a),!0),this.F=!1}catch(a){gE(this,a);return}a=e||"";const d=new bw(this.headers);c&&ew(c,function(a,b){d.set(b,a)}),c=pe(d.T()),e=h.FormData&&a instanceof h.FormData,!(0<=jj(oa,b))||c||e||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),d.forEach(function(a,b){this.g.setRequestHeader(b,a)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{gB(this),0<this.B&&((this.K=nU(this.g))?(this.g.timeout=this.B,this.g.ontimeout=E(this.pa,this)):this.A=fP(this.pa,this.B,this)),this.v=!0,this.g.send(a),this.v=!1}catch(a){gE(this,a)}};function nU(a){return by&&oZ()&&typeof a.timeout=="number"&&a.ontimeout!==void 0}function nT(a){return a.toLowerCase()=="content-type"}e.pa=function(){typeof eB!="undefined"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,C(this,"timeout"),this.abort(8))};function gE(a,b){a.h=!1,a.g&&(a.l=!0,a.g.abort(),a.l=!1),a.j=b,a.m=5,gD(a),dM(a)}function gD(a){a.D||(a.D=!0,C(a,"complete"),C(a,"error"))}e.abort=function(a){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=a||7,C(this,"complete"),C(this,"abort"),dM(this))},e.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),dM(this,!0)),y.Z.M.call(this)},e.Fa=function(){this.s||(this.F||this.v||this.l?gC(this):this.cb())},e.cb=function(){gC(this)};function gC(a){var e,c,d,b,f,g;if(a.h&&typeof eB!="undefined"&&(!a.C[1]||ap(a)!=4||a.ba()!=2))if(a.v&&ap(a)==4)fP(a.Fa,0,a);else if(C(a,"readystatechange"),ap(a)==4){a.h=!1;try{const i=a.ba();a:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:e=!0;break a;default:e=!1}if((c=e)||((d=i===0)&&(b=String(a.H).match(ht)[1]||null,!b&&h.self&&h.self.location&&(f=h.self.location.protocol,b=f.substr(0,f.length-1)),d=!ob.test(b?b.toLowerCase():"")),c=d),c)C(a,"complete"),C(a,"success");else{a.m=6;try{g=2<ap(a)?a.g.statusText:""}catch(a){g=""}a.j=g+" ["+a.ba()+"]",gD(a)}}finally{dM(a)}}}function dM(a,b){if(a.g){gB(a);const c=a.g,d=a.C[0]?dq:null;a.g=null,a.C=null,b||C(a,"ready");try{c.onreadystatechange=d}catch(a){}}}function gB(a){a.g&&a.K&&(a.g.ontimeout=null),a.A&&(h.clearTimeout(a.A),a.A=null)}function ap(a){return a.g?a.g.readyState:0}e.ba=function(){try{return 2<ap(this)?this.g.status:-1}catch(a){return-1}},e.ga=function(){try{return this.g?this.g.responseText:""}catch(a){return""}},e.Qa=function(b){if(this.g){var a=this.g.responseText;return b&&a.indexOf(b)==0&&(a=a.substring(b.length)),og(a)}};function gA(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.J){case gJ:case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(a){return null}}e.Da=function(){return this.m},e.La=function(){return typeof this.j=="string"?this.j:String(this.j)};function nS(b){let a="";return eb(b,function(b,c){a+=c,a+=":",a+=b,a+="\r\n"}),a}function eI(c,d,a){a:{for(b in a){var b=!1;break a}b=!0}b||(a=nS(a),typeof c=="string"?a!=null&&encodeURIComponent(String(a)):t(c,d,a))}function cj(c,b,a){return a&&a.internalChannelParams?a.internalChannelParams[c]||b:b}function gx(a){this.za=0,this.l=[],this.h=new cH,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=cj("failFast",!1,a),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=cj("baseRetryDelayMs",5e3,a),this.$a=cj("retryDelaySeedMs",1e4,a),this.Ya=cj("forwardChannelMaxRetries",2,a),this.ra=cj("forwardChannelRequestTimeoutMs",2e4,a),this.qa=a&&a.xmlHttpFactory||void 0,this.Ba=a&&a.Yb||!1,this.K=void 0,this.H=a&&a.supportsCrossDomainXhr||!1,this.J="",this.i=new ha(a&&a.concurrentRequestLimit),this.Ca=new ol,this.ja=a&&a.fastHandshake||!1,this.Ra=a&&a.Wb||!1,a&&a.Aa&&this.h.Aa(),a&&a.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&a&&a.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!a||a.Xb!==!1}e=gx.prototype,e.ma=8,e.G=1;function eL(c){if(gw(c),c.G==3){var a=c.V++,b=al(c.F);t(b,"SID",c.J),t(b,"RID",a),t(b,"TYPE","terminate"),cn(c,b),a=new bV(c,c.h,a,void 0),a.K=2,a.v=dJ(al(b)),b=!1,h.navigator&&h.navigator.sendBeacon&&(b=h.navigator.sendBeacon(a.v.toString(),"")),!b&&h.Image&&((new Image).src=a.v,b=!0),b||(a.g=gk(a.l,null),a.g.ea(a.v)),a.F=Date.now(),bN(a)}gn(c)}e.hb=function(a){try{this.h.info("Origin Trials invoked: "+a)}catch(a){}};function dl(a){a.g&&(eW(a),a.g.cancel(),a.g=null)}function gw(a){dl(a),a.u&&(h.clearTimeout(a.u),a.u=null),dc(a),a.i.cancel(),a.m&&(typeof a.m=="number"&&h.clearTimeout(a.m),a.m=null)}function eO(a,b){a.l.push(new oo(a.Za++,b)),a.G==3&&dj(a)}function dj(a){g$(a.i)||a.m||(a.m=!0,fK(a.Ha,a),a.C=0)}function nR(a,b){return!(g_(a.i)>=a.i.j-(a.m?1:0))&&(a.m?(a.l=b.D.concat(a.l),!0):!(a.G==1||a.G==2||a.C>=(a.Xa?0:a.Ya))&&(a.m=bX(E(a.Ha,a,b),go(a,a.C)),a.C++,!0))}e.Ha=function(d){var b,a,c;if(this.m)if(this.m=null,this.G==1){if(!d){this.V=Math.floor(1e5*Math.random()),d=this.V++;const f=new bV(this,this.h,d,void 0);let e=this.s;if(this.P&&(e?(e=jc(e),ja(e,this.P)):e=this.P),this.o===null&&(f.H=e),this.ja)a:{b=0;for(a=0;a<this.l.length;a++){b:{c=this.l[a];if("__data__"in c.g&&(c=c.g.__data__,typeof c=="string")){c=c.length;break b}c=void 0}if(c===void 0)break;if(b+=c,4096<b){b=a;break a}if(b===4096||a===this.l.length-1){b=a+1;break a}}b=1e3}else b=1e3;b=gr(this,f,b),a=al(this.F),t(a,"RID",d),t(a,"CVER",22),this.D&&t(a,"X-HTTP-Session-Id",this.D),cn(this,a),this.o&&e&&eI(a,this.o,e),ef(this.i,f),this.Ra&&t(a,"TYPE","init"),this.ja?(t(a,"$req",b),t(a,"SID","null"),f.$=!0,eP(f,a,null)):eP(f,a,b),this.G=2}}else this.G==3&&(d?gt(this,d):this.l.length==0||g$(this.i)||gt(this))};function gt(a,c){var b;c?b=c.m:b=a.V++;const d=al(a.F);t(d,"SID",a.J),t(d,"RID",b),t(d,"AID",a.U),cn(a,d),a.o&&a.s&&eI(d,a.o,a.s),b=new bV(a,a.h,b,a.C+1),a.o===null&&(b.H=a.s),c&&(a.l=c.D.concat(a.l)),c=gr(a,b,1e3),b.setTimeout(Math.round(.5*a.ra)+Math.round(.5*a.ra*Math.random())),ef(a.i,b),eP(b,d,c)}function cn(a,b){a.j&&ew({},function(a,c){t(b,c,a)})}function gr(a,e,b){var c,d;b=Math.min(a.l.length,b),c=a.j?E(a.j.Oa,a.j,a):null;a:{d=a.l;let e=-1;for(;;){const a=["count="+b];e==-1?0<b?(e=d[0].h,a.push("ofs="+e)):e=0:a.push("ofs="+e);let f=!0;for(let g=0;g<b;g++){let h=d[g].h;const i=d[g].g;if(h-=e,0>h)e=Math.max(0,d[g].h-100),f=!1;else try{oj(i,a,"req"+h+"_")}catch(a){c&&c(i)}}if(f){c=a.join("&");break a}}}return a=a.l.splice(0,b),e.D=a,c}function gq(a){a.g||a.u||(a.Y=1,fK(a.Ga,a),a.A=0)}function eV(a){return!(a.g||a.u||3<=a.A)&&(a.Y++,a.u=bX(E(a.Ga,a),go(a,a.A)),a.A++,!0)}e.Ga=function(){if(this.u=null,gu(this),this.$&&!(this.L||this.g==null||0>=this.O)){var a=2*this.O;this.h.info("BP detection timer enabled: "+a),this.B=bX(E(this.bb,this),a)}},e.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,P(10),dl(this),gu(this))};function eW(a){a.B!=null&&(h.clearTimeout(a.B),a.B=null)}function gu(a){var b,c;a.g=new bV(a,a.h,"rpc",a.Y),a.o===null&&(a.g.H=a.s),a.g.O=0,b=al(a.oa),t(b,"RID","rpc"),t(b,"SID",a.J),t(b,"CI",a.N?"0":"1"),t(b,"AID",a.U),cn(a,b),t(b,"TYPE","xmlhttp"),a.o&&a.s&&eI(b,a.o,a.s),a.K&&a.g.setTimeout(a.K),c=a.g,a=a.la,c.K=1,c.v=dJ(al(b)),c.s=null,c.U=!0,hH(c,a)}e.ab=function(){this.v!=null&&(this.v=null,dl(this),eV(this),P(19))};function dc(a){a.v!=null&&(h.clearTimeout(a.v),a.v=null)}function gp(a,b){var d=null,c,e;if(a.g==b)dc(a),eW(a),a.g=null,c=2;else if(ee(a.i,b))d=b.D,gW(a.i,b),c=1;else return;if(a.I=b.N,a.G!=0)if(b.i)c==1?(d=b.s?b.s.length:0,b=Date.now()-b.F,e=a.C,c=cP(),C(c,new hP(c,d,b,e)),dj(a)):gq(a);else if(e=b.o,e==3||e==0&&0<a.I||!(c==1&&nR(a,b)||c==2&&eV(a)))switch(d&&0<d.length&&(b=a.i,b.i=b.i.concat(d)),e){case 1:aE(a,5);break;case 4:aE(a,10);break;case 3:aE(a,6);break;default:aE(a,2)}}function go(a,c){let b=a.Pa+Math.floor(Math.random()*a.$a);return a.j||(b*=2),b*c}function aE(a,c){var b,d;a.h.info("Error code "+c),c==2?(b=null,a.j&&(b=null),d=E(a.jb,a),b||(b=new aU("//www.google.com/images/cleardot.gif"),h.location&&h.location.protocol=="http"||dE(b,"https"),dJ(b)),oh(b.toString(),d)):P(2),a.G=0,a.j&&a.j.va(c),gn(a),gw(a)}e.jb=function(a){a?(this.h.info("Successfully pinged google.com"),P(2)):(this.h.info("Failed to ping google.com"),P(1))};function gn(a){a.G=0,a.I=-1,a.j&&((gV(a.i).length!=0||a.l.length!=0)&&(a.i.i.length=0,dZ(a.l),a.l.length=0),a.j.ua())}function gl(c,b,d){let a=oz(d);if(a.i!="")b&&dF(a,b+"."+a.i),dG(a,a.m);else{const c=h.location;a=ox(c.protocol,b?b+"."+c.hostname:c.hostname,+c.port,d)}return c.aa&&eb(c.aa,function(b,c){t(a,c,b)}),b=c.D,d=c.sa,b&&d&&t(a,b,d),t(a,"VER",c.ma),cn(c,a),a}function gk(a,b,c){if(b&&!a.H)throw Error("Can't create secondary domain capable XhrIo object.");return b=c&&a.Ba&&!a.qa?new y(new bZ({ib:!0})):new y(a.qa),b.L=a.H,b}function gj(){}e=gj.prototype,e.xa=function(){},e.wa=function(){},e.va=function(){},e.ua=function(){},e.Oa=function(){};function cY(){if(by&&!(10<=Number(oX)))throw Error("Environmental error: no available transport.")}cY.prototype.g=function(a,b){return new _(a,b)};function _(b,a){B.call(this),this.g=new gx(a),this.l=b,this.h=a&&a.messageUrlParams||null,b=a&&a.messageHeaders||null,a&&a.clientProtocolHeaderRequired&&(b?b["X-Client-Protocol"]="webchannel":b={"X-Client-Protocol":"webchannel"}),this.g.s=b,b=a&&a.initMessageHeaders||null,a&&a.messageContentType&&(b?b["X-WebChannel-Content-Type"]=a.messageContentType:b={"X-WebChannel-Content-Type":a.messageContentType}),a&&a.ya&&(b?b["X-WebChannel-Client-Profile"]=a.ya:b={"X-WebChannel-Client-Profile":a.ya}),this.g.P=b,(b=a&&a.httpHeadersOverwriteParam)&&!cz(b)&&(this.g.o=b),this.A=a&&a.supportsCrossDomainXhr||!1,this.v=a&&a.sendRawJson||!1,(a=a&&a.httpSessionIdParam)&&!cz(a)&&(this.g.D=a,b=this.h,b!==null&&a in b&&(b=this.h,a in b&&delete b[a])),this.j=new bc(this)}F(_,B),_.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var a=this.g,b=this.l,c=this.h||void 0;a.Wa&&(a.h.info("Origin Trials enabled."),fK(E(a.hb,a,b))),P(0),a.W=b,a.aa=c||{},a.N=a.X,a.F=gl(a,null,a.W),dj(a)},_.prototype.close=function(){eL(this.g)},_.prototype.u=function(b){if(typeof b=="string"){var a={};a.__data__=b,eO(this.g,a)}else this.v?(a={},a.__data__=fI(b),eO(this.g,a)):eO(this.g,b)},_.prototype.M=function(){this.g.j=null,delete this.j,eL(this.g),delete this.g,_.Z.M.call(this)};function gg(a){e$.call(this);var b=a.__sm__;if(b){a:{for(const c in b){a=c;break a}a=void 0}(this.i=a)&&(a=this.i,b=b!==null&&a in b?b[a]:void 0),this.data=b}else this.data=a}F(gg,e$);function gf(){eZ.call(this),this.status=1}F(gf,eZ);function bc(a){this.g=a}F(bc,gj),bc.prototype.xa=function(){C(this.g,"a")},bc.prototype.wa=function(a){C(this.g,new gg(a))},bc.prototype.va=function(a){C(this.g,new gf(a))},bc.prototype.ua=function(){C(this.g,"b")},cY.prototype.createWebChannel=cY.prototype.g,_.prototype.send=_.prototype.u,_.prototype.open=_.prototype.m,_.prototype.close=_.prototype.close,cW.NO_ERROR=0,cW.TIMEOUT=8,cW.HTTP_ERROR=6,hO.COMPLETE="complete",hJ.EventType=bW,bW.OPEN="a",bW.CLOSE="b",bW.ERROR="c",bW.MESSAGE="d",B.prototype.listen=B.prototype.N,y.prototype.listenOnce=y.prototype.O,y.prototype.getLastError=y.prototype.La,y.prototype.getLastErrorCode=y.prototype.Da,y.prototype.getStatus=y.prototype.ba,y.prototype.getResponseJson=y.prototype.Qa,y.prototype.getResponseText=y.prototype.ga,y.prototype.send=y.prototype.ea,nP=aq.createWebChannelTransport=function(){return new cY},nO=aq.getStatEventTarget=function(){return cP()},fl=aq.ErrorCode=cW,nK=aq.EventType=hO,nI=aq.Event=aL,gb=aq.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},nE=aq.FetchXmlHttpFactory=bZ,cU=aq.WebChannel=hJ,nD=aq.XhrIo=y,f_="@firebase/firestore",U=class{constructor(a){this.uid=a}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(a){return a.uid===this.uid}},U.UNAUTHENTICATED=new U(null),U.GOOGLE_CREDENTIALS=new U("google-credentials-uid"),U.FIRST_PARTY=new U("first-party-uid"),U.MOCK_USER=new U("mock-user"),bi="9.6.5",aF=new jR("@firebase/firestore");function fw(){return aF.logLevel}function c(a,...b){if(aF.logLevel<=n.DEBUG){const c=b.map(fA);aF.debug(`Firestore (${bi}): ${a}`,...c)}}function R(a,...b){if(aF.logLevel<=n.ERROR){const c=b.map(fA);aF.error(`Firestore (${bi}): ${a}`,...c)}}function fZ(a,...b){if(aF.logLevel<=n.WARN){const c=b.map(fA);aF.warn(`Firestore (${bi}): ${a}`,...c)}}function fA(a){if(typeof a=="string")return a;try{return b=a,JSON.stringify(b)}catch(b){return a}var b}function f(b="Unexpected state"){const a=`FIRESTORE (${bi}) INTERNAL ASSERTION FAILED: `+b;throw R(a),new Error(a)}function j(a,b){a||f()}function i(a,b){return a}a={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},d=class extends fB{constructor(a,b){super(a,b),this.code=a,this.message=b,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}},ad=class{constructor(){this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}},nB=class{constructor(a,b){this.user=b,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${a}`)}},nA=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(a,b){a.enqueueRetryable(()=>b(U.UNAUTHENTICATED))}shutdown(){}},nz=class{constructor(a){this.t=a,this.currentUser=U.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(b,h){let d=this.i;const e=a=>this.i!==d?(d=this.i,h(a)):Promise.resolve();let a=new ad;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new ad,b.enqueueRetryable(()=>e(this.currentUser))};const f=()=>{const c=a;b.enqueueRetryable(async()=>{await c.promise,await e(this.currentUser)})},g=a=>{c("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=a,this.auth.addAuthTokenListener(this.o),f()};this.t.onInit(a=>g(a)),setTimeout(()=>{if(!this.auth){const b=this.t.getImmediate({optional:!0});b?g(b):(c("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new ad)}},0),f()}getToken(){const a=this.i,b=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(b).then(b=>this.i!==a?(c("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):b?(j(typeof b.accessToken=="string"),new nB(b.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const a=this.auth&&this.auth.getUid();return j(a===null||typeof a=="string"),new U(a)}},ny=class{constructor(c,d,a){this.type="FirstParty",this.user=U.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",d);const b=c.auth.getAuthHeaderValueForFirstParty([]);b&&this.headers.set("Authorization",b),a&&this.headers.set("X-Goog-Iam-Authorization-Token",a)}},nu=class{constructor(a,b,c){this.h=a,this.l=b,this.m=c}getToken(){return Promise.resolve(new ny(this.h,this.l,this.m))}start(a,b){a.enqueueRetryable(()=>b(U.FIRST_PARTY))}shutdown(){}invalidateToken(){}},nt=class{constructor(a){this.value=a,this.type="AppCheck",this.headers=new Map,a&&a.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},nr=class{constructor(a){this.g=a,this.forceRefresh=!1,this.appCheck=null}start(b,d){this.o=a=>{b.enqueueRetryable(()=>(a=>(a.error!=null&&c("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`),d(a.token)))(a))};const a=a=>{c("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.appCheck.addTokenListener(this.o)};this.g.onInit(b=>a(b)),setTimeout(()=>{if(!this.appCheck){const b=this.g.getImmediate({optional:!0});b?a(b):c("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const a=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(a).then(a=>a?(j(typeof a.token=="string"),new nt(a.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}},ac=class{constructor(b,a){this.previousValue=b,a&&(a.sequenceNumberHandler=a=>this.p(a),this.T=b=>a.writeSequenceNumber(b))}p(a){return this.previousValue=Math.max(a,this.previousValue),this.previousValue}next(){const a=++this.previousValue;return this.T&&this.T(a),a}};function np(c){const a=typeof self!="undefined"&&(self.crypto||self.msCrypto),b=new Uint8Array(c);if(a&&typeof a.getRandomValues=="function")a.getRandomValues(b);else for(let a=0;a<c;a++)b[a]=Math.floor(256*Math.random());return b}ac.I=-1,no=class{static A(){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=Math.floor(256/a.length)*a.length;let b="";for(;b.length<20;){const d=np(40);for(let e=0;e<d.length;++e)b.length<20&&d[e]<c&&(b+=a.charAt(d[e]%a.length))}return b}};function m(a,b){return a<b?-1:a>b?1:0}function bv(a,b,c){return a.length===b.length&&a.every((a,d)=>c(a,b[d]))}function fT(a){return a+"\0"}M=class{constructor(b,c){if(this.seconds=b,this.nanoseconds=c,c<0)throw new d(a.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+c);if(c>=1e9)throw new d(a.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+c);if(b<-62135596800)throw new d(a.INVALID_ARGUMENT,"Timestamp seconds out of range: "+b);if(b>=253402300800)throw new d(a.INVALID_ARGUMENT,"Timestamp seconds out of range: "+b)}static now(){return M.fromMillis(Date.now())}static fromDate(a){return M.fromMillis(a.getTime())}static fromMillis(a){const b=Math.floor(a/1e3),c=Math.floor(1e6*(a-1e3*b));return new M(b,c)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(a){return this.seconds===a.seconds?m(this.nanoseconds,a.nanoseconds):m(this.seconds,a.seconds)}isEqual(a){return a.seconds===this.seconds&&a.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const a=this.seconds- -62135596800;return String(a).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}},k=class{constructor(a){this.timestamp=a}static fromTimestamp(a){return new k(a)}static min(){return new k(new M(0,0))}compareTo(a){return this.timestamp._compareTo(a.timestamp)}isEqual(a){return this.timestamp.isEqual(a.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};function fW(a){let b=0;for(const c in a)Object.prototype.hasOwnProperty.call(a,c)&&b++;return b}function cx(a,b){for(const c in a)Object.prototype.hasOwnProperty.call(a,c)&&b(c,a[c])}function fY(a){for(const b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0}cL=class{constructor(b,a,c){a===void 0?a=0:a>b.length&&f(),c===void 0?c=b.length-a:c>b.length-a&&f(),this.segments=b,this.offset=a,this.len=c}get length(){return this.len}isEqual(a){return cL.comparator(this,a)===0}child(a){const b=this.segments.slice(this.offset,this.limit());return a instanceof cL?a.forEach(a=>{b.push(a)}):b.push(a),this.construct(b)}limit(){return this.offset+this.length}popFirst(a){return a=a===void 0?1:a,this.construct(this.segments,this.offset+a,this.length-a)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(a){return this.segments[this.offset+a]}isEmpty(){return this.length===0}isPrefixOf(a){if(a.length<this.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}isImmediateParentOf(a){if(this.length+1!==a.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}forEach(a){for(let b=this.offset,c=this.limit();b<c;b++)a(this.segments[b])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(a,b){const c=Math.min(a.length,b.length);for(let d=0;d<c;d++){const e=a.get(d),f=b.get(d);if(e<f)return-1;if(e>f)return 1}return a.length<b.length?-1:a.length>b.length?1:0}},q=class extends cL{construct(a,b,c){return new q(a,b,c)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...c){const b=[];for(const e of c){if(e.indexOf("//")>=0)throw new d(a.INVALID_ARGUMENT,`Invalid segment (${e}). Paths must not contain // in them.`);b.push(...e.split("/").filter(a=>a.length>0))}return new q(b)}static emptyPath(){return new q([])}},nn=/^[_a-zA-Z][_a-zA-Z0-9]*$/,S=class extends cL{construct(a,b,c){return new S(a,b,c)}static isValidIdentifier(a){return nn.test(a)}canonicalString(){return this.toArray().map(a=>(a=a.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),S.isValidIdentifier(a)||(a="`"+a+"`"),a)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new S(["__name__"])}static fromServerFormat(b){const g=[];let e="",c=0;const h=()=>{if(e.length===0)throw new d(a.INVALID_ARGUMENT,`Invalid field path (${b}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);g.push(e),e=""};let f=!1;for(;c<b.length;){const g=b[c];if(g==="\\"){if(c+1===b.length)throw new d(a.INVALID_ARGUMENT,"Path has trailing escape character: "+b);const f=b[c+1];if(f!=="\\"&&f!=="."&&f!=="`")throw new d(a.INVALID_ARGUMENT,"Path has invalid escape sequence: "+b);e+=f,c+=2}else g==="`"?(f=!f,c++):g!=="."||f?(e+=g,c++):(h(),c++)}if(h(),f)throw new d(a.INVALID_ARGUMENT,"Unterminated ` in path: "+b);return new S(g)}static emptyPath(){return new S([])}},nm=class{constructor(a){this.fields=a,a.sort(S.comparator)}covers(a){for(const b of this.fields)if(b.isPrefixOf(a))return!0;return!1}isEqual(a){return bv(this.fields,a.fields,(a,b)=>a.isEqual(b))}},D=class{constructor(a){this.binaryString=a}static fromBase64String(a){const b=atob(a);return new D(b)}static fromUint8Array(a){const b=function(a){let b="";for(let c=0;c<a.length;++c)b+=String.fromCharCode(a[c]);return b}(a);return new D(b)}[Symbol.iterator](){let a=0;return{next:()=>a<this.binaryString.length?{value:this.binaryString.charCodeAt(a++),done:!1}:{value:void 0,done:!0}}}toBase64(){return a=this.binaryString,btoa(a);var a}toUint8Array(){return function(a){const b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(a){return m(this.binaryString,a.binaryString)}isEqual(a){return this.binaryString===a.binaryString}},D.EMPTY_BYTE_STRING=new D(""),nl=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function aD(a){if(j(!!a),typeof a=="string"){let c=0;const b=nl.exec(a);if(j(!!b),b[1]){let a=b[1];a=(a+"000000000").substr(0,9),c=Number(a)}const d=new Date(a);return{seconds:Math.floor(d.getTime()/1e3),nanos:c}}return{seconds:x(a.seconds),nanos:x(a.nanos)}}function x(a){return typeof a=="number"?a:typeof a=="string"?Number(a):0}function bg(a){return typeof a=="string"?D.fromBase64String(a):D.fromUint8Array(a)}function gh(c){var a,b;return((b=(((a=c==null?void 0:c.mapValue)===null||a===void 0?void 0:a.fields)||{}).__type__)===null||b===void 0?void 0:b.stringValue)==="server_timestamp"}function gi(b){const a=b.mapValue.fields.__previous_value__;return gh(a)?gi(a):a}function ch(b){const a=aD(b.mapValue.fields.__local_write_time__.timestampValue);return new M(a.seconds,a.nanos)}function bm(a){return a==null}function c$(a){return a===0&&1/a==-1/0}function nk(a){return typeof a=="number"&&Number.isInteger(a)&&!c$(a)&&a<=Number.MAX_SAFE_INTEGER&&a>=Number.MIN_SAFE_INTEGER}g=class{constructor(a){this.path=a}static fromPath(a){return new g(q.fromString(a))}static fromName(a){return new g(q.fromString(a).popFirst(5))}hasCollectionId(a){return this.path.length>=2&&this.path.get(this.path.length-2)===a}isEqual(a){return a!==null&&q.comparator(this.path,a.path)===0}toString(){return this.path.toString()}static comparator(a,b){return q.comparator(a.path,b.path)}static isDocumentKey(a){return a.length%2==0}static fromSegments(a){return new g(new q(a.slice()))}};function aO(a){return"nullValue"in a?0:"booleanValue"in a?1:"integerValue"in a||"doubleValue"in a?2:"timestampValue"in a?3:"stringValue"in a?5:"bytesValue"in a?6:"referenceValue"in a?7:"geoPointValue"in a?8:"arrayValue"in a?9:"mapValue"in a?gh(a)?4:10:f()}function ai(a,b){if(a===b)return!0;const c=aO(a);if(c!==aO(b))return!1;switch(c){case 0:return!0;case 1:return a.booleanValue===b.booleanValue;case 4:return ch(a).isEqual(ch(b));case 3:return function(a,b){if(typeof a.timestampValue=="string"&&typeof b.timestampValue=="string"&&a.timestampValue.length===b.timestampValue.length)return a.timestampValue===b.timestampValue;const c=aD(a.timestampValue),d=aD(b.timestampValue);return c.seconds===d.seconds&&c.nanos===d.nanos}(a,b);case 5:return a.stringValue===b.stringValue;case 6:return function(a,b){return bg(a.bytesValue).isEqual(bg(b.bytesValue))}(a,b);case 7:return a.referenceValue===b.referenceValue;case 8:return function(a,b){return x(a.geoPointValue.latitude)===x(b.geoPointValue.latitude)&&x(a.geoPointValue.longitude)===x(b.geoPointValue.longitude)}(a,b);case 2:return function(a,b){if("integerValue"in a&&"integerValue"in b)return x(a.integerValue)===x(b.integerValue);if("doubleValue"in a&&"doubleValue"in b){const c=x(a.doubleValue),d=x(b.doubleValue);return c===d?c$(c)===c$(d):isNaN(c)&&isNaN(d)}return!1}(a,b);case 9:return bv(a.arrayValue.values||[],b.arrayValue.values||[],ai);case 10:return function(c,d){const a=c.mapValue.fields||{},b=d.mapValue.fields||{};if(fW(a)!==fW(b))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(b[c]===void 0||!ai(a[c],b[c])))return!1;return!0}(a,b);default:return f()}}function cs(a,b){return(a.values||[]).find(a=>ai(a,b))!==void 0}function bs(a,b){if(a===b)return 0;const c=aO(a),d=aO(b);if(c!==d)return m(c,d);switch(c){case 0:return 0;case 1:return m(a.booleanValue,b.booleanValue);case 2:return function(c,d){const a=x(c.integerValue||c.doubleValue),b=x(d.integerValue||d.doubleValue);return a<b?-1:a>b?1:a===b?0:isNaN(a)?isNaN(b)?0:-1:1}(a,b);case 3:return gs(a.timestampValue,b.timestampValue);case 4:return gs(ch(a),ch(b));case 5:return m(a.stringValue,b.stringValue);case 6:return function(a,b){const c=bg(a),d=bg(b);return c.compareTo(d)}(a.bytesValue,b.bytesValue);case 7:return function(c,d){const a=c.split("/"),b=d.split("/");for(let c=0;c<a.length&&c<b.length;c++){const d=m(a[c],b[c]);if(d!==0)return d}return m(a.length,b.length)}(a.referenceValue,b.referenceValue);case 8:return function(a,b){const c=m(x(a.latitude),x(b.latitude));return c!==0?c:m(x(a.longitude),x(b.longitude))}(a.geoPointValue,b.geoPointValue);case 9:return function(c,d){const a=c.values||[],b=d.values||[];for(let c=0;c<a.length&&c<b.length;++c){const d=bs(a[c],b[c]);if(d)return d}return m(a.length,b.length)}(a.arrayValue,b.arrayValue);case 10:return function(e,f){const c=e.fields||{},a=Object.keys(c),d=f.fields||{},b=Object.keys(d);a.sort(),b.sort();for(let e=0;e<a.length&&e<b.length;++e){const f=m(a[e],b[e]);if(f!==0)return f;const g=bs(c[a[e]],d[b[e]]);if(g!==0)return g}return m(a.length,b.length)}(a.mapValue,b.mapValue);default:throw f()}}function gs(a,b){if(typeof a=="string"&&typeof b=="string"&&a.length===b.length)return m(a,b);const c=aD(a),d=aD(b),e=m(c.seconds,d.seconds);return e!==0?e:m(c.nanos,d.nanos)}function eR(a){return eX(a)}function eX(a){return"nullValue"in a?"null":"booleanValue"in a?""+a.booleanValue:"integerValue"in a?""+a.integerValue:"doubleValue"in a?""+a.doubleValue:"timestampValue"in a?function(b){const a=aD(b);return`time(${a.seconds},${a.nanos})`}(a.timestampValue):"stringValue"in a?a.stringValue:"bytesValue"in a?bg(a.bytesValue).toBase64():"referenceValue"in a?(c=a.referenceValue,g.fromName(c).toString()):"geoPointValue"in a?`geo(${(b=a.geoPointValue).latitude},${b.longitude})`:"arrayValue"in a?function(c){let a="[",b=!0;for(const d of c.values||[])b?b=!1:a+=",",a+=eX(d);return a+"]"}(a.arrayValue):"mapValue"in a?function(b){const d=Object.keys(b.fields||{}).sort();let a="{",c=!0;for(const e of d)c?c=!1:a+=",",a+=`${e}:${eX(b.fields[e])}`;return a+"}"}(a.mapValue):f();var b,c}function gv(a,b){return{referenceValue:`projects/${a.projectId}/databases/${a.database}/documents/${b.path.canonicalString()}`}}function eN(a){return!!a&&"integerValue"in a}function eK(a){return!!a&&"arrayValue"in a}function gy(a){return!!a&&"nullValue"in a}function gz(a){return!!a&&"doubleValue"in a&&isNaN(Number(a.doubleValue))}function eG(a){return!!a&&"mapValue"in a}function cg(a){if(a.geoPointValue)return{geoPointValue:Object.assign({},a.geoPointValue)};if(a.timestampValue&&typeof a.timestampValue=="object")return{timestampValue:Object.assign({},a.timestampValue)};if(a.mapValue){const b={mapValue:{fields:{}}};return cx(a.mapValue.fields,(a,c)=>b.mapValue.fields[a]=cg(c)),b}if(a.arrayValue){const b={arrayValue:{values:[]}};for(let c=0;c<(a.arrayValue.values||[]).length;++c)b.arrayValue.values[c]=cg(a.arrayValue.values[c]);return b}return Object.assign({},a)}ae=class{constructor(a){this.value=a}static empty(){return new ae({mapValue:{}})}field(a){if(a.isEmpty())return this.value;{let b=this.value;for(let c=0;c<a.length-1;++c)if(b=(b.mapValue.fields||{})[a.get(c)],!eG(b))return null;return b=(b.mapValue.fields||{})[a.lastSegment()],b||null}}set(a,b){this.getFieldsMap(a.popLast())[a.lastSegment()]=cg(b)}setAll(d){let a=S.emptyPath(),b={},c=[];d.forEach((e,d)=>{if(!a.isImmediateParentOf(d)){const e=this.getFieldsMap(a);this.applyChanges(e,b,c),b={},c=[],a=d.popLast()}e?b[d.lastSegment()]=cg(e):c.push(d.lastSegment())});const e=this.getFieldsMap(a);this.applyChanges(e,b,c)}delete(b){const a=this.field(b.popLast());eG(a)&&a.mapValue.fields&&delete a.mapValue.fields[b.lastSegment()]}isEqual(a){return ai(this.value,a.value)}getFieldsMap(b){let a=this.value;a.mapValue.fields||(a.mapValue={fields:{}});for(let d=0;d<b.length;++d){let c=a.mapValue.fields[b.get(d)];eG(c)&&c.mapValue.fields||(c={mapValue:{fields:{}}},a.mapValue.fields[b.get(d)]=c),a=c}return a.mapValue.fields}applyChanges(a,b,c){cx(b,(b,c)=>a[b]=c);for(const b of c)delete a[b]}clone(){return new ae(cg(this.value))}},z=class{constructor(a,b,c,d,e){this.key=a,this.documentType=b,this.version=c,this.data=d,this.documentState=e}static newInvalidDocument(a){return new z(a,0,k.min(),ae.empty(),0)}static newFoundDocument(a,b,c){return new z(a,1,b,c,0)}static newNoDocument(a,b){return new z(a,2,b,ae.empty(),0)}static newUnknownDocument(a,b){return new z(a,3,b,ae.empty(),2)}convertToFoundDocument(a,b){return this.version=a,this.documentType=1,this.data=b,this.documentState=0,this}convertToNoDocument(a){return this.version=a,this.documentType=2,this.data=ae.empty(),this.documentState=0,this}convertToUnknownDocument(a){return this.version=a,this.documentType=3,this.data=ae.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(a){return a instanceof z&&this.key.isEqual(a.key)&&this.version.isEqual(a.version)&&this.documentType===a.documentType&&this.documentState===a.documentState&&this.data.isEqual(a.data)}mutableCopy(){return new z(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}},nj=class{constructor(a,b=null,c=[],d=[],e=null,f=null,g=null){this.path=a,this.collectionGroup=b,this.orderBy=c,this.filters=d,this.limit=e,this.startAt=f,this.endAt=g,this.R=null}};function gF(a,b=null,c=[],d=[],e=null,f=null,g=null){return new nj(a,b,c,d,e,f,g)}function cc(b){const a=i(b);if(a.R===null){let b=a.path.canonicalString();a.collectionGroup!==null&&(b+="|cg:"+a.collectionGroup),b+="|f:",b+=a.filters.map(a=>nh(a)).join(","),b+="|ob:",b+=a.orderBy.map(a=>function(a){return a.field.canonicalString()+a.dir}(a)).join(","),bm(a.limit)||(b+="|l:",b+=a.limit),a.startAt&&(b+="|lb:",b+=dN(a.startAt)),a.endAt&&(b+="|ub:",b+=dN(a.endAt)),a.R=b}return a.R}function ni(a){let b=a.path.canonicalString();return a.collectionGroup!==null&&(b+=" collectionGroup="+a.collectionGroup),a.filters.length>0&&(b+=`, filters: [${a.filters.map(b=>{return`${(a=b).field.canonicalString()} ${a.op} ${eR(a.value)}`;var a}).join(", ")}]`),bm(a.limit)||(b+=", limit: "+a.limit),a.orderBy.length>0&&(b+=`, orderBy: [${a.orderBy.map(a=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(a)).join(", ")}]`),a.startAt&&(b+=", startAt: "+dN(a.startAt)),a.endAt&&(b+=", endAt: "+dN(a.endAt)),`Target(${b})`}function dw(a,b){if(a.limit!==b.limit)return!1;if(a.orderBy.length!==b.orderBy.length)return!1;for(let c=0;c<a.orderBy.length;c++)if(!mS(a.orderBy[c],b.orderBy[c]))return!1;if(a.filters.length!==b.filters.length)return!1;for(let e=0;e<a.filters.length;e++)if(c=a.filters[e],d=b.filters[e],c.op!==d.op||!c.field.isEqual(d.field)||!ai(c.value,d.value))return!1;var c,d;return a.collectionGroup===b.collectionGroup&&!!a.path.isEqual(b.path)&&!!gZ(a.startAt,b.startAt)&&gZ(a.endAt,b.endAt)}function dy(a){return g.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}T=class extends class{}{constructor(a,b,c){super(),this.field=a,this.op=b,this.value=c}static create(b,a,c){return b.isKeyField()?a==="in"||a==="not-in"?this.P(b,a,c):new ne(b,a,c):a==="array-contains"?new mY(b,c):a==="in"?new mX(b,c):a==="not-in"?new mV(b,c):a==="array-contains-any"?new mU(b,c):new T(b,a,c)}static P(a,c,b){return c==="in"?new nd(a,b):new m$(a,b)}matches(b){const a=b.data.field(this.field);return this.op==="!="?a!==null&&this.v(bs(a,this.value)):a!==null&&aO(this.value)===aO(a)&&this.v(bs(a,this.value))}v(a){switch(this.op){case"<":return a<0;case"<=":return a<=0;case"==":return a===0;case"!=":return a!==0;case">":return a>0;case">=":return a>=0;default:return f()}}V(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}};function nh(a){return a.field.canonicalString()+a.op.toString()+eR(a.value)}ne=class extends T{constructor(b,c,a){super(b,c,a),this.key=g.fromName(a.referenceValue)}matches(a){const b=g.comparator(a.key,this.key);return this.v(b)}},nd=class extends T{constructor(b,a){super(b,"in",a),this.keys=gP("in",a)}matches(a){return this.keys.some(b=>b.isEqual(a.key))}},m$=class extends T{constructor(b,a){super(b,"not-in",a),this.keys=gP("not-in",a)}matches(a){return!this.keys.some(b=>b.isEqual(a.key))}};function gP(c,b){var a;return(((a=b.arrayValue)===null||a===void 0?void 0:a.values)||[]).map(a=>g.fromName(a.referenceValue))}mY=class extends T{constructor(a,b){super(a,"array-contains",b)}matches(b){const a=b.data.field(this.field);return eK(a)&&cs(a.arrayValue,this.value)}},mX=class extends T{constructor(a,b){super(a,"in",b)}matches(b){const a=b.data.field(this.field);return a!==null&&cs(this.value.arrayValue,a)}},mV=class extends T{constructor(a,b){super(a,"not-in",b)}matches(b){if(cs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const a=b.data.field(this.field);return a!==null&&!cs(this.value.arrayValue,a)}},mU=class extends T{constructor(a,b){super(a,"array-contains-any",b)}matches(b){const a=b.data.field(this.field);return!(!eK(a)||!a.arrayValue.values)&&a.arrayValue.values.some(a=>cs(this.value.arrayValue,a))}},el=class{constructor(a,b){this.position=a,this.before=b}};function dN(a){return`${a.before?"b":"a"}:${a.position.map(a=>eR(a)).join(",")}`}bU=class{constructor(a,b="asc"){this.field=a,this.dir=b}};function mS(a,b){return a.dir===b.dir&&a.field.isEqual(b.field)}function gY(b,d,c){let a=0;for(let e=0;e<b.position.length;e++){const f=d[e],h=b.position[e];if(f.field.isKeyField()?a=g.comparator(g.fromName(h.referenceValue),c.key):a=bs(h,c.data.field(f.field)),f.dir==="desc"&&(a*=-1),a!==0)break}return b.before?a<=0:a<0}function gZ(a,b){if(a===null)return b===null;if(b===null)return!1;if(a.before!==b.before||a.position.length!==b.position.length)return!1;for(let c=0;c<a.position.length;c++)if(!ai(a.position[c],b.position[c]))return!1;return!0}bS=class{constructor(a,b=null,c=[],d=[],e=null,f="F",g=null,h=null){this.path=a,this.collectionGroup=b,this.explicitOrderBy=c,this.filters=d,this.limit=e,this.limitType=f,this.startAt=g,this.endAt=h,this.S=null,this.D=null,this.startAt,this.endAt}};function mN(a,b,c,d,e,f,g,h){return new bS(a,b,c,d,e,f,g,h)}function dS(a){return new bS(a)}function dT(a){return!bm(a.limit)&&a.limitType==="F"}function dU(a){return!bm(a.limit)&&a.limitType==="L"}function hd(a){return a.explicitOrderBy.length>0?a.explicitOrderBy[0].field:null}function he(a){for(const b of a.filters)if(b.V())return b.field;return null}function hf(a){return a.collectionGroup!==null}function bO(b){const a=i(b);if(a.S===null){a.S=[];const b=he(a),c=hd(a);if(b!==null&&c===null)b.isKeyField()||a.S.push(new bU(b)),a.S.push(new bU(S.keyField(),"asc"));else{let b=!1;for(const c of a.explicitOrderBy)a.S.push(c),c.field.isKeyField()&&(b=!0);if(!b){const b=a.explicitOrderBy.length>0?a.explicitOrderBy[a.explicitOrderBy.length-1].dir:"asc";a.S.push(new bU(S.keyField(),b))}}}return a.S}function am(b){const a=i(b);if(!a.D)if(a.limitType==="F")a.D=gF(a.path,a.collectionGroup,bO(a),a.filters,a.limit,a.startAt,a.endAt);else{const b=[];for(const c of bO(a)){const d=c.dir==="desc"?"asc":"desc";b.push(new bU(c.field,d))}const c=a.endAt?new el(a.endAt.position,!a.endAt.before):null,d=a.startAt?new el(a.startAt.position,!a.startAt.before):null;a.D=gF(a.path,a.collectionGroup,b,a.filters,a.limit,c,d)}return a.D}function mM(a,b,c){return new bS(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),b,c,a.startAt,a.endAt)}function dP(a,b){return dw(am(a),am(b))&&a.limitType===b.limitType}function hk(a){return`${cc(am(a))}|lt:${a.limitType}`}function em(a){return`Query(target=${ni(am(a))}; limitType=${a.limitType})`}function bF(b,a){return a.isFoundDocument()&&function(a,c){const b=c.key.path;return a.collectionGroup!==null?c.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(b):g.isDocumentKey(a.path)?a.path.isEqual(b):a.path.isImmediateParentOf(b)}(b,a)&&function(a,b){for(const c of a.explicitOrderBy)if(!c.field.isKeyField()&&b.data.field(c.field)===null)return!1;return!0}(b,a)&&function(a,b){for(const c of a.filters)if(!c.matches(b))return!1;return!0}(b,a)&&function(a,b){return!(a.startAt&&!gY(a.startAt,bO(a),b))&&(!(a.endAt&&gY(a.endAt,bO(a),b)))}(b,a)}function hn(a){return(c,d)=>{let b=!1;for(const e of bO(a)){const f=mK(e,c,d);if(f!==0)return f;b=b||e.field.isKeyField()}return 0}}function mK(a,b,c){const d=a.field.isKeyField()?g.comparator(b.key,c.key):function(a,d,e){const b=d.data.field(a),c=e.data.field(a);return b!==null&&c!==null?bs(b,c):f()}(a.field,b,c);switch(a.dir){case"asc":return d;case"desc":return-1*d;default:return f()}}function hp(b,a){if(b.C){if(isNaN(a))return{doubleValue:"NaN"};if(a===1/0)return{doubleValue:"Infinity"};if(a===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:c$(a)?"-0":a}}function hq(a){return{integerValue:""+a}}function mJ(b,a){return nk(a)?hq(a):hp(b,a)}dH=class{constructor(){this._=void 0}};function mI(a,b,c){return a instanceof bG?function(a,b){const c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return b&&(c.fields.__previous_value__=b),{mapValue:c}}(c,b):a instanceof bq?hy(a,b):a instanceof aY?hA(a,b):function(a,d){const b=mG(a,d),c=hC(b)+hC(a.N);return eN(b)&&eN(a.N)?hq(c):hp(a.k,c)}(a,b)}function mH(a,b,c){return a instanceof bq?hy(a,b):a instanceof aY?hA(a,b):c}function mG(c,a){return c instanceof bQ?eN(b=a)||function(a){return!!a&&"doubleValue"in a}(b)?a:{integerValue:0}:null;var b}bG=class extends dH{},bq=class extends dH{constructor(a){super(),this.elements=a}};function hy(b,c){const a=hD(c);for(const c of b.elements)a.some(a=>ai(a,c))||a.push(c);return{arrayValue:{values:a}}}aY=class extends dH{constructor(a){super(),this.elements=a}};function hA(b,c){let a=hD(c);for(const c of b.elements)a=a.filter(a=>!ai(a,c));return{arrayValue:{values:a}}}bQ=class extends dH{constructor(a,b){super(),this.k=a,this.N=b}};function hC(a){return x(a.integerValue||a.doubleValue)}function hD(a){return eK(a)&&a.arrayValue.values?a.arrayValue.values.slice():[]}mC=class{constructor(a,b){this.field=a,this.transform=b}};function mB(a,b){return a.field.isEqual(b.field)&&function(a,b){return a instanceof bq&&b instanceof bq||a instanceof aY&&b instanceof aY?bv(a.elements,b.elements,ai):a instanceof bQ&&b instanceof bQ?ai(a.N,b.N):a instanceof bG&&b instanceof bG}(a.transform,b.transform)}mt=class{constructor(a,b){this.version=a,this.transformResults=b}},aK=class{constructor(a,b){this.updateTime=a,this.exists=b}static none(){return new aK}static exists(a){return new aK(void 0,a)}static updateTime(a){return new aK(a)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(a){return this.exists===a.exists&&(this.updateTime?!!a.updateTime&&this.updateTime.isEqual(a.updateTime):!a.updateTime)}};function df(a,b){return a.updateTime!==void 0?b.isFoundDocument()&&b.version.isEqual(a.updateTime):a.exists===void 0||a.exists===b.isFoundDocument()}c_=class{};function ms(a,b,c){a instanceof cX?function(a,b,c){const d=a.value.clone(),e=hR(a.fieldTransforms,b,c.transformResults);d.setAll(e),b.convertToFoundDocument(c.version,d).setHasCommittedMutations()}(a,b,c):a instanceof bY?function(b,a,c){if(!df(b.precondition,a))return void a.convertToUnknownDocument(c.version);const e=hR(b.fieldTransforms,a,c.transformResults),d=a.data;d.setAll(hQ(b)),d.setAll(e),a.convertToFoundDocument(c.version,d).setHasCommittedMutations()}(a,b,c):function(c,a,b){a.convertToNoDocument(b.version).setHasCommittedMutations()}(0,b,c)}function fc(a,b,c){a instanceof cX?function(b,a,d){if(!df(b.precondition,a))return;const c=b.value.clone(),e=hS(b.fieldTransforms,d,a);c.setAll(e),a.convertToFoundDocument(hN(a),c).setHasLocalMutations()}(a,b,c):a instanceof bY?function(b,a,d){if(!df(b.precondition,a))return;const e=hS(b.fieldTransforms,d,a),c=a.data;c.setAll(hQ(b)),c.setAll(e),a.convertToFoundDocument(hN(a),c).setHasLocalMutations()}(a,b,c):function(b,a){df(b.precondition,a)&&a.convertToNoDocument(k.min())}(a,b)}function hM(a,b){return a.type===b.type&&!!a.key.isEqual(b.key)&&!!a.precondition.isEqual(b.precondition)&&!!function(a,b){return a===void 0&&b===void 0||!(!a||!b)&&bv(a,b,(a,b)=>mB(a,b))}(a.fieldTransforms,b.fieldTransforms)&&(a.type===0?a.value.isEqual(b.value):a.type!==1||a.data.isEqual(b.data)&&a.fieldMask.isEqual(b.fieldMask))}function hN(a){return a.isFoundDocument()?a.version:k.min()}cX=class extends c_{constructor(a,b,c,d=[]){super(),this.key=a,this.value=b,this.precondition=c,this.fieldTransforms=d,this.type=0}},bY=class extends c_{constructor(a,b,c,d,e=[]){super(),this.key=a,this.data=b,this.fieldMask=c,this.precondition=d,this.fieldTransforms=e,this.type=1}};function hQ(a){const b=new Map;return a.fieldMask.fields.forEach(c=>{if(!c.isEmpty()){const d=a.data.field(c);b.set(c,d)}}),b}function hR(b,d,a){const c=new Map;j(b.length===a.length);for(let e=0;e<a.length;e++){const f=b[e],g=f.transform,h=d.data.field(f.field);c.set(f.field,mH(g,h,a[e]))}return c}function hS(b,c,d){const a=new Map;for(const e of b){const f=e.transform,g=d.data.field(e.field);a.set(e.field,mI(f,g,c))}return a}hT=class extends c_{constructor(a,b){super(),this.key=a,this.precondition=b,this.type=2,this.fieldTransforms=[]}},hU=class extends c_{constructor(a,b){super(),this.key=a,this.precondition=b,this.type=3,this.fieldTransforms=[]}},mr=class{constructor(a){this.count=a}};function mq(b){switch(b){default:return f();case a.CANCELLED:case a.UNKNOWN:case a.DEADLINE_EXCEEDED:case a.RESOURCE_EXHAUSTED:case a.INTERNAL:case a.UNAVAILABLE:case a.UNAUTHENTICATED:return!1;case a.INVALID_ARGUMENT:case a.NOT_FOUND:case a.ALREADY_EXISTS:case a.PERMISSION_DENIED:case a.FAILED_PRECONDITION:case a.ABORTED:case a.OUT_OF_RANGE:case a.UNIMPLEMENTED:case a.DATA_LOSS:return!0}}function hZ(b){if(b===void 0)return R("GRPC error has no .code"),a.UNKNOWN;switch(b){case w.OK:return a.OK;case w.CANCELLED:return a.CANCELLED;case w.UNKNOWN:return a.UNKNOWN;case w.DEADLINE_EXCEEDED:return a.DEADLINE_EXCEEDED;case w.RESOURCE_EXHAUSTED:return a.RESOURCE_EXHAUSTED;case w.INTERNAL:return a.INTERNAL;case w.UNAVAILABLE:return a.UNAVAILABLE;case w.UNAUTHENTICATED:return a.UNAUTHENTICATED;case w.INVALID_ARGUMENT:return a.INVALID_ARGUMENT;case w.NOT_FOUND:return a.NOT_FOUND;case w.ALREADY_EXISTS:return a.ALREADY_EXISTS;case w.PERMISSION_DENIED:return a.PERMISSION_DENIED;case w.FAILED_PRECONDITION:return a.FAILED_PRECONDITION;case w.ABORTED:return a.ABORTED;case w.OUT_OF_RANGE:return a.OUT_OF_RANGE;case w.UNIMPLEMENTED:return a.UNIMPLEMENTED;case w.DATA_LOSS:return a.DATA_LOSS;default:return f()}}(l=w||(w={}))[l.OK=0]="OK",l[l.CANCELLED=1]="CANCELLED",l[l.UNKNOWN=2]="UNKNOWN",l[l.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",l[l.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",l[l.NOT_FOUND=5]="NOT_FOUND",l[l.ALREADY_EXISTS=6]="ALREADY_EXISTS",l[l.PERMISSION_DENIED=7]="PERMISSION_DENIED",l[l.UNAUTHENTICATED=16]="UNAUTHENTICATED",l[l.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",l[l.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",l[l.ABORTED=10]="ABORTED",l[l.OUT_OF_RANGE=11]="OUT_OF_RANGE",l[l.UNIMPLEMENTED=12]="UNIMPLEMENTED",l[l.INTERNAL=13]="INTERNAL",l[l.UNAVAILABLE=14]="UNAVAILABLE",l[l.DATA_LOSS=15]="DATA_LOSS",N=class{constructor(a,b){this.comparator=a,this.root=b||K.EMPTY}insert(a,b){return new N(this.comparator,this.root.insert(a,b,this.comparator).copy(null,null,K.BLACK,null,null))}remove(a){return new N(this.comparator,this.root.remove(a,this.comparator).copy(null,null,K.BLACK,null,null))}get(b){let a=this.root;for(;!a.isEmpty();){const c=this.comparator(b,a.key);if(c===0)return a.value;c<0?a=a.left:c>0&&(a=a.right)}return null}indexOf(c){let b=0,a=this.root;for(;!a.isEmpty();){const d=this.comparator(c,a.key);if(d===0)return b+a.left.size;d<0?a=a.left:(b+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(a){return this.root.inorderTraversal(a)}forEach(a){this.inorderTraversal((b,c)=>(a(b,c),!1))}toString(){const a=[];return this.inorderTraversal((b,c)=>(a.push(`${b}:${c}`),!1)),`{${a.join(", ")}}`}reverseTraversal(a){return this.root.reverseTraversal(a)}getIterator(){return new cG(this.root,null,this.comparator,!1)}getIteratorFrom(a){return new cG(this.root,a,this.comparator,!1)}getReverseIterator(){return new cG(this.root,null,this.comparator,!0)}getReverseIteratorFrom(a){return new cG(this.root,a,this.comparator,!0)}},cG=class{constructor(a,c,e,d){this.isReverse=d,this.nodeStack=[];let b=1;for(;!a.isEmpty();)if(b=c?e(a.key,c):1,d&&(b*=-1),b<0)a=this.isReverse?a.left:a.right;else{if(b===0){this.nodeStack.push(a);break}this.nodeStack.push(a),a=this.isReverse?a.right:a.left}}getNext(){let a=this.nodeStack.pop();const b={key:a.key,value:a.value};if(this.isReverse)for(a=a.left;!a.isEmpty();)this.nodeStack.push(a),a=a.right;else for(a=a.right;!a.isEmpty();)this.nodeStack.push(a),a=a.left;return b}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const a=this.nodeStack[this.nodeStack.length-1];return{key:a.key,value:a.value}}},K=class{constructor(d,e,a,b,c){this.key=d,this.value=e,this.color=a!=null?a:K.RED,this.left=b!=null?b:K.EMPTY,this.right=c!=null?c:K.EMPTY,this.size=this.left.size+1+this.right.size}copy(a,b,c,d,e){return new K(a!=null?a:this.key,b!=null?b:this.value,c!=null?c:this.color,d!=null?d:this.left,e!=null?e:this.right)}isEmpty(){return!1}inorderTraversal(a){return this.left.inorderTraversal(a)||a(this.key,this.value)||this.right.inorderTraversal(a)}reverseTraversal(a){return this.right.reverseTraversal(a)||a(this.key,this.value)||this.left.reverseTraversal(a)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(b,c,d){let a=this;const e=d(b,a.key);return a=e<0?a.copy(null,null,null,a.left.insert(b,c,d),null):e===0?a.copy(null,c,null,null,null):a.copy(null,null,null,null,a.right.insert(b,c,d)),a.fixUp()}removeMin(){if(this.left.isEmpty())return K.EMPTY;let a=this;return a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.removeMin(),null),a.fixUp()}remove(b,c){let d,a=this;if(c(b,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(b,c),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),c(b,a.key)===0){if(a.right.isEmpty())return K.EMPTY;d=a.right.min(),a=a.copy(d.key,d.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(b,c))}return a.fixUp()}isRed(){return this.color}fixUp(){let a=this;return a.right.isRed()&&!a.left.isRed()&&(a=a.rotateLeft()),a.left.isRed()&&a.left.left.isRed()&&(a=a.rotateRight()),a.left.isRed()&&a.right.isRed()&&(a=a.colorFlip()),a}moveRedLeft(){let a=this.colorFlip();return a.right.left.isRed()&&(a=a.copy(null,null,null,null,a.right.rotateRight()),a=a.rotateLeft(),a=a.colorFlip()),a}moveRedRight(){let a=this.colorFlip();return a.left.left.isRed()&&(a=a.rotateRight(),a=a.colorFlip()),a}rotateLeft(){const a=this.copy(null,null,K.RED,null,this.right.left);return this.right.copy(null,null,this.color,a,null)}rotateRight(){const a=this.copy(null,null,K.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,a)}colorFlip(){const a=this.left.copy(null,null,!this.left.color,null,null),b=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,a,b)}checkMaxDepth(){const a=this.check();return Math.pow(2,a)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw f();if(this.right.isRed())throw f();const a=this.left.check();if(a!==this.right.check())throw f();return a+(this.isRed()?0:1)}},K.EMPTY=null,K.RED=!0,K.BLACK=!1,K.EMPTY=new class{constructor(){this.size=0}get key(){throw f()}get value(){throw f()}get color(){throw f()}get left(){throw f()}get right(){throw f()}copy(a,b,c,d,e){return this}insert(a,b,c){return new K(a,b)}remove(a,b){return this}isEmpty(){return!0}inorderTraversal(a){return!1}reverseTraversal(a){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}},v=class{constructor(a){this.comparator=a,this.data=new N(this.comparator)}has(a){return this.data.get(a)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(a){return this.data.indexOf(a)}forEach(a){this.data.inorderTraversal((b,c)=>(a(b),!1))}forEachInRange(a,c){const b=this.data.getIteratorFrom(a[0]);for(;b.hasNext();){const d=b.getNext();if(this.comparator(d.key,a[1])>=0)return;c(d.key)}}forEachWhile(c,b){let a;for(a=b!==void 0?this.data.getIteratorFrom(b):this.data.getIterator();a.hasNext();)if(!c(a.getNext().key))return}firstAfterOrEqual(b){const a=this.data.getIteratorFrom(b);return a.hasNext()?a.getNext().key:null}getIterator(){return new ic(this.data.getIterator())}getIteratorFrom(a){return new ic(this.data.getIteratorFrom(a))}add(a){return this.copy(this.data.remove(a).insert(a,!0))}delete(a){return this.has(a)?this.copy(this.data.remove(a)):this}isEmpty(){return this.data.isEmpty()}unionWith(b){let a=this;return a.size<b.size&&(a=b,b=this),b.forEach(b=>{a=a.add(b)}),a}isEqual(a){if(!(a instanceof v))return!1;if(this.size!==a.size)return!1;const b=this.data.getIterator(),c=a.data.getIterator();for(;b.hasNext();){const a=b.getNext().key,d=c.getNext().key;if(this.comparator(a,d)!==0)return!1}return!0}toArray(){const a=[];return this.forEach(b=>{a.push(b)}),a}toString(){const a=[];return this.forEach(b=>a.push(b)),"SortedSet("+a.toString()+")"}copy(b){const a=new v(this.comparator);return a.data=b,a}},ic=class{constructor(a){this.iter=a}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}},mn=new N(g.comparator);function aj(){return mn}mm=new N(g.comparator);function fO(){return mm}mj=new N(g.comparator);function mi(){return mj}mh=new v(g.comparator);function r(...b){let a=mh;for(const c of b)a=a.add(c);return a}mg=new v(m);function io(){return mg}fJ=class{constructor(a,b,c,d,e){this.snapshotVersion=a,this.targetChanges=b,this.targetMismatches=c,this.documentUpdates=d,this.resolvedLimboDocuments=e}static createSynthesizedRemoteEventForCurrentChange(a,c){const b=new Map;return b.set(a,cQ.createSynthesizedTargetChangeForCurrentChange(a,c)),new fJ(k.min(),b,io(),aj(),r())}},cQ=class{constructor(a,b,c,d,e){this.resumeToken=a,this.current=b,this.addedDocuments=c,this.modifiedDocuments=d,this.removedDocuments=e}static createSynthesizedTargetChangeForCurrentChange(b,a){return new cQ(D.EMPTY_BYTE_STRING,a,r(),r(),r())}},cR=class{constructor(a,b,c,d){this.$=a,this.removedTargetIds=b,this.key=c,this.O=d}},is=class{constructor(a,b){this.targetId=a,this.M=b}},it=class{constructor(a,b,c=D.EMPTY_BYTE_STRING,d=null){this.state=a,this.targetIds=b,this.resumeToken=c,this.cause=d}},iu=class{constructor(){this.F=0,this.L=ix(),this.B=D.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return this.F!==0}get j(){return this.q}W(a){a.approximateByteSize()>0&&(this.q=!0,this.B=a)}G(){let a=r(),b=r(),c=r();return this.L.forEach((d,e)=>{switch(e){case 0:a=a.add(d);break;case 2:b=b.add(d);break;case 1:c=c.add(d);break;default:f()}}),new cQ(this.B,this.U,a,b,c)}H(){this.q=!1,this.L=ix()}J(a,b){this.q=!0,this.L=this.L.insert(a,b)}Y(a){this.q=!0,this.L=this.L.remove(a)}X(){this.F+=1}Z(){this.F-=1}tt(){this.q=!0,this.U=!0}},mf=class{constructor(a){this.et=a,this.nt=new Map,this.st=aj(),this.it=iw(),this.rt=new v(m)}ot(a){for(const b of a.$)a.O&&a.O.isFoundDocument()?this.ct(b,a.O):this.at(b,a.key,a.O);for(const b of a.removedTargetIds)this.at(b,a.key,a.O)}ut(a){this.forEachTarget(a,c=>{const b=this.ht(c);switch(a.state){case 0:this.lt(c)&&b.W(a.resumeToken);break;case 1:b.Z(),b.K||b.H(),b.W(a.resumeToken);break;case 2:b.Z(),b.K||this.removeTarget(c);break;case 3:this.lt(c)&&(b.tt(),b.W(a.resumeToken));break;case 4:this.lt(c)&&(this.ft(c),b.W(a.resumeToken));break;default:f()}})}forEachTarget(a,b){a.targetIds.length>0?a.targetIds.forEach(b):this.nt.forEach((c,a)=>{this.lt(a)&&b(a)})}dt(c){const a=c.targetId,b=c.M.count,d=this.wt(a);if(d){const c=d.target;if(dy(c))if(b===0){const b=new g(c.path);this.at(a,b,z.newNoDocument(b,k.min()))}else j(b===1);else this._t(a)!==b&&(this.ft(a),this.rt=this.rt.add(a))}}gt(b){const c=new Map;this.nt.forEach((a,d)=>{const e=this.wt(d);if(e){if(a.current&&dy(e.target)){const a=new g(e.target.path);this.st.get(a)!==null||this.yt(d,a)||this.at(d,a,z.newNoDocument(a,b))}a.j&&(c.set(d,a.G()),a.H())}});let a=r();this.it.forEach((c,d)=>{let b=!0;d.forEachWhile(c=>{const a=this.wt(c);return!a||a.purpose===2||(b=!1,!1)}),b&&(a=a.add(c))});const d=new fJ(b,c,this.rt,this.st,a);return this.st=aj(),this.it=iw(),this.rt=new v(m),d}ct(b,a){if(!this.lt(b))return;const c=this.yt(b,a.key)?2:0;this.ht(b).J(a.key,c),this.st=this.st.insert(a.key,a),this.it=this.it.insert(a.key,this.Tt(a.key).add(b))}at(b,a,c){if(!this.lt(b))return;const d=this.ht(b);this.yt(b,a)?d.J(a,1):d.Y(a),this.it=this.it.insert(a,this.Tt(a).delete(b)),c&&(this.st=this.st.insert(a,c))}removeTarget(a){this.nt.delete(a)}_t(a){const b=this.ht(a).G();return this.et.getRemoteKeysForTarget(a).size+b.addedDocuments.size-b.removedDocuments.size}X(a){this.ht(a).X()}ht(b){let a=this.nt.get(b);return a||(a=new iu,this.nt.set(b,a)),a}Tt(b){let a=this.it.get(b);return a||(a=new v(m),this.it=this.it.insert(b,a)),a}lt(a){const b=this.wt(a)!==null;return b||c("WatchChangeAggregator","Detected inactive target",a),b}wt(a){const b=this.nt.get(a);return b&&b.K?null:this.et.Et(a)}ft(a){this.nt.set(a,new iu),this.et.getRemoteKeysForTarget(a).forEach(b=>{this.at(a,b,null)})}yt(a,b){return this.et.getRemoteKeysForTarget(a).has(b)}};function iw(){return new N(g.comparator)}function ix(){return new N(g.comparator)}me=(()=>{const a={asc:"ASCENDING",desc:"DESCENDING"};return a})(),md=(()=>{const a={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};return a})(),mb=class{constructor(a,b){this.databaseId=a,this.C=b}};function b$(b,a){return b.C?`${new Date(1e3*a.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+a.nanoseconds).slice(-9)}Z`:{seconds:""+a.seconds,nanos:a.nanoseconds}}function iC(b,a){return b.C?a.toBase64():a.toUint8Array()}function lY(a,b){return b$(a,b.toTimestamp())}function X(a){return j(!!a),k.fromTimestamp(function(b){const a=aD(b);return new M(a.seconds,a.nanos)}(a))}function fr(a,b){return function(a){return new q(["projects",a.projectId,"databases",a.database])}(a).child("documents").child(b).canonicalString()}function iG(b){const a=q.fromString(b);return j(jf(a)),a}function dk(a,b){return fr(a.databaseId,b.path)}function aJ(c,e){const b=iG(e);if(b.get(1)!==c.databaseId.projectId)throw new d(a.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+b.get(1)+" vs "+c.databaseId.projectId);if(b.get(3)!==c.databaseId.database)throw new d(a.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+b.get(3)+" vs "+c.databaseId.database);return new g(iM(b))}function eM(a,b){return fr(a.databaseId,b)}function iK(b){const a=iG(b);return a.length===4?q.emptyPath():iM(a)}function eC(a){return new q(["projects",a.databaseId.projectId,"databases",a.databaseId.database]).canonicalString()}function iM(a){return j(a.length>4&&a.get(4)==="documents"),a.popFirst(5)}function iN(a,b,c){return{name:dk(a,b),fields:c.value.mapValue.fields}}function lX(g,b,c){const d=aJ(g,b.name),e=X(b.updateTime),f=new ae({mapValue:{fields:b.fields}}),a=z.newFoundDocument(d,e,f);return c&&a.setHasCommittedMutations(),c?a.setHasCommittedMutations():a}function lU(e,b){let c;if("targetChange"in b){b.targetChange;const h=function(a){return a==="NO_CHANGE"?0:a==="ADD"?1:a==="REMOVE"?2:a==="CURRENT"?3:a==="RESET"?4:f()}(b.targetChange.targetChangeType||"NO_CHANGE"),i=b.targetChange.targetIds||[],k=function(b,a){return b.C?(j(a===void 0||typeof a=="string"),D.fromBase64String(a||"")):(j(a===void 0||a instanceof Uint8Array),D.fromUint8Array(a||new Uint8Array))}(e,b.targetChange.resumeToken),g=b.targetChange.cause,l=g&&function(b){const c=b.code===void 0?a.UNKNOWN:hZ(b.code);return new d(c,b.message||"")}(g);c=new it(h,i,k,l||null)}else if("documentChange"in b){b.documentChange;const a=b.documentChange;a.document,a.document.name,a.document.updateTime;const f=aJ(e,a.document.name),g=X(a.document.updateTime),h=new ae({mapValue:{fields:a.document.fields}}),d=z.newFoundDocument(f,g,h),i=a.targetIds||[],j=a.removedTargetIds||[];c=new cR(i,j,d.key,d)}else if("documentDelete"in b){b.documentDelete;const a=b.documentDelete;a.document;const f=aJ(e,a.document),g=a.readTime?X(a.readTime):k.min(),d=z.newNoDocument(f,g),h=a.removedTargetIds||[];c=new cR([],h,d.key,d)}else if("documentRemove"in b){b.documentRemove;const a=b.documentRemove;a.document;const d=aJ(e,a.document),f=a.removedTargetIds||[];c=new cR([],f,d,null)}else{if(!("filter"in b))return f();{b.filter;const a=b.filter;a.targetId;const d=a.count||0,e=new mr(d),f=a.targetId;c=new is(f,e)}}return c}function eo(c,a){let b;if(a instanceof cX)b={update:iN(c,a.key,a.value)};else if(a instanceof hT)b={delete:dk(c,a.key)};else if(a instanceof bY)b={update:iN(c,a.key,a.data),updateMask:lK(a.fieldMask)};else{if(!(a instanceof hU))return f();b={verify:dk(c,a.key)}}return a.fieldTransforms.length>0&&(b.updateTransforms=a.fieldTransforms.map(a=>function(c,b){const a=b.transform;if(a instanceof bG)return{fieldPath:b.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof bq)return{fieldPath:b.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof aY)return{fieldPath:b.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof bQ)return{fieldPath:b.field.canonicalString(),increment:a.N};throw f()}(0,a))),a.precondition.isNone||(b.currentDocument=function(b,a){return a.updateTime!==void 0?{updateTime:lY(b,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:f()}(c,a.precondition)),b}function iR(b,a){const c=a.currentDocument?function(a){return a.updateTime!==void 0?aK.updateTime(X(a.updateTime)):a.exists!==void 0?aK.exists(a.exists):aK.none()}(a.currentDocument):aK.none(),d=a.updateTransforms?a.updateTransforms.map(a=>function(c,a){let b=null;if("setToServerValue"in a)j(a.setToServerValue==="REQUEST_TIME"),b=new bG;else if("appendMissingElements"in a){const c=a.appendMissingElements.values||[];b=new bq(c)}else if("removeAllFromArray"in a){const c=a.removeAllFromArray.values||[];b=new aY(c)}else"increment"in a?b=new bQ(c,a.increment):f();const d=S.fromServerFormat(a.fieldPath);return new mC(d,b)}(b,a)):[];if(a.update){a.update.name;const e=aJ(b,a.update.name),f=new ae({mapValue:{fields:a.update.fields}});if(a.updateMask){const b=function(a){const b=a.fieldPaths||[];return new nm(b.map(a=>S.fromServerFormat(a)))}(a.updateMask);return new bY(e,f,b,c,d)}return new cX(e,f,c,d)}if(a.delete){const d=aJ(b,a.delete);return new hT(d,c)}if(a.verify){const d=aJ(b,a.verify);return new hU(d,c)}return f()}function lT(a,b){return a&&a.length>0?(j(b!==void 0),a.map(a=>function(a,c){let b=a.updateTime?X(a.updateTime):X(c);return b.isEqual(k.min())&&(b=X(c)),new mt(b,a.transformResults||[])}(a,b))):[]}function iT(a,b){return{documents:[eM(a,b.path)]}}function iU(c,a){const b={structuredQuery:{}},d=a.path;a.collectionGroup!==null?(b.parent=eM(c,d),b.structuredQuery.from=[{collectionId:a.collectionGroup,allDescendants:!0}]):(b.parent=eM(c,d.popLast()),b.structuredQuery.from=[{collectionId:d.lastSegment()}]);const e=function(b){if(b.length===0)return;const a=b.map(a=>function(a){if(a.op==="=="){{if(gz(a.value))return{unaryFilter:{field:bu(a.field),op:"IS_NAN"}};if(gy(a.value))return{unaryFilter:{field:bu(a.field),op:"IS_NULL"}}}}else if(a.op==="!="){if(gz(a.value))return{unaryFilter:{field:bu(a.field),op:"IS_NOT_NAN"}};if(gy(a.value))return{unaryFilter:{field:bu(a.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:bu(a.field),op:lN(a.op),value:a.value}}}(a));return a.length===1?a[0]:{compositeFilter:{op:"AND",filters:a}}}(a.filters);e&&(b.structuredQuery.where=e);const f=function(a){if(a.length===0)return;return a.map(a=>function(a){return{field:bu(a.field),direction:lO(a.dir)}}(a))}(a.orderBy);f&&(b.structuredQuery.orderBy=f);const g=function(b,a){return b.C||bm(a)?a:{value:a}}(c,a.limit);return g!==null&&(b.structuredQuery.limit=g),a.startAt&&(b.structuredQuery.startAt=iY(a.startAt)),a.endAt&&(b.structuredQuery.endAt=iY(a.endAt)),b}function iV(c){let b=iK(c.parent);const a=c.structuredQuery,d=a.from?a.from.length:0;let e=null;if(d>0){j(d===1);const c=a.from[0];c.allDescendants?e=c.collectionId:b=b.child(c.collectionId)}let f=[];a.where&&(f=iX(a.where));let g=[];a.orderBy&&(g=a.orderBy.map(a=>function(a){return new bU(bt(a.field),function(a){switch(a){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(a.direction))}(a)));let h=null;a.limit&&(h=function(a){let b;return b=typeof a=="object"?a.value:a,bm(b)?null:b}(a.limit));let i=null;a.startAt&&(i=iZ(a.startAt));let k=null;return a.endAt&&(k=iZ(a.endAt)),mN(b,e,g,f,h,"F",i,k)}function lS(c,b){const a=function(b,a){switch(a){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return f()}}(0,b.purpose);return a==null?null:{"goog-listen-tags":a}}function iX(a){return a?a.unaryFilter!==void 0?[lL(a)]:a.fieldFilter!==void 0?[lM(a)]:a.compositeFilter!==void 0?a.compositeFilter.filters.map(a=>iX(a)).reduce((a,b)=>a.concat(b)):f():[]}function iY(a){return{before:a.before,values:a.position}}function iZ(a){const b=!!a.before,c=a.values||[];return new el(c,b)}function lO(a){return me[a]}function lN(a){return md[a]}function bu(a){return{fieldPath:a.canonicalString()}}function bt(a){return S.fromServerFormat(a.fieldPath)}function lM(a){return T.create(bt(a.fieldFilter.field),function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return f()}}(a.fieldFilter.op),a.fieldFilter.value)}function lL(a){switch(a.unaryFilter.op){case"IS_NAN":const b=bt(a.unaryFilter.field);return T.create(b,"==",{doubleValue:NaN});case"IS_NULL":const c=bt(a.unaryFilter.field);return T.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=bt(a.unaryFilter.field);return T.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const e=bt(a.unaryFilter.field);return T.create(e,"!=",{nullValue:"NULL_VALUE"});default:return f()}}function lK(b){const a=[];return b.fields.forEach(b=>a.push(b.canonicalString())),{fieldPaths:a}}function jf(a){return a.length>=4&&a.get(0)==="projects"&&a.get(2)==="databases"}function ab(b){let a="";for(let c=0;c<b.length;c++)a.length>0&&(a=ji(a)),a=lJ(b.get(c),a);return ji(a)}function lJ(b,c){let a=c;const d=b.length;for(let c=0;c<d;c++){const e=b.charAt(c);switch(e){case"\0":a+="";break;case"":a+="";break;default:a+=e}}return a}function ji(a){return a+""}function ao(a){const c=a.length;if(j(c>=2),c===2)return j(a.charAt(0)===""&&a.charAt(1)===""),q.emptyPath();const e=c-2,d=[];let b="";for(let h=0;h<c;){const g=a.indexOf("",h);switch((g<0||g>e)&&f(),a.charAt(g+1)){case"":const e=a.substring(h,g);let c;b.length===0?c=e:(b+=e,c=b,b=""),d.push(c);break;case"":b+=a.substring(h,g),b+="\0";break;case"":b+=a.substring(h,g+1);break;default:f()}h=g+2}return new q(d)}lI=class{constructor(a,b){this.seconds=a,this.nanoseconds=b}},$=class{constructor(a,b,c){this.ownerId=a,this.allowTabSynchronization=b,this.leaseTimestampMs=c}},$.store="owner",$.key="owner",ax=class{constructor(a,b,c){this.userId=a,this.lastAcknowledgedBatchId=b,this.lastStreamToken=c}},ax.store="mutationQueues",ax.keyPath="userId",s=class{constructor(a,b,c,d,e){this.userId=a,this.batchId=b,this.localWriteTimeMs=c,this.baseMutations=d,this.mutations=e}},s.store="mutations",s.keyPath="batchId",s.userMutationsIndex="userMutationsIndex",s.userMutationsKeyPath=["userId","batchId"],I=class{constructor(){}static prefixForUser(a){return[a]}static prefixForPath(a,b){return[a,ab(b)]}static key(a,b,c){return[a,ab(b),c]}},I.store="documentMutations",I.PLACEHOLDER=new I,lH=class{constructor(a,b){this.path=a,this.readTime=b}},lG=class{constructor(a,b){this.path=a,this.version=b}},u=class{constructor(a,b,c,d,e,f){this.unknownDocument=a,this.noDocument=b,this.document=c,this.hasCommittedMutations=d,this.readTime=e,this.parentPath=f}},u.store="remoteDocuments",u.readTimeIndex="readTimeIndex",u.readTimeIndexPath="readTime",u.collectionReadTimeIndex="collectionReadTimeIndex",u.collectionReadTimeIndexPath=["parentPath","readTime"],ag=class{constructor(a){this.byteSize=a}},ag.store="remoteDocumentGlobal",ag.key="remoteDocumentGlobalKey",W=class{constructor(a,b,c,d,e,f,g){this.targetId=a,this.canonicalId=b,this.readTime=c,this.resumeToken=d,this.lastListenSequenceNumber=e,this.lastLimboFreeSnapshotVersion=f,this.query=g}},W.store="targets",W.keyPath="targetId",W.queryTargetsIndexName="queryTargetsIndex",W.queryTargetsKeyPath=["canonicalId","targetId"],H=class{constructor(a,b,c){this.targetId=a,this.path=b,this.sequenceNumber=c}},H.store="targetDocuments",H.keyPath=["targetId","path"],H.documentTargetsIndex="documentTargetsIndex",H.documentTargetsKeyPath=["path","targetId"],Z=class{constructor(a,b,c,d){this.highestTargetId=a,this.highestListenSequenceNumber=b,this.lastRemoteSnapshotVersion=c,this.targetCount=d}},Z.key="targetGlobalKey",Z.store="targetGlobal",aW=class{constructor(a,b){this.collectionId=a,this.parent=b}},aW.store="collectionParents",aW.keyPath=["collectionId","parent"],an=class{constructor(a,b,c,d){this.clientId=a,this.updateTimeMs=b,this.networkEnabled=c,this.inForeground=d}},an.store="clientMetadata",an.keyPath="clientId",bC=class{constructor(a,b,c){this.bundleId=a,this.createTime=b,this.version=c}},bC.store="bundles",bC.keyPath="bundleId",bp=class{constructor(a,b,c){this.name=a,this.readTime=b,this.bundledQuery=c}},bp.store="namedQueries",bp.keyPath="name",lF=[...[...[...[...[ax.store,s.store,I.store,u.store,W.store,$.store,Z.store,H.store],an.store],ag.store],aW.store],bC.store,bp.store],jB="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",jC=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(a){this.onCommittedListeners.push(a)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(a=>a())}},b=class{constructor(a){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,a(a=>{this.isDone=!0,this.result=a,this.nextCallback&&this.nextCallback(a)},a=>{this.isDone=!0,this.error=a,this.catchCallback&&this.catchCallback(a)})}catch(a){return this.next(void 0,a)}next(a,c){return this.callbackAttached&&f(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(c,this.error):this.wrapSuccess(a,this.result):new b((b,d)=>{this.nextCallback=c=>{this.wrapSuccess(a,c).next(b,d)},this.catchCallback=a=>{this.wrapFailure(c,a).next(b,d)}})}toPromise(){return new Promise((a,b)=>{this.next(a,b)})}wrapUserFunction(a){try{const c=a();return c instanceof b?c:b.resolve(c)}catch(a){return b.reject(a)}}wrapSuccess(a,c){return a?this.wrapUserFunction(()=>a(c)):b.resolve(c)}wrapFailure(a,c){return a?this.wrapUserFunction(()=>a(c)):b.reject(c)}static resolve(a){return new b((b,c)=>{b(a)})}static reject(a){return new b((c,b)=>{b(a)})}static waitFor(a){return new b((d,f)=>{let b=0,c=0,e=!1;a.forEach(a=>{++b,a.next(()=>{++c,e&&c===b&&d()},a=>f(a))}),e=!0,c===b&&d()})}static or(c){let a=b.resolve(!1);for(const d of c)a=a.next(a=>a?b.resolve(a):d());return a}static forEach(b,c){const a=[];return b.forEach((b,d)=>{a.push(c.call(this,b,d))}),this.waitFor(a)}},fd=class{constructor(a,b){this.action=a,this.transaction=b,this.aborted=!1,this.It=new ad,this.transaction.oncomplete=()=>{this.It.resolve()},this.transaction.onabort=()=>{b.error?this.It.reject(new cf(a,b.error)):this.It.resolve()},this.transaction.onerror=b=>{const c=fh(b.target.error);this.It.reject(new cf(a,c))}}static open(b,a,c,d){try{return new fd(a,b.transaction(d,c))}catch(b){throw new cf(a,b)}}get At(){return this.It.promise}abort(a){a&&this.It.reject(a),this.aborted||(c("SimpleDb","Aborting transaction:",a?a.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(a){const b=this.transaction.objectStore(a);return new ly(b)}},ay=class{constructor(a,b,c){this.name=a,this.version=b,this.Rt=c,ay.bt(aP())===12.2&&R("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(a){return c("SimpleDb","Removing database:",a),aR(window.indexedDB.deleteDatabase(a)).toPromise()}static Pt(){if(!rR())return!1;if(ay.vt())return!0;const a=aP(),b=ay.bt(a),d=0<b&&b<10,c=ay.Vt(a),e=0<c&&c<4.5;return!(a.indexOf("MSIE ")>0||a.indexOf("Trident/")>0||a.indexOf("Edge/")>0||d||e)}static vt(){var a;return typeof process!="undefined"&&((a=process.env)===null||a===void 0?void 0:a.St)==="YES"}static Dt(a,b){return a.store(b)}static bt(b){const a=b.match(/i(?:phone|pad|pod) os ([\d_]+)/i),c=a?a[1].split("_").slice(0,2).join("."):"-1";return Number(c)}static Vt(b){const a=b.match(/Android ([\d.]+)/i),c=a?a[1].split(".").slice(0,2).join("."):"-1";return Number(c)}async Ct(b){return this.db||(c("SimpleDb","Opening database:",this.name),this.db=await new Promise((g,f)=>{const e=indexedDB.open(this.name,this.version);e.onsuccess=a=>{const b=a.target.result;g(b)},e.onblocked=()=>{f(new cf(b,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},e.onerror=e=>{const c=e.target.error;c.name==="VersionError"?f(new d(a.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):c.name==="InvalidStateError"?f(new d(a.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+c)):f(new cf(b,c))},e.onupgradeneeded=a=>{c("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',a.oldVersion);const b=a.target.result;this.Rt.Nt(b,e.transaction,a.oldVersion,this.version).next(()=>{c("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.kt&&(this.db.onversionchange=a=>this.kt(a)),this.db}xt(a){this.kt=a,this.db&&(this.db.onversionchange=b=>a(b))}async runTransaction(a,e,f,g){const h=e==="readonly";let d=0;for(;;){++d;try{this.db=await this.Ct(a);const c=fd.open(this.db,a,h?"readonly":"readwrite",f),d=g(c).catch(a=>(c.abort(a),b.reject(a))).toPromise();return d.catch(()=>{}),await c.At,d}catch(a){const b=a.name!=="FirebaseError"&&d<3;if(c("SimpleDb","Transaction failed with error:",a.message,"Retrying:",b),this.close(),!b)return Promise.reject(a)}}}close(){this.db&&this.db.close(),this.db=void 0}},lz=class{constructor(a){this.$t=a,this.Ot=!1,this.Mt=null}get isDone(){return this.Ot}get Ft(){return this.Mt}set cursor(a){this.$t=a}done(){this.Ot=!0}Lt(a){this.Mt=a}delete(){return aR(this.$t.delete())}},cf=class extends d{constructor(b,c){super(a.UNAVAILABLE,`IndexedDB transaction '${b}' failed: ${c}`),this.name="IndexedDbTransactionError"}};function aQ(a){return a.name==="IndexedDbTransactionError"}ly=class{constructor(a){this.store=a}put(a,b){let d;return b!==void 0?(c("SimpleDb","PUT",this.store.name,a,b),d=this.store.put(b,a)):(c("SimpleDb","PUT",this.store.name,"<auto-key>",a),d=this.store.put(a)),aR(d)}add(a){return c("SimpleDb","ADD",this.store.name,a,a),aR(this.store.add(a))}get(a){return aR(this.store.get(a)).next(b=>(b===void 0&&(b=null),c("SimpleDb","GET",this.store.name,a,b),b))}delete(a){return c("SimpleDb","DELETE",this.store.name,a),aR(this.store.delete(a))}count(){return c("SimpleDb","COUNT",this.store.name),aR(this.store.count())}Bt(b,c){const d=this.cursor(this.options(b,c)),a=[];return this.Ut(d,(c,b)=>{a.push(b)}).next(()=>a)}qt(b,d){c("SimpleDb","DELETE ALL",this.store.name);const a=this.options(b,d);a.Kt=!1;const e=this.cursor(a);return this.Ut(e,(b,c,a)=>a.delete())}jt(c,a){let b;a?b=c:(b={},a=c);const d=this.cursor(b);return this.Ut(d,a)}Qt(c){const a=this.cursor({});return new b((b,d)=>{a.onerror=a=>{const b=fh(a.target.error);d(b)},a.onsuccess=d=>{const a=d.target.result;a?c(a.primaryKey,a.value).next(c=>{c?a.continue():b()}):b()}})}Ut(a,d){const c=[];return new b((e,f)=>{a.onerror=a=>{f(a.target.error)},a.onsuccess=h=>{const a=h.target.result;if(!a)return void e();const f=new lz(a),g=d(a.primaryKey,a.value,f);if(g instanceof b){const a=g.catch(a=>(f.done(),b.reject(a)));c.push(a)}f.isDone?e():f.Ft===null?a.continue():a.continue(f.Ft)}}).next(()=>b.waitFor(c))}options(a,b){let c;return a!==void 0&&(typeof a=="string"?c=a:b=a),{index:c,range:b}}cursor(a){let b="next";if(a.reverse&&(b="prev"),a.index){const c=this.store.index(a.index);return a.Kt?c.openKeyCursor(a.range,b):c.openCursor(a.range,b)}return this.store.openCursor(a.range,b)}};function aR(a){return new b((b,c)=>{a.onsuccess=a=>{const c=a.target.result;b(c)},a.onerror=a=>{const b=fh(a.target.error);c(b)}})}jL=!1;function fh(a){const b=ay.bt(aP());if(b>=12.2&&b<13){const b="An internal error was encountered in the Indexed Database server";if(a.message.indexOf(b)>=0){const a=new d("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${b}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return jL||(jL=!0,setTimeout(()=>{throw a},0)),a}}return a}jN=class extends jC{constructor(a,b){super(),this.Wt=a,this.currentSequenceNumber=b}};function V(a,b){const c=i(a);return ay.Dt(c.Wt,b)}fm=class{constructor(a,b,c,d){this.batchId=a,this.localWriteTime=b,this.baseMutations=c,this.mutations=d}applyToRemoteDocument(a,b){const c=b.mutationResults;for(let b=0;b<this.mutations.length;b++){const d=this.mutations[b];d.key.isEqual(a.key)&&ms(d,a,c[b])}}applyToLocalView(a){for(const b of this.baseMutations)b.key.isEqual(a.key)&&fc(b,a,this.localWriteTime);for(const b of this.mutations)b.key.isEqual(a.key)&&fc(b,a,this.localWriteTime)}applyToLocalDocumentSet(a){this.mutations.forEach(d=>{const b=a.get(d.key),c=b;this.applyToLocalView(c),b.isValidDocument()||c.convertToNoDocument(k.min())})}keys(){return this.mutations.reduce((a,b)=>a.add(b.key),r())}isEqual(a){return this.batchId===a.batchId&&bv(this.mutations,a.mutations,(a,b)=>hM(a,b))&&bv(this.baseMutations,a.baseMutations,(a,b)=>hM(a,b))}},jQ=class{constructor(a,b,c,d){this.batch=a,this.commitVersion=b,this.mutationResults=c,this.docVersions=d}static from(a,e,b){j(a.mutations.length===b.length);let c=mi();const d=a.mutations;for(let a=0;a<d.length;a++)c=c.insert(d[a].key,b[a].version);return new jQ(a,e,b,c)}},aS=class{constructor(a,b,c,d,e=k.min(),f=k.min(),g=D.EMPTY_BYTE_STRING){this.target=a,this.targetId=b,this.purpose=c,this.sequenceNumber=d,this.snapshotVersion=e,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=g}withSequenceNumber(a){return new aS(this.target,this.targetId,this.purpose,a,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(a,b){return new aS(this.target,this.targetId,this.purpose,this.sequenceNumber,b,this.lastLimboFreeSnapshotVersion,a)}withLastLimboFreeSnapshotVersion(a){return new aS(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,a,this.resumeToken)}},jS=class{constructor(a){this.Gt=a}};function jT(b,a){if(a.document)return lX(b.Gt,a.document,!!a.hasCommittedMutations);if(a.noDocument){const c=g.fromSegments(a.noDocument.path),d=a$(a.noDocument.readTime),b=z.newNoDocument(c,d);return a.hasCommittedMutations?b.setHasCommittedMutations():b}if(a.unknownDocument){const b=g.fromSegments(a.unknownDocument.path),c=a$(a.unknownDocument.version);return z.newUnknownDocument(b,c)}return f()}function jU(d,a,e){const b=jV(e),c=a.key.path.popLast().toArray();if(a.isFoundDocument()){const e=function(b,a){return{name:dk(b,a.key),fields:a.data.value.mapValue.fields,updateTime:b$(b,a.version.toTimestamp())}}(d.Gt,a),f=a.hasCommittedMutations;return new u(null,null,e,f,b,c)}if(a.isNoDocument()){const d=a.key.path.toArray(),e=a_(a.version),f=a.hasCommittedMutations;return new u(null,new lH(d,e),null,f,b,c)}if(a.isUnknownDocument()){const d=a.key.path.toArray(),e=a_(a.version);return new u(new lG(d,e),null,null,!0,b,c)}return f()}function jV(b){const a=b.toTimestamp();return[a.seconds,a.nanoseconds]}function lx(a){const b=new M(a[0],a[1]);return k.fromTimestamp(b)}function a_(b){const a=b.toTimestamp();return new lI(a.seconds,a.nanoseconds)}function a$(a){const b=new M(a.seconds,a.nanoseconds);return k.fromTimestamp(b)}function bb(b,a){const c=(a.baseMutations||[]).map(a=>iR(b.Gt,a));for(let b=0;b<a.mutations.length-1;++b){const c=a.mutations[b];if(b+1<a.mutations.length&&a.mutations[b+1].transform!==void 0){const d=a.mutations[b+1];c.updateTransforms=d.transform.fieldTransforms,a.mutations.splice(b+1,1),++b}}const d=a.mutations.map(a=>iR(b.Gt,a)),e=M.fromMillis(a.localWriteTimeMs);return new fm(a.batchId,e,c,d)}function bT(a){const d=a$(a.readTime),e=a.lastLimboFreeSnapshotVersion!==void 0?a$(a.lastLimboFreeSnapshotVersion):k.min();let b;var c;return a.query.documents!==void 0?(j((c=a.query).documents.length===1),b=am(dS(iK(c.documents[0])))):b=function(a){return am(iV(a))}(a.query),new aS(b,a.targetId,0,a.lastListenSequenceNumber,d,e,D.fromBase64String(a.resumeToken))}function j$(b,a){const d=a_(a.snapshotVersion),e=a_(a.lastLimboFreeSnapshotVersion);let c;c=dy(a.target)?iT(b.Gt,a.target):iU(b.Gt,a.target);const f=a.resumeToken.toBase64();return new W(a.targetId,cc(a.target),d,f,a.sequenceNumber,e,c)}function ka(a){const b=iV({parent:a.parent,structuredQuery:a.structuredQuery});return a.limitType==="LAST"?mM(b,b.limit,"L"):b}lw=class{getBundleMetadata(a,b){return kc(a).get(b).next(b=>{if(b)return{id:(a=b).bundleId,createTime:a$(a.createTime),version:a.version};var a})}saveBundleMetadata(b,c){return kc(b).put({bundleId:(a=c).id,createTime:a_(X(a.createTime)),version:a.version});var a}getNamedQuery(a,b){return kd(a).get(b).next(b=>{if(b)return{name:(a=b).name,query:ka(a.bundledQuery),readTime:a$(a.readTime)};var a})}saveNamedQuery(a,b){return kd(a).put(function(a){return{name:a.name,readTime:a_(X(a.readTime)),bundledQuery:a.bundledQuery}}(b))}};function kc(a){return V(a,bC.store)}function kd(a){return V(a,bp.store)}lr=class{constructor(){this.zt=new ft}addToCollectionParentIndex(c,a){return this.zt.add(a),b.resolve()}getCollectionParents(c,a){return b.resolve(this.zt.getEntries(a))}},ft=class{constructor(){this.index={}}add(a){const b=a.lastSegment(),c=a.popLast(),d=this.index[b]||new v(q.comparator),e=!d.has(c);return this.index[b]=d.add(c),e}has(a){const c=a.lastSegment(),d=a.popLast(),b=this.index[c];return b&&b.has(d)}getEntries(a){return(this.index[a]||new v(q.comparator)).toArray()}},lp=class{constructor(){this.Ht=new ft}addToCollectionParentIndex(c,a){if(!this.Ht.has(a)){const b=a.lastSegment(),d=a.popLast();c.addOnCommittedListener(()=>{this.Ht.add(a)});const e={collectionId:b,parent:ab(d)};return kh(c).put(e)}return b.resolve()}getCollectionParents(c,a){const b=[],d=IDBKeyRange.bound([a,""],[fT(a),""],!1,!0);return kh(c).Bt(d).next(c=>{for(const d of c){if(d.collectionId!==a)break;b.push(ao(d.parent))}return b})}};function kh(a){return V(a,aW.store)}ki={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Y=class{constructor(a,b,c){this.cacheSizeCollectionThreshold=a,this.percentileToCollect=b,this.maximumSequenceNumbersToCollect=c}static withCacheSize(a){return new Y(a,Y.DEFAULT_COLLECTION_PERCENTILE,Y.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function kk(d,i,a){const l=d.store(s.store),g=d.store(I.store),c=[],h=IDBKeyRange.only(a.batchId);let e=0;const k=l.jt({range:h},(b,c,a)=>(e++,a.delete()));c.push(k.next(()=>{j(e===1)}));const f=[];for(const b of a.mutations){const d=I.key(i,b.key.path,a.batchId);c.push(g.delete(d)),f.push(b.key)}return b.waitFor(c).next(()=>f)}function cO(a){if(!a)return 0;let b;if(a.document)b=a.document;else if(a.unknownDocument)b=a.unknownDocument;else{if(!a.noDocument)throw f();b=a.noDocument}return JSON.stringify(b).length}Y.DEFAULT_COLLECTION_PERCENTILE=10,Y.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Y.DEFAULT=new Y(41943040,Y.DEFAULT_COLLECTION_PERCENTILE,Y.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Y.DISABLED=new Y(-1,0,0),km=class{constructor(a,b,c,d){this.userId=a,this.k=b,this.Jt=c,this.referenceDelegate=d,this.Yt={}}static Xt(a,b,c,d){j(a.uid!=="");const e=a.isAuthenticated()?a.uid:"";return new km(e,b,c,d)}checkEmpty(b){let a=!0;const c=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return aB(b).jt({index:s.userMutationsIndex,range:c},(c,d,b)=>{a=!1,b.done()}).next(()=>a)}addMutationBatch(a,e,f,c){const g=bA(a),d=aB(a);return d.add({}).next(h=>{j(typeof h=="number");const k=new fm(h,e,f,c),n=function(b,c,a){const d=a.baseMutations.map(a=>eo(b.Gt,a)),e=a.mutations.map(a=>eo(b.Gt,a));return new s(c,a.batchId,a.localWriteTime.toMillis(),d,e)}(this.k,this.userId,k),i=[];let l=new v((a,b)=>m(a.canonicalString(),b.canonicalString()));for(const a of c){const b=I.key(this.userId,a.key.path,h);l=l.add(a.key.path.popLast()),i.push(d.put(n)),i.push(g.put(b,I.PLACEHOLDER))}return l.forEach(b=>{i.push(this.Jt.addToCollectionParentIndex(a,b))}),a.addOnCommittedListener(()=>{this.Yt[h]=k.keys()}),b.waitFor(i).next(()=>k)})}lookupMutationBatch(a,b){return aB(a).get(b).next(a=>a?(j(a.userId===this.userId),bb(this.k,a)):null)}Zt(c,a){return this.Yt[a]?b.resolve(this.Yt[a]):this.lookupMutationBatch(c,a).next(b=>{if(b){const c=b.keys();return this.Yt[a]=c,c}return null})}getNextMutationBatchAfterBatchId(c,d){const a=d+1,e=IDBKeyRange.lowerBound([this.userId,a]);let b=null;return aB(c).jt({index:s.userMutationsIndex,range:e},(e,c,d)=>{c.userId===this.userId&&(j(c.batchId>=a),b=bb(this.k,c)),d.done()}).next(()=>b)}getHighestUnacknowledgedBatchId(b){const c=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let a=-1;return aB(b).jt({index:s.userMutationsIndex,range:c,reverse:!0},(d,b,c)=>{a=b.batchId,c.done()}).next(()=>a)}getAllMutationBatches(a){const b=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return aB(a).Bt(s.userMutationsIndex,b).next(a=>a.map(a=>bb(this.k,a)))}getAllMutationBatchesAffectingDocumentKey(a,b){const d=I.prefixForPath(this.userId,b.path),e=IDBKeyRange.lowerBound(d),c=[];return bA(a).jt({range:e},(d,l,e)=>{const[g,h,i]=d,k=ao(h);if(g===this.userId&&b.path.isEqual(k))return aB(a).get(i).next(a=>{if(!a)throw f();j(a.userId===this.userId),c.push(bb(this.k,a))});e.done()}).next(()=>c)}getAllMutationBatchesAffectingDocumentKeys(c,e){let a=new v(m);const d=[];return e.forEach(b=>{const e=I.prefixForPath(this.userId,b.path),f=IDBKeyRange.lowerBound(e),g=bA(c).jt({range:f},(c,i,d)=>{const[e,f,g]=c,h=ao(f);e===this.userId&&b.path.isEqual(h)?a=a.add(g):d.done()});d.push(g)}),b.waitFor(d).next(()=>this.te(c,a))}getAllMutationBatchesAffectingQuery(c,d){const b=d.path,e=b.length+1,f=I.prefixForPath(this.userId,b),g=IDBKeyRange.lowerBound(f);let a=new v(m);return bA(c).jt({range:g},(i,j,d)=>{const[f,g,h]=i,c=ao(g);f===this.userId&&b.isPrefixOf(c)?c.length===e&&(a=a.add(h)):d.done()}).next(()=>this.te(c,a))}te(d,e){const a=[],c=[];return e.forEach(b=>{c.push(aB(d).get(b).next(b=>{if(b===null)throw f();j(b.userId===this.userId),a.push(bb(this.k,b))}))}),b.waitFor(c).next(()=>a)}removeMutationBatch(a,c){return kk(a.Wt,this.userId,c).next(d=>(a.addOnCommittedListener(()=>{this.ee(c.batchId)}),b.forEach(d,b=>this.referenceDelegate.markPotentiallyOrphaned(a,b))))}ee(a){delete this.Yt[a]}performConsistencyCheck(a){return this.checkEmpty(a).next(d=>{if(!d)return b.resolve();const e=IDBKeyRange.lowerBound(I.prefixForUser(this.userId)),c=[];return bA(a).jt({range:e},(a,d,b)=>{if(a[0]===this.userId){const b=ao(a[1]);c.push(b)}else b.done()}).next(()=>{j(c.length===0)})})}containsKey(a,b){return kn(a,this.userId,b)}ne(a){return kq(a).get(this.userId).next(a=>a||new ax(this.userId,-1,""))}};function kn(g,b,d){const c=I.prefixForPath(b,d.path),e=c[1],f=IDBKeyRange.lowerBound(c);let a=!1;return bA(g).jt({range:f,Kt:!0},(c,h,d)=>{const[f,g,i]=c;f===b&&g===e&&(a=!0),d.done()}).next(()=>a)}function aB(a){return V(a,s.store)}function bA(a){return V(a,I.store)}function kq(a){return V(a,ax.store)}bB=class{constructor(a){this.se=a}next(){return this.se+=2,this.se}static ie(){return new bB(0)}static re(){return new bB(-1)}},lo=class{constructor(a,b){this.referenceDelegate=a,this.k=b}allocateTargetId(a){return this.oe(a).next(b=>{const c=new bB(b.highestTargetId);return b.highestTargetId=c.next(),this.ce(a,b).next(()=>b.highestTargetId)})}getLastRemoteSnapshotVersion(a){return this.oe(a).next(a=>k.fromTimestamp(new M(a.lastRemoteSnapshotVersion.seconds,a.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(a){return this.oe(a).next(a=>a.highestListenSequenceNumber)}setTargetsMetadata(b,a,c){return this.oe(b).next(d=>(d.highestListenSequenceNumber=a,c&&(d.lastRemoteSnapshotVersion=c.toTimestamp()),a>d.highestListenSequenceNumber&&(d.highestListenSequenceNumber=a),this.ce(b,d)))}addTargetData(a,b){return this.ae(a,b).next(()=>this.oe(a).next(c=>(c.targetCount+=1,this.ue(b,c),this.ce(a,c))))}updateTargetData(a,b){return this.ae(a,b)}removeTargetData(a,b){return this.removeMatchingKeysForTargetId(a,b.targetId).next(()=>bn(a).delete(b.targetId)).next(()=>this.oe(a)).next(b=>(j(b.targetCount>0),b.targetCount-=1,this.ce(a,b)))}removeTargets(a,e,f){let c=0;const d=[];return bn(a).jt((h,g)=>{const b=bT(g);b.sequenceNumber<=e&&f.get(b.targetId)===null&&(c++,d.push(this.removeTargetData(a,b)))}).next(()=>b.waitFor(d)).next(()=>c)}forEachTarget(a,b){return bn(a).jt((d,a)=>{const c=bT(a);b(c)})}oe(a){return ku(a).get(Z.key).next(a=>(j(a!==null),a))}ce(a,b){return ku(a).put(Z.key,b)}ae(a,b){return bn(a).put(j$(this.k,b))}ue(a,b){let c=!1;return a.targetId>b.highestTargetId&&(b.highestTargetId=a.targetId,c=!0),a.sequenceNumber>b.highestListenSequenceNumber&&(b.highestListenSequenceNumber=a.sequenceNumber,c=!0),c}getTargetCount(a){return this.oe(a).next(a=>a.targetCount)}getTargetData(d,a){const b=cc(a),e=IDBKeyRange.bound([b,Number.NEGATIVE_INFINITY],[b,Number.POSITIVE_INFINITY]);let c=null;return bn(d).jt({range:e,index:W.queryTargetsIndexName},(f,d,e)=>{const b=bT(d);dw(a,b.target)&&(c=b,e.done())}).next(()=>c)}addMatchingKeys(c,e,d){const a=[],f=aA(c);return e.forEach(b=>{const e=ab(b.path);a.push(f.put(new H(d,e))),a.push(this.referenceDelegate.addReference(c,d,b))}),b.waitFor(a)}removeMatchingKeys(a,d,c){const e=aA(a);return b.forEach(d,d=>{const f=ab(d.path);return b.waitFor([e.delete([c,f]),this.referenceDelegate.removeReference(a,c,d)])})}removeMatchingKeysForTargetId(b,a){const c=aA(b),d=IDBKeyRange.bound([a],[a+1],!1,!0);return c.delete(d)}getMatchingKeysForTargetId(c,b){const d=IDBKeyRange.bound([b],[b+1],!1,!0),e=aA(c);let a=r();return e.jt({range:d,Kt:!0},(b,e,f)=>{const c=ao(b[1]),d=new g(c);a=a.add(d)}).next(()=>a)}containsKey(c,d){const a=ab(d.path),e=IDBKeyRange.bound([a],[fT(a)],!1,!0);let b=0;return aA(c).jt({index:H.documentTargetsIndex,Kt:!0,range:e},([a,d],e,c)=>{a!==0&&(b++,c.done())}).next(()=>b>0)}Et(a,b){return bn(a).get(b).next(a=>a?bT(a):null)}};function bn(a){return V(a,W.store)}function ku(a){return V(a,Z.store)}function aA(a){return V(a,H.store)}async function bk(b){if(b.code!==a.FAILED_PRECONDITION||b.message!==jB)throw b;c("LocalStore","Unexpectedly lost primary lease")}function kx([b,c],[d,e]){const a=m(b,d);return a===0?m(c,e):a}ln=class{constructor(a){this.he=a,this.buffer=new v(kx),this.le=0}fe(){return++this.le}de(b){const a=[b,this.fe()];if(this.buffer.size<this.he)this.buffer=this.buffer.add(a);else{const b=this.buffer.last();kx(a,b)<0&&(this.buffer=this.buffer.delete(b).add(a))}}get maxValue(){return this.buffer.last()[0]}},lg=class{constructor(a,b){this.garbageCollector=a,this.asyncQueue=b,this.we=!1,this._e=null}start(a){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.me(a)}stop(){this._e&&(this._e.cancel(),this._e=null)}get started(){return this._e!==null}me(a){const b=this.we?3e5:6e4;c("LruGarbageCollector",`Garbage collection scheduled in ${b}ms`),this._e=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",b,async()=>{this._e=null,this.we=!0;try{await a.collectGarbage(this.garbageCollector)}catch(a){aQ(a)?c("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",a):await bk(a)}await this.me(a)})}},lf=class{constructor(a,b){this.ge=a,this.params=b}calculateTargetCount(a,b){return this.ge.ye(a).next(a=>Math.floor(b/100*a))}nthSequenceNumber(c,d){if(d===0)return b.resolve(ac.I);const a=new ln(d);return this.ge.forEachTarget(c,b=>a.de(b.sequenceNumber)).next(()=>this.ge.pe(c,b=>a.de(b))).next(()=>a.maxValue)}removeTargets(a,b,c){return this.ge.removeTargets(a,b,c)}removeOrphanedDocuments(a,b){return this.ge.removeOrphanedDocuments(a,b)}collect(a,d){return this.params.cacheSizeCollectionThreshold===-1?(c("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(ki)):this.getCacheSize(a).next(b=>b<this.params.cacheSizeCollectionThreshold?(c("LruGarbageCollector",`Garbage collection skipped; Cache size ${b} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ki):this.Te(a,d))}getCacheSize(a){return this.ge.getCacheSize(a)}Te(d,l){let f,a,g,h,i,e,j;const k=Date.now();return this.calculateTargetCount(d,this.params.percentileToCollect).next(b=>(b>this.params.maximumSequenceNumbersToCollect?(c("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${b}`),a=this.params.maximumSequenceNumbersToCollect):a=b,h=Date.now(),this.nthSequenceNumber(d,a))).next(a=>(f=a,i=Date.now(),this.removeTargets(d,f,l))).next(a=>(g=a,e=Date.now(),this.removeOrphanedDocuments(d,f))).next(d=>(j=Date.now(),fw()<=n.DEBUG&&c("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${h-k}ms
	Determined least recently used ${a} in `+(i-h)+`ms
	Removed ${g} targets in `+(e-i)+`ms
	Removed ${d} documents in `+(j-e)+`ms
Total Duration: ${j-k}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:a,targetsRemoved:g,documentsRemoved:d})))}},lc=class{constructor(a,b){this.db=a,this.garbageCollector=function(a,b){return new lf(a,b)}(this,b)}ye(a){const b=this.Ee(a);return this.db.getTargetCache().getTargetCount(a).next(a=>b.next(b=>a+b))}Ee(b){let a=0;return this.pe(b,b=>{a++}).next(()=>a)}forEachTarget(a,b){return this.db.getTargetCache().forEachTarget(a,b)}pe(a,b){return this.Ie(a,(c,a)=>b(a))}addReference(a,c,b){return cK(a,b)}removeReference(a,c,b){return cK(a,b)}removeTargets(a,b,c){return this.db.getTargetCache().removeTargets(a,b,c)}markPotentiallyOrphaned(a,b){return cK(a,b)}Ae(a,c){return function(a,d){let c=!1;return kq(a).Qt(e=>kn(a,e,d).next(a=>(a&&(c=!0),b.resolve(!a)))).next(()=>c)}(a,c)}removeOrphanedDocuments(a,f){const c=this.db.getRemoteDocumentCache().newChangeBuffer(),d=[];let e=0;return this.Ie(a,(b,g)=>{if(g<=f){const f=this.Ae(a,b).next(d=>{if(!d)return e++,c.getEntry(a,b).next(()=>(c.removeEntry(b),aA(a).delete([0,ab(b.path)])))});d.push(f)}}).next(()=>b.waitFor(d)).next(()=>c.apply(a)).next(()=>e)}removeTarget(a,b){const c=b.withSequenceNumber(a.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(a,c)}updateLimboDocument(a,b){return cK(a,b)}Ie(d,c){const e=aA(d);let b,a=ac.I;return e.jt({index:H.documentTargetsIndex},([d,h],{path:e,sequenceNumber:f})=>{d===0?(a!==ac.I&&c(new g(ao(b)),a),a=f,b=e):a=ac.I}).next(()=>{a!==ac.I&&c(new g(ao(b)),a)})}getCacheSize(a){return this.db.getRemoteDocumentCache().getSize(a)}};function cK(a,b){return aA(a).put(function(a,b){return new H(0,ab(a.path),b)}(b,a.currentSequenceNumber))}bd=class{constructor(a,b){this.mapKeyFn=a,this.equalsFn=b,this.inner={}}get(a){const c=this.mapKeyFn(a),b=this.inner[c];if(b!==void 0)for(const[c,d]of b)if(this.equalsFn(c,a))return d}has(a){return this.get(a)!==void 0}set(a,c){const d=this.mapKeyFn(a),b=this.inner[d];if(b!==void 0){for(let d=0;d<b.length;d++)if(this.equalsFn(b[d][0],a))return void(b[d]=[a,c]);b.push([a,c])}else this.inner[d]=[[a,c]]}delete(b){const c=this.mapKeyFn(b),a=this.inner[c];if(a===void 0)return!1;for(let d=0;d<a.length;d++)if(this.equalsFn(a[d][0],b))return a.length===1?delete this.inner[c]:a.splice(d,1),!0;return!1}forEach(a){cx(this.inner,(c,b)=>{for(const[c,d]of b)a(c,d)})}isEmpty(){return fY(this.inner)}},kE=class{constructor(){this.changes=new bd(a=>a.toString(),(a,b)=>a.isEqual(b)),this.changesApplied=!1}getReadTime(b){const a=this.changes.get(b);return a?a.readTime:k.min()}addEntry(a,b){this.assertNotApplied(),this.changes.set(a.key,{document:a,readTime:b})}removeEntry(a,b=null){this.assertNotApplied(),this.changes.set(a,{document:z.newInvalidDocument(a),readTime:b})}getEntry(d,a){this.assertNotApplied();const c=this.changes.get(a);return c!==void 0?b.resolve(c.document):this.getFromCache(d,a)}getEntries(a,b){return this.getAllFromCache(a,b)}apply(a){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(a)}assertNotApplied(){}},lb=class{constructor(a,b){this.k=a,this.Jt=b}addEntry(a,b,c){return aT(a).put(cI(b),c)}removeEntry(a,b){const c=aT(a),d=cI(b);return c.delete(d)}updateMetadata(a,b){return this.getMetadata(a).next(c=>(c.byteSize+=b,this.Re(a,c)))}getEntry(b,a){return aT(b).get(cI(a)).next(b=>this.be(a,b))}Pe(b,a){return aT(b).get(cI(a)).next(b=>({document:this.be(a,b),size:cO(b)}))}getEntries(b,c){let a=aj();return this.ve(b,c,(b,c)=>{const d=this.be(b,c);a=a.insert(b,d)}).next(()=>a)}Ve(c,d){let a=aj(),b=new N(g.comparator);return this.ve(c,d,(c,d)=>{const e=this.be(c,d);a=a.insert(c,e),b=b.insert(c,cO(d))}).next(()=>({documents:a,Se:b}))}ve(f,d,e){if(d.isEmpty())return b.resolve();const h=IDBKeyRange.bound(d.first().path.toArray(),d.last().path.toArray()),c=d.getIterator();let a=c.getNext();return aT(f).jt({range:h},(f,h,b)=>{const d=g.fromSegments(f);for(;a&&g.comparator(a,d)<0;)e(a,null),a=c.getNext();a&&a.isEqual(d)&&(e(a,h),a=c.hasNext()?c.getNext():null),a?b.Lt(a.path.toArray()):b.done()}).next(()=>{for(;a;)e(a,null),a=c.hasNext()?c.getNext():null})}getDocumentsMatchingQuery(e,a,d){let c=aj();const f=a.path.length+1,b={};if(d.isEqual(k.min())){const c=a.path.toArray();b.range=IDBKeyRange.lowerBound(c)}else{const c=a.path.toArray(),e=jV(d);b.range=IDBKeyRange.lowerBound([c,e],!0),b.index=u.collectionReadTimeIndex}return aT(e).jt(b,(d,e,g)=>{if(d.length!==f)return;const b=jT(this.k,e);a.path.isPrefixOf(b.key.path)?bF(a,b)&&(c=c.insert(b.key,b)):g.done()}).next(()=>c)}newChangeBuffer(a){return new kY(this,!!a&&a.trackRemovals)}getSize(a){return this.getMetadata(a).next(a=>a.byteSize)}getMetadata(a){return kH(a).get(ag.key).next(a=>(j(!!a),a))}Re(a,b){return kH(a).put(ag.key,b)}be(b,a){if(a){const b=jT(this.k,a);if(!(b.isNoDocument()&&b.version.isEqual(k.min())))return b}return z.newInvalidDocument(b)}},kY=class extends kE{constructor(a,b){super(),this.De=a,this.trackRemovals=b,this.Ce=new bd(a=>a.toString(),(a,b)=>a.isEqual(b))}applyChanges(c){const a=[];let d=0,e=new v((a,b)=>m(a.canonicalString(),b.canonicalString()));return this.changes.forEach((b,f)=>{const g=this.Ce.get(b);if(f.document.isValidDocument()){const h=jU(this.De.k,f.document,this.getReadTime(b));e=e.add(b.path.popLast());const i=cO(h);d+=i-g,a.push(this.De.addEntry(c,b,h))}else if(d-=g,this.trackRemovals){const d=jU(this.De.k,z.newNoDocument(b,k.min()),this.getReadTime(b));a.push(this.De.addEntry(c,b,d))}else a.push(this.De.removeEntry(c,b))}),e.forEach(b=>{a.push(this.De.Jt.addToCollectionParentIndex(c,b))}),a.push(this.De.updateMetadata(c,d)),b.waitFor(a)}getFromCache(b,a){return this.De.Pe(b,a).next(b=>(this.Ce.set(a,b.size),b.document))}getAllFromCache(a,b){return this.De.Ve(a,b).next(({documents:a,Se:b})=>(b.forEach((a,b)=>{this.Ce.set(a,b)}),a))}};function kH(a){return V(a,ag.store)}function aT(a){return V(a,u.store)}function cI(a){return a.path.toArray()}kW=class{constructor(a){this.k=a}Nt(d,g,c,e){j(c<e&&c>=0&&e<=11);const f=new fd("createOrUpgrade",g);c<1&&e>=1&&(function(a){a.createObjectStore($.store)}(d),function(a){a.createObjectStore(ax.store,{keyPath:ax.keyPath}),a.createObjectStore(s.store,{keyPath:s.keyPath,autoIncrement:!0}).createIndex(s.userMutationsIndex,s.userMutationsKeyPath,{unique:!0}),a.createObjectStore(I.store)}(d),kL(d),function(a){a.createObjectStore(u.store)}(d));let a=b.resolve();return c<3&&e>=3&&(c!==0&&(!function(a){a.deleteObjectStore(H.store),a.deleteObjectStore(W.store),a.deleteObjectStore(Z.store)}(d),kL(d)),a=a.next(()=>function(a){const b=a.store(Z.store),c=new Z(0,0,k.min().toTimestamp(),0);return b.put(Z.key,c)}(f))),c<4&&e>=4&&(c!==0&&(a=a.next(()=>function(a,c){return c.store(s.store).Bt().next(d=>{a.deleteObjectStore(s.store),a.createObjectStore(s.store,{keyPath:s.keyPath,autoIncrement:!0}).createIndex(s.userMutationsIndex,s.userMutationsKeyPath,{unique:!0});const e=c.store(s.store),f=d.map(a=>e.put(a));return b.waitFor(f)})}(d,f))),a=a.next(()=>{!function(a){a.createObjectStore(an.store,{keyPath:an.keyPath})}(d)})),c<5&&e>=5&&(a=a.next(()=>this.Ne(f))),c<6&&e>=6&&(a=a.next(()=>(function(a){a.createObjectStore(ag.store)}(d),this.ke(f)))),c<7&&e>=7&&(a=a.next(()=>this.xe(f))),c<8&&e>=8&&(a=a.next(()=>this.$e(d,f))),c<9&&e>=9&&(a=a.next(()=>{!function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")}(d),function(b){const a=b.objectStore(u.store);a.createIndex(u.readTimeIndex,u.readTimeIndexPath,{unique:!1}),a.createIndex(u.collectionReadTimeIndex,u.collectionReadTimeIndexPath,{unique:!1})}(g)})),c<10&&e>=10&&(a=a.next(()=>this.Oe(f))),c<11&&e>=11&&(a=a.next(()=>{!function(a){a.createObjectStore(bC.store,{keyPath:bC.keyPath})}(d),function(a){a.createObjectStore(bp.store,{keyPath:bp.keyPath})}(d)})),a}ke(a){let b=0;return a.store(u.store).jt((c,a)=>{b+=cO(a)}).next(()=>{const c=new ag(b);return a.store(ag.store).put(ag.key,c)})}Ne(a){const c=a.store(ax.store),d=a.store(s.store);return c.Bt().next(c=>b.forEach(c,c=>{const e=IDBKeyRange.bound([c.userId,-1],[c.userId,c.lastAcknowledgedBatchId]);return d.Bt(s.userMutationsIndex,e).next(d=>b.forEach(d,b=>{j(b.userId===c.userId);const d=bb(this.k,b);return kk(a,c.userId,d).next(()=>{})}))}))}xe(a){const c=a.store(H.store),d=a.store(u.store);return a.store(Z.store).get(Z.key).next(e=>{const a=[];return d.jt((f,h)=>{const d=new q(f),g=function(a){return[0,ab(a)]}(d);a.push(c.get(g).next(a=>a?b.resolve():(a=>c.put(new H(0,ab(a),e.highestListenSequenceNumber)))(d)))}).next(()=>b.waitFor(a))})}$e(c,a){c.createObjectStore(aW.store,{keyPath:aW.keyPath});const d=a.store(aW.store),e=new ft,b=a=>{if(e.add(a)){const b=a.lastSegment(),c=a.popLast();return d.put({collectionId:b,parent:ab(c)})}};return a.store(u.store).jt({Kt:!0},(a,d)=>{const c=new q(a);return b(c.popLast())}).next(()=>a.store(I.store).jt({Kt:!0},([d,a,e],f)=>{const c=ao(a);return b(c.popLast())}))}Oe(b){const a=b.store(W.store);return a.jt((e,b)=>{const c=bT(b),d=j$(this.k,c);return a.put(d)})}};function kL(a){a.createObjectStore(H.store,{keyPath:H.keyPath}).createIndex(H.documentTargetsIndex,H.documentTargetsKeyPath,{unique:!0}),a.createObjectStore(W.store,{keyPath:W.keyPath}).createIndex(W.queryTargetsIndexName,W.queryTargetsKeyPath,{unique:!0}),a.createObjectStore(Z.store)}fL="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",kN=class{constructor(e,b,f,l,g,h,i,j,k,c){if(this.allowTabSynchronization=e,this.persistenceKey=b,this.clientId=f,this.Me=g,this.window=h,this.document=i,this.Fe=k,this.Le=c,this.Be=null,this.Ue=!1,this.isPrimary=!1,this.networkEnabled=!0,this.qe=null,this.inForeground=!1,this.Ke=null,this.je=null,this.Qe=Number.NEGATIVE_INFINITY,this.We=a=>Promise.resolve(),!kN.Pt())throw new d(a.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new lc(this,l),this.Ge=b+"main",this.k=new jS(j),this.ze=new ay(this.Ge,11,new kW(this.k)),this.He=new lo(this.referenceDelegate,this.k),this.Jt=new lp,this.Je=function(a,b){return new lb(a,b)}(this.k,this.Jt),this.Ye=new lw,this.window&&this.window.localStorage?this.Xe=this.window.localStorage:(this.Xe=null,c===!1&&R("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ze().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new d(a.FAILED_PRECONDITION,fL);return this.tn(),this.en(),this.nn(),this.runTransaction("getHighestListenSequenceNumber","readonly",a=>this.He.getHighestSequenceNumber(a))}).then(a=>{this.Be=new ac(a,this.Fe)}).then(()=>{this.Ue=!0}).catch(a=>(this.ze&&this.ze.close(),Promise.reject(a)))}sn(a){return this.We=async b=>{if(this.started)return a(b)},a(this.isPrimary)}setDatabaseDeletedListener(a){this.ze.xt(async b=>{b.newVersion===null&&await a()})}setNetworkEnabled(a){this.networkEnabled!==a&&(this.networkEnabled=a,this.Me.enqueueAndForget(async()=>{this.started&&await this.Ze()}))}Ze(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",a=>cB(a).put(new an(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.rn(a).next(a=>{a||(this.isPrimary=!1,this.Me.enqueueRetryable(()=>this.We(!1)))})}).next(()=>this.on(a)).next(b=>this.isPrimary&&!b?this.cn(a).next(()=>!1):!!b&&this.an(a).next(()=>!0))).catch(a=>{if(aQ(a))return c("IndexedDbPersistence","Failed to extend owner lease: ",a),this.isPrimary;if(!this.allowTabSynchronization)throw a;return c("IndexedDbPersistence","Releasing owner lease after error during lease refresh",a),!1}).then(a=>{this.isPrimary!==a&&this.Me.enqueueRetryable(()=>this.We(a)),this.isPrimary=a})}rn(a){return cp(a).get($.key).next(a=>b.resolve(this.un(a)))}hn(a){return cB(a).delete(this.clientId)}async ln(){if(this.isPrimary&&!this.fn(this.Qe,18e5)){this.Qe=Date.now();const a=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",c=>{const a=V(c,an.store);return a.Bt().next(c=>{const e=this.dn(c,18e5),d=c.filter(a=>e.indexOf(a)===-1);return b.forEach(d,b=>a.delete(b.clientId)).next(()=>d)})}).catch(()=>[]);if(this.Xe)for(const b of a)this.Xe.removeItem(this.wn(b.clientId))}}nn(){this.je=this.Me.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ze().then(()=>this.ln()).then(()=>this.nn()))}un(a){return!!a&&a.ownerId===this.clientId}on(e){return this.Le?b.resolve(!0):cp(e).get($.key).next(b=>{if(b!==null&&this.fn(b.leaseTimestampMs,5e3)&&!this._n(b.ownerId)){if(this.un(b)&&this.networkEnabled)return!0;if(!this.un(b)){if(!b.allowTabSynchronization)throw new d(a.FAILED_PRECONDITION,fL);return!1}}return!(!this.networkEnabled||!this.inForeground)||cB(e).Bt().next(a=>this.dn(a,5e3).find(a=>{if(this.clientId!==a.clientId){const b=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,d=this.networkEnabled===a.networkEnabled;if(b||c&&d)return!0}return!1})===void 0)}).next(a=>(this.isPrimary!==a&&c("IndexedDbPersistence",`Client ${a?"is":"is not"} eligible for a primary lease.`),a))}async shutdown(){this.Ue=!1,this.mn(),this.je&&(this.je.cancel(),this.je=null),this.gn(),this.yn(),await this.ze.runTransaction("shutdown","readwrite",[$.store,an.store],b=>{const a=new jN(b,ac.I);return this.cn(a).next(()=>this.hn(a))}),this.ze.close(),this.pn()}dn(a,b){return a.filter(a=>this.fn(a.updateTimeMs,b)&&!this._n(a.clientId))}Tn(){return this.runTransaction("getActiveClients","readonly",a=>cB(a).Bt().next(a=>this.dn(a,18e5).map(a=>a.clientId)))}get started(){return this.Ue}getMutationQueue(a){return km.Xt(a,this.k,this.Jt,this.referenceDelegate)}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getIndexManager(){return this.Jt}getBundleCache(){return this.Ye}runTransaction(e,f,g){c("IndexedDbPersistence","Starting transaction:",e);const h=f==="readonly"?"readonly":"readwrite";let b;return this.ze.runTransaction(e,h,lF,c=>(b=new jN(c,this.Be?this.Be.next():ac.I),f==="readwrite-primary"?this.rn(b).next(a=>!!a||this.on(b)).next(c=>{if(!c)throw R(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Me.enqueueRetryable(()=>this.We(!1)),new d(a.FAILED_PRECONDITION,jB);return g(b)}).next(a=>this.an(b).next(()=>a)):this.En(b).next(()=>g(b)))).then(a=>(b.raiseOnCommittedEvent(),a))}En(b){return cp(b).get($.key).next(b=>{if(b!==null&&this.fn(b.leaseTimestampMs,5e3)&&!this._n(b.ownerId)&&!this.un(b)&&!(this.Le||this.allowTabSynchronization&&b.allowTabSynchronization))throw new d(a.FAILED_PRECONDITION,fL)})}an(a){const b=new $(this.clientId,this.allowTabSynchronization,Date.now());return cp(a).put($.key,b)}static Pt(){return ay.Pt()}cn(d){const a=cp(d);return a.get($.key).next(d=>this.un(d)?(c("IndexedDbPersistence","Releasing primary lease."),a.delete($.key)):b.resolve())}fn(a,c){const b=Date.now();return!(a<b-c)&&(!(a>b)||(R(`Detected an update time that is in the future: ${a} > ${b}`),!1))}tn(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ke=()=>{this.Me.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ze()))},this.document.addEventListener("visibilitychange",this.Ke),this.inForeground=this.document.visibilityState==="visible")}gn(){this.Ke&&(this.document.removeEventListener("visibilitychange",this.Ke),this.Ke=null)}en(){var a;typeof((a=this.window)===null||a===void 0?void 0:a.addEventListener)=="function"&&(this.qe=()=>{this.mn(),rS()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Me.enterRestrictedMode(!0),this.Me.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.qe))}yn(){this.qe&&(this.window.removeEventListener("pagehide",this.qe),this.qe=null)}_n(b){var a;try{const d=((a=this.Xe)===null||a===void 0?void 0:a.getItem(this.wn(b)))!==null;return c("IndexedDbPersistence",`Client '${b}' ${d?"is":"is not"} zombied in LocalStorage`),d}catch(a){return R("IndexedDbPersistence","Failed to get zombied client id.",a),!1}}mn(){if(this.Xe)try{this.Xe.setItem(this.wn(this.clientId),String(Date.now()))}catch(a){R("Failed to set zombie client id.",a)}}pn(){if(this.Xe)try{this.Xe.removeItem(this.wn(this.clientId))}catch(a){}}wn(a){return`firestore_zombie_${this.persistenceKey}_${a}`}};function cp(a){return V(a,$.store)}function cB(a){return V(a,an.store)}function kV(a,c){let b=a.projectId;return a.isDefaultDatabase||(b+="."+a.database),"firestore/"+c+"/"+b+"/"}kR=class{constructor(a,b,c){this.Je=a,this.An=b,this.Jt=c}Rn(a,b){return this.An.getAllMutationBatchesAffectingDocumentKey(a,b).next(c=>this.bn(a,b,c))}bn(a,b,c){return this.Je.getEntry(a,b).next(a=>{for(const b of c)b.applyToLocalView(a);return a})}Pn(a,b){a.forEach((c,a)=>{for(const c of b)c.applyToLocalView(a)})}vn(a,b){return this.Je.getEntries(a,b).next(b=>this.Vn(a,b).next(()=>b))}Vn(b,a){return this.An.getAllMutationBatchesAffectingDocumentKeys(b,a).next(b=>this.Pn(a,b))}getDocumentsMatchingQuery(b,a,c){return function(a){return g.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(a)?this.Sn(b,a.path):hf(a)?this.Dn(b,a,c):this.Cn(b,a,c)}Sn(a,b){return this.Rn(a,new g(b)).next(a=>{let b=fO();return a.isFoundDocument()&&(b=b.insert(a.key,a)),b})}Dn(c,d,f){const e=d.collectionGroup;let a=fO();return this.Jt.getCollectionParents(c,e).next(g=>b.forEach(g,b=>{const g=function(a,b){return new bS(b,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}(d,b.child(e));return this.Cn(c,g,f).next(b=>{b.forEach((b,c)=>{a=a.insert(b,c)})})}).next(()=>a))}Cn(b,c,e){let a,d;return this.Je.getDocumentsMatchingQuery(b,c,e).next(d=>(a=d,this.An.getAllMutationBatchesAffectingQuery(b,c))).next(c=>(d=c,this.Nn(b,d,a).next(b=>{a=b;for(const b of d)for(const e of b.mutations){const d=e.key;let c=a.get(d);c==null&&(c=z.newInvalidDocument(d),a=a.insert(d,c)),fc(e,c,b.localWriteTime),c.isFoundDocument()||(a=a.remove(d))}}))).next(()=>(a.forEach((b,d)=>{bF(c,d)||(a=a.remove(b))}),a))}Nn(d,e,c){let a=r();for(const b of e)for(const d of b.mutations)d instanceof bY&&c.get(d.key)===null&&(a=a.add(d.key));let b=c;return this.Je.getEntries(d,a).next(a=>(a.forEach((c,a)=>{a.isFoundDocument()&&(b=b.insert(c,a))}),b))}},kS=class{constructor(a,b,c,d){this.targetId=a,this.fromCache=b,this.kn=c,this.xn=d}static $n(d,c){let a=r(),b=r();for(const d of c.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:b=b.add(d.doc.key)}return new kS(d,c.fromCache,a,b)}},iF=class{On(a){this.Mn=a}getDocumentsMatchingQuery(b,a,d,e){return function(a){return a.filters.length===0&&a.limit===null&&a.startAt==null&&a.endAt==null&&(a.explicitOrderBy.length===0||a.explicitOrderBy.length===1&&a.explicitOrderBy[0].field.isKeyField())}(a)||d.isEqual(k.min())?this.Fn(b,a):this.Mn.vn(b,e).next(g=>{const f=this.Ln(a,g);return(dT(a)||dU(a))&&this.Bn(a.limitType,f,e,d)?this.Fn(b,a):(fw()<=n.DEBUG&&c("QueryEngine","Re-using previous result from %s to execute query: %s",d.toString(),em(a)),this.Mn.getDocumentsMatchingQuery(b,a,d).next(a=>(f.forEach(b=>{a=a.insert(b.key,b)}),a)))})}Ln(b,c){let a=new v(hn(b));return c.forEach((d,c)=>{bF(b,c)&&(a=a.add(c))}),a}Bn(c,a,d,e){if(d.size!==a.size)return!0;const b=c==="F"?a.last():a.first();return!!b&&(b.hasPendingWrites||b.version.compareTo(e)>0)}Fn(b,a){return fw()<=n.DEBUG&&c("QueryEngine","Using full collection scan to execute query:",em(a)),this.Mn.getDocumentsMatchingQuery(b,a,k.min())}},kU=class{constructor(a,b,c,d){this.persistence=a,this.Un=b,this.k=d,this.qn=new N(m),this.Kn=new bd(a=>cc(a),dw),this.jn=k.min(),this.An=a.getMutationQueue(c),this.Qn=a.getRemoteDocumentCache(),this.He=a.getTargetCache(),this.Wn=new kR(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=a.getBundleCache(),this.Un.On(this.Wn)}collectGarbage(a){return this.persistence.runTransaction("Collect garbage","readwrite-primary",b=>a.collect(b,this.qn))}};function kQ(a,b,c,d){return new kU(a,b,c,d)}async function kK(d,e){const a=i(d);let b=a.An,c=a.Wn;const f=await a.persistence.runTransaction("Handle user change","readonly",d=>{let f;return a.An.getAllMutationBatches(d).next(g=>(f=g,b=a.persistence.getMutationQueue(e),c=new kR(a.Qn,b,a.persistence.getIndexManager()),b.getAllMutationBatches(d))).next(g=>{const b=[],e=[];let a=r();for(const c of f){b.push(c.batchId);for(const b of c.mutations)a=a.add(b.key)}for(const b of g){e.push(b.batchId);for(const c of b.mutations)a=a.add(c.key)}return c.vn(d,a).next(a=>({Gn:a,removedBatchIds:b,addedBatchIds:e}))})});return a.An=b,a.Wn=c,a.Un.On(a.Wn),f}function kX(d,c){const a=i(d);return a.persistence.runTransaction("Acknowledge batch","readwrite-primary",d=>{const f=c.batch.keys(),e=a.Qn.newChangeBuffer({trackRemovals:!0});return function(h,e,a,f){const d=a.batch,g=d.keys();let c=b.resolve();return g.forEach(b=>{c=c.next(()=>f.getEntry(e,b)).next(c=>{const e=a.docVersions.get(b);j(e!==null),c.version.compareTo(e)<0&&(d.applyToRemoteDocument(c,a),c.isValidDocument()&&f.addEntry(c,a.commitVersion))})}),c.next(()=>h.An.removeMutationBatch(e,d))}(a,d,c,e).next(()=>e.apply(d)).next(()=>a.An.performConsistencyCheck(d)).next(()=>a.Wn.vn(d,f))})}function kG(b){const a=i(b);return a.persistence.runTransaction("Get last remote snapshot version","readonly",b=>a.He.getLastRemoteSnapshotVersion(b))}function kZ(f,c){const a=i(f),e=c.snapshotVersion;let d=a.qn;return a.persistence.runTransaction("Apply remote event","readwrite-primary",f=>{const i=a.Qn.newChangeBuffer({trackRemovals:!0});d=a.qn;const g=[];c.targetChanges.forEach((h,i)=>{const j=d.get(i);if(!j)return;g.push(a.He.removeMatchingKeys(f,h.removedDocuments,i).next(()=>a.He.addMatchingKeys(f,h.addedDocuments,i)));let b=j.withSequenceNumber(f.currentSequenceNumber);c.targetMismatches.has(i)?b=b.withResumeToken(D.EMPTY_BYTE_STRING,k.min()).withLastLimboFreeSnapshotVersion(k.min()):h.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(h.resumeToken,e)),d=d.insert(i,b),function(b,c,a){return b.resumeToken.approximateByteSize()===0||(c.snapshotVersion.toMicroseconds()-b.snapshotVersion.toMicroseconds()>=3e8||a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size>0)}(j,b,h)&&g.push(a.He.updateTargetData(f,b))});let h=aj();if(c.documentUpdates.forEach((b,d)=>{c.resolvedLimboDocuments.has(b)&&g.push(a.persistence.referenceDelegate.updateLimboDocument(f,b))}),g.push(k_(f,i,c.documentUpdates,e,void 0).next(a=>{h=a})),!e.isEqual(k.min())){const b=a.He.getLastRemoteSnapshotVersion(f).next(b=>a.He.setTargetsMetadata(f,f.currentSequenceNumber,e));g.push(b)}return b.waitFor(g).next(()=>i.apply(f)).next(()=>a.Wn.Vn(f,h)).next(()=>h)}).then(b=>(a.qn=d,b))}function k_(f,a,d,g,e){let b=r();return d.forEach(a=>b=b.add(a)),a.getEntries(f,b).next(f=>{let b=aj();return d.forEach((h,d)=>{const i=f.get(h),j=(e==null?void 0:e.get(h))||g;d.isNoDocument()&&d.version.isEqual(k.min())?(a.removeEntry(h,j),b=b.insert(h,d)):!i.isValidDocument()||d.version.compareTo(i.version)>0||d.version.compareTo(i.version)===0&&i.hasPendingWrites?(a.addEntry(d,j),b=b.insert(h,d)):c("LocalStore","Ignoring outdated watch update for ",h,". Current version:",i.version," Watch version:",d.version)}),b})}function k$(c,a){const b=i(c);return b.persistence.runTransaction("Get next mutation batch","readonly",c=>(a===void 0&&(a=-1),b.An.getNextMutationBatchAfterBatchId(c,a)))}function la(d,c){const a=i(d);return a.persistence.runTransaction("Allocate target","readwrite",e=>{let d;return a.He.getTargetData(e,c).next(f=>f?(d=f,b.resolve(d)):a.He.allocateTargetId(e).next(b=>(d=new aS(c,b,0,e.currentSequenceNumber),a.He.addTargetData(e,d).next(()=>d))))}).then(b=>{const d=a.qn.get(b.targetId);return(d===null||b.snapshotVersion.compareTo(d.snapshotVersion)>0)&&(a.qn=a.qn.insert(b.targetId,b),a.Kn.set(c,b.targetId)),b})}async function fF(f,b,d){const a=i(f),e=a.qn.get(b),g=d?"readwrite":"readwrite-primary";try{d||await a.persistence.runTransaction("Release target",g,b=>a.persistence.referenceDelegate.removeTarget(b,e))}catch(a){if(!aQ(a))throw a;c("LocalStore",`Failed to update sequence numbers for target ${b}: ${a}`)}a.qn=a.qn.remove(b),a.Kn.delete(e.target)}function kB(g,d,e){const a=i(g);let f=k.min(),c=r();return a.persistence.runTransaction("Execute query","readonly",g=>function(e,f,c){const a=i(e),d=a.Kn.get(c);return d!==void 0?b.resolve(a.qn.get(d)):a.He.getTargetData(f,c)}(a,g,am(d)).next(b=>{if(b)return f=b.lastLimboFreeSnapshotVersion,a.He.getMatchingKeysForTargetId(g,b.targetId).next(a=>{c=a})}).next(()=>a.Un.getDocumentsMatchingQuery(g,d,e?f:k.min(),e?c:r())).next(a=>({documents:a,zn:c})))}async function ld(b){const a=i(b);return a.persistence.runTransaction("Synchronize last document change read time","readonly",a=>function(b){const c=aT(b);let a=k.min();return c.jt({index:u.readTimeIndex,reverse:!0},(d,b,c)=>{b.readTime&&(a=lx(b.readTime)),c.done()}).next(()=>a)}(a)).then(b=>{a.jn=b})}le=class{constructor(a){this.k=a,this.Xn=new Map,this.Zn=new Map}getBundleMetadata(c,a){return b.resolve(this.Xn.get(a))}saveBundleMetadata(d,c){var a;return this.Xn.set(c.id,{id:(a=c).id,version:a.version,createTime:X(a.createTime)}),b.resolve()}getNamedQuery(c,a){return b.resolve(this.Zn.get(a))}saveNamedQuery(c,a){return this.Zn.set(a.name,function(a){return{name:a.name,query:ka(a.bundledQuery),readTime:X(a.readTime)}}(a)),b.resolve()}},fD=class{constructor(){this.ts=new v(A.es),this.ns=new v(A.ss)}isEmpty(){return this.ts.isEmpty()}addReference(b,c){const a=new A(b,c);this.ts=this.ts.add(a),this.ns=this.ns.add(a)}rs(a,b){a.forEach(a=>this.addReference(a,b))}removeReference(a,b){this.os(new A(a,b))}cs(a,b){a.forEach(a=>this.removeReference(a,b))}us(a){const b=new g(new q([])),d=new A(b,a),e=new A(b,a+1),c=[];return this.ns.forEachInRange([d,e],a=>{this.os(a),c.push(a.key)}),c}hs(){this.ts.forEach(a=>this.os(a))}os(a){this.ts=this.ts.delete(a),this.ns=this.ns.delete(a)}ls(b){const c=new g(new q([])),d=new A(c,b),e=new A(c,b+1);let a=r();return this.ns.forEachInRange([d,e],b=>{a=a.add(b.key)}),a}containsKey(a){const c=new A(a,0),b=this.ts.firstAfterOrEqual(c);return b!==null&&a.isEqual(b.key)}},A=class{constructor(a,b){this.key=a,this.fs=b}static es(a,b){return g.comparator(a.key,b.key)||m(a.fs,b.fs)}static ss(a,b){return m(a.fs,b.fs)||g.comparator(a.key,b.key)}},lh=class{constructor(a,b){this.Jt=a,this.referenceDelegate=b,this.An=[],this.ds=1,this.ws=new v(A.es)}checkEmpty(a){return b.resolve(this.An.length===0)}addMutationBatch(e,f,g,a){const c=this.ds;this.ds++,this.An.length>0&&this.An[this.An.length-1];const d=new fm(c,f,g,a);this.An.push(d);for(const b of a)this.ws=this.ws.add(new A(b.key,c)),this.Jt.addToCollectionParentIndex(e,b.key.path.popLast());return b.resolve(d)}lookupMutationBatch(c,a){return b.resolve(this._s(a))}getNextMutationBatchAfterBatchId(f,d){const e=d+1,a=this.gs(e),c=a<0?0:a;return b.resolve(this.An.length>c?this.An[c]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.An.length===0?-1:this.ds-1)}getAllMutationBatches(a){return b.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(f,a){const d=new A(a,0),e=new A(a,Number.POSITIVE_INFINITY),c=[];return this.ws.forEachInRange([d,e],a=>{const b=this._s(a.fs);c.push(b)}),b.resolve(c)}getAllMutationBatchesAffectingDocumentKeys(d,c){let a=new v(m);return c.forEach(b=>{const c=new A(b,0),d=new A(b,Number.POSITIVE_INFINITY);this.ws.forEachInRange([c,d],b=>{a=a.add(b.fs)})}),b.resolve(this.ys(a))}getAllMutationBatchesAffectingQuery(i,e){const d=e.path,f=d.length+1;let a=d;g.isDocumentKey(a)||(a=a.child(""));const h=new A(new g(a),0);let c=new v(m);return this.ws.forEachWhile(a=>{const b=a.key.path;return!!d.isPrefixOf(b)&&(b.length===f&&(c=c.add(a.fs)),!0)},h),b.resolve(this.ys(c))}ys(b){const a=[];return b.forEach(c=>{const b=this._s(c);b!==null&&a.push(b)}),a}removeMutationBatch(d,a){j(this.ps(a.batchId,"removed")===0),this.An.shift();let c=this.ws;return b.forEach(a.mutations,b=>{const e=new A(b.key,a.batchId);return c=c.delete(e),this.referenceDelegate.markPotentiallyOrphaned(d,b.key)}).next(()=>{this.ws=c})}ee(a){}containsKey(e,a){const d=new A(a,0),c=this.ws.firstAfterOrEqual(d);return b.resolve(a.isEqual(c&&c.key))}performConsistencyCheck(a){return this.An.length,b.resolve()}ps(a,b){return this.gs(a)}gs(a){return this.An.length===0?0:a-this.An[0].batchId}_s(b){const a=this.gs(b);return a<0||a>=this.An.length?null:this.An[a]}},li=class{constructor(a,b){this.Jt=a,this.Ts=b,this.docs=new N(g.comparator),this.size=0}addEntry(g,a,e){const b=a.key,d=this.docs.get(b),f=d?d.size:0,c=this.Ts(a);return this.docs=this.docs.insert(b,{document:a.mutableCopy(),size:c,readTime:e}),this.size+=c-f,this.Jt.addToCollectionParentIndex(g,b.path.popLast())}removeEntry(a){const b=this.docs.get(a);b&&(this.docs=this.docs.remove(a),this.size-=b.size)}getEntry(d,a){const c=this.docs.get(a);return b.resolve(c?c.document.mutableCopy():z.newInvalidDocument(a))}getEntries(d,c){let a=aj();return c.forEach(b=>{const c=this.docs.get(b);a=a.insert(b,c?c.document.mutableCopy():z.newInvalidDocument(b))}),b.resolve(a)}getDocumentsMatchingQuery(h,a,e){let c=aj();const f=new g(a.path.child("")),d=this.docs.getIteratorFrom(f);for(;d.hasNext();){const{key:f,value:{document:b,readTime:g}}=d.getNext();if(!a.path.isPrefixOf(f.path))break;g.compareTo(e)<=0||bF(a,b)&&(c=c.insert(b.key,b.mutableCopy()))}return b.resolve(c)}Es(c,a){return b.forEach(this.docs,b=>a(b))}newChangeBuffer(a){return new lj(this)}getSize(a){return b.resolve(this.size)}},lj=class extends kE{constructor(a){super(),this.De=a}applyChanges(c){const a=[];return this.changes.forEach((b,d)=>{d.document.isValidDocument()?a.push(this.De.addEntry(c,d.document,this.getReadTime(b))):this.De.removeEntry(b)}),b.waitFor(a)}getFromCache(a,b){return this.De.getEntry(a,b)}getAllFromCache(a,b){return this.De.getEntries(a,b)}},lk=class{constructor(a){this.persistence=a,this.Is=new bd(a=>cc(a),dw),this.lastRemoteSnapshotVersion=k.min(),this.highestTargetId=0,this.As=0,this.Rs=new fD,this.targetCount=0,this.bs=bB.ie()}forEachTarget(c,a){return this.Is.forEach((c,b)=>a(b)),b.resolve()}getLastRemoteSnapshotVersion(a){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(a){return b.resolve(this.As)}allocateTargetId(a){return this.highestTargetId=this.bs.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(d,a,c){return c&&(this.lastRemoteSnapshotVersion=c),a>this.As&&(this.As=a),b.resolve()}ae(a){this.Is.set(a.target,a);const b=a.targetId;b>this.highestTargetId&&(this.bs=new bB(b),this.highestTargetId=b),a.sequenceNumber>this.As&&(this.As=a.sequenceNumber)}addTargetData(c,a){return this.ae(a),this.targetCount+=1,b.resolve()}updateTargetData(c,a){return this.ae(a),b.resolve()}removeTargetData(c,a){return this.Is.delete(a.target),this.Rs.us(a.targetId),this.targetCount-=1,b.resolve()}removeTargets(d,e,f){let a=0;const c=[];return this.Is.forEach((g,b)=>{b.sequenceNumber<=e&&f.get(b.targetId)===null&&(this.Is.delete(g),c.push(this.removeMatchingKeysForTargetId(d,b.targetId)),a++)}),b.waitFor(c).next(()=>a)}getTargetCount(a){return b.resolve(this.targetCount)}getTargetData(d,a){const c=this.Is.get(a)||null;return b.resolve(c)}addMatchingKeys(d,a,c){return this.Rs.rs(a,c),b.resolve()}removeMatchingKeys(e,a,f){this.Rs.cs(a,f);const c=this.persistence.referenceDelegate,d=[];return c&&a.forEach(a=>{d.push(c.markPotentiallyOrphaned(e,a))}),b.waitFor(d)}removeMatchingKeysForTargetId(c,a){return this.Rs.us(a),b.resolve()}getMatchingKeysForTargetId(d,a){const c=this.Rs.ls(a);return b.resolve(c)}containsKey(c,a){return b.resolve(this.Rs.containsKey(a))}},ll=class{constructor(a,b){this.Ps={},this.Be=new ac(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=a(this),this.He=new lk(this),this.Jt=new lr,this.Je=function(a,b){return new li(a,b)}(this.Jt,a=>this.referenceDelegate.vs(a)),this.k=new jS(b),this.Ye=new le(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(b){let a=this.Ps[b.toKey()];return a||(a=new lh(this.Jt,this.referenceDelegate),this.Ps[b.toKey()]=a),a}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(b,e,d){c("MemoryPersistence","Starting transaction:",b);const a=new lm(this.Be.next());return this.referenceDelegate.Vs(),d(a).next(b=>this.referenceDelegate.Ss(a).next(()=>b)).toPromise().then(b=>(a.raiseOnCommittedEvent(),b))}Ds(a,c){return b.or(Object.values(this.Ps).map(b=>()=>b.containsKey(a,c)))}},lm=class extends jC{constructor(a){super(),this.currentSequenceNumber=a}},ky=class{constructor(a){this.persistence=a,this.Cs=new fD,this.Ns=null}static ks(a){return new ky(a)}get xs(){if(this.Ns)return this.Ns;throw f()}addReference(d,c,a){return this.Cs.addReference(a,c),this.xs.delete(a.toString()),b.resolve()}removeReference(d,c,a){return this.Cs.removeReference(a,c),this.xs.add(a.toString()),b.resolve()}markPotentiallyOrphaned(c,a){return this.xs.add(a.toString()),b.resolve()}removeTarget(b,a){this.Cs.us(a.targetId).forEach(a=>this.xs.add(a.toString()));const c=this.persistence.getTargetCache();return c.getMatchingKeysForTargetId(b,a.targetId).next(a=>{a.forEach(a=>this.xs.add(a.toString()))}).next(()=>c.removeTargetData(b,a))}Vs(){this.Ns=new Set}Ss(a){const c=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.xs,d=>{const b=g.fromPath(d);return this.$s(a,b).next(a=>{a||c.removeEntry(b)})}).next(()=>(this.Ns=null,c.apply(a)))}updateLimboDocument(b,a){return this.$s(b,a).next(b=>{b?this.xs.delete(a.toString()):this.xs.add(a.toString())})}vs(a){return 0}$s(c,a){return b.or([()=>b.resolve(this.Cs.containsKey(a)),()=>this.persistence.getTargetCache().containsKey(c,a),()=>this.persistence.Ds(c,a)])}},ks=class{constructor(){this.activeTargetIds=io()}Fs(a){this.activeTargetIds=this.activeTargetIds.add(a)}Ls(a){this.activeTargetIds=this.activeTargetIds.delete(a)}Ms(){const a={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(a)}},kg=class{constructor(){this.pi=new ks,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(a){}updateMutationState(a,b,c){}addLocalQueryTarget(a){return this.pi.Fs(a),this.Ti[a]||"not-current"}updateQueryState(a,b,c){this.Ti[a]=b}removeLocalQueryTarget(a){this.pi.Ls(a)}isLocalQueryTarget(a){return this.pi.activeTargetIds.has(a)}clearQueryState(a){delete this.Ti[a]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(a){return this.pi.activeTargetIds.has(a)}start(){return this.pi=new ks,Promise.resolve()}handleUserChange(a,b,c){}setOnlineState(a){}shutdown(){}writeSequenceNumber(a){}notifyBundleLoaded(){}},lq=class{Ei(a){}shutdown(){}},ke=class{constructor(){this.Ii=()=>this.Ai(),this.Ri=()=>this.bi(),this.Pi=[],this.vi()}Ei(a){this.Pi.push(a)}shutdown(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}Ai(){c("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const a of this.Pi)a(0)}bi(){c("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const a of this.Pi)a(1)}static Pt(){return typeof window!="undefined"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}},ls={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},lt=class{constructor(a){this.Vi=a.Vi,this.Si=a.Si}Di(a){this.Ci=a}Ni(a){this.ki=a}onMessage(a){this.xi=a}close(){this.Si()}send(a){this.Vi(a)}$i(){this.Ci()}Oi(a){this.ki(a)}Mi(a){this.xi(a)}},lu=class extends class{constructor(a){this.databaseInfo=a,this.databaseId=a.databaseId;const b=a.ssl?"https":"http";this.Fi=b+"://"+a.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(a,f,b,g,h){const d=this.Ui(a,f);c("RestConnection","Sending: ",d,b);const e={};return this.qi(e,g,h),this.Ki(a,d,e,b).then(a=>(c("RestConnection","Received: ",a),a),c=>{throw fZ("RestConnection",`${a} failed with error: `,c,"url: ",d,"request:",b),c})}ji(a,b,c,d,e){return this.Bi(a,b,c,d,e)}qi(a,b,c){a["X-Goog-Api-Client"]="gl-js/ fire/"+bi,a["Content-Type"]="text/plain",this.databaseInfo.appId&&(a["X-Firebase-GMPID"]=this.databaseInfo.appId),b&&b.headers.forEach((b,c)=>a[c]=b),c&&c.headers.forEach((b,c)=>a[c]=b)}Ui(a,b){const c=ls[a];return`${this.Fi}/v1/${b}:${c}`}}{constructor(a){super(a),this.forceLongPolling=a.forceLongPolling,this.autoDetectLongPolling=a.autoDetectLongPolling,this.useFetchStreams=a.useFetchStreams}Ki(b,e,g,h){return new Promise((k,j)=>{const i=new nD;i.listenOnce(nK.COMPLETE,()=>{try{switch(i.getLastErrorCode()){case fl.NO_ERROR:const e=i.getResponseJson();c("Connection","XHR received:",JSON.stringify(e)),k(e);break;case fl.TIMEOUT:c("Connection",'RPC "'+b+'" timed out'),j(new d(a.DEADLINE_EXCEEDED,"Request time out"));break;case fl.HTTP_ERROR:const g=i.getStatus();if(c("Connection",'RPC "'+b+'" failed with status:',g,"response text:",i.getResponseText()),g>0){const b=i.getResponseJson().error;if(b&&b.status&&b.message){const c=function(c){const b=c.toLowerCase().replace(/_/g,"-");return Object.values(a).indexOf(b)>=0?b:a.UNKNOWN}(b.status);j(new d(c,b.message))}else j(new d(a.UNKNOWN,"Server responded with status "+i.getStatus()))}else j(new d(a.UNAVAILABLE,"Connection failed."));break;default:f()}}finally{c("Connection",'RPC "'+b+'" completed.')}});const l=JSON.stringify(h);i.send(e,"POST",l,g,15)})}Qi(q,p,o){const n=[this.Fi,"/","google.firestore.v1.Firestore","/",q,"/channel"],m=nP(),l=nO(),g={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(g.xmlHttpFactory=new nE({})),this.qi(g.initMessageHeaders,p,o),sk()||se()||sd()||r$()||rU()||si()||(g.httpHeadersOverwriteParam="$httpHeaders");const i=n.join("");c("Connection","Creating WebChannel: "+i,g);const e=m.createWebChannel(i,g);let k=!1,b=!1;const f=new lt({Vi:a=>{b?c("Connection","Not sending because WebChannel is closed:",a):(k||(c("Connection","Opening WebChannel transport."),e.open(),k=!0),c("Connection","WebChannel sending:",a),e.send(a))},Si:()=>e.close()}),h=(a,b,c)=>{a.listen(b,a=>{try{c(a)}catch(a){setTimeout(()=>{throw a},0)}})};return h(e,cU.EventType.OPEN,()=>{b||c("Connection","WebChannel transport opened.")}),h(e,cU.EventType.CLOSE,()=>{b||(b=!0,c("Connection","WebChannel transport closed"),f.Oi())}),h(e,cU.EventType.ERROR,c=>{b||(b=!0,fZ("Connection","WebChannel transport errored:",c),f.Oi(new d(a.UNAVAILABLE,"The operation could not be completed")))}),h(e,cU.EventType.MESSAGE,h=>{var g;if(!b){const k=h.data[0];j(!!k);const l=k,i=l.error||((g=l[0])===null||g===void 0?void 0:g.error);if(i){c("Connection","WebChannel received error:",i);const h=i.status;let g=function(b){const a=w[b];if(a!==void 0)return hZ(a)}(h),j=i.message;g===void 0&&(g=a.INTERNAL,j="Unknown error status: "+h+" with message "+i.message),b=!0,f.Oi(new d(g,j)),e.close()}else c("Connection","WebChannel received:",k),f.Mi(k)}}),h(l,nI.STAT_EVENT,a=>{a.stat===gb.PROXY?c("Connection","Detected buffering proxy"):a.stat===gb.NOPROXY&&c("Connection","Detected no buffering proxy")}),setTimeout(()=>{f.$i()},0),f}};function lv(){return typeof window!="undefined"?window:null}function cS(){return typeof document!="undefined"?document:null}function cV(a){return new mb(a,!0)}jJ=class{constructor(a,b,c=1e3,d=1.5,e=6e4){this.Me=a,this.timerId=b,this.Wi=c,this.Gi=d,this.zi=e,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(e){this.cancel();const b=Math.floor(this.Hi+this.tr()),d=Math.max(0,Date.now()-this.Yi),a=Math.max(0,b-d);a>0&&c("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.Hi} ms, delay with jitter: ${b} ms, last attempt: ${d} ms ago)`),this.Ji=this.Me.enqueueAfterDelay(this.timerId,a,()=>(this.Yi=Date.now(),e())),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}er(){this.Ji!==null&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){this.Ji!==null&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}},jG=class{constructor(a,b,c,d,e,f,g,h){this.Me=a,this.nr=c,this.sr=d,this.ir=e,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=g,this.listener=h,this.state=0,this.rr=0,this.cr=null,this.ar=null,this.stream=null,this.ur=new jJ(a,b)}hr(){return this.state===1||this.state===5||this.lr()}lr(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.dr()}async stop(){this.hr()&&await this.close(0)}wr(){this.state=0,this.ur.reset()}_r(){this.lr()&&this.cr===null&&(this.cr=this.Me.enqueueAfterDelay(this.nr,6e4,()=>this.mr()))}gr(a){this.yr(),this.stream.send(a)}async mr(){if(this.lr())return this.close(0)}yr(){this.cr&&(this.cr.cancel(),this.cr=null)}pr(){this.ar&&(this.ar.cancel(),this.ar=null)}async close(c,b){this.yr(),this.pr(),this.ur.cancel(),this.rr++,c!==4?this.ur.reset():b&&b.code===a.RESOURCE_EXHAUSTED?(R(b.toString()),R("Using maximum backoff delay to prevent overloading the backend."),this.ur.Xi()):b&&b.code===a.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Tr(),this.stream.close(),this.stream=null),this.state=c,await this.listener.Ni(b)}Tr(){}auth(){this.state=1;const b=this.Er(this.rr),c=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,b])=>{this.rr===c&&this.Ir(a,b)},c=>{b(()=>{const b=new d(a.UNKNOWN,"Fetching auth token failed: "+c.message);return this.Ar(b)})})}Ir(b,c){const a=this.Er(this.rr);this.stream=this.Rr(b,c),this.stream.Di(()=>{a(()=>(this.state=2,this.ar=this.Me.enqueueAfterDelay(this.sr,1e4,()=>(this.lr()&&(this.state=3),Promise.resolve())),this.listener.Di()))}),this.stream.Ni(b=>{a(()=>this.Ar(b))}),this.stream.onMessage(b=>{a(()=>this.onMessage(b))})}dr(){this.state=5,this.ur.Zi(async()=>{this.state=0,this.start()})}Ar(a){return c("PersistentStream",`close with error: ${a}`),this.stream=null,this.close(4,a)}Er(a){return b=>{this.Me.enqueueAndForget(()=>this.rr===a?b():(c("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},lA=class extends jG{constructor(a,b,c,d,e,f){super(a,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",b,c,d,f),this.k=e}Rr(a,b){return this.ir.Qi("Listen",a,b)}onMessage(a){this.ur.reset();const b=lU(this.k,a),c=function(b){if(!("targetChange"in b))return k.min();const a=b.targetChange;return a.targetIds&&a.targetIds.length?k.min():a.readTime?X(a.readTime):k.min()}(a);return this.listener.br(b,c)}Pr(b){const a={};a.database=eC(this.k),a.addTarget=function(c,a){let b;const d=a.target;return b=dy(d)?{documents:iT(c,d)}:{query:iU(c,d)},b.targetId=a.targetId,a.resumeToken.approximateByteSize()>0?b.resumeToken=iC(c,a.resumeToken):a.snapshotVersion.compareTo(k.min())>0&&(b.readTime=b$(c,a.snapshotVersion.toTimestamp())),b}(this.k,b);const c=lS(this.k,b);c&&(a.labels=c),this.gr(a)}vr(b){const a={};a.database=eC(this.k),a.removeTarget=b,this.gr(a)}},lB=class extends jG{constructor(a,b,c,d,e,f){super(a,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",b,c,d,f),this.k=e,this.Vr=!1}get Sr(){return this.Vr}start(){this.Vr=!1,this.lastStreamToken=void 0,super.start()}Tr(){this.Vr&&this.Dr([])}Rr(a,b){return this.ir.Qi("Write",a,b)}onMessage(a){if(j(!!a.streamToken),this.lastStreamToken=a.streamToken,this.Vr){this.ur.reset();const b=lT(a.writeResults,a.commitTime),c=X(a.commitTime);return this.listener.Cr(c,b)}return j(!a.writeResults||a.writeResults.length===0),this.Vr=!0,this.listener.Nr()}kr(){const a={};a.database=eC(this.k),this.gr(a)}Dr(a){const b={streamToken:this.lastStreamToken,writes:a.map(a=>eo(this.k,a))};this.gr(b)}},lC=class extends class{}{constructor(a,b,c,d){super(),this.authCredentials=a,this.appCheckCredentials=b,this.ir=c,this.k=d,this.$r=!1}Or(){if(this.$r)throw new d(a.FAILED_PRECONDITION,"The client has already been terminated.")}Bi(b,c,e){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,d])=>this.ir.Bi(b,c,e,a,d)).catch(b=>{throw b.name==="FirebaseError"?(b.code===a.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),b):new d(a.UNKNOWN,b.toString())})}ji(b,c,e){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,d])=>this.ir.ji(b,c,e,a,d)).catch(b=>{throw b.name==="FirebaseError"?(b.code===a.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),b):new d(a.UNKNOWN,b.toString())})}terminate(){this.$r=!0}},lD=class{constructor(a,b){this.asyncQueue=a,this.onlineStateHandler=b,this.state="Unknown",this.Mr=0,this.Fr=null,this.Lr=!0}Br(){this.Mr===0&&(this.Ur("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.Fr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve())))}Kr(a){this.state==="Online"?this.Ur("Unknown"):(this.Mr++,this.Mr>=1&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${a.toString()}`),this.Ur("Offline")))}set(a){this.jr(),this.Mr=0,a==="Online"&&(this.Lr=!1),this.Ur(a)}Ur(a){a!==this.state&&(this.state=a,this.onlineStateHandler(a))}qr(b){const a=`Could not reach Cloud Firestore backend. ${b}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?(R(a),this.Lr=!1):c("OnlineStateTracker",a)}jr(){this.Fr!==null&&(this.Fr.cancel(),this.Fr=null)}},lE=class{constructor(b,d,a,e,f){this.localStore=b,this.datastore=d,this.asyncQueue=a,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=f,this.Hr.Ei(b=>{a.enqueueAndForget(async()=>{aN(this)&&(c("RemoteStore","Restarting streams for network reachability change."),await async function(b){const a=i(b);a.Gr.add(4),await cv(a),a.Jr.set("Unknown"),a.Gr.delete(4),await da(a)}(this))})}),this.Jr=new lD(a,e)}};async function da(a){if(aN(a))for(const b of a.zr)await b(!0)}async function cv(a){for(const b of a.zr)await b(!1)}function jp(c,b){const a=i(c);a.Wr.has(b.targetId)||(a.Wr.set(b.targetId,b),eD(a)?dW(a):aZ(a).lr()&&ed(a,b))}function jk(d,c){const a=i(d),b=aZ(a);a.Wr.delete(c),b.lr()&&je(a,c),a.Wr.size===0&&(b.lr()?b._r():aN(a)&&a.Jr.set("Unknown"))}function ed(a,b){a.Yr.X(b.targetId),aZ(a).Pr(b)}function je(a,b){a.Yr.X(b),aZ(a).vr(b)}function dW(a){a.Yr=new mf({getRemoteKeysForTarget:b=>a.remoteSyncer.getRemoteKeysForTarget(b),Et:b=>a.Wr.get(b)||null}),aZ(a).start(),a.Jr.Br()}function eD(a){return aN(a)&&!aZ(a).hr()&&a.Wr.size>0}function aN(a){return i(a).Gr.size===0}function i_(a){a.Yr=void 0}async function lP(a){a.Wr.forEach((b,c)=>{ed(a,b)})}async function lQ(a,b){i_(a),eD(a)?(a.Jr.Kr(b),dW(a)):a.Jr.set("Unknown")}async function lR(b,a,d){if(b.Jr.set("Online"),a instanceof it&&a.state===2&&a.cause)try{await async function(a,b){const c=b.cause;for(const d of b.targetIds)a.Wr.has(d)&&(await a.remoteSyncer.rejectListen(d,c),a.Wr.delete(d),a.Yr.removeTarget(d))}(b,a)}catch(d){c("RemoteStore","Failed to remove targets %s: %s ",a.targetIds.join(","),d),await dD(b,d)}else if(a instanceof cR?b.Yr.ot(a):a instanceof is?b.Yr.dt(a):b.Yr.ut(a),!d.isEqual(k.min()))try{const a=await kG(b.localStore);d.compareTo(a)>=0&&await function(a,c){const b=a.Yr.gt(c);return b.targetChanges.forEach((b,d)=>{if(b.resumeToken.approximateByteSize()>0){const e=a.Wr.get(d);e&&a.Wr.set(d,e.withResumeToken(b.resumeToken,c))}}),b.targetMismatches.forEach(c=>{const b=a.Wr.get(c);if(!b)return;a.Wr.set(c,b.withResumeToken(D.EMPTY_BYTE_STRING,b.snapshotVersion)),je(a,c);const d=new aS(b.target,c,1,b.sequenceNumber);ed(a,d)}),a.remoteSyncer.applyRemoteEvent(b)}(b,d)}catch(a){c("RemoteStore","Failed to raise snapshot:",a),await dD(b,a)}}async function dD(a,d,b){if(!aQ(d))throw d;a.Gr.add(1),await cv(a),a.Jr.set("Offline"),b||(b=()=>kG(a.localStore)),a.asyncQueue.enqueueRetryable(async()=>{c("RemoteStore","Retrying IndexedDB access"),await b(),a.Gr.delete(1),await da(a)})}function iS(b,a){return a().catch(c=>dD(b,c,a))}async function dz(c){const a=i(c),d=av(a);let b=a.Qr.length>0?a.Qr[a.Qr.length-1].batchId:-1;for(;lV(a);)try{const c=await k$(a.localStore,b);if(c===null){a.Qr.length===0&&d._r();break}b=c.batchId,lW(a,c)}catch(b){await dD(a,b)}iO(a)&&iD(a)}function lV(a){return aN(a)&&a.Qr.length<10}function lW(b,c){b.Qr.push(c);const a=av(b);a.lr()&&a.Sr&&a.Dr(c.mutations)}function iO(a){return aN(a)&&!av(a).hr()&&a.Qr.length>0}function iD(a){av(a).start()}async function lZ(a){av(a).kr()}async function l_(a){const b=av(a);for(const c of a.Qr)b.Dr(c.mutations)}async function l$(a,b,c){const d=a.Qr.shift(),e=jQ.from(d,b,c);await iS(a,()=>a.remoteSyncer.applySuccessfulWrite(e)),await dz(a)}async function ma(b,c){c&&av(b).Sr&&await async function(b,d){if(c=d.code,mq(c)&&c!==a.ABORTED){const a=b.Qr.shift();av(b).wr(),await iS(b,()=>b.remoteSyncer.rejectFailedWrite(a.batchId,d)),await dz(b)}var c}(b,c),iO(b)&&iD(b)}async function iA(b,d){const a=i(b);a.asyncQueue.verifyOperationInProgress(),c("RemoteStore","RemoteStore received new credentials");const e=aN(a);a.Gr.add(3),await cv(a),e&&a.Jr.set("Unknown"),await a.remoteSyncer.handleCredentialChange(d),a.Gr.delete(3),await da(a)}async function mc(c,b){const a=i(c);b?(a.Gr.delete(2),await da(a)):b||(a.Gr.add(2),await cv(a),a.Jr.set("Unknown"))}function aZ(a){return a.Xr||(a.Xr=function(b,c,d){const a=i(b);return a.Or(),new lA(c,a.ir,a.authCredentials,a.appCheckCredentials,a.k,d)}(a.datastore,a.asyncQueue,{Di:lP.bind(null,a),Ni:lQ.bind(null,a),br:lR.bind(null,a)}),a.zr.push(async b=>{b?(a.Xr.wr(),eD(a)?dW(a):a.Jr.set("Unknown")):(await a.Xr.stop(),i_(a))})),a.Xr}function av(a){return a.Zr||(a.Zr=function(b,c,d){const a=i(b);return a.Or(),new lB(c,a.ir,a.authCredentials,a.appCheckCredentials,a.k,d)}(a.datastore,a.asyncQueue,{Di:lZ.bind(null,a),Ni:ma.bind(null,a),Nr:l_.bind(null,a),Cr:l$.bind(null,a)}),a.zr.push(async b=>{b?(a.Zr.wr(),await dz(a)):(await a.Zr.stop(),a.Qr.length>0&&(c("RemoteStore",`Stopping write stream with ${a.Qr.length} pending writes`),a.Qr=[]))})),a.Zr}iv=class{constructor(a,b,c,d,e){this.asyncQueue=a,this.timerId=b,this.targetTimeMs=c,this.op=d,this.removalCallback=e,this.deferred=new ad,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}static createAndSchedule(g,c,b,d,e){const f=Date.now()+b,a=new iv(g,c,f,d,e);return a.start(b),a}start(a){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),a)}skipDelay(){return this.handleDelayElapsed()}cancel(b){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new d(a.CANCELLED,"Operation cancelled"+(b?": "+b:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(a=>this.deferred.resolve(a))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function im(b,c){if(R("AsyncQueue",`${c}: ${b}`),aQ(b))return new d(a.UNAVAILABLE,`${c}: ${b}`);throw b}cq=class{constructor(a){this.comparator=a?(b,c)=>a(b,c)||g.comparator(b.key,c.key):(a,b)=>g.comparator(a.key,b.key),this.keyedMap=fO(),this.sortedSet=new N(this.comparator)}static emptySet(a){return new cq(a.comparator)}has(a){return this.keyedMap.get(a)!=null}get(a){return this.keyedMap.get(a)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(b){const a=this.keyedMap.get(b);return a?this.sortedSet.indexOf(a):-1}get size(){return this.sortedSet.size}forEach(a){this.sortedSet.inorderTraversal((b,c)=>(a(b),!1))}add(a){const b=this.delete(a.key);return b.copy(b.keyedMap.insert(a.key,a),b.sortedSet.insert(a,null))}delete(a){const b=this.get(a);return b?this.copy(this.keyedMap.remove(a),this.sortedSet.remove(b)):this}isEqual(a){if(!(a instanceof cq))return!1;if(this.size!==a.size)return!1;const b=this.sortedSet.getIterator(),c=a.sortedSet.getIterator();for(;b.hasNext();){const a=b.getNext().key,d=c.getNext().key;if(!a.isEqual(d))return!1}return!0}toString(){const a=[];return this.forEach(b=>{a.push(b.toString())}),a.length===0?"DocumentSet ()":"DocumentSet (\n  "+a.join("  \n")+"\n)"}copy(b,c){const a=new cq;return a.comparator=this.comparator,a.keyedMap=b,a.sortedSet=c,a}},ij=class{constructor(){this.eo=new N(g.comparator)}track(a){const c=a.doc.key,b=this.eo.get(c);b?a.type!==0&&b.type===3?this.eo=this.eo.insert(c,a):a.type===3&&b.type!==1?this.eo=this.eo.insert(c,{type:b.type,doc:a.doc}):a.type===2&&b.type===2?this.eo=this.eo.insert(c,{type:2,doc:a.doc}):a.type===2&&b.type===0?this.eo=this.eo.insert(c,{type:0,doc:a.doc}):a.type===1&&b.type===0?this.eo=this.eo.remove(c):a.type===1&&b.type===2?this.eo=this.eo.insert(c,{type:1,doc:b.doc}):a.type===0&&b.type===1?this.eo=this.eo.insert(c,{type:2,doc:a.doc}):f():this.eo=this.eo.insert(c,a)}no(){const a=[];return this.eo.inorderTraversal((c,b)=>{a.push(b)}),a}},cw=class{constructor(a,b,c,d,e,f,g,h){this.query=a,this.docs=b,this.oldDocs=c,this.docChanges=d,this.mutatedKeys=e,this.fromCache=f,this.syncStateChanged=g,this.excludesMetadataChanges=h}static fromInitialDocuments(c,a,d,e){const b=[];return a.forEach(a=>{b.push({type:0,doc:a})}),new cw(c,a,cq.emptySet(a),b,d,e,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(a){if(!(this.fromCache===a.fromCache&&this.syncStateChanged===a.syncStateChanged&&this.mutatedKeys.isEqual(a.mutatedKeys)&&dP(this.query,a.query)&&this.docs.isEqual(a.docs)&&this.oldDocs.isEqual(a.oldDocs)))return!1;const b=this.docChanges,c=a.docChanges;if(b.length!==c.length)return!1;for(let a=0;a<b.length;a++)if(b[a].type!==c[a].type||!b[a].doc.isEqual(c[a].doc))return!1;return!0}},mk=class{constructor(){this.so=void 0,this.listeners=[]}},ml=class{constructor(){this.queries=new bd(a=>hk(a),dP),this.onlineState="Unknown",this.io=new Set}};async function ig(f,b){const c=i(f),d=b.query;let e=!1,a=c.queries.get(d);if(a||(e=!0,a=new mk),e)try{a.so=await c.onListen(d)}catch(a){const c=im(a,`Initialization of query '${em(b.query)}' failed`);return void b.onError(c)}c.queries.set(d,a),a.listeners.push(b),b.ro(c.onlineState),a.so&&b.oo(a.so)&&fu(c)}async function id(f,d){const b=i(f),c=d.query;let e=!1;const a=b.queries.get(c);if(a){const b=a.listeners.indexOf(d);b>=0&&(a.listeners.splice(b,1),e=a.listeners.length===0)}if(e)return b.queries.delete(c),b.onUnlisten(c)}function mo(c,d){const a=i(c);let b=!1;for(const c of d){const f=c.query,e=a.queries.get(f);if(e){for(const a of e.listeners)a.oo(c)&&(b=!0);e.so=c}}b&&fu(a)}function mp(d,a,e){const b=i(d),c=b.queries.get(a);if(c)for(const a of c.listeners)a.onError(e);b.queries.delete(a)}function fu(a){a.io.forEach(a=>{a.next()})}hV=class{constructor(a,b,c){this.query=a,this.co=b,this.ao=!1,this.uo=null,this.onlineState="Unknown",this.options=c||{}}oo(a){if(!this.options.includeMetadataChanges){const b=[];for(const c of a.docChanges)c.type!==3&&b.push(c);a=new cw(a.query,a.docs,a.oldDocs,b,a.mutatedKeys,a.fromCache,a.syncStateChanged,!0)}let b=!1;return this.ao?this.ho(a)&&(this.co.next(a),b=!0):this.lo(a,this.onlineState)&&(this.fo(a),b=!0),this.uo=a,b}onError(a){this.co.error(a)}ro(a){this.onlineState=a;let b=!1;return this.uo&&!this.ao&&this.lo(this.uo,a)&&(this.fo(this.uo),b=!0),b}lo(a,b){if(!a.fromCache)return!0;const c=b!=="Offline";return(!this.options.wo||!c)&&(!a.docs.isEmpty()||b==="Offline")}ho(a){if(a.docChanges.length>0)return!0;const b=this.uo&&this.uo.hasPendingWrites!==a.hasPendingWrites;return!(!a.syncStateChanged&&!b)&&this.options.includeMetadataChanges===!0}fo(a){a=cw.fromInitialDocuments(a.query,a.docs,a.mutatedKeys,a.fromCache),this.ao=!0,this.co.next(a)}},hK=class{constructor(a){this.key=a}},hG=class{constructor(a){this.key=a}},mu=class{constructor(a,b){this.query=a,this.To=b,this.Eo=null,this.current=!1,this.Io=r(),this.mutatedKeys=r(),this.Ao=hn(a),this.Ro=new cq(this.Ao)}get bo(){return this.To}Po(i,c){const d=c?c.vo:new ij,e=c?c.Ro:this.Ro;let b=c?c.mutatedKeys:this.mutatedKeys,a=e,f=!1;const g=dT(this.query)&&e.size===this.query.limit?e.last():null,h=dU(this.query)&&e.size===this.query.limit?e.first():null;if(i.inorderTraversal((j,l)=>{const i=e.get(j),c=bF(this.query,l)?l:null,n=!!i&&this.mutatedKeys.has(i.key),m=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations);let k=!1;i&&c?i.data.isEqual(c.data)?n!==m&&(d.track({type:3,doc:c}),k=!0):this.Vo(i,c)||(d.track({type:2,doc:c}),k=!0,(g&&this.Ao(c,g)>0||h&&this.Ao(c,h)<0)&&(f=!0)):!i&&c?(d.track({type:0,doc:c}),k=!0):i&&!c&&(d.track({type:1,doc:i}),k=!0,(g||h)&&(f=!0)),k&&(c?(a=a.add(c),b=m?b.add(j):b.delete(j)):(a=a.delete(j),b=b.delete(j)))}),dT(this.query)||dU(this.query))for(;a.size>this.query.limit;){const c=dT(this.query)?a.last():a.first();a=a.delete(c.key),b=b.delete(c.key),d.track({type:1,doc:c})}return{Ro:a,vo:d,Bn:f,mutatedKeys:b}}Vo(b,a){return b.hasLocalMutations&&a.hasCommittedMutations&&!a.hasLocalMutations}applyChanges(a,i,g){const h=this.Ro;this.Ro=a.Ro,this.mutatedKeys=a.mutatedKeys;const b=a.vo.no();b.sort((a,b)=>function(b,c){const a=a=>{switch(a){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return f()}};return a(b)-a(c)}(a.type,b.type)||this.Ao(a.doc,b.doc)),this.So(g);const e=i?this.Do():[],c=this.Io.size===0&&this.current?1:0,d=c!==this.Eo;return this.Eo=c,b.length!==0||d?{snapshot:new cw(this.query,a.Ro,h,b,a.mutatedKeys,c===0,d,!1),Co:e}:{Co:e}}ro(a){return this.current&&a==="Offline"?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new ij,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}No(a){return!this.To.has(a)&&!!this.Ro.has(a)&&!this.Ro.get(a).hasLocalMutations}So(a){a&&(a.addedDocuments.forEach(a=>this.To=this.To.add(a)),a.modifiedDocuments.forEach(a=>{}),a.removedDocuments.forEach(a=>this.To=this.To.delete(a)),this.current=a.current)}Do(){if(!this.current)return[];const b=this.Io;this.Io=r(),this.Ro.forEach(a=>{this.No(a.key)&&(this.Io=this.Io.add(a.key))});const a=[];return b.forEach(b=>{this.Io.has(b)||a.push(new hG(b))}),this.Io.forEach(c=>{b.has(c)||a.push(new hK(c))}),a}ko(a){this.To=a.zn,this.Io=r();const b=this.Po(a.documents);return this.applyChanges(b,!0)}xo(){return cw.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,this.Eo===0)}},mv=class{constructor(a,b,c){this.query=a,this.targetId=b,this.view=c}},mw=class{constructor(a){this.key=a,this.$o=!1}},mx=class{constructor(a,b,c,d,e,f){this.localStore=a,this.remoteStore=b,this.eventManager=c,this.sharedClientState=d,this.currentUser=e,this.maxConcurrentLimboResolutions=f,this.Oo={},this.Mo=new bd(a=>hk(a),dP),this.Fo=new Map,this.Lo=new Set,this.Bo=new N(g.comparator),this.Uo=new Map,this.qo=new fD,this.Ko={},this.jo=new Map,this.Qo=bB.re(),this.onlineState="Unknown",this.Wo=void 0}get isPrimaryClient(){return this.Wo===!0}};async function my(f,c){const a=mQ(f);let b,d;const e=a.Mo.get(c);if(e)b=e.targetId,a.sharedClientState.addLocalQueryTarget(b),d=e.view.xo();else{const e=await la(a.localStore,am(c)),f=a.sharedClientState.addLocalQueryTarget(e.targetId);b=e.targetId,d=await mz(a,c,b,f==="current"),a.isPrimaryClient&&jp(a.remoteStore,e)}return d}async function mz(a,b,c,g){a.Go=(b,c,d)=>async function(c,a,f,d){let b=a.view.Po(f);b.Bn&&(b=await kB(c.localStore,a.query,!1).then(({documents:c})=>a.view.Po(c,b)));const g=d&&d.targetChanges.get(a.targetId),e=a.view.applyChanges(b,c.isPrimaryClient,g);return ho(c,a.targetId,e.Co),e.snapshot}(a,b,c,d);const e=await kB(a.localStore,b,!0),d=new mu(b,e.zn),h=d.Po(e.documents),i=cQ.createSynthesizedTargetChangeForCurrentChange(c,g&&a.onlineState!=="Offline"),f=d.applyChanges(h,a.isPrimaryClient,i);ho(a,c,f.Co);const j=new mv(b,c,d);return a.Mo.set(b,j),a.Fo.has(c)?a.Fo.get(c).push(b):a.Fo.set(c,[b]),f.snapshot}async function mA(e,c){const a=i(e),b=a.Mo.get(c),d=a.Fo.get(b.targetId);if(d.length>1)return a.Fo.set(b.targetId,d.filter(a=>!dP(a,c))),void a.Mo.delete(c);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(b.targetId),a.sharedClientState.isActiveQueryTarget(b.targetId)||await fF(a.localStore,b.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(b.targetId),jk(a.remoteStore,b.targetId),er(a,b.targetId)}).catch(bk)):(er(a,b.targetId),await fF(a.localStore,b.targetId,!0))}async function hF(c,a){const b=i(c);try{const c=await kZ(b.localStore,a);a.targetChanges.forEach((a,d)=>{const c=b.Uo.get(d);c&&(j(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1),a.addedDocuments.size>0?c.$o=!0:a.modifiedDocuments.size>0?j(c.$o):a.removedDocuments.size>0&&(j(c.$o),c.$o=!1))}),await dQ(b,c,a)}catch(a){await bk(a)}}function hE(d,b,c){const a=i(d);if(a.isPrimaryClient&&c===0||!a.isPrimaryClient&&c===1){const c=[];a.Mo.forEach((e,d)=>{const a=d.view.ro(b);a.snapshot&&c.push(a.snapshot)}),function(d,b){const a=i(d);a.onlineState=b;let c=!1;a.queries.forEach((d,a)=>{for(const d of a.listeners)d.ro(b)&&(c=!0)}),c&&fu(a)}(a.eventManager,b),c.length&&a.Oo.br(c),a.onlineState=b,a.isPrimaryClient&&a.sharedClientState.setOnlineState(b)}}async function mD(f,b,d){const a=i(f);a.sharedClientState.updateQueryState(b,"rejected",d);const e=a.Uo.get(b),c=e&&e.key;if(c){let d=new N(g.comparator);d=d.insert(c,z.newNoDocument(c,k.min()));const e=r().add(c),f=new fJ(k.min(),new Map,new v(m),d,e);await hF(a,f),a.Bo=a.Bo.remove(c),a.Uo.delete(b),ec(a)}else await fF(a.localStore,b,!1).then(()=>er(a,b,d)).catch(bk)}async function mE(d,c){const a=i(d),b=c.batch.batchId;try{const d=await kX(a.localStore,c);hu(a,b,null),hv(a,b),a.sharedClientState.updateMutationState(b,"acknowledged"),await dQ(a,d)}catch(a){await bk(a)}}async function mF(d,b,c){const a=i(d);try{const d=await function(b,c){const a=i(b);return a.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let d;return a.An.lookupMutationBatch(b,c).next(c=>(j(c!==null),d=c.keys(),a.An.removeMutationBatch(b,c))).next(()=>a.An.performConsistencyCheck(b)).next(()=>a.Wn.vn(b,d))})}(a.localStore,b);hu(a,b,c),hv(a,b),a.sharedClientState.updateMutationState(b,"rejected",c),await dQ(a,d)}catch(a){await bk(a)}}function hv(a,b){(a.jo.get(b)||[]).forEach(a=>{a.resolve()}),a.jo.delete(b)}function hu(e,c,d){const b=i(e);let a=b.Ko[b.currentUser.toKey()];if(a){const e=a.get(c);e&&(d?e.reject(d):e.resolve(),a=a.remove(c)),b.Ko[b.currentUser.toKey()]=a}}function er(a,b,c=null){a.sharedClientState.removeLocalQueryTarget(b);for(const d of a.Fo.get(b))a.Mo.delete(d),c&&a.Oo.zo(d,c);a.Fo.delete(b),a.isPrimaryClient&&a.qo.us(b).forEach(b=>{a.qo.containsKey(b)||hr(a,b)})}function hr(a,b){a.Lo.delete(b.path.canonicalString());const c=a.Bo.get(b);c!==null&&(jk(a.remoteStore,c),a.Bo=a.Bo.remove(b),a.Uo.delete(c),ec(a))}function ho(a,b,d){for(const e of d)e instanceof hK?(a.qo.addReference(e.key,b),mL(a,e)):e instanceof hG?(c("SyncEngine","Document no longer in limbo: "+e.key),a.qo.removeReference(e.key,b),a.qo.containsKey(e.key)||hr(a,e.key)):f()}function mL(a,e){const b=e.key,d=b.path.canonicalString();a.Bo.get(b)||a.Lo.has(d)||(c("SyncEngine","New document in limbo: "+b),a.Lo.add(d),ec(a))}function ec(a){for(;a.Lo.size>0&&a.Bo.size<a.maxConcurrentLimboResolutions;){const d=a.Lo.values().next().value;a.Lo.delete(d);const b=new g(q.fromString(d)),c=a.Qo.next();a.Uo.set(c,new mw(b)),a.Bo=a.Bo.insert(b,c),jp(a.remoteStore,new aS(am(dS(b.path)),c,2,ac.I))}}async function dQ(j,g,h){const a=i(j),e=[],f=[],d=[];a.Mo.isEmpty()||(a.Mo.forEach((c,b)=>{d.push(a.Go(b,g,h).then(c=>{if(c){a.isPrimaryClient&&a.sharedClientState.updateQueryState(b.targetId,c.fromCache?"not-current":"current"),e.push(c);const d=kS.$n(b.targetId,c);f.push(d)}}))}),await Promise.all(d),a.Oo.br(e),await async function(e,d){const a=i(e);try{await a.persistence.runTransaction("notifyLocalViewChanges","readwrite",c=>b.forEach(d,d=>b.forEach(d.kn,b=>a.persistence.referenceDelegate.addReference(c,d.targetId,b)).next(()=>b.forEach(d.xn,b=>a.persistence.referenceDelegate.removeReference(c,d.targetId,b)))))}catch(a){if(!aQ(a))throw a;c("LocalStore","Failed to update sequence numbers: "+a)}for(const b of d){const c=b.targetId;if(!b.fromCache){const b=a.qn.get(c),d=b.snapshotVersion,e=b.withLastLimboFreeSnapshotVersion(d);a.qn=a.qn.insert(c,e)}}}(a.localStore,f))}async function mO(f,e){const b=i(f);if(!b.currentUser.isEqual(e)){c("SyncEngine","User change. New user:",e.toKey());const f=await kK(b.localStore,e);b.currentUser=e,function(b,c){b.jo.forEach(b=>{b.forEach(b=>{b.reject(new d(a.CANCELLED,c))})}),b.jo.clear()}(b,"'waitForPendingWrites' promise is rejected due to a user change."),b.sharedClientState.handleUserChange(e,f.removedBatchIds,f.addedBatchIds),await dQ(b,f.Gn)}}function mP(d,c){const a=i(d),b=a.Uo.get(c);if(b&&b.$o)return r().add(b.key);{let b=r();const d=a.Fo.get(c);if(!d)return b;for(const c of d){const e=a.Mo.get(c);b=b.unionWith(e.view.bo)}return b}}function mQ(b){const a=i(b);return a.remoteStore.remoteSyncer.applyRemoteEvent=hF.bind(null,a),a.remoteStore.remoteSyncer.getRemoteKeysForTarget=mP.bind(null,a),a.remoteStore.remoteSyncer.rejectListen=mD.bind(null,a),a.Oo.br=mo.bind(null,a.eventManager),a.Oo.zo=mp.bind(null,a.eventManager),a}function mR(b){const a=i(b);return a.remoteStore.remoteSyncer.applySuccessfulWrite=mE.bind(null,a),a.remoteStore.remoteSyncer.rejectFailedWrite=mF.bind(null,a),a}gX=class{constructor(){this.synchronizeTabs=!1}async initialize(a){this.k=cV(a.databaseInfo.databaseId),this.sharedClientState=this.Jo(a),this.persistence=this.Yo(a),await this.persistence.start(),this.gcScheduler=this.Xo(a),this.localStore=this.Zo(a)}Xo(a){return null}Zo(a){return kQ(this.persistence,new iF,a.initialUser,this.k)}Yo(a){return new ll(ky.ks,this.k)}Jo(a){return new kg}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}},mT=class extends gX{constructor(a,b,c){super(),this.tc=a,this.cacheSizeBytes=b,this.forceOwnership=c,this.synchronizeTabs=!1}async initialize(a){await super.initialize(a),await ld(this.localStore),await this.tc.initialize(this,a),await mR(this.tc.syncEngine),await dz(this.tc.remoteStore),await this.persistence.sn(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve()))}Zo(a){return kQ(this.persistence,new iF,a.initialUser,this.k)}Xo(a){const b=this.persistence.referenceDelegate.garbageCollector;return new lg(b,a.asyncQueue)}Yo(a){const b=kV(a.databaseInfo.databaseId,a.databaseInfo.persistenceKey),c=this.cacheSizeBytes!==void 0?Y.withCacheSize(this.cacheSizeBytes):Y.DEFAULT;return new kN(this.synchronizeTabs,b,a.clientId,c,a.asyncQueue,lv(),cS(),this.k,this.sharedClientState,!!this.forceOwnership)}Jo(a){return new kg}},gT=class{async initialize(b,a){this.localStore||(this.localStore=b.localStore,this.sharedClientState=b.sharedClientState,this.datastore=this.createDatastore(a),this.remoteStore=this.createRemoteStore(a),this.eventManager=this.createEventManager(a),this.syncEngine=this.createSyncEngine(a,!b.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>hE(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=mO.bind(null,this.syncEngine),await mc(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(a){return new ml}createDatastore(a){const c=cV(a.databaseInfo.databaseId),d=(b=a.databaseInfo,new lu(b));var b;return function(a,b,c,d){return new lC(a,b,c,d)}(a.authCredentials,a.appCheckCredentials,d,c)}createRemoteStore(f){return a=this.localStore,b=this.datastore,c=f.asyncQueue,d=a=>hE(this.syncEngine,a,0),e=ke.Pt()?new ke:new lq,new lE(a,b,c,d,e);var a,b,c,d,e}createSyncEngine(a,b){return function(b,h,c,d,e,f,g){const a=new mx(b,h,c,d,e,f);return g&&(a.Wo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,a.initialUser,a.maxConcurrentLimboResolutions,b)}terminate(){return async function(b){const a=i(b);c("RemoteStore","RemoteStore shutting down."),a.Gr.add(5),await cv(a),a.Hr.shutdown(),a.Jr.set("Unknown")}(this.remoteStore)}},gS=class{constructor(a){this.observer=a,this.muted=!1}next(a){this.observer.next&&this.ec(this.observer.next,a)}error(a){this.observer.error?this.ec(this.observer.error,a):console.error("Uncaught Error in snapshot listener:",a)}nc(){this.muted=!0}ec(a,b){this.muted||setTimeout(()=>{this.muted||a(b)},0)}},mW=class{constructor(b,d,a,e){this.authCredentials=b,this.appCheckCredentials=d,this.asyncQueue=a,this.databaseInfo=e,this.user=U.UNAUTHENTICATED,this.clientId=no.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(a,async a=>{c("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(a,a=>(c("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(a){this.authCredentialListener=a}setAppCheckTokenChangeListener(a){this.appCheckCredentialListener=a}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new d(a.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const a=new ad;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),a.resolve()}catch(b){const c=im(b,"Failed to shutdown persistence");a.reject(c)}}),a.promise}};async function gR(a,b){a.asyncQueue.verifyOperationInProgress(),c("FirestoreClient","Initializing OfflineComponentProvider");const d=await a.getConfiguration();await b.initialize(d);let e=d.initialUser;a.setCredentialChangeListener(async a=>{e.isEqual(a)||(await kK(b.localStore,a),e=a)}),b.persistence.setDatabaseDeletedListener(()=>a.terminate()),a.offlineComponents=b}async function gQ(a,b){a.asyncQueue.verifyOperationInProgress();const d=await mZ(a);c("FirestoreClient","Initializing OnlineComponentProvider");const e=await a.getConfiguration();await b.initialize(d,e),a.setCredentialChangeListener(a=>iA(b.remoteStore,a)),a.setAppCheckTokenChangeListener((c,a)=>iA(b.remoteStore,a)),a.onlineComponents=b}async function mZ(a){return a.offlineComponents||(c("FirestoreClient","Using default OfflineComponentProvider"),await gR(a,new gX)),a.offlineComponents}async function m_(a){return a.onlineComponents||(c("FirestoreClient","Using default OnlineComponentProvider"),await gQ(a,new gT)),a.onlineComponents}async function gO(c){const a=await m_(c),b=a.eventManager;return b.onListen=my.bind(null,a.syncEngine),b.onUnlisten=mA.bind(null,a.syncEngine),b}function na(b,e,f={}){const c=new ad;return b.asyncQueue.enqueueAndForget(async()=>function(c,h,e,f,b){const i=new gS({next:i=>{h.enqueueAndForget(()=>id(c,g));const j=i.docs.has(e);!j&&i.fromCache?b.reject(new d(a.UNAVAILABLE,"Failed to get document because the client is offline.")):j&&i.fromCache&&f&&f.source==="server"?b.reject(new d(a.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(i)},error:a=>b.reject(a)}),g=new hV(dS(e.path),i,{includeMetadataChanges:!0,wo:!0});return ig(c,g)}(await gO(b),b.asyncQueue,e,f,c)),c.promise}function nb(b,e,f={}){const c=new ad;return b.asyncQueue.enqueueAndForget(async()=>function(c,f,g,h,b){const i=new gS({next:g=>{f.enqueueAndForget(()=>id(c,e)),g.fromCache&&h.source==="server"?b.reject(new d(a.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(g)},error:a=>b.reject(a)}),e=new hV(g,i,{includeMetadataChanges:!0,wo:!0});return ig(c,e)}(await gO(b),b.asyncQueue,e,f,c)),c.promise}nc=class{constructor(a,b,c,d,e,f,g,h){this.databaseId=a,this.appId=b,this.persistenceKey=c,this.host=d,this.ssl=e,this.forceLongPolling=f,this.autoDetectLongPolling=g,this.useFetchStreams=h}},dB=class{constructor(a,b){this.projectId=a,this.database=b||"(default)"}get isDefaultDatabase(){return this.database==="(default)"}isEqual(a){return a instanceof dB&&a.projectId===this.projectId&&a.database===this.database}},gM=new Map;function nf(b,c,e){if(!e)throw new d(a.INVALID_ARGUMENT,`Function ${b}() cannot be called with an empty ${c}.`)}function ng(b,c,e,f){if(c===!0&&f===!0)throw new d(a.INVALID_ARGUMENT,`${b} and ${e} cannot be used together.`)}function gL(b){if(g.isDocumentKey(b))throw new d(a.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${b} has ${b.length}.`)}function du(a){if(a===void 0)return"undefined";if(a===null)return"null";if(typeof a=="string")return a.length>20&&(a=`${a.substring(0,20)}...`),JSON.stringify(a);if(typeof a=="number"||typeof a=="boolean")return""+a;if(typeof a=="object"){if(a instanceof Array)return"an array";{const b=function(a){return a.constructor?a.constructor.name:null}(a);return b?`a custom ${b} object`:"an object"}}return typeof a=="function"?"a function":f()}function cd(b,c){if("_delegate"in b&&(b=b._delegate),!(b instanceof c)){if(c.name===b.constructor.name)throw new d(a.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=du(b);throw new d(a.INVALID_ARGUMENT,`Expected type '${c.name}', but it was: ${e}`)}}return b}gm=class{constructor(b){var c;if(b.host===void 0){if(b.ssl!==void 0)throw new d(a.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=b.host,this.ssl=(c=b.ssl)===null||c===void 0||c;if(this.credentials=b.credentials,this.ignoreUndefinedProperties=!!b.ignoreUndefinedProperties,b.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(b.cacheSizeBytes!==-1&&b.cacheSizeBytes<1048576)throw new d(a.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=b.cacheSizeBytes}this.experimentalForceLongPolling=!!b.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!b.experimentalAutoDetectLongPolling,this.useFetchStreams=!!b.useFetchStreams,ng("experimentalForceLongPolling",b.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",b.experimentalAutoDetectLongPolling)}isEqual(a){return this.host===a.host&&this.ssl===a.ssl&&this.credentials===a.credentials&&this.cacheSizeBytes===a.cacheSizeBytes&&this.experimentalForceLongPolling===a.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===a.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===a.ignoreUndefinedProperties&&this.useFetchStreams===a.useFetchStreams}},gd=class{constructor(b,c,e){this._authCredentials=c,this._appCheckCredentials=e,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gm({}),this._settingsFrozen=!1,b instanceof dB?this._databaseId=b:(this._app=b,this._databaseId=function(b){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new d(a.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new dB(b.options.projectId)}(b))}get app(){if(!this._app)throw new d(a.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(b){if(this._settingsFrozen)throw new d(a.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gm(b),b.credentials!==void 0&&(this._authCredentials=function(b){if(!b)return new nA;switch(b.type){case"gapi":const c=b.client;return j(!(typeof c!="object"||c===null||!c.auth||!c.auth.getAuthHeaderValueForFirstParty)),new nu(c,b.sessionIndex||"0",b.iamToken||null);case"provider":return b.client;default:throw new d(a.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(b.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(a){const b=gM.get(a);b&&(c("ComponentProvider","Removing Datastore"),gM.delete(a),b.terminate())}(this),Promise.resolve()}},ar=class{constructor(a,b,c){this.converter=b,this._key=c,this.type="document",this.firestore=a}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new cy(this.firestore,this.converter,this._key.path.popLast())}withConverter(a){return new ar(this.firestore,a,this._key)}},cT=class{constructor(a,b,c){this.converter=b,this._query=c,this.type="query",this.firestore=a}withConverter(a){return new cT(this.firestore,a,this._query)}},cy=class extends cT{constructor(b,c,a){super(b,c,dS(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const a=this._path.popLast();return a.isEmpty()?null:new ar(this.firestore,null,new g(a))}withConverter(a){return new cy(this.firestore,a,this._path)}};function fS(b,c,...e){if(b=cM(b),nf("collection","path",c),b instanceof gd){const a=q.fromString(c,...e);return gL(a),new cy(b,null,a)}{if(!(b instanceof ar||b instanceof cy))throw new d(a.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const f=b._path.child(q.fromString(c,...e));return gL(f),new cy(b.firestore,null,f)}}nq=class{constructor(){this.mc=Promise.resolve(),this.gc=[],this.yc=!1,this.Tc=[],this.Ec=null,this.Ic=!1,this.Ac=!1,this.Rc=[],this.ur=new jJ(this,"async_queue_retry"),this.bc=()=>{const a=cS();a&&c("AsyncQueue","Visibility state changed to "+a.visibilityState),this.ur.er()};const a=cS();a&&typeof a.addEventListener=="function"&&a.addEventListener("visibilitychange",this.bc)}get isShuttingDown(){return this.yc}enqueueAndForget(a){this.enqueue(a)}enqueueAndForgetEvenWhileRestricted(a){this.Pc(),this.vc(a)}enterRestrictedMode(a){if(!this.yc){this.yc=!0,this.Ac=a||!1;const b=cS();b&&typeof b.removeEventListener=="function"&&b.removeEventListener("visibilitychange",this.bc)}}enqueue(b){if(this.Pc(),this.yc)return new Promise(()=>{});const a=new ad;return this.vc(()=>this.yc&&this.Ac?Promise.resolve():(b().then(a.resolve,a.reject),a.promise)).then(()=>a.promise)}enqueueRetryable(a){this.enqueueAndForget(()=>(this.gc.push(a),this.Vc()))}async Vc(){if(this.gc.length!==0){try{await this.gc[0](),this.gc.shift(),this.ur.reset()}catch(a){if(!aQ(a))throw a;c("AsyncQueue","Operation failed with retryable error: "+a)}this.gc.length>0&&this.ur.Zi(()=>this.Vc())}}vc(b){const a=this.mc.then(()=>(this.Ic=!0,b().catch(a=>{this.Ec=a,this.Ic=!1;const b=function(a){let b=a.message||"";return a.stack&&(b=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),b}(a);throw R("INTERNAL UNHANDLED ERROR: ",b),a}).then(a=>(this.Ic=!1,a))));return this.mc=a,a}enqueueAfterDelay(a,b,d){this.Pc(),this.Rc.indexOf(a)>-1&&(b=0);const c=iv.createAndSchedule(this,a,b,d,a=>this.Sc(a));return this.Tc.push(c),c}Pc(){this.Ec&&f()}verifyOperationInProgress(){}async Dc(){let a;do a=this.mc,await a;while(a!==this.mc)}Cc(a){for(const b of this.Tc)if(b.timerId===a)return!0;return!1}Nc(a){return this.Dc().then(()=>{this.Tc.sort((a,b)=>a.targetTimeMs-b.targetTimeMs);for(const b of this.Tc)if(b.skipDelay(),a!=="all"&&b.timerId===a)break;return this.Dc()})}kc(a){this.Rc.push(a)}Sc(a){const b=this.Tc.indexOf(a);this.Tc.splice(b,1)}},cD=class extends gd{constructor(a,b,c){super(a,b,c),this.type="firestore",this._queue=new nq,this._persistenceKey="name"in a?a.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||fU(this),this._firestoreClient.terminate()}};function ns(a=pw()){return pI(a,"firestore").getImmediate()}function fM(a){return a._firestoreClient||fU(a),a._firestoreClient.verifyNotTerminated(),a._firestoreClient}function fU(a){var b;const c=a._freezeSettings(),d=function(b,c,d,a){return new nc(b,c,d,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams)}(a._databaseId,((b=a._app)===null||b===void 0?void 0:b.options.appId)||"",a._persistenceKey,c);a._firestoreClient=new mW(a._authCredentials,a._appCheckCredentials,a._queue,d)}function nv(a,b){nx(a=cd(a,cD));const d=fM(a),e=a._freezeSettings(),c=new gT;return nw(d,c,new mT(c,e.cacheSizeBytes,b==null?void 0:b.forceOwnership))}function nw(b,d,e){const c=new ad;return b.asyncQueue.enqueue(async()=>{try{await gR(b,e),await gQ(b,d),c.resolve()}catch(b){if(!function(b){return b.name==="FirebaseError"?b.code===a.FAILED_PRECONDITION||b.code===a.UNIMPLEMENTED:!(typeof DOMException!="undefined"&&b instanceof DOMException)||b.code===22||b.code===20||b.code===11}(b))throw b;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+b),c.reject(b)}}).then(()=>c.promise)}function nx(b){if(b._initialized||b._terminated)throw new d(a.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}fV=class{constructor(...b){for(let c=0;c<b.length;++c)if(b[c].length===0)throw new d(a.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new S(b)}isEqual(a){return this._internalPath.isEqual(a._internalPath)}},ck=class{constructor(a){this._byteString=a}static fromBase64String(b){try{return new ck(D.fromBase64String(b))}catch(b){throw new d(a.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+b)}}static fromUint8Array(a){return new ck(D.fromUint8Array(a))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(a){return this._byteString.isEqual(a._byteString)}},fX=class{constructor(a){this._methodName=a}},fH=class{constructor(b,c){if(!isFinite(b)||b<-90||b>90)throw new d(a.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+b);if(!isFinite(c)||c<-180||c>180)throw new d(a.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+c);this._lat=b,this._long=c}get latitude(){return this._lat}get longitude(){return this._long}isEqual(a){return this._lat===a._lat&&this._long===a._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(a){return m(this._lat,a._lat)||m(this._long,a._long)}},nC=/^__.*__$/;function f$(a){switch(a){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw f()}}ga=class{constructor(b,c,d,e,a,f){this.settings=b,this.databaseId=c,this.k=d,this.ignoreUndefinedProperties=e,a===void 0&&this.xc(),this.fieldTransforms=a||[],this.fieldMask=f||[]}get path(){return this.settings.path}get $c(){return this.settings.$c}Oc(a){return new ga(Object.assign(Object.assign({},this.settings),a),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mc(b){var a;const d=(a=this.path)===null||a===void 0?void 0:a.child(b),c=this.Oc({path:d,Fc:!1});return c.Lc(b),c}Bc(c){var a;const d=(a=this.path)===null||a===void 0?void 0:a.child(c),b=this.Oc({path:d,Fc:!1});return b.xc(),b}Uc(a){return this.Oc({path:void 0,Fc:!0})}qc(a){return fk(a,this.settings.methodName,this.settings.Kc||!1,this.path,this.settings.jc)}contains(a){return this.fieldMask.find(b=>a.isPrefixOf(b))!==void 0||this.fieldTransforms.find(b=>a.isPrefixOf(b.field))!==void 0}xc(){if(this.path)for(let a=0;a<this.path.length;a++)this.Lc(this.path.get(a))}Lc(a){if(a.length===0)throw this.qc("Document fields must not be empty");if(f$(this.$c)&&nC.test(a))throw this.qc('Document fields cannot begin and end with "__"')}},nF=class{constructor(a,b,c){this.databaseId=a,this.ignoreUndefinedProperties=b,this.k=c||cV(a)}Qc(a,b,c,d=!1){return new ga({$c:a,methodName:b,jc:c,path:S.emptyPath(),Fc:!1,Kc:d},this.databaseId,this.k,this.ignoreUndefinedProperties)}};function nG(a){const b=a._freezeSettings(),c=cV(a._databaseId);return new nF(a._databaseId,!!b.ignoreUndefinedProperties,c)}function st(a,b,c,d=!1){return fn(c,a.Qc(d?4:3,b))}function fn(b,a){if(gc(b=cM(b)))return nL("Unsupported field value:",a,b),nJ(b,a);if(b instanceof fX)return function(b,a){if(!f$(a.$c))throw a.qc(`${b._methodName}() can only be used with update() and set()`);if(!a.path)throw a.qc(`${b._methodName}() is not currently supported inside arrays`);const c=b._toFieldTransform(a);c&&a.fieldTransforms.push(c)}(b,a),null;if(b===void 0&&a.ignoreUndefinedProperties)return null;if(a.path&&a.fieldMask.push(a.path),b instanceof Array){if(a.settings.Fc&&a.$c!==4)throw a.qc("Nested arrays are not supported");return function(c,d){const a=[];let b=0;for(const f of c){let e=fn(f,d.Uc(b));e==null&&(e={nullValue:"NULL_VALUE"}),a.push(e),b++}return{arrayValue:{values:a}}}(b,a)}return function(a,b){if((a=cM(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return mJ(b.k,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const c=M.fromDate(a);return{timestampValue:b$(b.k,c)}}if(a instanceof M){const c=new M(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:b$(b.k,c)}}if(a instanceof fH)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof ck)return{bytesValue:iC(b.k,a._byteString)};if(a instanceof ar){const c=b.databaseId,d=a.firestore._databaseId;if(!d.isEqual(c))throw b.qc(`Document reference is for database ${d.projectId}/${d.database} but should be for database ${c.projectId}/${c.database}`);return{referenceValue:fr(a.firestore._databaseId||b.databaseId,a._key.path)}}throw b.qc(`Unsupported field value: ${du(a)}`)}(b,a)}function nJ(b,a){const c={};return fY(b)?a.path&&a.path.length>0&&a.fieldMask.push(a.path):cx(b,(b,e)=>{const d=fn(e,a.Mc(b));d!=null&&(c[b]=d)}),{mapValue:{fields:c}}}function gc(a){return!(typeof a!="object"||a===null||a instanceof Array||a instanceof Date||a instanceof M||a instanceof fH||a instanceof ck||a instanceof ar||a instanceof fX)}function nL(b,c,a){if(!gc(a)||!function(a){return typeof a=="object"&&a!==null&&(Object.getPrototypeOf(a)===Object.prototype||Object.getPrototypeOf(a)===null)}(a)){const d=du(a);throw d==="an object"?c.qc(b+" a custom object"):c.qc(b+" "+d)}}nM=new RegExp("[~\\*/\\[\\]]");function nN(b,a,c){if(a.search(nM)>=0)throw fk(`Invalid field path (${a}). Paths must not contain '~', '*', '/', '[', or ']'`,b,!1,void 0,c);try{return new fV(...a.split("."))._internalPath}catch(d){throw fk(`Invalid field path (${a}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,b,!1,void 0,c)}}function fk(i,j,k,e,g){const h=e&&!e.isEmpty(),f=g!==void 0;let c=`Function ${j}() called with invalid data`;k&&(c+=" (via `toFirestore()`)"),c+=". ";let b="";return(h||f)&&(b+=" (found",h&&(b+=` in field ${e}`),f&&(b+=` in document ${g}`),b+=")"),new d(a.INVALID_ARGUMENT,c+i+b)}ge=class{constructor(a,b,c,d,e){this._firestore=a,this._userDataWriter=b,this._key=c,this._document=d,this._converter=e}get id(){return this._key.path.lastSegment()}get ref(){return new ar(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const a=new nQ(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(a)}return this._userDataWriter.convertValue(this._document.data.value)}}get(a){if(this._document){const b=this._document.data.field(eQ("DocumentSnapshot.get",a));if(b!==null)return this._userDataWriter.convertValue(b)}}},nQ=class extends ge{data(){return super.data()}};function eQ(b,a){return typeof a=="string"?nN(b,a):a instanceof fV?a._internalPath:a._delegate._internalPath}ci=class{constructor(a,b){this.hasPendingWrites=a,this.fromCache=b}isEqual(a){return this.hasPendingWrites===a.hasPendingWrites&&this.fromCache===a.fromCache}},gG=class extends ge{constructor(a,b,c,d,e,f){super(a,b,c,d,f),this._firestore=a,this._firestoreImpl=a,this.metadata=e}exists(){return super.exists()}data(a={}){if(this._document){if(this._converter){const b=new ds(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(b,a)}return this._userDataWriter.convertValue(this._document.data.value,a.serverTimestamps)}}get(a,b={}){if(this._document){const c=this._document.data.field(eQ("DocumentSnapshot.get",a));if(c!==null)return this._userDataWriter.convertValue(c,b.serverTimestamps)}}},ds=class extends gG{data(a={}){return super.data(a)}},nV=class{constructor(b,c,d,a){this._firestore=b,this._userDataWriter=c,this._snapshot=a,this.metadata=new ci(a.hasPendingWrites,a.fromCache),this.query=d}get docs(){const a=[];return this.forEach(b=>a.push(b)),a}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(a,b){this._snapshot.docs.forEach(c=>{a.call(b,new ds(this._firestore,this._userDataWriter,c.key,c,new ci(this._snapshot.mutatedKeys.has(c.key),this._snapshot.fromCache),this.query.converter))})}docChanges(c={}){const b=!!c.includeMetadataChanges;if(b&&this._snapshot.excludesMetadataChanges)throw new d(a.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===b||(this._cachedChanges=function(a,b){if(a._snapshot.oldDocs.isEmpty()){let b=0;return a._snapshot.docChanges.map(c=>({type:"added",doc:new ds(a._firestore,a._userDataWriter,c.doc.key,c.doc,new ci(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter),oldIndex:-1,newIndex:b++}))}{let c=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(a=>b||a.type!==3).map(b=>{const f=new ds(a._firestore,a._userDataWriter,b.doc.key,b.doc,new ci(a._snapshot.mutatedKeys.has(b.doc.key),a._snapshot.fromCache),a.query.converter);let d=-1,e=-1;return b.type!==0&&(d=c.indexOf(b.doc.key),c=c.delete(b.doc.key)),b.type!==1&&(c=c.add(b.doc),e=c.indexOf(b.doc.key)),{type:nW(b.type),doc:f,oldIndex:d,newIndex:e}})}}(this,b),this._cachedChangesIncludeMetadataChanges=b),this._cachedChanges}};function nW(a){switch(a){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return f()}}function nX(b){if(dU(b)&&b.explicitOrderBy.length===0)throw new d(a.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}nY=class{};function nZ(a,...b){for(const c of b)a=c._apply(a);return a}n_=class extends nY{constructor(a,b,c){super(),this.zc=a,this.Hc=b,this.Jc=c,this.type="where"}_apply(b){const c=nG(b.firestore),e=function(f,j,k,h,i,b,c){let e;if(i.isKeyField()){if(b==="array-contains"||b==="array-contains-any")throw new d(a.INVALID_ARGUMENT,`Invalid Query. You can't perform '${b}' queries on documentId().`);if(b==="in"||b==="not-in"){gI(c,b);const a=[];for(const b of c)a.push(gH(h,f,b));e={arrayValue:{values:a}}}else e=gH(h,f,c)}else b!=="in"&&b!=="not-in"&&b!=="array-contains-any"||gI(c,b),e=st(k,j,c,b==="in"||b==="not-in");const g=T.create(i,b,e);return function(c,b){if(b.V()){const e=he(c);if(e!==null&&!e.isEqual(b.field))throw new d(a.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${e.toString()}' and '${b.field.toString()}'`);const f=hd(c);f!==null&&oc(c,b.field,f)}const e=function(a,b){for(const c of a.filters)if(b.indexOf(c.op)>=0)return c.op;return null}(c,function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(b.op));if(e!==null)throw e===b.op?new d(a.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${b.op.toString()}' filter.`):new d(a.INVALID_ARGUMENT,`Invalid query. You cannot use '${b.op.toString()}' filters with '${e.toString()}' filters.`)}(f,g),g}(b._query,"where",c,b.firestore._databaseId,this.zc,this.Hc,this.Jc);return new cT(b.firestore,b.converter,function(a,b){const c=a.filters.concat([b]);return new bS(a.path,a.collectionGroup,a.explicitOrderBy.slice(),c,a.limit,a.limitType,a.startAt,a.endAt)}(b._query,e))}};function n$(a,b,c){const d=b,e=eQ("where",a);return new n_(e,d,c)}function gH(c,e,b){if(typeof(b=cM(b))=="string"){if(b==="")throw new d(a.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!hf(e)&&b.indexOf("/")!==-1)throw new d(a.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${b}' contains a '/' character.`);const f=e.path.child(q.fromString(b));if(!g.isDocumentKey(f))throw new d(a.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${f}' is not because it has an odd number of segments (${f.length}).`);return gv(c,new g(f))}if(b instanceof ar)return gv(c,b._key);throw new d(a.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${du(b)}.`)}function gI(b,c){if(!Array.isArray(b)||b.length===0)throw new d(a.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${c.toString()}' filters.`);if(b.length>10)throw new d(a.INVALID_ARGUMENT,`Invalid Query. '${c.toString()}' filters support a maximum of 10 elements in the value array.`)}function oc(e,b,c){if(!c.isEqual(b))throw new d(a.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${b.toString()}' and so you must also use '${b.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${c.toString()}' instead.`)}od=class{convertValue(a,b="none"){switch(aO(a)){case 0:return null;case 1:return a.booleanValue;case 2:return x(a.integerValue||a.doubleValue);case 3:return this.convertTimestamp(a.timestampValue);case 4:return this.convertServerTimestamp(a,b);case 5:return a.stringValue;case 6:return this.convertBytes(bg(a.bytesValue));case 7:return this.convertReference(a.referenceValue);case 8:return this.convertGeoPoint(a.geoPointValue);case 9:return this.convertArray(a.arrayValue,b);case 10:return this.convertObject(a.mapValue,b);default:throw f()}}convertObject(b,c){const a={};return cx(b.fields,(b,d)=>{a[b]=this.convertValue(d,c)}),a}convertGeoPoint(a){return new fH(x(a.latitude),x(a.longitude))}convertArray(a,b){return(a.values||[]).map(a=>this.convertValue(a,b))}convertServerTimestamp(a,b){switch(b){case"previous":const c=gi(a);return c==null?null:this.convertValue(c,b);case"estimate":return this.convertTimestamp(ch(a));default:return null}}convertTimestamp(b){const a=aD(b);return new M(a.seconds,a.nanos)}convertDocumentKey(e,b){const a=q.fromString(e);j(jf(a));const c=new dB(a.get(1),a.get(3)),d=new g(a.popFirst(5));return c.isEqual(b)||R(`Document ${d} contains a document reference within a different database (${c.projectId}/${c.database}) which is not supported. It will be treated as a reference in the current database (${b.projectId}/${b.database}) instead.`),d}};function oe(a){a=cd(a,ar);const b=cd(a.firestore,cD);return na(fM(b),a._key).then(c=>oi(b,a,c))}gK=class extends od{constructor(a){super(),this.firestore=a}convertBytes(a){return new ck(a)}convertReference(a){const b=this.convertDocumentKey(a,this.firestore._databaseId);return new ar(this.firestore,null,b)}};function gU(a){a=cd(a,cT);const b=cd(a.firestore,cD),c=fM(b),d=new gK(b);return nX(a._query),nb(c,a._query).then(c=>new nV(b,d,a,c))}function oi(c,a,b){const d=b.docs.get(a._key),e=new gK(c);return new gG(c,e,a._key,d,new ci(b.hasPendingWrites,b.fromCache),a.converter)}!function(a,b=!0){!function(a){bi=a}(pA),eS(new cN("firestore",(a,{options:c})=>{const e=a.getProvider("app").getImmediate(),d=new cD(e,new nz(a.getProvider("auth-internal")),new nr(a.getProvider("app-check-internal")));return c=Object.assign({useFetchStreams:b},c),d._setSettings(c),d},"PUBLIC")),bf(f_,"3.4.4",a),bf(f_,"3.4.4","esm2017")}();function ek(a,b,c={}){const d=new CustomEvent(b,{bubbles:!0,composed:!0,detail:c});a.dispatchEvent(d)}ok={apiKey:"AIzaSyAg0cVb-NI8UNGGmXxIe9vxk1fVTcMA2VQ",authDomain:"dnd-project-b2aa4.firebaseapp.com",databaseURL:"https://dnd-project-b2aa4-default-rtdb.firebaseio.com",projectId:"dnd-project-b2aa4",storageBucket:"dnd-project-b2aa4.appspot.com",messagingSenderId:"1031136765027",appId:"1:1031136765027:web:8b106f77f9f22ba7cc8456"},py(ok),ej=ns(),nv(ej).catch(a=>{console.log(a),a.code==="failed-precondition"||a.code==="unimplemented"}),dR={},on=async()=>{const a=fS(ej,"items"),b=nZ(a,n$("image","!=",null)),c=await gU(b);c.forEach(a=>{dR[a.id]=a.data()});const d=await gU(fS(ej,"campaigns"));d.forEach(async b=>{const a=b.data();console.log("campaign"," => ",a),a.inventories.forEach(async a=>{const b=await oe(a);console.log("inventory",b.data())})}),ek(window,"ITEMS")},on(),d$=window.ShadowRoot&&(window.ShadyCSS===void 0||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,d_=Symbol(),hg=new Map,hh=class{constructor(a,b){if(this._$cssResult$=!0,b!==d_)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=a}get styleSheet(){let a=hg.get(this.cssText);return d$&&a===void 0&&(hg.set(this.cssText,a=new CSSStyleSheet),a.replaceSync(this.cssText)),a}toString(){return this.cssText}},bL=a=>new hh(typeof a=="string"?a:a+"",d_),br=(a,...b)=>{const c=a.length===1?a[0]:b.reduce((b,c,d)=>b+(a=>{if(a._$cssResult$===!0)return a.cssText;if(typeof a=="number")return a;throw Error("Value passed to 'css' function must be a 'css' function result: "+a+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(c)+a[d+1],a[0]);return new hh(c,d_)},ou=(a,b)=>{d$?a.adoptedStyleSheets=b.map(a=>a instanceof CSSStyleSheet?a:a.styleSheet):b.forEach(d=>{const b=document.createElement("style"),c=window.litNonce;c!==void 0&&b.setAttribute("nonce",c),b.textContent=d.cssText,a.appendChild(b)})},hi=d$?a=>a:a=>a instanceof CSSStyleSheet?(b=>{let a="";for(const c of b.cssRules)a+=c.cssText;return bL(a)})(a):a,hl=window.trustedTypes,oy=hl?hl.emptyScript:"",hm=window.reactiveElementPolyfillSupport,eq={toAttribute(a,b){switch(b){case Boolean:a=a?oy:null;break;case Object:case Array:a=a==null?a:JSON.stringify(a)}return a},fromAttribute(a,c){let b=a;switch(c){case Boolean:b=a!==null;break;case Number:b=a===null?null:Number(a);break;case Object:case Array:try{b=JSON.parse(a)}catch(a){b=null}}return b}},hw=(a,b)=>b!==a&&(b==b||a==a),eE={attribute:!0,type:String,converter:eq,reflect:!1,hasChanged:hw},be=class extends HTMLElement{constructor(){super(),this._$Et=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Ei=null,this.o()}static addInitializer(b){var a;(a=this.l)!==null&&a!==void 0||(this.l=[]),this.l.push(b)}static get observedAttributes(){this.finalize();const a=[];return this.elementProperties.forEach((d,c)=>{const b=this._$Eh(c,d);b!==void 0&&(this._$Eu.set(b,c),a.push(b))}),a}static createProperty(a,b=eE){if(b.state&&(b.attribute=!1),this.finalize(),this.elementProperties.set(a,b),!b.noAccessor&&!this.prototype.hasOwnProperty(a)){const d=typeof a=="symbol"?Symbol():"__"+a,c=this.getPropertyDescriptor(a,d,b);c!==void 0&&Object.defineProperty(this.prototype,a,c)}}static getPropertyDescriptor(a,b,c){return{get(){return this[b]},set(d){const e=this[a];this[b]=d,this.requestUpdate(a,e,c)},configurable:!0,enumerable:!0}}static getPropertyOptions(a){return this.elementProperties.get(a)||eE}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const a=Object.getPrototypeOf(this);if(a.finalize(),this.elementProperties=new Map(a.elementProperties),this._$Eu=new Map,this.hasOwnProperty("properties")){const a=this.properties,b=[...Object.getOwnPropertyNames(a),...Object.getOwnPropertySymbols(a)];for(const c of b)this.createProperty(c,a[c])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(a){const b=[];if(Array.isArray(a)){const c=new Set(a.flat(1/0).reverse());for(const a of c)b.unshift(hi(a))}else a!==void 0&&b.push(hi(a));return b}static _$Eh(b,c){const a=c.attribute;return a===!1?void 0:typeof a=="string"?a:typeof b=="string"?b.toLowerCase():void 0}o(){var a;this._$Ep=new Promise(a=>this.enableUpdating=a),this._$AL=new Map,this._$Em(),this.requestUpdate(),(a=this.constructor.l)===null||a===void 0||a.forEach(a=>a(this))}addController(a){var b,c;((b=this._$Eg)!==null&&b!==void 0?b:this._$Eg=[]).push(a),this.renderRoot!==void 0&&this.isConnected&&((c=a.hostConnected)===null||c===void 0||c.call(a))}removeController(b){var a;(a=this._$Eg)===null||a===void 0||a.splice(this._$Eg.indexOf(b)>>>0,1)}_$Em(){this.constructor.elementProperties.forEach((b,a)=>{this.hasOwnProperty(a)&&(this._$Et.set(a,this[a]),delete this[a])})}createRenderRoot(){var a;const b=(a=this.shadowRoot)!==null&&a!==void 0?a:this.attachShadow(this.constructor.shadowRootOptions);return ou(b,this.constructor.elementStyles),b}connectedCallback(){var a;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(a=this._$Eg)===null||a===void 0||a.forEach(b=>{var a;return(a=b.hostConnected)===null||a===void 0?void 0:a.call(b)})}enableUpdating(a){}disconnectedCallback(){var a;(a=this._$Eg)===null||a===void 0||a.forEach(b=>{var a;return(a=b.hostDisconnected)===null||a===void 0?void 0:a.call(b)})}attributeChangedCallback(a,c,b){this._$AK(a,b)}_$ES(e,f,a=eE){var b,c;const d=this.constructor._$Eh(e,a);if(d!==void 0&&a.reflect===!0){const g=((c=(b=a.converter)===null||b===void 0?void 0:b.toAttribute)!==null&&c!==void 0?c:eq.toAttribute)(f,a.type);this._$Ei=e,g==null?this.removeAttribute(d):this.setAttribute(d,g),this._$Ei=null}}_$AK(g,f){var b,c,d;const e=this.constructor,a=e._$Eu.get(g);if(a!==void 0&&this._$Ei!==a){const h=e.getPropertyOptions(a),g=h.converter,i=(d=(c=(b=g)===null||b===void 0?void 0:b.fromAttribute)!==null&&c!==void 0?c:typeof g=="function"?g:null)!==null&&d!==void 0?d:eq.fromAttribute;this._$Ei=a,this[a]=i(f,h.type),this._$Ei=null}}requestUpdate(a,c,b){let d=!0;a!==void 0&&(((b=b||this.constructor.getPropertyOptions(a)).hasChanged||hw)(this[a],c)?(this._$AL.has(a)||this._$AL.set(a,c),b.reflect===!0&&this._$Ei!==a&&(this._$E_===void 0&&(this._$E_=new Map),this._$E_.set(a,b))):d=!1),!this.isUpdatePending&&d&&(this._$Ep=this._$EC())}async _$EC(){this.isUpdatePending=!0;try{await this._$Ep}catch(a){Promise.reject(a)}const a=this.scheduleUpdate();return a!=null&&await a,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var c;if(!this.isUpdatePending)return;this.hasUpdated,this._$Et&&(this._$Et.forEach((a,b)=>this[b]=a),this._$Et=void 0);let a=!1;const b=this._$AL;try{a=this.shouldUpdate(b),a?(this.willUpdate(b),(c=this._$Eg)===null||c===void 0||c.forEach(b=>{var a;return(a=b.hostUpdate)===null||a===void 0?void 0:a.call(b)}),this.update(b)):this._$EU()}catch(b){throw a=!1,this._$EU(),b}a&&this._$AE(b)}willUpdate(a){}_$AE(b){var a;(a=this._$Eg)===null||a===void 0||a.forEach(b=>{var a;return(a=b.hostUpdated)===null||a===void 0?void 0:a.call(b)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(b)),this.updated(b)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Ep}shouldUpdate(a){return!0}update(a){this._$E_!==void 0&&(this._$E_.forEach((b,a)=>this._$ES(a,this[a],b)),this._$E_=void 0),this._$EU()}updated(a){}firstUpdated(a){}},be.finalized=!0,be.elementProperties=new Map,be.elementStyles=[],be.shadowRootOptions={mode:"open"},hm==null||hm({ReactiveElement:be}),((eg=globalThis.reactiveElementVersions)!==null&&eg!==void 0?eg:globalThis.reactiveElementVersions=[]).push("1.2.2"),bh=globalThis.trustedTypes,h_=bh?bh.createPolicy("lit-html",{createHTML:a=>a}):void 0,at=`lit$${(Math.random()+"").slice(9)}$`,ie="?"+at,oJ=`<${ie}>`,bo=document,cu=(a="")=>bo.createComment(a),cr=a=>a===null||typeof a!="object"&&typeof a!="function",ik=Array.isArray,oO=b=>{var a;return ik(b)||typeof((a=b)===null||a===void 0?void 0:a[Symbol.iterator])=="function"},co=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,ip=/-->/g,iq=/>/g,aV=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,iH=/'/g,iI=/"/g,iJ=/^(?:script|style|textarea|title)$/i,iL=a=>(b,...c)=>({_$litType$:a,strings:b,values:c}),o=iL(1),sy=iL(2),aX=Symbol.for("lit-noChange"),p=Symbol.for("lit-nothing"),iQ=new WeakMap,pa=(g,e,a)=>{var c,d;const f=(c=a==null?void 0:a.renderBefore)!==null&&c!==void 0?c:e;let b=f._$litPart$;if(b===void 0){const c=(d=a==null?void 0:a.renderBefore)!==null&&d!==void 0?d:null;f._$litPart$=b=new dO(e.insertBefore(cu(),c),c,void 0,a!=null?a:{})}return b._$AI(g),b},bx=bo.createTreeWalker(bo,129,null,!1),pc=(b,e)=>{const f=b.length-1,d=[];let c,g=e===2?"<svg>":"",a=co;for(let j=0;j<f;j++){const i=b[j];let l,e,h=-1,k=0;for(;k<i.length&&(a.lastIndex=k,e=a.exec(i),e!==null);)k=a.lastIndex,a===co?e[1]==="!--"?a=ip:e[1]!==void 0?a=iq:e[2]!==void 0?(iJ.test(e[2])&&(c=RegExp("</"+e[2],"g")),a=aV):e[3]!==void 0&&(a=aV):a===aV?e[0]===">"?(a=c!=null?c:co,h=-1):e[1]===void 0?h=-2:(h=a.lastIndex-e[2].length,l=e[1],a=e[3]===void 0?aV:e[3]==='"'?iI:iH):a===iI||a===iH?a=aV:a===ip||a===iq?a=co:(a=aV,c=void 0);const m=a===aV&&b[j+1].startsWith("/>")?" ":"";g+=a===co?i+oJ:h>=0?(d.push(l),i.slice(0,h)+"$lit$"+i.slice(h)+at+m):i+at+(h===-2?(d.push(void 0),j):m)}const h=g+(b[f]||"<?>")+(e===2?"</svg>":"");if(!Array.isArray(b)||!b.hasOwnProperty("raw"))throw Error("invalid template strings array");return[h_!==void 0?h_.createHTML(h):h,d]},dK=class{constructor({strings:d,_$litType$:e},f){let a;this.parts=[];let c=0,g=0;const h=d.length-1,b=this.parts,[i,j]=pc(d,e);if(this.el=dK.createElement(i,f),bx.currentNode=this.el.content,e===2){const a=this.el.content,b=a.firstChild;b.remove(),a.append(...b.childNodes)}for(;(a=bx.nextNode())!==null&&b.length<h;){if(a.nodeType===1){{if(a.hasAttributes()){const d=[];for(const e of a.getAttributeNames())if(e.endsWith("$lit$")||e.startsWith(at)){const f=j[g++];if(d.push(e),f!==void 0){const e=a.getAttribute(f.toLowerCase()+"$lit$").split(at),d=/([.?@])?(.*)/.exec(f);b.push({type:1,index:c,name:d[2],strings:e,ctor:d[1]==="."?pi:d[1]==="?"?pk:d[1]==="@"?pl:dI})}else b.push({type:6,index:c})}for(const b of d)a.removeAttribute(b)}if(iJ.test(a.tagName)){const d=a.textContent.split(at),e=d.length-1;if(e>0){a.textContent=bh?bh.emptyScript:"";for(let f=0;f<e;f++)a.append(d[f],cu()),bx.nextNode(),b.push({type:2,index:++c});a.append(d[e],cu())}}}}else if(a.nodeType===8)if(a.data===ie)b.push({type:2,index:c});else{let d=-1;for(;(d=a.data.indexOf(at,d+1))!==-1;)b.push({type:7,index:c}),d+=at.length-1}c++}}static createElement(b,c){const a=bo.createElement("template");return a.innerHTML=b,a}};function bD(d,b,e=d,c){var f,g,h,j;if(b===aX)return b;let a=c!==void 0?(f=e._$Cl)===null||f===void 0?void 0:f[c]:e._$Cu;const i=cr(b)?void 0:b._$litDirective$;return(a==null?void 0:a.constructor)!==i&&((g=a==null?void 0:a._$AO)===null||g===void 0||g.call(a,!1),i===void 0?a=void 0:(a=new i(d),a._$AT(d,e,c)),c!==void 0?((h=(j=e)._$Cl)!==null&&h!==void 0?h:j._$Cl=[])[c]=a:e._$Cu=a),a!==void 0&&(b=bD(d,a._$AS(d,b.values),a,c)),b}pf=class{constructor(a,b){this.v=[],this._$AN=void 0,this._$AD=a,this._$AM=b}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}p(b){var d;const{el:{content:i},parts:f}=this._$AD,g=((d=b==null?void 0:b.creationScope)!==null&&d!==void 0?d:bo).importNode(i,!0);bx.currentNode=g;let c=bx.nextNode(),e=0,h=0,a=f[0];for(;a!==void 0;){if(e===a.index){let d;a.type===2?d=new dO(c,c.nextSibling,this,b):a.type===1?d=new a.ctor(c,a.name,a.strings,this,b):a.type===6&&(d=new pm(c,this,b)),this.v.push(d),a=f[++h]}e!==(a==null?void 0:a.index)&&(c=bx.nextNode(),e++)}return g}m(b){let a=0;for(const c of this.v)c!==void 0&&(c.strings!==void 0?(c._$AI(b,c,a),a+=c.strings.length-2):c._$AI(b[a])),a++}},dO=class{constructor(c,d,e,a){var b;this.type=2,this._$AH=p,this._$AN=void 0,this._$AA=c,this._$AB=d,this._$AM=e,this.options=a,this._$Cg=(b=a==null?void 0:a.isConnected)===null||b===void 0||b}get _$AU(){var a,b;return(b=(a=this._$AM)===null||a===void 0?void 0:a._$AU)!==null&&b!==void 0?b:this._$Cg}get parentNode(){let a=this._$AA.parentNode;const b=this._$AM;return b!==void 0&&a.nodeType===11&&(a=b.parentNode),a}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(a,b=this){a=bD(this,a,b),cr(a)?a===p||a==null||a===""?(this._$AH!==p&&this._$AR(),this._$AH=p):a!==this._$AH&&a!==aX&&this.$(a):a._$litType$!==void 0?this.T(a):a.nodeType!==void 0?this.S(a):oO(a)?this.A(a):this.$(a)}M(a,b=this._$AB){return this._$AA.parentNode.insertBefore(a,b)}S(a){this._$AH!==a&&(this._$AR(),this._$AH=this.M(a))}$(a){this._$AH!==p&&cr(this._$AH)?this._$AA.nextSibling.data=a:this.S(bo.createTextNode(a)),this._$AH=a}T(c){var b;const{values:d,_$litType$:a}=c,e=typeof a=="number"?this._$AC(c):(a.el===void 0&&(a.el=dK.createElement(a.h,this.options)),a);if(((b=this._$AH)===null||b===void 0?void 0:b._$AD)===e)this._$AH.m(d);else{const a=new pf(e,this),b=a.p(this.options);a.m(d),this.S(b),this._$AH=a}}_$AC(a){let b=iQ.get(a.strings);return b===void 0&&iQ.set(a.strings,b=new dK(a)),b}A(d){ik(this._$AH)||(this._$AH=[],this._$AR());const b=this._$AH;let c,a=0;for(const e of d)a===b.length?b.push(c=new dO(this.M(cu()),this.M(cu()),this,this.options)):c=b[a],c._$AI(e),a++;a<b.length&&(this._$AR(c&&c._$AB.nextSibling,a),b.length=a)}_$AR(a=this._$AA.nextSibling,c){var b;for((b=this._$AP)===null||b===void 0||b.call(this,!1,!0,c);a&&a!==this._$AB;){const d=a.nextSibling;a.remove(),a=d}}setConnected(b){var a;this._$AM===void 0&&(this._$Cg=b,(a=this._$AP)===null||a===void 0||a.call(this,b))}},dI=class{constructor(b,c,a,d,e){this.type=1,this._$AH=p,this._$AN=void 0,this.element=b,this.name=c,this._$AM=d,this.options=e,a.length>2||a[0]!==""||a[1]!==""?(this._$AH=Array(a.length-1).fill(new String),this.strings=a):this._$AH=p}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(a,d=this,e,f){const c=this.strings;let b=!1;if(c===void 0)a=bD(this,a,d,0),b=!cr(a)||a!==this._$AH&&a!==aX,b&&(this._$AH=a);else{const h=a;let f,g;for(a=c[0],f=0;f<c.length-1;f++)g=bD(this,h[e+f],d,f),g===aX&&(g=this._$AH[f]),b||(b=!cr(g)||g!==this._$AH[f]),g===p?a=p:a!==p&&(a+=(g!=null?g:"")+c[f+1]),this._$AH[f]=g}b&&!f&&this.k(a)}k(a){a===p?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,a!=null?a:"")}},pi=class extends dI{constructor(){super(...arguments),this.type=3}k(a){this.element[this.name]=a===p?void 0:a}},pj=bh?bh.emptyScript:"",pk=class extends dI{constructor(){super(...arguments),this.type=4}k(a){a&&a!==p?this.element.setAttribute(this.name,pj):this.element.removeAttribute(this.name)}},pl=class extends dI{constructor(a,b,c,d,e){super(a,b,c,d,e),this.type=5}_$AI(a,e=this){var c;if((a=(c=bD(this,a,e,0))!==null&&c!==void 0?c:p)===aX)return;const b=this._$AH,d=a===p&&b!==p||a.capture!==b.capture||a.once!==b.once||a.passive!==b.passive,f=a!==p&&(b===p||d);d&&this.element.removeEventListener(this.name,this,b),f&&this.element.addEventListener(this.name,this,a),this._$AH=a}handleEvent(c){var a,b;typeof this._$AH=="function"?this._$AH.call((b=(a=this.options)===null||a===void 0?void 0:a.host)!==null&&b!==void 0?b:this.element,c):this._$AH.handleEvent(c)}},pm=class{constructor(a,b,c){this.element=a,this.type=6,this._$AN=void 0,this._$AM=b,this.options=c}get _$AU(){return this._$AM._$AU}_$AI(a){bD(this,a)}},jl=window.litHtmlPolyfillSupport,jl==null||jl(dK,dO),((fx=globalThis.litHtmlVersions)!==null&&fx!==void 0?fx:globalThis.litHtmlVersions=[]).push("2.1.3"),au=class extends be{constructor(){super(...arguments),this.renderOptions={host:this},this._$Dt=void 0}createRenderRoot(){var a,b;const c=super.createRenderRoot();return(a=(b=this.renderOptions).renderBefore)!==null&&a!==void 0||(b.renderBefore=c.firstChild),c}update(a){const b=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(a),this._$Dt=pa(b,this.renderRoot,this.renderOptions)}connectedCallback(){var a;super.connectedCallback(),(a=this._$Dt)===null||a===void 0||a.setConnected(!0)}disconnectedCallback(){var a;super.disconnectedCallback(),(a=this._$Dt)===null||a===void 0||a.setConnected(!1)}render(){return aX}},au.finalized=!0,au._$litElement$=!0,(es=globalThis.litElementHydrateSupport)===null||es===void 0||es.call(globalThis,{LitElement:au}),jm=globalThis.litElementPolyfillSupport,jm==null||jm({LitElement:au}),((et=globalThis.litElementVersions)!==null&&et!==void 0?et:globalThis.litElementVersions=[]).push("3.1.2"),dp=a=>b=>typeof b=="function"?((b,a)=>(window.customElements.define(b,a),a))(a,b):((a,b)=>{const{kind:c,elements:d}=b;return{kind:c,elements:d,finisher(b){window.customElements.define(a,b)}}})(a,b),pt=(b,a)=>a.kind==="method"&&a.descriptor&&!("value"in a.descriptor)?{...a,finisher(c){c.createProperty(a.key,b)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:a.key,initializer(){typeof a.initializer=="function"&&(this[a.key]=a.initializer.call(this))},finisher(c){c.createProperty(a.key,b)}};function az(a){return(b,c)=>c!==void 0?((a,b,c)=>{b.constructor.createProperty(c,a)})(a,b,c):pt(a,b)}function dn(a){return az({...a,state:!0})}sx=((eF=window.HTMLSlotElement)===null||eF===void 0?void 0:eF.prototype.assignedElements)!=null?(a,b)=>a.assignedElements(b):(a,b)=>a.assignedNodes(b).filter(a=>a.nodeType===Node.ELEMENT_NODE),af=class{constructor(a){this.values=[],this.delimiter=":",this.hasValue(a)&&this.addValue(a)}toString(){return this.values.join(this.delimiter)}hasValue(a){return typeof a!="undefined"&&a!==null&&a!==""}addValue(a){return Array.isArray(a)?this.values=this.values.concat(a):this.values.push(a),this.values=this.values.filter(a=>this.hasValue(a)),this}setDelimiter(a){return this.delimiter=a,this}},pz=class extends Error{constructor(a="Unsupported"){super(a)}};function eH(a){return new pz(a)}function pB(){return this._qualifierModel||{error:eH(`unsupported qualifier ${this.constructor.name}`)}}pC=class{constructor(){this._qualifierModel={}}toJson(){return pB.apply(this)}},G=class extends pC{constructor(b,a){super(),this.delimiter="_",this.key=b,a instanceof af?this.qualifierValue=a:(this.qualifierValue=new af,this.qualifierValue.addValue(a))}toString(){const{key:a,delimiter:b,qualifierValue:c}=this;return`${a}${b}${c.toString()}`}addValue(a){return this.qualifierValue.addValue(a),this}},aa=class extends G{constructor(c,a){let b;a?b=new af([c,`${a}`]).setDelimiter(":"):b=c,super("fl",b),this.flagValue=a}toString(){return super.toString().replace(/\./,"%2E")}getFlagValue(){return this.flagValue}};function pF(b,c){const a=Array.from(b.entries());return c.forEach(b=>{a.push(["fl",b])}),a.sort().map(a=>a[1])}function pG(){return this._actionModel&&this._actionModel.actionType?this._actionModel:{error:eH(`unsupported action ${this.constructor.name}`)}}pH=class{constructor(){this._actionModel={}}toJson(){return pG.apply(this)}},cm=class extends pH{constructor(){super(...arguments),this.qualifiers=new Map,this.flags=[],this.delimiter=",",this.actionTag=""}prepareQualifiers(){}getActionTag(){return this.actionTag}setActionTag(a){return this.actionTag=a,this}toString(){return this.prepareQualifiers(),pF(this.qualifiers,this.flags).join(this.delimiter)}addQualifier(a){if(typeof a=="string"){const[b,c]=a.toLowerCase().split("_");b==="fl"?this.flags.push(new aa(c)):this.qualifiers.set(b,new G(b,c))}else this.qualifiers.set(a.key,a);return this}addFlag(a){return typeof a=="string"?this.flags.push(new aa(a)):a instanceof aa&&this.flags.push(a),this}addValueToQualifier(a,b){return this.qualifiers.get(a).addValue(b),this}};function jn(b){const a=b.toString();if(a.match(/[A-Z]/gi))return a;if(a.length>1&&a[0]==="0")return a;const c=!isNaN(parseFloat(a))&&a.indexOf(":")===-1;return c&&a.indexOf(".")===-1?`${a}.0`:a}pK=class extends af{};function pL(){return new aa("ignore_aspect_ratio")}function pM(){return new aa("lossy")}function pN(){return new aa("preserve_transparency")}function pO(a){return new aa("progressive",a)}function pP(){return new aa("region_relative")}function pQ(){return new aa("relative")}function bz(a){const b={};return Object.keys(a).forEach(c=>{b[a[c]]=c}),b}jq=["cname","secureDistribution","privateCdn","signUrl","longUrlSignature","shorten","useRootPath","secure","forceVersion","analytics"],jr={"=":"eq","!=":"ne","<":"lt",">":"gt","<=":"lte",">=":"gte","&&":"and","||":"or","*":"mul","/":"div","+":"add","-":"sub","^":"pow"},js={aspect_ratio:"ar",aspectRatio:"ar",current_page:"cp",currentPage:"cp",duration:"du",face_count:"fc",faceCount:"fc",height:"h",initial_aspect_ratio:"iar",initial_height:"ih",initial_width:"iw",initialAspectRatio:"iar",initialHeight:"ih",initialWidth:"iw",initial_duration:"idu",initialDuration:"idu",page_count:"pc",page_x:"px",page_y:"py",pageCount:"pc",pageX:"px",pageY:"py",tags:"tags",width:"w",trimmed_aspect_ratio:"tar",current_public_id:"cpi",initial_density:"idn",page_names:"pgnames"},jt={limitFit:"limit",limitFill:"lfill",minimumFit:"mfit",thumbnail:"thumb",limitPad:"lpad",minimumPad:"mpad"},pW={colorSpace:"cs",dpr:"dpr",density:"dn",defaultImage:"d",format:"f",quality:"q"},pX={redEye:"redeye",advancedRedEye:"adv_redeye",oilPaint:"oil_paint",unsharpMask:"unsharp_mask"},pY={autoBest:"auto:best",autoEco:"auto:eco",autoGood:"auto:good",autoLow:"auto:low",jpegminiHigh:"jpegmini:1",jpegminiMedium:"jpegmini:2",jpegminiBest:"jpegmini:0"},pZ={444:"CHROMA_444",420:"CHROMA_420"},p_={noCmyk:"no_cmyk",keepCmyk:"keep_cmyk",tinySrgb:"tinysrgb",srgbTrueColor:"srgb:truecolor"},sw=bz(pZ),sv=bz(p_),qb=bz(jt),qc=bz(pW),sz=bz(pX),su=bz(pY),qf=class extends cm{constructor(a,b,c){super(),this._actionModel={dimensions:{}},this._actionModel.actionType=qb[a]||a,this.addQualifier(new G("c",a)),b&&this.width(b),c&&this.height(c)}height(a){return this._actionModel.dimensions.height=a,this.addQualifier(new G("h",a))}width(a){return this._actionModel.dimensions.width=a,this.addQualifier(new G("w",a))}aspectRatio(a){if(a instanceof pK)return this._actionModel.dimensions.aspectRatio=`${a}`,this.addQualifier(new G("ar",a));if(typeof a=="number"||typeof a=="string")return this._actionModel.dimensions.aspectRatio=jn(a),this.addQualifier(new G("ar",jn(a)));if(a instanceof aa)return this._actionModel.dimensions.aspectRatio=`${a.qualifierValue}`,this.addFlag(a)}relative(){return this._actionModel.relative=!0,this.addFlag(pQ())}regionRelative(){return this._actionModel.regionRelative=!0,this.addFlag(pP())}static fromJson(d){const{actionType:c,dimensions:e,relative:j,regionRelative:f}=d,{aspectRatio:b,width:g,height:h}=e,i=jt[c]||c,a=new this(i,g,h);return b&&a.aspectRatio(b==="ignore_aspect_ratio"?pL():b),j&&a.relative(),f&&a.regionRelative(),a}},ju=class extends G{constructor(a){super("g",new af(a))}},jv=class extends ju{constructor(){super("auto")}autoFocus(...a){return this.addValue(a),this}},jw=class extends ju{constructor(a){super(a)}fallbackGravity(a){return this.addValue(a.qualifierValue),this}};function jx(...a){const b=[...a];return new jw(b)}function jy(){return new jv}db=class extends af{constructor(a){super(),this.name=a}toString(){return this.name}};function qm(){return new db("ocr_text")}function qn(a){return a&&`${a}`.split(":")[0]==="auto"}function qo(a){const b=e_(a);return["north","center","east","west","south","north_west","south_east","south_west","north_east"].includes(b)}function e_(a){return`${a}`.replace("g_","")}function qq(a){return{compass:e_(a),gravityType:"direction"}}function qr(a){return e_(a)==="ocr_text"}function qs(){return{gravityType:"ocr"}}function qt(a){return`${a.qualifierValue}`.split(":")[0]==="auto"}function qu(c){const d=c.toString(),a=d.split("_"),b={object:a[0]};return a.length>1&&(a[1]==="avoid"?b.avoid=!0:b.weight=+a[1]),b}function jz(a){let b;const c=a==="auto"?new jv:a;`${a}`.startsWith("auto:")?b=`${a}`.split(":").filter(a=>a!=="auto"):b=c.qualifierValue.values.filter(a=>a!=="auto");const d=b.map(qu);return{gravityType:"auto",autoFocus:d}}function qw(b){const c=`${b}`.split(":").includes("auto"),a=b.qualifierValue.values,e=c?a.slice(0,a.length-1):a,d={gravityType:"object",focusOnObjects:e.map(a=>`${a}`)};if(c){const b=a[a.length-1].values.slice(1),c=jy().autoFocus(...b);d.fallbackGravity=jz(c)}return d}function qx(a){const b=a.split(":"),c=b.map(a=>new db(a));return new jw(c)}function qy(a){return qo(a)?qq(a):qr(a)?qs():qn(a)||qt(a)?jz(a):qw(typeof a=="string"?qx(a):a)}jA=class extends af{constructor(a,b){super(),this._weight=b,this.focusOn=a,this.shouldAvoid=!1}static focusOn(a,b){return new jA(a,b)}shouldAddWeight(){return typeof this._weight=="number"||typeof this._weight=="string"||this.shouldAvoid}getName(){return this.focusOn.name}getWeight(){return this.shouldAvoid?"avoid":this._weight}toString(){return this.shouldAddWeight()?`${this.getName()}_${this.getWeight()}`:`${this.getName()}`}weight(a){return this._weight=a,this}avoid(){return this.shouldAvoid=!0,this}};function qA(a){return a.gravityType==="direction"}function qB(a){return a.gravityType==="ocr"}function qC(a){return a.gravityType==="auto"}function qD(c){const{object:d,weight:a,avoid:e}=c,b=new jA(new db(d));return(a||a===0)&&b.weight(a),e&&b.avoid(),b}function jD(a){const b=a.autoFocus||[],c=b.map(qD);return jy().autoFocus(...c)}function qF(a){const c=(a.focusOnObjects||[]).map(a=>new db(a)),b=jx(...c);if(a.fallbackGravity){const c=jD(a.fallbackGravity);b.fallbackGravity(c)}return b}function qG(a){return qA(a)?a.compass:qB(a)?jx(qm()):qC(a)?jD(a):qF(a)}fa=class extends qf{gravity(a){this._actionModel.gravity=qy(a);const b=typeof a=="string"?new G("g",a):a;return this.addQualifier(b)}static fromJson(a){const b=super.fromJson.apply(this,[a]);return a.gravity&&b.gravity(qG(a.gravity)),b}},cZ=class extends G{constructor(a){super("b"),a&&this.addValue(a)}},qJ=class extends cZ{intensity(a){return this.intensityLevel=a,this}brightness(a){return this.brightnessLevel=a,this}toString(){return`
    b_blurred
    ${this.intensityLevel?`:${this.intensityLevel}`:""}
    ${this.brightnessLevel?`:${this.brightnessLevel}`:""}
    `.replace(/\s+/g,"")}},jE=qJ;function ff(a){return a&&a.match(/^#/)?`rgb:${a.substr(1)}`:a}fg=class extends cZ{constructor(){super(),this._palette=[]}contrast(){return this._contrast=!0,this}palette(...a){return this._palette=a.map(a=>ff(a)),this}},jF=class extends fg{toString(){return`
    b_auto:border
    ${this._contrast?"_contrast":""}
    ${this._palette.length?`:palette_${this._palette.join("_")}`:""}
    `.replace(/\s+/g,"")}},jH=class extends fg{gradientColors(a){return this._gradientColors=a,this}gradientDirection(a){return this._gradientDirection=a,this}},jI=class extends jH{toString(){return`
    b_auto:border_gradient
    ${this._contrast?"_contrast":""}
    ${this._gradientColors?`:${this._gradientColors}`:""}
    ${this._gradientDirection?`:${this._gradientDirection}`:""}
    ${this._palette.length?`:palette_${this._palette.join("_")}`:""}
    `.replace(/\s+/g,"")}},jK=class extends jH{toString(){return`
    b_auto:predominant_gradient
    ${this._contrast?"_contrast":""}
    ${this._gradientColors?`:${this._gradientColors}`:""}
    ${this._gradientDirection?`:${this._gradientDirection}`:""}
    ${this._palette.length?`:palette_${this._palette.join("_")}`:""}
    `.replace(/\s+/g,"")}},jM=class extends fg{toString(){return`
    b_auto:predominant
    ${this._contrast?"_contrast":""}
    ${this._palette.length?`:palette_${this._palette.join("_")}`:""}
    `.replace(/\s+/g,"")}};function jP(a){return`${a}`.replace("b_","")}function qT(){return{backgroundType:"auto"}}function qU(d){const{intensityLevel:a,brightnessLevel:b}=d,c={backgroundType:"blurred"};return(a||a===0)&&(c.intensity=a),(b||b===0)&&(c.brightness=b),c}function fo(b){const d=b._contrast,c=b._palette,a={backgroundType:""};return d&&(a.contrast=!0),c&&(a.palette=c),a}function qW(a){return Object.assign(Object.assign({},fo(a)),{backgroundType:"border"})}function jW(a){const c=a._gradientColors,d=`${a._gradientDirection}`,b=fo(a);return c&&(b.gradientColors=c),d&&(b.gradientDirection=d),b}function qY(a){return Object.assign(Object.assign({},jW(a)),{backgroundType:"borderGradient"})}function qZ(a){return{backgroundType:"color",color:jP(a)}}function q_(a){return Object.assign(Object.assign({},fo(a)),{backgroundType:"predominant"})}function q$(a){return Object.assign(Object.assign({},jW(a)),{backgroundType:"predominantGradient"})}function ra(a){return jP(a)==="auto"?qT():a instanceof jE?qU(a):a instanceof jF?qW(a):a instanceof jI?qY(a):a instanceof jM?q_(a):a instanceof jK?q$(a):qZ(a)}rb=class extends af{constructor(a){super(a),this.val=a}getValue(){return this.val}},rc=class extends af{constructor(a){super(),this.value=a}toString(){return this.value}};function rd(a){const b=Object.keys(jr).map(a=>`\\s${a.replace(/(\*|\+|\^|\|)/g,"\\$1")}\\s`),c=b.join("|"),d=new RegExp(`(${c})`,"g"),e=a.toString().replace(d,a=>`_${jr[a.trim()]}_`),f=Object.keys(js),g=f.join("|"),h=new RegExp(`(\\$_*[^_ ]+)|${g}`,"g"),i=e.replace(h,a=>a.startsWith("$")?a:js[a]||a),j=i.replace(/\s/g,"_");return new rc(j)}function jX(){return new jF}function jY(){return new cZ("auto")}function jZ(){return new jI}function j_(){return new jK}function kb(){return new jM}function kf(a){return new cZ(ff(a))}function rk(){return new jE}rl={auto:jY,border:jX,borderGradient:jZ,predominantGradient:j_,predominant:kb,color:kf,blurred:rk};function rm(d){const{brightness:a,intensity:b}=d,c=rl.blurred();return(a||a==0)&&c.brightness(a),(b||b==0)&&c.intensity(b),c}function kj(a,e){const{gradientColors:b,gradientDirection:c,contrast:f,palette:d}=e;return f&&a.contrast(),d&&a.palette(...d),b&&a.gradientColors(+b),c&&a.gradientDirection(c),a}function kl(a,c){const{contrast:d,palette:b}=c;return d&&a.contrast(),b&&a.palette(...b),a}function rp(a){const{backgroundType:b}=a;switch(b){case"auto":return jY();case"blurred":return rm(a);case"border":return kl(jX(),a);case"borderGradient":return kj(jZ(),a);case"predominant":return kl(kb(),a);case"predominantGradient":return kj(j_(),a);default:return kf(a.color)}}rq=class extends fa{background(a){return this._actionModel.background=ra(a),this.addQualifier(a)}offsetX(a){return this._actionModel.x=a,this.addQualifier(new G("x",a))}offsetY(a){return this._actionModel.y=a,this.addQualifier(new G("y",a))}static fromJson(a){const b=super.fromJson.apply(this,[a]);return a.background&&b.background(rp(a.background)),a.x&&b.offsetX(a.x),a.y&&b.offsetY(a.y),a.zoom&&b.zoom(a.zoom),b}},rr=class extends fa{zoom(a){return this._actionModel.zoom=a,this.addQualifier(new G("z",a))}static fromJson(a){const b=super.fromJson.apply(this,[a]);return a.zoom&&b.zoom(a.zoom),b}},rs=class extends fa{x(a){return this._actionModel.x=a,this.addQualifier(new G("x",a))}y(a){return this._actionModel.y=a,this.addQualifier(new G("y",a))}static fromJson(a){const b=super.fromJson.apply(this,[a]);return a.x&&b.x(a.x),a.y&&b.y(a.y),b}};function rt(a,b){return new rs("fill",a,b)}function ru(a,b){return new rq("pad",a,b)}function rv(a,b){return new rr("thumb",a,b)}function rw(a){return!(typeof a!="object"||a instanceof Array)}rx=class{filterOutNonSupportedKeys(a,c){const b=Object.create({});return rw(a)?(Object.keys(a).forEach(d=>{c.indexOf(d)>=0?b[d]=a[d]:console.warn("Warning - unsupported key provided to configuration: ",d)}),b):Object.create({})}},ry=rx,ko=class extends ry{constructor(a){super();const b=this.filterOutNonSupportedKeys(a,jq);Object.assign(this,{secure:!0},b)}extend(a){const b=this.filterOutNonSupportedKeys(a,jq);return new ko(Object.assign({},this,b))}setCname(a){return this.cname=a,this}setSecureDistribution(a){return this.secureDistribution=a,this}setPrivateCdn(a){return this.privateCdn=a,this}setSignUrl(a){return this.signUrl=a,this}setLongUrlSignature(a){return this.longUrlSignature=a,this}setShorten(a){return this.shorten=a,this}setUseRootPath(a){return this.useRootPath=a,this}setSecure(a){return this.secure=a,this}setForceVersion(a){return this.forceVersion=a,this}},rA=ko,rB=class extends cm{constructor(a){super(),this.addQualifier(new G("b",new af(a).setDelimiter("_")))}},kr=class{constructor(a){this.raw=a}toString(){return this.raw}toJson(){return{error:eH(`unsupported action ${this.constructor.name}`)}}};function rD(b){const a=b;return"error"in a&&!!a.error}bI=class{constructor(){this.actions=[]}addAction(a){let b;if(typeof a=="string"){if(a.indexOf("/")>=0)throw"addAction cannot accept a string with a forward slash in it - /, use .addTransformation() instead";b=new kr(a)}else b=a;return this.actions.push(b),this}addTransformation(a){return a instanceof bI?this.actions=this.actions.concat(a.actions):this.actions.push(new kr(a)),this}toString(){return this.actions.map(a=>a.toString()).filter(a=>a).join("/")}animated(a){return this.addAction(a)}border(a){return this.addAction(a)}reshape(a){return this.addAction(a)}resize(a){return this.addAction(a)}quality(a){return this.addAction(a)}roundCorners(a){return this.addAction(a)}overlay(a){return this.addAction(a)}underlay(a){return a.setLayerType("u"),this.addAction(a)}addVariable(a){return this.addAction(a)}conditional(a){return this.addAction(a)}effect(a){return this.addAction(a)}adjust(a){return this.addAction(a)}rotate(a){return this.addAction(a)}namedTransformation(a){return this.addAction(a)}delivery(a){return this.addAction(a)}backgroundColor(a){return this.addAction(new rB(ff(a)))}psdTools(a){return this.addAction(a)}extract(a){return this.addAction(a)}addFlag(a){const b=new cm;let c=a;return typeof a=="string"&&(c=new aa(a)),b.addQualifier(c),this.addAction(b)}customFunction(a){return this.addAction(a)}transcode(a){return this.addAction(a)}videoEdit(a){return this.addAction(a)}toJson(){const a=[];for(const c of this.actions){const b=c.toJson();if(rD(b))return b;a.push(b)}return{actions:a}}},rF=class extends bI{},rG=class extends bI{};function rH(a){return a.match(/^https?:\//)}function rI(a){return a.indexOf("/")<0}function rJ(a){return a.match(/^v[0-9]+/)}function rK(c,d){const a=d.secure,f=d.privateCdn,e=d.cname,b=d.secureDistribution;return!a&&!e?`http://res.cloudinary.com/${c}`:a&&!b&&f?`https://${c}-res.cloudinary.com`:a&&!b?`https://res.cloudinary.com/${c}`:a&&b&&f?`https://${b}`:a&&b?`https://${b}/${c}`:!a&&e?`http://${e}/${c}`:"ERROR"}function rL(a){return a||"image"}function rM(a){return a||"upload"}function rN(a,b,c){const d=c!==!1;return b?`v${b}`:rJ(a)||rH(a)||rI(a)?"":d?"v1":""}function fC(c,e,d){let a=e>>0,b=String(typeof d!="undefined"?d:" ");return c.length>a?String(c):(a=a-c.length,a>b.length&&(b+=rP(b,a/b.length)),b.slice(0,a)+String(c))}function rP(c,d){let a=d,b="";while(a>0)b+=c,a--;return b}rQ="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",kv={},kw=0,rQ.split("").forEach(b=>{let a=kw.toString(2);a=fC(a,6,"0"),kv[a]=b,kw++});function rT(a){if(a.split(".").length<2)throw new Error("invalid semVer, must have at least two segments");return a.split(".").reverse().map(a=>{const b=+a;if(isNaN(b)||b<0)throw"Invalid version number provided";return fC(a,2,"0")}).join(".")}function kz(c){let b="";const d=c.split(".").length,e=d*6,f=rT(c),g=parseInt(f.split(".").join(""));let a=g.toString(2);if(a=fC(a,e,"0"),a.length%6!==0)throw"Version must be smaller than 43.21.26)";return a.match(/.{1,6}/g).forEach(a=>{b+=kv[a]}),b}function rV(a){const b={sdkSemver:a.sdkSemver,techVersion:a.techVersion,sdkCode:a.sdkCode,feature:"0"};return a.accessibility&&(b.feature="D"),a.lazyload&&(b.feature="C"),a.responsive&&(b.feature="A"),a.placeholder&&(b.feature="B"),b}rW="1.5.1";function rX(){const a="0.0.0";if(typeof window!="undefined")return a;try{return process.versions.node||a}catch(b){return a}}function rY(a){const b={techVersion:rX(),sdkCode:"T",sdkSemver:rW.split("-")[0],responsive:!1,placeholder:!1,lazyload:!1,accessibility:!1};return a?Object.assign(Object.assign({},b),a):b}function rZ(b){const c=rY(b),a=rV(c);try{const b=r_(a.techVersion),c=kz(a.sdkSemver),d=kz(b),e=a.feature,f=a.sdkCode,g="A";return`${g}${f}${c}${d}${e}`}catch(a){return"E"}}function r_(b){const a=b.split(".");return`${a[0]}.${a[1]}`}kA={"image/upload":"images","image/private":"private_images","image/authenticated":"authenticated_images","raw/upload":"files","video/upload":"videos"},sa=class{constructor(a,b={},c){this.setPublicID(a),this.setCloudConfig(b),this.setURLConfig(c)}setURLConfig(a){return this.urlConfig=new rA(a),this}setCloudConfig(a){return this.cloudName=a.cloudName,this.apiKey=a.apiKey,this.apiSecret=a.apiSecret,this.authToken=a.authToken,this}setPublicID(a){return this.publicID=a?a.toString():"",this}setDeliveryType(a){return this.deliveryType=a,this}setSuffix(a){return this.suffix=a,this}setSignature(a){return this.signature=a,this}setVersion(a){return a&&(this.version=a),this}setAssetType(a){return a&&(this.assetType=a),this}sign(){return this}toURL(a={}){return this.createCloudinaryURL(null,a.trackedAnalytics)}validateAssetForURLCreation(){if(typeof this.cloudName=="undefined")throw"You must supply a cloudName when initializing the asset";const a=this.suffix&&this.suffix.indexOf(".")>=0,b=this.suffix&&this.suffix.indexOf("/")>=0;if(a||b)throw"`suffix`` should not include . or /"}getResourceType(){const b=rL(this.assetType),c=rM(this.deliveryType),e=!!this.suffix,a=`${b}/${c}`,d=kA[`${b}/${c}`],f=this.urlConfig.useRootPath,g=this.urlConfig.shorten;if(f){if(a==="image/upload")return"";throw new Error(`useRootPath can only be used with assetType: 'image' and deliveryType: 'upload'. Provided: ${a} instead`)}if(g&&a==="image/upload")return"iu";if(e){if(d)return d;throw new Error(`URL Suffix only supported for ${Object.keys(kA).join(", ")}, Provided: ${a} instead`)}return a}getSignature(){return this.signature?`s--${this.signature}--`:""}createCloudinaryURL(a,h){if(!this.publicID)return"";this.validateAssetForURLCreation();const e=rK(this.cloudName,this.urlConfig),f=a?a.toString():"",g=rN(this.publicID,this.version,this.urlConfig.forceVersion),c=this.publicID.replace(/,/g,"%2C"),d=[e,this.getResourceType(),this.getSignature(),f,g,c,this.suffix].filter(a=>a).join("/");if(typeof a=="string")return d;const b=encodeURI(d).replace(/\?/g,"%3F").replace(/=/g,"%3D");return this.urlConfig.analytics!==!1&&!c.includes("?")?`${b}?_a=${rZ(h)}`:b}},sb=class extends cm{constructor(c,a,d){super(),this._actionModel={};let b;a instanceof rb?b=a.getValue():b=a,this._actionModel.actionType=qc[c],this._actionModel[d]=b,this.addQualifier(new G(c,a))}},sc=class extends aa{constructor(a){super("progressive",a)}},kC=class extends sb{constructor(a,b){super(a,b,"formatType")}lossy(){return this._actionModel.lossy=!0,this.addFlag(pM()),this}progressive(a){return a instanceof sc?(this._actionModel.progressive={mode:a.getFlagValue()},this.addFlag(a)):(this._actionModel.progressive={mode:a},this.addFlag(pO(a))),this}preserveTransparency(){return this._actionModel.preserveTransparency=!0,this.addFlag(pN()),this}static fromJson(d){const{formatType:c,lossy:e,progressive:b,preserveTransparency:f}=d;let a;return c?a=new this("f",c):a=new this("f"),b&&(b.mode?a.progressive(b.mode):a.progressive()),e&&a.lossy(),f&&a.preserveTransparency(),a}},kD=class extends sa{constructor(a,b,c,d){super(a,b,c),this.transformation=d}animated(a){return this.transformation.animated(a),this}border(a){return this.transformation.border(a),this}reshape(a){return this.transformation.reshape(a),this}resize(a){return this.transformation.resize(a),this}quality(a){return this.addAction(new kC("q",a)),this}format(a){return this.addAction(new kC("f",a)),this}roundCorners(a){return this.transformation.roundCorners(a),this}overlay(a){return this.transformation.overlay(a),this}addVariable(a){return this.transformation.addVariable(a),this}conditional(a){return this.transformation.conditional(a),this}effect(a){return this.transformation.effect(a),this}adjust(a){return this.transformation.adjust(a),this}rotate(a){return this.transformation.rotate(a),this}namedTransformation(a){return this.transformation.namedTransformation(a),this}delivery(a){return this.transformation.delivery(a),this}backgroundColor(a){return this.transformation.backgroundColor(a),this}psdTools(a){return this.transformation.psdTools(a),this}extract(a){return this.transformation.extract(a),this}addFlag(a){return this.transformation.addFlag(a),this}customFunction(a){return this.transformation.customFunction(a),this}addAction(a){return this.transformation.addAction(a),this}addTransformation(a){return this.transformation.addTransformation(a),this}toString(){return this.transformation.toString()}underlay(a){return this.transformation.underlay(a),this}toURL(a={}){return this.createCloudinaryURL(this.transformation,a===null||a===void 0?void 0:a.trackedAnalytics)}},sf=class extends kD{constructor(a,b,c){super(a,b,c,new rF)}},sg=class extends kD{constructor(a,b,c){super(a,b,c,new rG),this.assetType="video"}transcode(a){return this.transformation.transcode(a),this}videoEdit(a){return this.transformation.videoEdit(a),this}},sh=class{constructor(a){a&&(this.cloudinaryConfig=a)}image(a){return new sf(a,this.cloudinaryConfig.cloud,this.cloudinaryConfig.url)}video(a){return new sg(a,this.cloudinaryConfig.cloud,this.cloudinaryConfig.url)}setConfig(a){return this.cloudinaryConfig=a,this}getConfig(){return this.cloudinaryConfig}extendConfig(){}},kF=new sh({cloud:{cloudName:"timbomckay"},url:{secure:!0}}),kI=Math.round(window.devicePixelRatio*60),ba=class extends au{connectedCallback(){super.connectedCallback(),this.setAttribute("tabindex","0"),this.addEventListener("dragstart",()=>{this.classList.add("dragging")}),this.addEventListener("dragend",()=>{this.classList.remove("dragging")}),this.addEventListener("dragenter",()=>{this.classList.add("hovering")}),this.addEventListener("dragleave",()=>{this.classList.remove("hovering")}),this.addEventListener("drop",()=>{this.classList.remove("hovering")})}render(){if(this.uid==null)return p;const{details:a}=this;if(this.title=a.name,a.rarity&&(this.rarity=a.rarity),a.image){const c=Object.keys(a.sources).shift(),d=a.name.replace(/\s/g,"_").replace(/,/g,"").replace(/\(/g,"").replace(/\)/g,"").replace(/'/g,""),b=kF.image(`items/${c}/${d}`);return b.format("auto").resize(rv().width(kI).height(kI)),o`<img src="${b.toURL()}" alt="${a.name}" crossorigin="anonymous" />`}return a.extends&&ek(this,"click"),o`${a.name}`}},ba.styles=br`
    * { box-sizing: border-box; }
  
    :host {
      aspect-ratio: 1/1;
      border-color: #78350f;
      border-style: solid;
      border-width: 1px;
      font-size: 0.75rem;
      line-height: 1;
      overflow: hidden;
      padding: 0.25rem;
      position: relative;
    }
    :host(.hovering) {
      background-color: red;
    }
    :host(.dragging) {
      background-color: yellow;
      transform: scale(1.15);
    }

    img {
      height: auto;
      width: auto;
      max-width: 100%;
      transform: scale(1.75);
      pointer-events: none;
    }

    :host([rarity])::before {      
      background-color: var(--rarity, transparent);
      content: "";
      display: block;
      height: 1rem;
      position: absolute;
      right: 0px;
      top: 0px;
      transform-origin: top;
      transform: rotate(45deg) translate(50%, -100%);
      width: 1rem;
      z-index: 1;
    }

    :host([rarity="common"]) { --rarity: #94A3B8; }
    :host([rarity="uncommon"]) { --rarity: #84CC16; }
    :host([rarity="rare"]) { --rarity: #3B82F6; }
    :host([rarity="very rare"]) { --rarity: #7C3AED; }
    :host([rarity="legendary"]) { --rarity: #FCD34D; }
    :host([rarity="artifact"]) { --rarity: #DC2626; }
  `,O([az()],ba.prototype,"uid",2),O([az({type:String,reflect:!0})],ba.prototype,"rarity",2),O([az({type:Object,attribute:!1,hasChanged(a,b){return JSON.stringify(a)!==JSON.stringify(b)}})],ba.prototype,"details",2),ba=O([dp("wc-item")],ba),sl={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},sm=a=>(...b)=>({_$litDirective$:a,values:b}),sn=class{constructor(a){}get _$AU(){return this._$AM._$AU}_$AT(a,b,c){this._$Ct=a,this._$AM=b,this._$Ci=c}_$AS(a,b){return this.update(a,b)}update(b,a){return this.render(...a)}},fG=class extends sn{constructor(a){if(super(a),this.it=p,a.type!==sl.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(a){if(a===p||a==null)return this.vt=void 0,this.it=a;if(a===aX)return a;if(typeof a!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(a===this.it)return this.vt;this.it=a;const b=[a];return b.raw=b,this.vt={_$litType$:this.constructor.resultType,strings:b,values:[]}}},fG.directiveName="unsafeHTML",fG.resultType=1,kJ=sm(fG),sq=class extends cm{constructor(a,b){super(),this.exp=a,this.ifTx=b}otherwise(a){return this.elseTx=a,this}toString(){return[`if_${rd(this.exp)}`,`${this.ifTx}`,this.elseTx&&`if_else/${this.elseTx}`,`if_end`].filter(a=>a).join("/")}};function oL(a,b){return new sq(a,b)}cF=qe(sp()),rz={AI:"Acquisitions Incorporated",AL:"Adventurers' League",AWM:"Adventure with Muk",AZfyT:"A Zib for your Thoughts",AitFR:"Adventures in the Forgotten Realms",BGDIA:"Baldur's Gate: Descent Into Avernus",CM:"Candlekeep Mysteries",CoS:"Curse of Strahd",DC:"Divine Contention",DIP:"Dragon of Icespire Peak",DMG:"Dungeon Master's Guide",DoD:"Domains of Delight",EEPC:"Elemental Evil Player's Companion",EET:"Elemental Evil: Trinkets",EFR:"Eberron: Forgotten Relics",EGW:"Explorer's Guide to Wildemount",ERLW:"Eberron: Rising from the Last War",ESK:"Essentials Kit",FTD:"Fizban's Treasury of Dragons",GGR:"Guildmasters' Guide to Ravnica",GoS:"Ghosts of Saltmarsh",HEROES_FEAST:"Heroes' Feast",HftT:"Hunt for the Thessalhydra",HoL:"The House of Lament",HotDQ:"Hoard of the Dragon Queen",IDRotF:"Icewind Dale: Rime of the Frostmaiden",IMR:"Infernal Machine Rebuild",KKW:"Krenko's Way",LLK:"Lost Laboratory of Kwalish",LMoP:"Lost Mine of Phandelver",LR:"Locathah Rising",MFF:"Mordenkainen's Fiendish Folio",MM:"Monster Manual",MOT:"Mythic Odysseys of Theros",MTF:"Mordenkainen's Tome of Foes",MaBJoV:"Minsc and Boo's Journal of Villainy",NRH:"NERDS Restoring Harmony",OGA:"One Grung Above",OoW:"The Orrery of the Wanderer",OotA:"Out of the Abyss",PHB:"Player's Handbook",PotA:"Princes of the Apocalypse",RMBRE:"The Lost Dungeon of Rickedness: Big Rick Energy",RMR:"Dungeons & Dragons vs. Rick and Morty: Basic Rules",RoT:"The Rise of Tiamat",RoTOS:"The Rise of Tiamat Online Supplement",RtG:"Return to Glory",SAC:"Sage Advice Compendium",SADS:"Sapphire Anniversary Dice Set",SCAG:"Sword Coast Adventurer's Guide",SCC:"Strixhaven: A Curriculum of Chaos",SCC_ARiR:"A Reckoning in Ruins",SCC_CK:"Campus Kerfuffle",SCC_HfMT:"Hunt for Mage Tower",SCC_TMM:"The Magister's Masquerade",SCREEN:"Dungeon Master's Screen",SCREEN_WILDERNESS_KIT:"Dungeon Master's Screen: Wilderness Kit",SDW:"Sleeping Dragon's Wake",SKT:"Storm King's Thunder",SLW:"Storm Lord's Wrath",TCE:"Tasha's Cauldron of Everything",TLK:"The Lost Kenku",TTP:"The Tortle Package",TftYP:"Tales from the Yawning Portal",ToA:"Tomb of Annihilation",ToD:"Tyranny of Dragons",VGM:"Volo's Guide to Monsters",VRGR:"Van Richten's Guide to Ravenloft",WBtW:"The Wild Beyond the Witchlight",WDH:"Waterdeep: Dragon Heist",WDMM:"Waterdeep: Dungeon of the Mad Mage",XGE:"Xanathar's Guide to Everything",XMtS:"X Marks the Spot"},cE=Math.round(window.devicePixelRatio*480),cl=class extends au{constructor(){super(...arguments),this.uid=null}imageTemplate(){const{details:a}=this;if(!a.image)return p;const c=Object.keys(a.sources).shift(),d=a.name.replace(/\s/g,"_").replace(/,/g,"").replace(/\(/g,"").replace(/\)/g,"").replace(/'/g,""),b=kF.image(`items/${c}/${d}`);return b.format("auto").conditional(oL("aspect_ratio > 1.2",(new bI).resize(rt().width(cE).height(cE*.5625))).otherwise((new bI).resize(ru().width(cE).height(cE*.5)))),o`<div class="image-container">
      <img src="${b.toURL()}" alt="${a.name}" width="2" height="1" crossorigin="anonymous" />
    </div>`}attunementTemplate(a){if(!a)return p;const b=o`<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 20 20" height="20" viewBox="0 0 20 20" width="20"><g><rect fill="none" height="20" width="20"/></g><g><path d="M18,10l-1.77-2.03l0.25-2.69l-2.63-0.6l-1.37-2.32L10,3.43L7.53,2.36L6.15,4.68L3.53,5.28l0.25,2.69L2,10l1.77,2.03 l-0.25,2.69l2.63,0.6l1.37,2.32L10,16.56l2.47,1.07l1.37-2.32l2.63-0.6l-0.25-2.69L18,10z M8.59,13.07l-2.12-2.12l0.71-0.71 l1.41,1.41l4.24-4.24l0.71,0.71L8.59,13.07z"/></g></svg>`,c=o`<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M23 12l-2.44-2.78.34-3.68-3.61-.82-1.89-3.18L12 3 8.6 1.54 6.71 4.72l-3.61.81.34 3.68L1 12l2.44 2.78-.34 3.69 3.61.82 1.89 3.18L12 21l3.4 1.46 1.89-3.18 3.61-.82-.34-3.68L23 12zm-10 5h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>`;return o`<span class="attunement icon" data-tooltip="requires attunement${a.length?` ${a}`:""}">
      ${b}
    </span>`}damageTemplate(a){if(!a)return p;const{roll:b,type:c,versatile:d}=a;return o`
      <span class="icon">
        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0zm21.02 19c0 1.1-.9 2-2 2h-14c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v14z" fill="none"/><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM7.5 18c-.83 0-1.5-.67-1.5-1.5S6.67 15 7.5 15s1.5.67 1.5 1.5S8.33 18 7.5 18zm0-9C6.67 9 6 8.33 6 7.5S6.67 6 7.5 6 9 6.67 9 7.5 8.33 9 7.5 9zm4.5 4.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4.5 4.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm0-9c-.83 0-1.5-.67-1.5-1.5S15.67 6 16.5 6s1.5.67 1.5 1.5S17.33 9 16.5 9z"/></svg>
      </span>
      ${[b,d].filter(a=>!!a).join("/")} ${c}
      <span style="margin-right: auto;"></span>`}chargeTemplate(a){if(!a)return p;const b=()=>o`<span class="icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M11 21h-1l1-7H7.5c-.58 0-.57-.32-.38-.66.19-.34.05-.08.07-.12C8.48 10.94 10.42 7.54 13 3h1l-1 7h3.5c.49 0 .56.33.47.51l-.07.15C12.96 17.55 11 21 11 21z"/></svg>
    </span>`;return a>8?o`<span class="charges">
        ${b()}<span>*${a}</span>
      </span>`:o`<span class="charges">${Array.from(Array(a)).map(()=>b())}</span>`}rarityTemplate(a){return!a||a==="varies"?p:o`<span data-rarity="${a}"></span>`}closeButtonTemplate(){const a=o`<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>`;return o`<button style="line-height: 0;" type="button" @click="${()=>{ek(this,"close")}}">${a}</button>`}menuButtonTemplate(){const a=o`<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>`;return o`<details>
      <summary style="line-height: 0;">${a}</summary>
      <div>
        <i>Menu in Progress</i>
      </div>
    </details>`}processEntries(a){return o`${a==null?p:a.map(a=>this.processEntry(a))}`}processEntry(a,b){if(typeof a=="string")switch(b){case"li":return o`<li>${kJ(a)}</li>`;default:return o`<p>${kJ(a)}</p>`}if(Array.isArray(a))return o`Array: <pre>${JSON.stringify(a,null,2)}</pre>`;switch(a.type){case"list":return o`<ul class=${a.style}>${a.items.map(a=>o`${this.processEntry(a,"li")}`)}</ul>`;default:return o`<pre>${JSON.stringify(a,null,2)}</pre>`}}render(){if(!this.uid)return p;const{attunement:f,charges:k,damage:j,entries:i,image:m,name:g,properties:a,range:n,rarity:d,sources:c,srd:l,tier:b,type:h,...e}=this.details;return o`
      ${this.imageTemplate()}
      <div class="title">
        ${g}
        <div>
          ${this.attunementTemplate(f)}
        </div>
        ${this.rarityTemplate(d)}
      </div>
      <div class="content">
        <div class="content-inner">
          <div class="info">
            <i>${h} ${b?`(${b})`:""} ${d}</i>
            <div style="display: flex; align-items: center; gap: 0.5rem; flex-shrink: 0;">
              ${this.chargeTemplate(k)}
              ${a?o`<div>${a.map((a,b)=>o`<span class="property" style="z-index: -${b};">${a}</span>`)}</div>`:""}
            </div>
          </div>
          ${Object.keys(e).length?o`<pre>${JSON.stringify(e,null,2)}</pre>`:""}
          ${this.processEntries(i)}
          <div>
            <i class="sources">
              ${c?Object.keys(c).map(a=>rz[a]).join(" \u2022\xA0"):""}
            </i>
          </div>
        </div>
      </div>
      <div class="footer">
        ${this.damageTemplate(j)}
        ${this.menuButtonTemplate()}
        ${this.closeButtonTemplate()}
      </div>
    `}},cl.styles=br`
    * { box-sizing: border-box; }

    :host {
      border-color: ${bL(cF.primary[800])};
      border-style: solid;
      border-width: 0 0 1px 0;
      display: block;
    }

    :host([uid=""]) {
      display: none;
    }

    .image-container {
      padding: 0;
      position: relative;
    }

    img {
      display: block;
      height: auto;
      line-height: 0;
      margin-left: auto;
      margin-right: auto;
      max-width: 100%;
      mix-blend-mode: multiply;
      width: 100%;
    }
    
    .content {
      padding: 0 0.5rem;
    }

    .content-inner {
      border-color: ${bL(cF.yellow[600])};
      border-style: solid;
      border-width: 1px 0;
      font-size: 0.85em;
      padding: 0.5rem 0;
      line-height: 1.25;
      max-height: 50vh;
      overflow: auto;
    }

    .title, .info {
      align-items: center;
      display: flex;
      gap: 1rem;
      justify-content: space-between;
    }

    .title {
      color: ${bL(cF.primary[600])};
      font-size: 1.125rem;
      line-height: 1;
      font-weight: 600;
      padding: 0.5rem;
      position: relative;
    }

    .title .attunement {
      flex-shrink: 0;
      color: ${bL(cF.primary[900])};
      color: black;
      opacity: 0.325;
    }

    .icon {
      display: inline-block;
      line-height: 0;
    }
    
    .icon > svg {
      display: block;
      fill: currentColor;
      height: 1em;
      max-height: 100%;
      max-width: 100%;
      width: 1em;
    }

    b { line-height: 1; }

    ul { padding-left: 1.25rem; }

    li, p {
      margin-top: 0.5em;
    }

    ul.none {
      padding-left: 0;
      list-style-none;
    }

    .charges {
      line-height: 1;
      display: inline-flex;
    }

    .charges > .icon {
      margin-left: -0.5em;
    }

    .sources {
      font-size: 0.9em;
      margin-top: 1rem;
      display: block;
    }

    .property {
      background-color: black;
      border-radius: 9999px;
      border: 1px solid white;
      color: white;
      display: inline-grid;
      font-family: sans-serif;
      font-size: 12px;
      font-weight: bold;
      height: 1rem;
      line-height: 1;
      margin-left: -0.325rem;
      padding: 0 0.325rem;
      place-content: center;
      position: relative;
      text-align: center;
    }

    .footer {
      display: flex;
      align-items: center;
      padding: 0.5rem;
      gap: 0.25rem;
      justify-content: flex-end;
      font-size: 0.85em;
    }

    button {
      border: 0;
      background-color: transparent;
      background-image: none;
      cursor: pointer;
      color: inherit;
      line-height: inherit;
      padding: 0;
    }

    details {
      position: relative;
    }

    summary {
      cursor: pointer;
      list-style: none;
    }

    ::-webkit-details-marker {
      display: none;
    }

    details > div {
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 2px;
      bottom: 100%;
      filter: drop-shadow(1px 2px 2px rgba(0, 0, 0, 0.125));
      padding: 0.5rem;
      position: absolute;
      right: -0.25rem;
      width: 14ch;
    }

    span[data-rarity] {
      background-color: var(--rarity, transparent);
      box-shadow: 0 0 0 2px white;
      content: "";
      display: block;
      font-size: 0.45rem;
      height: 1em;
      left: 50%;
      position: absolute;
      top: 100%;
      transform: translate(-50%, -50%) rotate(-45deg);
      width: 1em;
      z-index: 1;
    }

    span[data-rarity="common"] { --rarity: #94A3B8; }
    span[data-rarity="uncommon"] { --rarity: #84CC16; }
    span[data-rarity="rare"] { --rarity: #3B82F6; }
    span[data-rarity="very rare"] { --rarity: #7C3AED; }
    span[data-rarity="legendary"] { --rarity: #FCD34D; }
    span[data-rarity="artifact"] { --rarity: #DC2626; }

    pre {
      background-color: whitesmoke;
      border: 1px solid #ccc;
      padding: 0.5rem;
      border-radius: 0.5rem;
      overflow: auto;
      font-size: 0.75rem;
    }
  `,O([az()],cl.prototype,"uid",2),O([az({type:Object,attribute:!1,hasChanged(a,b){return JSON.stringify(a)!==JSON.stringify(b)}})],cl.prototype,"details",2),cl=O([dp("wc-item-details")],cl),aH=class extends au{constructor(){super(...arguments),this.list=[],this.uid="--uid--",this.isDropTarget=!1,this.active=""}connectedCallback(){super.connectedCallback(),this.addEventListener("dragenter",a=>a.preventDefault()),this.addEventListener("dragover",a=>{a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"})}render(){return o`
      <div class="title">${this.uid}</div>
      <wc-item-details
        uid="${this.active}"
        .details="${dR[this.active]}"
        @close="${()=>{this.active=""}}"
      ></wc-item-details>
      <div class="container ${this.isDropTarget?"highlight":""}">
        ${this.list.map((a,b)=>o`<wc-item
          uid="${a}"
          .index="${b}"
          .details="${dR[a]}"
          draggable="true"
          @click="${()=>{this.active=a}}"
        ></wc-item>`)}
      </div>
    `}},aH.styles=[br`
      * { box-sizing: border-box; }

      .title {
        background-color: rgb(254, 243, 199);
        font-size: 0.9rem;
        padding: 0 0.25rem;
        text-align: center;
        position: sticky;
        top: 4.5rem;
        z-index: 9;
      }
      .container {
        padding: 0.5rem;
        display: grid;
        gap: 0.25rem;
        grid-template-columns: repeat(auto-fill, minmax(2.5rem, 1fr));
      }
      .highlight {
        background-color: yellow;
      }
    `,br`@media (min-width: 48rem) {
      .container {
        padding: 0.25rem;
      }

      .title {
        top: 2.5rem;
      }
    }`],O([az({type:Array,attribute:!1,hasChanged(a,b){return JSON.stringify(a)!==JSON.stringify(b)}})],aH.prototype,"list",2),O([az()],aH.prototype,"uid",2),O([dn()],aH.prototype,"isDropTarget",2),O([dn()],aH.prototype,"active",2),aH=O([dp("wc-item-list")],aH);function ak(){const a=Object.keys(dR);return a[Math.floor(Math.random()*a.length)]}function ah(){return Array.from(Array(Math.floor(Math.random()*24+7)),()=>ak())}nH=()=>({"ch-uid-123":{name:"Tenebrae",inventory:{Attuned:[ak(),ak()],Inventory:ah(),Backpack:ah(),"Bag of Holding":ah()}},"ch-uid-321":{name:"Cyan",inventory:{Attuned:[ak(),ak(),ak()],Inventory:ah(),Backpack:ah(),"Astral Scarf":ah()}},"ch-uid-aaa":{name:"Chris...?",inventory:{Attuned:[ak()],Inventory:ah(),Backpack:ah()}},"ch-uid-abc":{name:"DOMO",inventory:{Attuned:[ak(),ak()],Inventory:ah(),Backpack:ah()}}}),bE=class extends au{constructor(){super(...arguments),this.data=null,this.dragging={}}handleDrag(a,b,c){const{index:d,uid:e}=c.composedPath().shift();this.dragging={ch:a,list:b,index:d,uid:e}}handleDrop(c,d,e){e.preventDefault();const a=JSON.parse(JSON.stringify(this.data)),{ch:f,list:g,index:h,uid:i}=this.dragging;let{index:b}=e.composedPath().shift();b==null&&(b=a[c].inventory[d].length),a[f].inventory[g].splice(h,1),a[c].inventory[d].splice(b,0,i),this.data=a,this.dragging={}}setData(){this.data=nH()}connectedCallback(){super.connectedCallback(),window.addEventListener("ITEMS",()=>this.setData())}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("ITEMS",()=>this.setData())}render(){return this.data==null?p:o`${Object.entries(this.data).map(([a,b])=>o`<div class="character">
        <div class="name">${b.name}</div>
        ${Object.entries(b.inventory).map(([b,c])=>o`<wc-item-list
            .list="${c}"
            @drop="${c=>this.handleDrop(a,b,c)}"
            @dragstart="${c=>this.handleDrag(a,b,c)}"
            uid="${b}"
          ></wc-item-list>`)}
      </div>`)}`}},bE.styles=[br`
      * { box-sizing: border-box; }

      :host {
        min-height: calc(100vh - 5rem);
      }
      .character {
        border-width: 0 0 1px 0;
        border-color: #78350f;
        border-style: solid;
        list-style: none;
      }
      .name {
        text-align: center;
        padding: 0.5rem;
        position: sticky;
        top: 2rem;
        z-index: 10;
        background-color: white;
        height: 2.5rem;
      }
    `,br`@media (min-width: 48rem) {
      :host {
        display: flex;
        flex-direction: row;
        gap: 1rem;
        height: calc(100vh - 4rem);
      }
      .character {
        border-width: 1px;
        flex: 1 0 32ch;
        overflow: auto;
      }
      .name {
        top: 0;
      }
    }`],O([dn()],bE.prototype,"data",2),O([dn()],bE.prototype,"dragging",2),bE=O([dp("wc-inventory")],bE)})()