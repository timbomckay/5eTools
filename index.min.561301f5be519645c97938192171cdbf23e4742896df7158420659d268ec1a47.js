(()=>{var sh=Object.create,dO=Object.defineProperty,kD=Object.getOwnPropertyDescriptor,pQ=Object.getOwnPropertyNames,pR=Object.getPrototypeOf,pU=Object.prototype.hasOwnProperty,ra=a=>dO(a,"__esModule",{value:!0}),kC=(b,a)=>function(){return a||(0,b[Object.keys(b)[0]])((a={exports:{}}).exports,a),a.exports},sg=(b,a,c)=>{if(a&&typeof a=="object"||typeof a=="function")for(let d of pQ(a))!pU.call(b,d)&&d!=="default"&&dO(b,d,{get:()=>a[d],enumerable:!(c=kD(a,d))||c.enumerable});return b},se=a=>sg(ra(dO(a!=null?sh(pR(a)):{},"default",a&&a.__esModule&&"default"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a),L=(g,b,e,c)=>{for(var a=c>1?void 0:c?kD(b,e):b,f=g.length-1,d;f>=0;f--)(d=g[f])&&(a=(c?d(b,e,a):d(a))||a);return c&&a&&dO(b,e,a),a},sb=kC({"node_modules/tailwindcss/colors.js"(c,b){var a=!1;b.exports={black:"#000",white:"#fff",rose:{50:"#fff1f2",100:"#ffe4e6",200:"#fecdd3",300:"#fda4af",400:"#fb7185",500:"#f43f5e",600:"#e11d48",700:"#be123c",800:"#9f1239",900:"#881337"},pink:{50:"#fdf2f8",100:"#fce7f3",200:"#fbcfe8",300:"#f9a8d4",400:"#f472b6",500:"#ec4899",600:"#db2777",700:"#be185d",800:"#9d174d",900:"#831843"},fuchsia:{50:"#fdf4ff",100:"#fae8ff",200:"#f5d0fe",300:"#f0abfc",400:"#e879f9",500:"#d946ef",600:"#c026d3",700:"#a21caf",800:"#86198f",900:"#701a75"},purple:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7e22ce",800:"#6b21a8",900:"#581c87"},violet:{50:"#f5f3ff",100:"#ede9fe",200:"#ddd6fe",300:"#c4b5fd",400:"#a78bfa",500:"#8b5cf6",600:"#7c3aed",700:"#6d28d9",800:"#5b21b6",900:"#4c1d95"},indigo:{50:"#eef2ff",100:"#e0e7ff",200:"#c7d2fe",300:"#a5b4fc",400:"#818cf8",500:"#6366f1",600:"#4f46e5",700:"#4338ca",800:"#3730a3",900:"#312e81"},blue:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a"},get lightBlue(){return a||(console.log("warn - As of Tailwind CSS v2.2, `lightBlue` has been renamed to `sky`."),console.log("warn - Please update your color palette to eliminate this warning."),a=!0),{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e"}},sky:{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e"},cyan:{50:"#ecfeff",100:"#cffafe",200:"#a5f3fc",300:"#67e8f9",400:"#22d3ee",500:"#06b6d4",600:"#0891b2",700:"#0e7490",800:"#155e75",900:"#164e63"},teal:{50:"#f0fdfa",100:"#ccfbf1",200:"#99f6e4",300:"#5eead4",400:"#2dd4bf",500:"#14b8a6",600:"#0d9488",700:"#0f766e",800:"#115e59",900:"#134e4a"},emerald:{50:"#ecfdf5",100:"#d1fae5",200:"#a7f3d0",300:"#6ee7b7",400:"#34d399",500:"#10b981",600:"#059669",700:"#047857",800:"#065f46",900:"#064e3b"},green:{50:"#f0fdf4",100:"#dcfce7",200:"#bbf7d0",300:"#86efac",400:"#4ade80",500:"#22c55e",600:"#16a34a",700:"#15803d",800:"#166534",900:"#14532d"},lime:{50:"#f7fee7",100:"#ecfccb",200:"#d9f99d",300:"#bef264",400:"#a3e635",500:"#84cc16",600:"#65a30d",700:"#4d7c0f",800:"#3f6212",900:"#365314"},yellow:{50:"#fefce8",100:"#fef9c3",200:"#fef08a",300:"#fde047",400:"#facc15",500:"#eab308",600:"#ca8a04",700:"#a16207",800:"#854d0e",900:"#713f12"},amber:{50:"#fffbeb",100:"#fef3c7",200:"#fde68a",300:"#fcd34d",400:"#fbbf24",500:"#f59e0b",600:"#d97706",700:"#b45309",800:"#92400e",900:"#78350f"},orange:{50:"#fff7ed",100:"#ffedd5",200:"#fed7aa",300:"#fdba74",400:"#fb923c",500:"#f97316",600:"#ea580c",700:"#c2410c",800:"#9a3412",900:"#7c2d12"},red:{50:"#fef2f2",100:"#fee2e2",200:"#fecaca",300:"#fca5a5",400:"#f87171",500:"#ef4444",600:"#dc2626",700:"#b91c1c",800:"#991b1b",900:"#7f1d1d"},warmGray:{50:"#fafaf9",100:"#f5f5f4",200:"#e7e5e4",300:"#d6d3d1",400:"#a8a29e",500:"#78716c",600:"#57534e",700:"#44403c",800:"#292524",900:"#1c1917"},trueGray:{50:"#fafafa",100:"#f5f5f5",200:"#e5e5e5",300:"#d4d4d4",400:"#a3a3a3",500:"#737373",600:"#525252",700:"#404040",800:"#262626",900:"#171717"},gray:{50:"#fafafa",100:"#f4f4f5",200:"#e4e4e7",300:"#d4d4d8",400:"#a1a1aa",500:"#71717a",600:"#52525b",700:"#3f3f46",800:"#27272a",900:"#18181b"},coolGray:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"},blueGray:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"}}}}),sa=kC({"ns-hugo:/home/runner/work/5eTools/5eTools/assets/colors.js"(c,a){var b=sb();a.exports={...b,primary:{50:"#faf3f3",100:"#f5e7e7",200:"#e7c2c3",300:"#d89d9f",400:"#ba5456",500:"#9d0a0e",600:"#8d090d",700:"#76080b",800:"#5e0608",900:"#4d0507"}}}}),rY=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}wrapCallback(a){return(b,c)=>{b?this.reject(b):this.resolve(c),typeof a=="function"&&(this.promise.catch(()=>{}),a.length===1?a(b):a(b,c))}}},ry,kj,kg,rj,sm,dC,aE,q$,qV,qU,n,qT,qS,qJ,qH,jH,qE,fz,jD,fy,qC,qB,qA,qz,qy,qx,qw,qu,qt,qq,ql,qj,qg,qa,p_,pZ,pX,pW,pT,pL,pK,pJ,pI,pH,pz,ji,py,dw,fp,pt,du,ps,pr,pm,pl,pk,ao,e,fi,h,fg,pd,o$,oZ,i$,i_,iO,N,fc,fb,iJ,oV,by,iH,eZ,iF,oT,cX,cV,cU,cT,oS,eU,eT,oQ,oP,oO,bR,oN,eM,eK,eD,ev,oH,ib,oG,eu,et,h$,oB,hW,aT,hJ,cW,hB,bL,ek,ow,eh,cB,hj,hc,on,om,ol,ok,oh,oe,ep,nQ,gC,nP,nN,nB,nz,fl,ny,nw,fU,ns,dx,nr,fP,T,bj,aJ,a,d,an,np,nm,nl,nk,nj,ni,nh,ac,nf,M,k,ds,r,nc,R,nb,K,mX,f,ad,w,mW,V,mM,mL,mJ,mI,mH,mG,mF,d$,b$,cf,dm,bQ,bn,bz,bE,mf,md,aN,cO,cG,bT,hT,hU,lY,x,m,O,cz,H,v,ic,lU,lT,lS,lN,lM,eR,cR,cS,is,it,iu,lL,lK,lJ,lI,lg,X,ar,s,I,lf,lb,u,ag,U,G,$,aQ,aq,bf,bw,kY,jB,jC,b,fB,aw,kW,cg,kV,jL,jN,fD,jQ,aX,jS,kS,kR,fF,kP,ki,Y,km,bl,kO,kN,kM,kL,kJ,bB,kE,kI,kH,kK,fI,ky,ke,kb,jW,kU,le,fq,B,lh,li,lj,lk,ll,lm,jh,je,jd,lq,jc,ls,lt,lu,iW,iS,lA,lB,lC,lD,lE,hF,bU,hu,bV,mj,mk,mq,ho,hi,mt,mu,mv,mw,gL,mS,gH,mU,mV,na,c_,f$,fN,j$,aD,dI,cp,no,fH,fV,bJ,fX,fk,nA,go,nD,nK,gB,nO,cA,nR,db,nT,nW,nY,ob,oc,og,gU,dn,oj,dT,dS,ha,hb,cu,bC,oq,hg,dV,hl,ou,hr,ej,hK,eo,bd,eq,bi,h_,az,ia,oF,br,co,cn,id,oK,ca,ip,iq,aP,ir,iv,iz,iB,o,sl,aF,p,iQ,oY,be,o_,dj,pb,dl,dp,pe,pf,pg,ph,pi,ja,fj,fm,aB,jb,dB,pp,ae,E,aa,pw,cb,pA,jk,jl,jm,jn,pM,pN,pO,pP,sk,sj,pS,nx,si,pV,jo,jp,pY,ft,jt,fu,dz,qv,jv,fx,jw,jx,jy,jz,jE,qP,qQ,qZ,rc,rd,re,ri,kf,cl,rm,rn,rw,rx,kl,rz,rC,ko,kp,rI,ks,rO,rP,rQ,kt,kv,rT,rU,rV,kw,kz,bq,rZ,r_,r$,fJ,kB,sc,dL,ox,dM,ct,aG,oU,ce;function aM(){return typeof navigator!="undefined"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function rX(){return typeof window!="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(aM())}function rW(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(a){return!1}}function rS(){const a=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof a=="object"&&a.id!==void 0}function rR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function rN(){return aM().indexOf("Electron/")>=0}function rG(){const a=aM();return a.indexOf("MSIE ")>=0||a.indexOf("Trident/")>=0}function rE(){return aM().indexOf("MSAppHost/")>=0}function rD(){return!rW()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function rA(){return typeof indexedDB=="object"}ry="FirebaseError",kj=class extends Error{constructor(a,b,c){super(b),this.code=a,this.customData=c,this.name=ry,Object.setPrototypeOf(this,kj.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,kg.prototype.create)}},kg=class{constructor(a,b,c){this.service=a,this.serviceName=b,this.errors=c}create(a,...e){const b=e[0]||{},c=`${this.service}/${a}`,d=this.errors[a],f=d?rl(d,b):"Error",g=`${this.serviceName}: ${f} (${c}).`,h=new kj(c,g,b);return h}};function rl(a,b){return a.replace(rj,(d,a)=>{const c=b[a];return c!=null?String(c):`<${a}?>`})}rj=/\{\$([^}]+)}/g;function fE(a,b){if(a===b)return!0;const c=Object.keys(a),d=Object.keys(b);for(const e of c){if(!d.includes(e))return!1;const f=a[e],g=b[e];if(j_(f)&&j_(g)){if(!fE(f,g))return!1}else if(f!==g)return!1}for(const a of d)if(!c.includes(a))return!1;return!0}function j_(a){return a!==null&&typeof a=="object"}sm=4*60*60*1e3;function cx(a){return a&&a._delegate?a._delegate:a}dC=class{constructor(a,b,c){this.name=a,this.instanceFactory=b,this.type=c,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(a){return this.instantiationMode=a,this}setMultipleInstances(a){return this.multipleInstances=a,this}setServiceProps(a){return this.serviceProps=a,this}setInstanceCreatedCallback(a){return this.onInstanceCreated=a,this}},aE="[DEFAULT]",q$=class{constructor(a,b){this.name=a,this.container=b,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(b){const a=this.normalizeInstanceIdentifier(b);if(!this.instancesDeferred.has(a)){const b=new rY;if(this.instancesDeferred.set(a,b),this.isInitialized(a)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:a});c&&b.resolve(c)}catch(a){}}return this.instancesDeferred.get(a).promise}getImmediate(a){var b;const c=this.normalizeInstanceIdentifier(a===null||a===void 0?void 0:a.identifier),d=!!((b=a===null||a===void 0?void 0:a.optional)!==null&&b!==void 0)&&b;if(this.isInitialized(c)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:c})}catch(a){if(d)return null;throw a}else{if(d)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(a){if(a.name!==this.name)throw Error(`Mismatching Component ${a.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=a,!this.shouldAutoInitialize())return;if(qW(a))try{this.getOrInitializeService({instanceIdentifier:aE})}catch(a){}for(const[a,b]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(a);try{const a=this.getOrInitializeService({instanceIdentifier:c});b.resolve(a)}catch(a){}}}clearInstance(a=aE){this.instancesDeferred.delete(a),this.instancesOptions.delete(a),this.instances.delete(a)}async delete(){const a=Array.from(this.instances.values());await Promise.all([...a.filter(a=>"INTERNAL"in a).map(a=>a.INTERNAL.delete()),...a.filter(a=>"_delete"in a).map(a=>a._delete())])}isComponentSet(){return this.component!=null}isInitialized(a=aE){return this.instances.has(a)}getOptions(a=aE){return this.instancesOptions.get(a)||{}}initialize(b={}){const{options:d={}}=b,a=this.normalizeInstanceIdentifier(b.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:a,options:d});for(const[b,d]of this.instancesDeferred.entries()){const e=this.normalizeInstanceIdentifier(b);a===e&&d.resolve(c)}return c}onInit(b,f){var c;const a=this.normalizeInstanceIdentifier(f),d=(c=this.onInitCallbacks.get(a))!==null&&c!==void 0?c:new Set;d.add(b),this.onInitCallbacks.set(a,d);const e=this.instances.get(a);return e&&b(e,a),()=>{d.delete(b)}}invokeOnInitCallbacks(c,a){const b=this.onInitCallbacks.get(a);if(!b)return;for(const d of b)try{d(c,a)}catch(a){}}getOrInitializeService({instanceIdentifier:a,options:c={}}){let b=this.instances.get(a);if(!b&&this.component)if(b=this.component.instanceFactory(this.container,{instanceIdentifier:qX(a),options:c}),this.instances.set(a,b),this.instancesOptions.set(a,c),this.invokeOnInitCallbacks(b,a),this.component.onInstanceCreated)try{this.component.onInstanceCreated(this.container,a,b)}catch(a){}return b||null}normalizeInstanceIdentifier(a=aE){return this.component?this.component.multipleInstances?a:aE:a}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function qX(a){return a===aE?void 0:a}function qW(a){return a.instantiationMode==="EAGER"}qV=class{constructor(a){this.name=a,this.providers=new Map}addComponent(a){const b=this.getProvider(a.name);if(b.isComponentSet())throw new Error(`Component ${a.name} has already been registered with ${this.name}`);b.setComponent(a)}addOrOverwriteComponent(a){const b=this.getProvider(a.name);b.isComponentSet()&&this.providers.delete(a.name),this.addComponent(a)}getProvider(a){if(this.providers.has(a))return this.providers.get(a);const b=new q$(a,this);return this.providers.set(a,b),b}getProviders(){return Array.from(this.providers.values())}},qU=[],function(a){a[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT"}(n||(n={})),qT={debug:n.DEBUG,verbose:n.VERBOSE,info:n.INFO,warn:n.WARN,error:n.ERROR,silent:n.SILENT},qS=n.INFO,qJ={[n.DEBUG]:"log",[n.VERBOSE]:"log",[n.INFO]:"info",[n.WARN]:"warn",[n.ERROR]:"error"},qH=(b,a,...d)=>{if(a<b.logLevel)return;const e=(new Date).toISOString(),c=qJ[a];if(c)console[c](`[${e}]  ${b.name}:`,...d);else throw new Error(`Attempted to log a message with an invalid logType (value: ${a})`)},jH=class{constructor(a){this.name=a,this._logLevel=qS,this._logHandler=qH,this._userLogHandler=null,qU.push(this)}get logLevel(){return this._logLevel}set logLevel(a){if(!(a in n))throw new TypeError(`Invalid value "${a}" assigned to \`logLevel\``);this._logLevel=a}setLogLevel(a){this._logLevel=typeof a=="string"?qT[a]:a}get logHandler(){return this._logHandler}set logHandler(a){if(typeof a!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=a}get userLogHandler(){return this._userLogHandler}set userLogHandler(a){this._userLogHandler=a}debug(...a){this._userLogHandler&&this._userLogHandler(this,n.DEBUG,...a),this._logHandler(this,n.DEBUG,...a)}log(...a){this._userLogHandler&&this._userLogHandler(this,n.VERBOSE,...a),this._logHandler(this,n.VERBOSE,...a)}info(...a){this._userLogHandler&&this._userLogHandler(this,n.INFO,...a),this._logHandler(this,n.INFO,...a)}warn(...a){this._userLogHandler&&this._userLogHandler(this,n.WARN,...a),this._logHandler(this,n.WARN,...a)}error(...a){this._userLogHandler&&this._userLogHandler(this,n.ERROR,...a),this._logHandler(this,n.ERROR,...a)}},qE=class{constructor(a){this.container=a}getPlatformInfoString(){const a=this.container.getProviders();return a.map(a=>{if(qD(a)){const b=a.getImmediate();return`${b.library}/${b.version}`}return null}).filter(a=>a).join(" ")}};function qD(b){const a=b.getComponent();return(a===null||a===void 0?void 0:a.type)==="VERSION"}fz="@firebase/app",jD="0.7.11",fy=new jH("@firebase/app"),qC="@firebase/app-compat",qB="@firebase/analytics-compat",qA="@firebase/analytics",qz="@firebase/app-check-compat",qy="@firebase/app-check",qx="@firebase/auth",qw="@firebase/auth-compat",qu="@firebase/database",qt="@firebase/database-compat",qq="@firebase/functions",ql="@firebase/functions-compat",qj="@firebase/installations",qg="@firebase/installations-compat",qa="@firebase/messaging",p_="@firebase/messaging-compat",pZ="@firebase/performance",pX="@firebase/performance-compat",pW="@firebase/remote-config",pT="@firebase/remote-config-compat",pL="@firebase/storage",pK="@firebase/storage-compat",pJ="@firebase/firestore",pI="@firebase/firestore-compat",pH="firebase",pz="9.6.1",ji="[DEFAULT]",py={[fz]:"fire-core",[qC]:"fire-core-compat",[qA]:"fire-analytics",[qB]:"fire-analytics-compat",[qy]:"fire-app-check",[qz]:"fire-app-check-compat",[qx]:"fire-auth",[qw]:"fire-auth-compat",[qu]:"fire-rtdb",[qt]:"fire-rtdb-compat",[qq]:"fire-fn",[ql]:"fire-fn-compat",[qj]:"fire-iid",[qg]:"fire-iid-compat",[qa]:"fire-fcm",[p_]:"fire-fcm-compat",[pZ]:"fire-perf",[pX]:"fire-perf-compat",[pW]:"fire-rc",[pT]:"fire-rc-compat",[pL]:"fire-gcs",[pK]:"fire-gcs-compat",[pJ]:"fire-fst",[pI]:"fire-fst-compat","fire-js":"fire-js",[pH]:"fire-js-all"},dw=new Map,fp=new Map;function px(a,b){try{a.container.addComponent(b)}catch(c){fy.debug(`Component ${b.name} failed to register with FirebaseApp ${a.name}`,c)}}function fo(a){const b=a.name;if(fp.has(b))return fy.debug(`There were multiple attempts to register component ${b}.`),!1;fp.set(b,a);for(const b of dw.values())px(b,a);return!0}function pu(a,b){return a.container.getProvider(b)}pt={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function."},du=new kg("app","Firebase",pt),ps=class{constructor(b,a,c){this._isDeleted=!1,this._options=Object.assign({},b),this._config=Object.assign({},a),this._name=a.name,this._automaticDataCollectionEnabled=a.automaticDataCollectionEnabled,this._container=c,this.container.addComponent(new dC("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(a){this.checkDestroyed(),this._automaticDataCollectionEnabled=a}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(a){this._isDeleted=a}checkDestroyed(){if(this.isDeleted)throw du.create("app-deleted",{appName:this._name})}},pr=pz;function pq(e,b={}){if(typeof b!="object"){const a=b;b={name:a}}const d=Object.assign({name:ji,automaticDataCollectionEnabled:!1},b),a=d.name;if(typeof a!="string"||!a)throw du.create("bad-app-name",{appName:String(a)});const c=dw.get(a);if(c){if(fE(e,c.options)&&fE(d,c.config))return c;throw du.create("duplicate-app",{appName:a})}const f=new qV(a);for(const a of fp.values())f.addComponent(a);const g=new ps(e,d,f);return dw.set(a,g),g}function po(a=ji){const b=dw.get(a);if(!b)throw du.create("no-app",{appName:a});return b}function bu(g,b,f){var d;let a=(d=py[g])!==null&&d!==void 0?d:g;f&&(a+=`-${f}`);const e=a.match(/\s|\//),c=b.match(/\s|\//);if(e||c){const d=[`Unable to register library "${a}" with version "${b}":`];e&&d.push(`library name "${a}" contains illegal characters (whitespace or "/")`),e&&c&&d.push("and"),c&&d.push(`version name "${b}" contains illegal characters (whitespace or "/")`),fy.warn(d.join(" "));return}fo(new dC(`${a}-version`,()=>({library:a,version:b}),"VERSION"))}function pn(a){fo(new dC("platform-logger",a=>new qE(a),"PRIVATE")),bu(fz,jD,a),bu(fz,jD,"esm2017"),bu("fire-js","")}pn(""),pm="firebase",pl="9.6.1",bu(pm,pl,"app"),pk=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},ao={},fi=fi||{},h=pk||self;function dq(){}function fh(b){var a=typeof b;return a=a!="object"?a:b?Array.isArray(b)?"array":a:"null",a=="array"||a=="object"&&typeof b.length=="number"}function bX(a){var b=typeof a;return b=="object"&&a!=null||b=="function"}function pj(a){return Object.prototype.hasOwnProperty.call(a,fg)&&a[fg]||(a[fg]=++pd)}fg="closure_uid_"+(1e9*Math.random()>>>0),pd=0;function pc(a,b,c){return a.call.apply(a.bind,arguments)}function pa(a,b,d){if(!a)throw Error();if(2<arguments.length){var c=Array.prototype.slice.call(arguments,2);return function(){var d=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(d,c),a.apply(b,d)}}return function(){return a.apply(b,arguments)}}function C(a,b,c){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?C=pc:C=pa,C.apply(null,arguments)}function dk(a,c){var b=Array.prototype.slice.call(arguments,1);return function(){var c=b.slice();return c.push.apply(c,arguments),a.apply(this,c)}}function F(a,b){function c(){}c.prototype=b.prototype,a.Z=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.Vb=function(d,e,f){for(var c=Array(arguments.length-2),a=2;a<arguments.length;a++)c[a-2]=arguments[a];return b.prototype[e].apply(d,c)}}function av(){this.s=this.s,this.o=this.o}o$=0,oZ={},av.prototype.s=!1,av.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),o$!=0)){var a=pj(this);delete oZ[a]}},av.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()},i$=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if(typeof a=="string")return typeof b!="string"||b.length!=1?-1:a.indexOf(b,0);for(let c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},i_=Array.prototype.forEach?function(a,b,c){Array.prototype.forEach.call(a,b,c)}:function(a,c,d){const e=a.length,b=typeof a=="string"?a.split(""):a;for(let f=0;f<e;f++)f in b&&c.call(d,b[f],f,a)};function oX(a){a:{var b=nI;const d=a.length,c=typeof a=="string"?a.split(""):a;for(let e=0;e<d;e++)if(e in c&&b.call(void 0,c[e],e,a)){b=e;break a}b=-1}return 0>b?null:typeof a=="string"?a.charAt(b):a[b]}function iP(a){return Array.prototype.concat.apply([],arguments)}function fe(b){const a=b.length;if(0<a){const c=Array(a);for(let d=0;d<a;d++)c[d]=b[d];return c}return[]}function c$(a){return/^[\s\xa0]*$/.test(a)}iO=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};function Q(a,b){return a.indexOf(b)!=-1}function fd(a,b){return a<b?-1:a>b?1:0}a:{fc=h.navigator;if(fc){fb=fc.userAgent;if(fb){N=fb;break a}}N=""}function fa(a,b,c){for(const d in a)b.call(c,a[d],d,a)}function iL(a){const b={};for(const c in a)b[c]=a[c];return b}iJ="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function iI(c,d){let a,b;for(let d=1;d<arguments.length;d++){b=arguments[d];for(a in b)c[a]=b[a];for(let d=0;d<iJ.length;d++)a=iJ[d],Object.prototype.hasOwnProperty.call(b,a)&&(c[a]=b[a])}}function e_(a){return e_[" "](a),a}e_[" "]=dq;function oW(b){var a=oS;return Object.prototype.hasOwnProperty.call(a,9)?a[9]:a[9]=b(9)}oV=Q(N,"Opera"),by=Q(N,"Trident")||Q(N,"MSIE"),iH=Q(N,"Edge"),eZ=iH||by,iF=Q(N,"Gecko")&&!(Q(N.toLowerCase(),"webkit")&&!Q(N,"Edge"))&&!(Q(N,"Trident")||Q(N,"MSIE"))&&!Q(N,"Edge"),oT=Q(N.toLowerCase(),"webkit")&&!Q(N,"Edge");function iE(){var a=h.document;return a?a.documentMode:void 0}a:{cV="",cU=function(){var a=N;if(iF)return/rv:([^\);]+)(\)|;)/.exec(a);if(iH)return/Edge\/([\d\.]+)/.exec(a);if(by)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(oT)return/WebKit\/(\S+)/.exec(a);if(oV)return/(?:Version)[ \/]?(\S+)/.exec(a)}();cU&&(cV=cU?cU[1]:"");if(by){cT=iE();if(cT!=null&&cT>parseFloat(cV)){cX=String(cT);break a}}cX=cV}oS={};function oR(){return oW(function(){let c=0;const d=iO(String(cX)).split("."),e=iO("9").split("."),f=Math.max(d.length,e.length);for(let g=0;c==0&&g<f;g++){var a=d[g]||"",b=e[g]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],b=/(\d*)(\D*)(.*)/.exec(b)||["","","",""],a[0].length==0&&b[0].length==0)break;c=fd(a[1].length==0?0:parseInt(a[1],10),b[1].length==0?0:parseInt(b[1],10))||fd(a[2].length==0,b[2].length==0)||fd(a[2],b[2]),a=a[3],b=b[3]}while(c==0)}return 0<=c})}h.document&&by?(eT=iE(),eU=eT||parseInt(cX,10)||void 0):eU=void 0,oQ=eU,oP=function(){if(!h.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{h.addEventListener("test",dq,b),h.removeEventListener("test",dq,b)}catch(a){}return a}();function J(a,b){this.type=a,this.g=this.target=b,this.defaultPrevented=!1}J.prototype.h=function(){this.defaultPrevented=!0};function bP(a,c){var d,b,e;if(J.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){if(d=this.type=a.type,b=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null,this.target=a.target||a.srcElement,this.g=c,c=a.relatedTarget){if(iF){a:{try{e_(c.nodeName),e=!0;break a}catch(a){}e=!1}e||(c=null)}}else d=="mouseover"?c=a.fromElement:d=="mouseout"&&(c=a.toElement);this.relatedTarget=c,b?(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:oO[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&bP.Z.h.call(this)}}F(bP,J),oO={2:"touch",3:"pen",4:"mouse"},bP.prototype.h=function(){bP.Z.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1},bR="closure_listenable_"+(1e6*Math.random()|0),oN=0;function oM(a,b,c,d,e){this.listener=a,this.proxy=null,this.src=b,this.type=c,this.capture=!!d,this.ia=e,this.key=++oN,this.ca=this.fa=!1}function cM(a){a.ca=!0,a.listener=null,a.proxy=null,a.src=null,a.ia=null}function cN(a){this.src=a,this.g={},this.h=0}cN.prototype.add=function(b,a,d,e,f){var c=b.toString(),g;return b=this.g[c],b||(b=this.g[c]=[],this.h++),g=eN(b,a,e,f),-1<g?(a=b[g],d||(a.fa=!1)):(a=new oM(a,this.src,c,!!e,f),a.fa=d,b.push(a)),a};function eP(a,c){var b=c.type,d,e,f;b in a.g&&(d=a.g[b],e=i$(d,c),(f=0<=e)&&Array.prototype.splice.call(d,e,1),f&&(cM(c),a.g[b].length==0&&(delete a.g[b],a.h--)))}function eN(c,d,e,f){for(var a=0,b;a<c.length;++a)if(b=c[a],!b.ca&&b.listener==d&&b.capture==!!e&&b.ia==f)return a;return-1}eM="closure_lm_"+(1e6*Math.random()|0),eK={};function il(b,c,d,a,e){if(a&&a.once)return ii(b,c,d,a,e);if(Array.isArray(c)){for(var f=0;f<c.length;f++)il(b,c[f],d,a,e);return null}return d=ex(d),b&&b[bR]?b.N(c,d,bX(a)?!!a.capture:!!a,e):ik(b,c,d,!1,a,e)}function ik(a,e,c,b,d,h){if(!e)throw Error("Invalid event type");var g=bX(d)?!!d.capture:!!d,f=eF(a);if(f||(a[eM]=f=new cN(a)),c=f.add(e,c,b,g,h),c.proxy)return c;if(b=oL(),c.proxy=b,b.src=a,b.listener=c,a.addEventListener)oP||(d=g),d===void 0&&(d=!1),a.addEventListener(e.toString(),b,d);else if(a.attachEvent)a.attachEvent(ie(e.toString()),b);else if(a.addListener&&a.removeListener)a.addListener(b);else throw Error("addEventListener and attachEvent are unavailable.");return c}function oL(){function a(c){return b.call(a.src,a.listener,c)}var b=oJ;return a}function ii(a,b,c,d,e){if(Array.isArray(b)){for(var f=0;f<b.length;f++)ii(a,b[f],c,d,e);return null}return c=ex(c),a&&a[bR]?a.O(b,c,bX(d)?!!d.capture:!!d,e):ik(a,b,c,!0,d,e)}function ih(a,b,c,e,f){if(Array.isArray(b))for(var d=0;d<b.length;d++)ih(a,b[d],c,e,f);else e=bX(e)?!!e.capture:!!e,c=ex(c),a&&a[bR]?(a=a.i,b=String(b).toString(),b in a.g&&(d=a.g[b],c=eN(d,c,e,f),-1<c&&(cM(d[c]),Array.prototype.splice.call(d,c,1),d.length==0&&(delete a.g[b],a.h--)))):a&&(a=eF(a))&&(b=a.g[b.toString()],a=-1,b&&(a=eN(b,c,e,f)),(c=-1<a?b[a]:null)&&eG(c))}function eG(b){var a,c,d;typeof b!="number"&&b&&!b.ca&&(a=b.src,a&&a[bR]?eP(a.i,b):(c=b.type,d=b.proxy,a.removeEventListener?a.removeEventListener(c,d,b.capture):a.detachEvent?a.detachEvent(ie(c),d):a.addListener&&a.removeListener&&a.removeListener(d),(c=eF(a))?(eP(c,b),c.h==0&&(c.src=null,a[eM]=null)):cM(b)))}function ie(a){return a in eK?eK[a]:eK[a]="on"+a}function oJ(a,b){if(a.ca)a=!0;else{b=new bP(b,this);var c=a.listener,d=a.ia||a.src;a.fa&&eG(a),a=c.call(d,b)}return a}function eF(a){return a=a[eM],a instanceof cN?a:null}eD="__closure_events_fn_"+(1e9*Math.random()>>>0);function ex(a){return typeof a=="function"?a:(a[eD]||(a[eD]=function(b){return a.handleEvent(b)}),a[eD])}function A(){av.call(this),this.i=new cN(this),this.P=this,this.I=null}F(A,av),A.prototype[bR]=!0,A.prototype.removeEventListener=function(a,b,c,d){ih(this,a,b,c,d)};function D(e,a){var d,b=e.I,c,f,g;if(b)for(d=[];b;b=b.I)d.push(b);if(e=e.P,b=a.type||a,typeof a=="string"?a=new J(a,e):a instanceof J?a.target=a.target||e:(c=a,a=new J(b,e),iI(a,c)),c=!0,d)for(f=d.length-1;0<=f;f--)g=a.g=d[f],c=cC(g,b,!0,a)&&c;if(g=a.g=e,c=cC(g,b,!0,a)&&c,c=cC(g,b,!1,a)&&c,d)for(f=0;f<d.length;f++)g=a.g=d[f],c=cC(g,b,!1,a)&&c}A.prototype.M=function(){var a,b,d,c;if(A.Z.M.call(this),this.i){a=this.i;for(b in a.g){for(d=a.g[b],c=0;c<d.length;c++)cM(d[c]);delete a.g[b],a.h--}}this.I=null},A.prototype.N=function(a,b,c,d){return this.i.add(String(a),b,!1,c,d)},A.prototype.O=function(a,b,c,d){return this.i.add(String(a),b,!0,c,d)};function cC(g,b,i,f){var c,d,a,h,e;if(b=g.i.g[String(b)],!b)return!0;b=b.concat();for(c=!0,d=0;d<b.length;++d)a=b[d],a&&!a.ca&&a.capture==i&&(h=a.listener,e=a.ia||a.src,a.fa&&eP(g.i,a),c=h.call(e,f)!==!1&&c);return c&&!f.defaultPrevented}ev=h.JSON.stringify;function oI(){var a=h$;let b=null;return a.g&&(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null),b}oH=class{constructor(){this.h=this.g=null}add(b,c){const a=ib.get();a.set(b,c),this.h?this.h.next=a:this.g=a,this.h=a}},ib=new class{constructor(a,b){this.i=a,this.j=b,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}(()=>new oG,a=>a.reset()),oG=class{constructor(){this.next=this.g=this.h=null}set(a,b){this.h=a,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}};function oE(a){h.setTimeout(()=>{throw a},0)}function eg(a,b){eu||oD(),et||(eu(),et=!0),h$.add(a,b)}function oD(){var a=h.Promise.resolve(void 0);eu=function(){a.then(oC)}}et=!1,h$=new oH;function oC(){for(var a,b;a=oI();){try{a.h.call(a.g)}catch(a){oE(a)}b=ib,b.j(a),100>b.h&&(b.h++,a.next=b.g,b.g=a)}et=!1}function cy(a,b){A.call(this),this.h=a||1,this.g=b||h,this.j=C(this.kb,this),this.l=Date.now()}F(cy,A),e=cy.prototype,e.da=!1,e.S=null,e.kb=function(){if(this.da){var a=Date.now()-this.l;0<a&&a<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-a):(this.S&&(this.g.clearTimeout(this.S),this.S=null),D(this,"tick"),this.da&&(es(this),this.start()))}},e.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function es(a){a.da=!1,a.S&&(a.g.clearTimeout(a.S),a.S=null)}e.M=function(){cy.Z.M.call(this),es(this),delete this.g};function er(a,b,c){if(typeof a=="function")c&&(a=C(a,c));else if(a&&typeof a.handleEvent=="function")a=C(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(b)?-1:h.setTimeout(a,b||0)}function hX(a){a.g=er(()=>{a.g=null,a.i&&(a.i=!1,hX(a))},a.j);const b=a.h;a.h=null,a.m.apply(null,b)}oB=class extends av{constructor(a,b){super(),this.m=a,this.j=b,this.h=null,this.i=!1,this.g=null}l(a){this.h=arguments,this.g?this.i=!0:hX(this)}M(){super.M(),this.g&&(h.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function ch(a){av.call(this),this.h=a,this.g={}}F(ch,av),hW=[];function hP(b,e,a,f){var c,d;Array.isArray(a)||(a&&(hW[0]=a.toString()),a=hW);for(c=0;c<a.length;c++){if(d=il(e,a[c],f||b.handleEvent,!1,b.h||b),!d)break;b.g[d.key]=d}}function hO(a){fa(a.g,function(a,b){this.g.hasOwnProperty(b)&&eG(a)},a),a.g={}}ch.prototype.M=function(){ch.Z.M.call(this),hO(this)},ch.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function cH(){this.g=!0}cH.prototype.Aa=function(){this.g=!1};function oA(b,c,d,e,f,a){b.info(function(){var g,k,i,h,j,l;if(b.g)if(a){{g="";for(k=a.split("&"),i=0;i<k.length;i++)h=k[i].split("="),1<h.length&&(j=h[0],h=h[1],l=j.split("_"),g=2<=l.length&&l[1]=="type"?g+(j+"="+h+"&"):g+(j+"=redacted&"))}}else g=null;else g=a;return"XMLHTTP REQ ("+e+") [attempt "+f+"]: "+c+"\n"+d+"\n"+g})}function oz(a,b,c,d,e,f,g){a.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+e+"]: "+b+"\n"+c+"\n"+f+" "+g})}function bc(a,c,d,b){a.info(function(){return"XMLHTTP TEXT ("+c+"): "+sf(a,d)+(b?" "+b:"")})}function oy(a,b){a.info(function(){return"TIMEOUT: "+b})}cH.prototype.info=function(){};function sf(a,d){var b,g,c,e,f;if(!a.g)return d;if(!d)return null;try{if(b=JSON.parse(d),b)for(a=0;a<b.length;a++)if(Array.isArray(b[a]))if(g=b[a],!(2>g.length))if(c=g[1],Array.isArray(c)&&!(1>c.length))if(e=c[0],e!="noop"&&e!="stop"&&e!="close")for(f=1;f<c.length;f++)c[f]="";return ev(b)}catch(a){return d}}aT={},hJ=null;function cP(){return hJ=hJ||new A}aT.Ma="serverreachability";function hI(a){J.call(this,aT.Ma,a)}F(hI,J);function bS(b){const a=cP();D(a,new hI(a,b))}aT.STAT_EVENT="statevent";function hH(a,b){J.call(this,aT.STAT_EVENT,a),this.stat=b}F(hH,J);function P(b){const a=cP();D(a,new hH(a,b))}aT.Na="timingevent";function hG(a,b){J.call(this,aT.Na,a),this.size=b}F(hG,J);function bF(a,b){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return h.setTimeout(function(){a()},b)}cW={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},hB={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function en(){}en.prototype.h=null;function hz(a){return a.h||(a.h=a.i())}function hx(){}bL={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function em(){J.call(this,"d")}F(em,J);function el(){J.call(this,"c")}F(el,J);function dd(){}F(dd,en),dd.prototype.g=function(){return new XMLHttpRequest},dd.prototype.i=function(){return{}},ek=new dd;function bO(a,b,c,d){this.l=a,this.j=b,this.m=c,this.X=d||1,this.V=new ch(this),this.P=ow,a=eZ?125:void 0,this.W=new cy(a),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new hw}function hw(){this.i=null,this.g="",this.h=!1}ow=45e3,eh={},cB={},e=bO.prototype,e.setTimeout=function(a){this.P=a};function ed(a,b,c){a.K=1,a.v=dJ(al(b)),a.s=c,a.U=!0,hv(a,null)}function hv(a,b){a.F=Date.now(),bW(a),a.A=al(a.v);var d=a.A,c=a.X;Array.isArray(c)||(c=[String(c)]),gV(d.h,"t",c),a.C=0,d=a.l.H,a.h=new hw,a.g=gc(a.l,d?b:null,!a.s),0<a.O&&(a.L=new oB(C(a.Ia,a,a.g),a.O)),hP(a.V,a.g,"readystatechange",a.gb),b=a.H?iL(a.H):{},a.s?(a.u||(a.u="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.s,b)):(a.u="GET",a.g.ea(a.A,a.u,null,b)),bS(1),oA(a.j,a.u,a.A,a.m,a.X,a.s)}e.gb=function(a){a=a.target;const b=this.L;b&&aj(a)==3?b.l():this.Ia(a)},e.Ia=function(f){var a,b,d,e,k,c,g,i,j;try{if(f==this.g)a:{const l=aj(this.g);a=this.g.Da();const m=this.g.ba();if(!(3>l)&&(l!=3||eZ||this.g&&(this.h.h||this.g.ga()||gr(this.g)))){this.I||l!=4||a==7||(a==8||0>=m?bS(3):bS(2));dr(this);b=this.g.ba();this.N=b;b:if(ht(this)){d=gr(this.g);f="";e=d.length,k=aj(this.g)==4;if(!this.h.i){if(typeof TextDecoder=="undefined"){aH(this);b_(this);c="";break b}this.h.i=new h.TextDecoder}for(a=0;a<e;a++)this.h.h=!0,f+=this.h.i.decode(d[a],{stream:k&&a==e-1});d.splice(0,e);this.h.g+=f;this.C=0;c=this.h.g}else c=this.g.ga();this.i=b==200;oz(this.j,this.u,this.A,this.m,this.X,l,b);if(this.i){if(this.$&&!this.J){b:{if(this.g){g,i=this.g;if((g=i.g?i.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!c$(g)){j=g;break b}}j=null}if(b=j)bc(this.j,this.m,b,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,dZ(this,b);else{this.i=!1;this.o=3;P(12);aH(this);b_(this);break a}}this.U?(hs(this,l,c),eZ&&this.i&&l==3&&(hP(this.V,this.W,"tick",this.fb),this.W.start())):(bc(this.j,this.m,c,null),dZ(this,c));l==4&&aH(this);this.i&&!this.I&&(l==4?gj(this.l,this):(this.i=!1,bW(this)))}else b==400&&0<c.indexOf("Unknown SID")?(this.o=3,P(12)):(this.o=0,P(13)),aH(this),b_(this)}}}catch(a){}finally{}};function ht(a){return!!a.g&&a.u=="GET"&&a.K!=2&&a.l.Ba}function hs(a,b,c){let e=!0,d;for(;!a.I&&a.C<c.length;){if(d=ov(a,c),d==cB){b==4&&(a.o=4,P(14),e=!1),bc(a.j,a.m,null,"[Incomplete Response]");break}if(d==eh){a.o=4,P(15),bc(a.j,a.m,c,"[Invalid Chunk]"),e=!1;break}bc(a.j,a.m,d,null),dZ(a,d)}ht(a)&&d!=cB&&d!=eh&&(a.h.g="",a.C=0),b!=4||c.length!=0||a.h.h||(a.o=1,P(16),e=!1),a.i=a.i&&e,e?0<c.length&&!a.aa&&(a.aa=!0,b=a.l,b.g==a&&b.$&&!b.L&&(b.h.info("Great, no buffering proxy detected. Bytes received: "+c.length),eW(b),b.L=!0,P(11))):(bc(a.j,a.m,c,"[Invalid Chunked Response]"),aH(a),b_(a))}e.fb=function(){if(this.g){var a=aj(this.g),b=this.g.ga();this.C<b.length&&(dr(this),hs(this,a,b),this.i&&a!=4&&bW(this))}};function ov(d,b){var a=d.C,c=b.indexOf("\n",a);return c==-1?cB:(a=Number(b.substring(a,c)),isNaN(a))?eh:(c+=1,c+a>b.length)?cB:(b=b.substr(c,a),d.C=c+a,b)}e.cancel=function(){this.I=!0,aH(this)};function bW(a){a.Y=Date.now()+a.P,hm(a,a.P)}function hm(a,b){if(a.B!=null)throw Error("WatchDog timer not null");a.B=bF(C(a.eb,a),b)}function dr(a){a.B&&(h.clearTimeout(a.B),a.B=null)}e.eb=function(){this.B=null;const a=Date.now();0<=a-this.Y?(oy(this.j,this.A),this.K!=2&&(bS(3),P(17)),aH(this),this.o=2,b_(this)):hm(this,this.Y-a)};function b_(a){a.l.G==0||a.I||gj(a.l,a)}function aH(a){dr(a);var b=a.L;b&&typeof b.na=="function"&&b.na(),a.L=null,es(a.W),hO(a.V),a.g&&(b=a.g,a.g=null,b.abort(),b.na())}function dZ(c,e){var a,b,f,d,g,h,i;try{if(a=c.l,a.G!=0&&(a.g==c||ee(a.i,c)))if(a.I=c.N,!c.J&&ee(a.i,c)&&a.G==3){try{b=a.Ca.g.parse(e)}catch(a){b=null}if(Array.isArray(b)&&b.length==3){{if(f=b,f[0]==0){a:{if(!a.u){if(a.g)if(a.g.F+3e3<c.F)cY(a),cJ(a);else break a;eV(a);P(18)}}}else a.ta=f[1],0<a.ta-a.U&&37500>f[2]&&a.N&&a.A==0&&!a.v&&(a.v=bF(C(a.ab,a),6e3));if(1>=gM(a.i)&&a.ka){try{a.ka()}catch(a){}a.ka=void 0}}}else aL(a,11)}else if((c.J||a.g==c)&&cY(a),!c$(e))for(f=a.Ca.g.parse(e),e=0;e<f.length;e++){let j=f[e];if(a.U=j[0],j=j[1],a.G==2)if(j[0]=="c"){a.J=j[1],a.la=j[2];const k=j[3];k!=null&&(a.ma=k,a.h.info("VER="+a.ma));const l=j[4];l!=null&&(a.za=l,a.h.info("SVER="+a.za));const f=j[5];f!=null&&typeof f=="number"&&0<f&&(b=1.5*f,a.K=b,a.h.info("backChannelRequestTimeoutMs_="+b)),b=a;const e=c.g;if(e){const a=e.g?e.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(a&&(d=b.i,!d.g&&(Q(a,"spdy")||Q(a,"quic")||Q(a,"h2"))&&(d.j=d.l,d.g=new Set,d.h&&(ef(d,d.h),d.h=null))),b.D){const a=e.g?e.g.getResponseHeader("X-HTTP-Session-Id"):null;a&&(b.sa=a,t(b.F,b.D,a))}}a.G=3,a.j&&a.j.xa(),a.$&&(a.O=Date.now()-c.F,a.h.info("Handshake RTT: "+a.O+"ms")),b=a,g=c,b.oa=ge(b,b.H?b.la:null,b.W),g.J?(gK(b.i,g),h=g,i=b.K,i&&h.setTimeout(i),h.B&&(dr(h),bW(h)),b.g=g):gl(b),0<a.l.length&&cK(a)}else j[0]!="stop"&&j[0]!="close"||aL(a,7);else a.G==3&&(j[0]=="stop"||j[0]=="close"?j[0]=="stop"?aL(a,7):eL(a):j[0]!="noop"&&a.j&&a.j.wa(j),a.A=0)}bS(4)}catch(a){}}function ot(a){if(a.R&&typeof a.R=="function")return a.R();if(typeof a=="string")return a.split("");if(fh(a)){for(var b=[],d=a.length,c=0;c<d;c++)b.push(a[c]);return b}b=[],d=0;for(c in a)b[d++]=a[c];return b}function dX(a,f){var b,d,c,e;if(a.forEach&&typeof a.forEach=="function")a.forEach(f,void 0);else if(fh(a)||typeof a=="string")i_(a,f,void 0);else{if(a.T&&typeof a.T=="function")b=a.T();else if(a.R&&typeof a.R=="function")b=void 0;else if(fh(a)||typeof a=="string"){b=[];for(d=a.length,c=0;c<d;c++)b.push(c)}else for(c in b=[],d=0,a)b[d++]=c;d=ot(a),c=d.length;for(e=0;e<c;e++)f.call(void 0,d[e],b&&b[e],a)}}function bp(c,d){var b,a;if(this.h={},this.g=[],this.i=0,b=arguments.length,1<b){if(b%2)throw Error("Uneven number of arguments");for(a=0;a<b;a+=2)this.set(arguments[a],arguments[a+1])}else if(c)if(c instanceof bp)for(b=c.T(),a=0;a<b.length;a++)this.set(b[a],c.get(b[a]));else for(a in c)this.set(a,c[a])}e=bp.prototype,e.R=function(){dW(this);for(var b=[],a=0;a<this.g.length;a++)b.push(this.h[this.g[a]]);return b},e.T=function(){return dW(this),this.g.concat()};function dW(a){var b,d,c,e;if(a.i!=a.g.length){for(b=0,d=0;b<a.g.length;)c=a.g[b],aO(a.h,c)&&(a.g[d++]=c),b++;a.g.length=d}if(a.i!=a.g.length){e={};for(d=b=0;b<a.g.length;)c=a.g[b],aO(e,c)||(a.g[d++]=c,e[c]=1),b++;a.g.length=d}}e.get=function(a,b){return aO(this.h,a)?this.h[a]:b},e.set=function(a,b){aO(this.h,a)||(this.i++,this.g.push(a)),this.h[a]=b},e.forEach=function(d,e){for(var b=this.T(),a=0,c,f;a<b.length;a++)c=b[a],f=this.get(c),d.call(e,f,c,this)};function aO(a,b){return Object.prototype.hasOwnProperty.call(a,b)}hj=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function os(a,f){var b,c,d,e;if(a){a=a.split("&");for(b=0;b<a.length;b++)c=a[b].indexOf("="),d=null,0<=c?(e=a[b].substring(0,c),d=a[b].substring(c+1)):e=a[b],f(e,d?decodeURIComponent(d.replace(/\+/g," ")):"")}}function aS(b,c){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,b instanceof aS){this.g=c!==void 0?c:b.g,dE(this,b.j),this.s=b.s,dF(this,b.i),dG(this,b.m),this.l=b.l,c=b.h;var a=new cj;a.i=c.i,c.g&&(a.g=new bp(c.g),a.h=c.h),hh(this,a),this.o=b.o}else b&&(a=String(b).match(hj))?(this.g=!!c,dE(this,a[1]||"",!0),this.s=cr(a[2]||""),dF(this,a[3]||"",!0),dG(this,a[4]),this.l=cr(a[5]||"",!0),hh(this,a[6]||"",!0),this.o=cr(a[7]||"")):(this.g=!!c,this.h=new cj(null,this.g))}aS.prototype.toString=function(){var b=[],c=this.j,a;return c&&b.push(cs(c,hc,!0),":"),a=this.i,(a||c=="file")&&(b.push("//"),(c=this.s)&&b.push(cs(c,hc,!0),"@"),b.push(encodeURIComponent(String(a)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a=this.m,a!=null&&b.push(":",String(a))),(a=this.l)&&(this.i&&a.charAt(0)!="/"&&b.push("/"),b.push(cs(a,a.charAt(0)=="/"?om:on,!0))),(a=this.h.toString())&&b.push("?",a),(a=this.o)&&b.push("#",cs(a,ok)),b.join("")};function al(a){return new aS(a)}function dE(a,b,c){a.j=c?cr(b,!0):b,a.j&&(a.j=a.j.replace(/:$/,""))}function dF(b,a,c){b.i=c?cr(a,!0):a}function dG(b,a){if(a){if(a=Number(a),isNaN(a)||0>a)throw Error("Bad port number "+a);b.m=a}else b.m=null}function hh(a,b,c){b instanceof cj?(a.h=b,oi(a.h,a.g)):(c||(b=cs(b,ol)),a.h=new cj(b,a.g))}function t(a,b,c){a.h.set(b,c)}function dJ(a){return t(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function or(a){return a instanceof aS?al(a):new aS(a,void 0)}function op(b,c,d,e){var a=new aS(null,void 0);return b&&dE(a,b),c&&dF(a,c),d&&dG(a,d),e&&(a.l=e),a}function cr(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function cs(a,b,c){return typeof a=="string"?(a=encodeURI(a).replace(b,oo),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function oo(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}hc=/[#\/\?@]/g,on=/[#\?:]/g,om=/[#\?]/g,ol=/[#\?@]/g,ok=/#/g;function cj(a,b){this.h=this.g=null,this.i=a||null,this.j=!!b}function au(a){a.g||(a.g=new bp,a.h=0,a.i&&os(a.i,function(b,c){a.add(decodeURIComponent(b.replace(/\+/g," ")),c)}))}e=cj.prototype,e.add=function(a,c){au(this),this.i=null,a=bx(this,a);var b=this.g.get(a);return b||this.g.set(a,b=[]),b.push(c),this.h+=1,this};function g_(a,b){au(a),b=bx(a,b),aO(a.g.h,b)&&(a.i=null,a.h-=a.g.get(b).length,a=a.g,aO(a.h,b)&&(delete a.h[b],a.i--,a.g.length>2*a.i&&dW(a)))}function gW(a,b){return au(a),b=bx(a,b),aO(a.g.h,b)}e.forEach=function(a,b){au(this),this.g.forEach(function(c,d){i_(c,function(c){a.call(b,c,d,this)},this)},this)},e.T=function(){var e,b,c,a,f,d;au(this);for(e=this.g.R(),b=this.g.T(),c=[],a=0;a<b.length;a++)for(f=e[a],d=0;d<f.length;d++)c.push(b[a]);return c},e.R=function(a){var b,c;if(au(this),b=[],typeof a=="string")gW(this,a)&&(b=iP(b,this.g.get(bx(this,a))));else{a=this.g.R();for(c=0;c<a.length;c++)b=iP(b,a[c])}return b},e.set=function(a,b){return au(this),this.i=null,a=bx(this,a),gW(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[b]),this.h+=1,this},e.get=function(a,b){return a?(a=this.R(a),0<a.length?String(a[0]):b):b};function gV(a,c,b){g_(a,c),0<b.length&&(a.i=null,a.g.set(bx(a,c),fe(b)),a.h+=b.length)}e.toString=function(){var d,e,c,a,g,b,f;if(this.i)return this.i;if(!this.g)return"";for(d=[],e=this.g.T(),c=0;c<e.length;c++){a=e[c],g=encodeURIComponent(String(a)),a=this.R(a);for(b=0;b<a.length;b++)f=g,a[b]!==""&&(f+="="+encodeURIComponent(String(a[b]))),d.push(f)}return this.i=d.join("&")};function bx(b,a){return a=String(a),b.j&&(a=a.toLowerCase()),a}function oi(a,b){b&&!a.j&&(au(a),a.i=null,a.g.forEach(function(c,a){var b=a.toLowerCase();a!=b&&(g_(this,a),gV(this,b,c))},a)),a.j=b}oh=class{constructor(a,b){this.h=a,this.g=b}};function gR(a){this.l=a||oe,h.PerformanceNavigationTiming?(a=h.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(h.g&&h.g.Ea&&h.g.Ea()&&h.g.Ea().Zb),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}oe=10;function gN(a){return!!a.h||(!!a.g&&a.g.size>=a.j)}function gM(a){return a.h?1:a.g?a.g.size:0}function ee(a,b){return a.h?a.h==b:!!a.g&&a.g.has(b)}function ef(a,b){a.g?a.g.add(b):a.h=b}function gK(a,b){a.h&&a.h==b?a.h=null:a.g&&a.g.has(b)&&a.g.delete(b)}gR.prototype.cancel=function(){if(this.i=gJ(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const a of this.g.values())a.cancel();this.g.clear()}};function gJ(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let b=a.i;for(const c of a.g.values())b=b.concat(c.D);return b}return fe(a.i)}function ei(){}ei.prototype.stringify=function(a){return h.JSON.stringify(a,void 0)},ei.prototype.parse=function(a){return h.JSON.parse(a,void 0)};function n$(){this.g=new ei}function n_(c,a,d){const b=d||"";try{dX(c,function(c,e){let d=c;bX(c)&&(d=ev(c)),a.push(b+e+"="+encodeURIComponent(d))})}catch(c){throw a.push(b+"type="+encodeURIComponent("_badmap")),c}}function nS(c,a){const b=new cH;if(h.Image){const d=new Image;d.onload=dk(da,b,d,"TestLoadImage: loaded",!0,a),d.onerror=dk(da,b,d,"TestLoadImage: error",!1,a),d.onabort=dk(da,b,d,"TestLoadImage: abort",!1,a),d.ontimeout=dk(da,b,d,"TestLoadImage: timeout",!1,a),h.setTimeout(function(){d.ontimeout&&d.ontimeout()},1e4),d.src=c}else a(!1)}function da(d,a,e,b,c){try{a.onload=null,a.onerror=null,a.onabort=null,a.ontimeout=null,c(b)}catch(a){}}function bG(a){this.l=a.$b||null,this.j=a.ib||!1}F(bG,en),bG.prototype.g=function(){return new cL(this.l,this.j)},bG.prototype.i=function(a){return function(){return a}}({});function cL(a,b){A.call(this),this.D=a,this.u=b,this.m=void 0,this.readyState=ep,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}F(cL,A),ep=0,e=cL.prototype,e.open=function(a,b){if(this.readyState!=ep)throw this.abort(),Error("Error reopening a connection");this.C=a,this.B=b,this.readyState=1,cw(this)},e.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const b={headers:this.v,method:this.C,credentials:this.m,cache:void 0};a&&(b.body=a),(this.D||h).fetch(new Request(this.B,b)).then(this.Va.bind(this),this.ha.bind(this))},e.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,cv(this)),this.readyState=ep},e.Va=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,cw(this)),this.g&&(this.readyState=3,cw(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(typeof h.ReadableStream!="undefined"&&"body"in a){if(this.j=a.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;gD(this)}else a.text().then(this.Ua.bind(this),this.ha.bind(this))};function gD(a){a.j.read().then(a.Sa.bind(a)).catch(a.ha.bind(a))}e.Sa=function(a){if(this.g){if(this.u&&a.value)this.response.push(a.value);else if(!this.u){var b=a.value?a.value:new Uint8Array(0);(b=this.A.decode(b,{stream:!a.done}))&&(this.response=this.responseText+=b)}a.done?cv(this):cw(this),this.readyState==3&&gD(this)}},e.Ua=function(a){this.g&&(this.response=this.responseText=a,cv(this))},e.Ta=function(a){this.g&&(this.response=a,cv(this))},e.ha=function(){this.g&&cv(this)};function cv(a){a.readyState=4,a.l=null,a.j=null,a.A=null,cw(a)}e.setRequestHeader=function(a,b){this.v.append(a,b)},e.getResponseHeader=function(a){return this.h?this.h.get(a.toLowerCase())||"":""},e.getAllResponseHeaders=function(){if(!this.h)return"";const b=[],c=this.h.entries();for(var a=c.next();!a.done;)a=a.value,b.push(a[0]+": "+a[1]),a=c.next();return b.join("\r\n")};function cw(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(cL.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}}),nQ=h.JSON.parse;function z(a){A.call(this),this.headers=new bp,this.u=a||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=gC,this.K=this.L=!1}F(z,A),gC="",nP=/^https?$/i,nN=["POST","PUT"],e=z.prototype,e.ea=function(a,b,e,c){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+a);b=b?b.toUpperCase():"GET",this.H=a,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ek.g(),this.C=this.u?hz(this.u):hz(ek),this.g.onreadystatechange=C(this.Fa,this);try{this.F=!0,this.g.open(b,String(a),!0),this.F=!1}catch(a){gx(this,a);return}a=e||"";const d=new bp(this.headers);c&&dX(c,function(a,b){d.set(b,a)}),c=oX(d.T()),e=h.FormData&&a instanceof h.FormData,!(0<=i$(nN,b))||c||e||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),d.forEach(function(a,b){this.g.setRequestHeader(b,a)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{gt(this),0<this.B&&((this.K=nM(this.g))?(this.g.timeout=this.B,this.g.ontimeout=C(this.pa,this)):this.A=er(this.pa,this.B,this)),this.v=!0,this.g.send(a),this.v=!1}catch(a){gx(this,a)}};function nM(a){return by&&oR()&&typeof a.timeout=="number"&&a.ontimeout!==void 0}function nI(a){return a.toLowerCase()=="content-type"}e.pa=function(){typeof fi!="undefined"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,D(this,"timeout"),this.abort(8))};function gx(a,b){a.h=!1,a.g&&(a.l=!0,a.g.abort(),a.l=!1),a.j=b,a.m=5,gw(a),cD(a)}function gw(a){a.D||(a.D=!0,D(a,"complete"),D(a,"error"))}e.abort=function(a){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=a||7,D(this,"complete"),D(this,"abort"),cD(this))},e.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),cD(this,!0)),z.Z.M.call(this)},e.Fa=function(){this.s||(this.F||this.v||this.l?gu(this):this.cb())},e.cb=function(){gu(this)};function gu(a){var e,c,d,b,f,g;if(a.h&&typeof fi!="undefined"&&(!a.C[1]||aj(a)!=4||a.ba()!=2))if(a.v&&aj(a)==4)er(a.Fa,0,a);else if(D(a,"readystatechange"),aj(a)==4){a.h=!1;try{const i=a.ba();a:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:e=!0;break a;default:e=!1}if((c=e)||((d=i===0)&&(b=String(a.H).match(hj)[1]||null,!b&&h.self&&h.self.location&&(f=h.self.location.protocol,b=f.substr(0,f.length-1)),d=!nP.test(b?b.toLowerCase():"")),c=d),c)D(a,"complete"),D(a,"success");else{a.m=6;try{g=2<aj(a)?a.g.statusText:""}catch(a){g=""}a.j=g+" ["+a.ba()+"]",gw(a)}}finally{cD(a)}}}function cD(a,b){if(a.g){gt(a);const c=a.g,d=a.C[0]?dq:null;a.g=null,a.C=null,b||D(a,"ready");try{c.onreadystatechange=d}catch(a){}}}function gt(a){a.g&&a.K&&(a.g.ontimeout=null),a.A&&(h.clearTimeout(a.A),a.A=null)}function aj(a){return a.g?a.g.readyState:0}e.ba=function(){try{return 2<aj(this)?this.g.status:-1}catch(a){return-1}},e.ga=function(){try{return this.g?this.g.responseText:""}catch(a){return""}},e.Qa=function(b){if(this.g){var a=this.g.responseText;return b&&a.indexOf(b)==0&&(a=a.substring(b.length)),nQ(a)}};function gr(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.J){case gC:case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(a){return null}}e.Da=function(){return this.m},e.La=function(){return typeof this.j=="string"?this.j:String(this.j)};function nG(b){let a="";return fa(b,function(b,c){a+=c,a+=":",a+=b,a+="\r\n"}),a}function eI(c,d,a){a:{for(b in a){var b=!1;break a}b=!0}b||(a=nG(a),typeof c=="string"?a!=null&&encodeURIComponent(String(a)):t(c,d,a))}function cc(c,b,a){return a&&a.internalChannelParams?a.internalChannelParams[c]||b:b}function gq(a){this.za=0,this.l=[],this.h=new cH,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=cc("failFast",!1,a),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=cc("baseRetryDelayMs",5e3,a),this.$a=cc("retryDelaySeedMs",1e4,a),this.Ya=cc("forwardChannelMaxRetries",2,a),this.ra=cc("forwardChannelRequestTimeoutMs",2e4,a),this.qa=a&&a.xmlHttpFactory||void 0,this.Ba=a&&a.Yb||!1,this.K=void 0,this.H=a&&a.supportsCrossDomainXhr||!1,this.J="",this.i=new gR(a&&a.concurrentRequestLimit),this.Ca=new n$,this.ja=a&&a.fastHandshake||!1,this.Ra=a&&a.Wb||!1,a&&a.Aa&&this.h.Aa(),a&&a.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&a&&a.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!a||a.Xb!==!1}e=gq.prototype,e.ma=8,e.G=1;function eL(c){if(gp(c),c.G==3){var a=c.V++,b=al(c.F);t(b,"SID",c.J),t(b,"RID",a),t(b,"TYPE","terminate"),bM(c,b),a=new bO(c,c.h,a,void 0),a.K=2,a.v=dJ(al(b)),b=!1,h.navigator&&h.navigator.sendBeacon&&(b=h.navigator.sendBeacon(a.v.toString(),"")),!b&&h.Image&&((new Image).src=a.v,b=!0),b||(a.g=gc(a.l,null),a.g.ea(a.v)),a.F=Date.now(),bW(a)}gf(c)}e.hb=function(a){try{this.h.info("Origin Trials invoked: "+a)}catch(a){}};function cJ(a){a.g&&(eW(a),a.g.cancel(),a.g=null)}function gp(a){cJ(a),a.u&&(h.clearTimeout(a.u),a.u=null),cY(a),a.i.cancel(),a.m&&(typeof a.m=="number"&&h.clearTimeout(a.m),a.m=null)}function eO(a,b){a.l.push(new oh(a.Za++,b)),a.G==3&&cK(a)}function cK(a){gN(a.i)||a.m||(a.m=!0,eg(a.Ha,a),a.C=0)}function nC(a,b){return!(gM(a.i)>=a.i.j-(a.m?1:0))&&(a.m?(a.l=b.D.concat(a.l),!0):!(a.G==1||a.G==2||a.C>=(a.Xa?0:a.Ya))&&(a.m=bF(C(a.Ha,a,b),gg(a,a.C)),a.C++,!0))}e.Ha=function(d){var b,a,c;if(this.m)if(this.m=null,this.G==1){if(!d){this.V=Math.floor(1e5*Math.random()),d=this.V++;const f=new bO(this,this.h,d,void 0);let e=this.s;if(this.P&&(e?(e=iL(e),iI(e,this.P)):e=this.P),this.o===null&&(f.H=e),this.ja)a:{b=0;for(a=0;a<this.l.length;a++){b:{c=this.l[a];if("__data__"in c.g&&(c=c.g.__data__,typeof c=="string")){c=c.length;break b}c=void 0}if(c===void 0)break;if(b+=c,4096<b){b=a;break a}if(b===4096||a===this.l.length-1){b=a+1;break a}}b=1e3}else b=1e3;b=gn(this,f,b),a=al(this.F),t(a,"RID",d),t(a,"CVER",22),this.D&&t(a,"X-HTTP-Session-Id",this.D),bM(this,a),this.o&&e&&eI(a,this.o,e),ef(this.i,f),this.Ra&&t(a,"TYPE","init"),this.ja?(t(a,"$req",b),t(a,"SID","null"),f.$=!0,ed(f,a,null)):ed(f,a,b),this.G=2}}else this.G==3&&(d?gm(this,d):this.l.length==0||gN(this.i)||gm(this))};function gm(a,c){var b;c?b=c.m:b=a.V++;const d=al(a.F);t(d,"SID",a.J),t(d,"RID",b),t(d,"AID",a.U),bM(a,d),a.o&&a.s&&eI(d,a.o,a.s),b=new bO(a,a.h,b,a.C+1),a.o===null&&(b.H=a.s),c&&(a.l=c.D.concat(a.l)),c=gn(a,b,1e3),b.setTimeout(Math.round(.5*a.ra)+Math.round(.5*a.ra*Math.random())),ef(a.i,b),ed(b,d,c)}function bM(a,b){a.j&&dX({},function(a,c){t(b,c,a)})}function gn(a,e,b){var c,d;b=Math.min(a.l.length,b),c=a.j?C(a.j.Oa,a.j,a):null;a:{d=a.l;let e=-1;for(;;){const a=["count="+b];e==-1?0<b?(e=d[0].h,a.push("ofs="+e)):e=0:a.push("ofs="+e);let f=!0;for(let g=0;g<b;g++){let h=d[g].h;const i=d[g].g;if(h-=e,0>h)e=Math.max(0,d[g].h-100),f=!1;else try{n_(i,a,"req"+h+"_")}catch(a){c&&c(i)}}if(f){c=a.join("&");break a}}}return a=a.l.splice(0,b),e.D=a,c}function gl(a){a.g||a.u||(a.Y=1,eg(a.Ga,a),a.A=0)}function eV(a){return!(a.g||a.u||3<=a.A)&&(a.Y++,a.u=bF(C(a.Ga,a),gg(a,a.A)),a.A++,!0)}e.Ga=function(){if(this.u=null,gk(this),this.$&&!(this.L||this.g==null||0>=this.O)){var a=2*this.O;this.h.info("BP detection timer enabled: "+a),this.B=bF(C(this.bb,this),a)}},e.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,P(10),cJ(this),gk(this))};function eW(a){a.B!=null&&(h.clearTimeout(a.B),a.B=null)}function gk(a){var b,c;a.g=new bO(a,a.h,"rpc",a.Y),a.o===null&&(a.g.H=a.s),a.g.O=0,b=al(a.oa),t(b,"RID","rpc"),t(b,"SID",a.J),t(b,"CI",a.N?"0":"1"),t(b,"AID",a.U),bM(a,b),t(b,"TYPE","xmlhttp"),a.o&&a.s&&eI(b,a.o,a.s),a.K&&a.g.setTimeout(a.K),c=a.g,a=a.la,c.K=1,c.v=dJ(al(b)),c.s=null,c.U=!0,hv(c,a)}e.ab=function(){this.v!=null&&(this.v=null,cJ(this),eV(this),P(19))};function cY(a){a.v!=null&&(h.clearTimeout(a.v),a.v=null)}function gj(a,b){var d=null,c,e;if(a.g==b)cY(a),eW(a),a.g=null,c=2;else if(ee(a.i,b))d=b.D,gK(a.i,b),c=1;else return;if(a.I=b.N,a.G!=0)if(b.i)c==1?(d=b.s?b.s.length:0,b=Date.now()-b.F,e=a.C,c=cP(),D(c,new hG(c,d,b,e)),cK(a)):gl(a);else if(e=b.o,e==3||e==0&&0<a.I||!(c==1&&nC(a,b)||c==2&&eV(a)))switch(d&&0<d.length&&(b=a.i,b.i=b.i.concat(d)),e){case 1:aL(a,5);break;case 4:aL(a,10);break;case 3:aL(a,6);break;default:aL(a,2)}}function gg(a,c){let b=a.Pa+Math.floor(Math.random()*a.$a);return a.j||(b*=2),b*c}function aL(a,c){var b,d;a.h.info("Error code "+c),c==2?(b=null,a.j&&(b=null),d=C(a.jb,a),b||(b=new aS("//www.google.com/images/cleardot.gif"),h.location&&h.location.protocol=="http"||dE(b,"https"),dJ(b)),nS(b.toString(),d)):P(2),a.G=0,a.j&&a.j.va(c),gf(a),gp(a)}e.jb=function(a){a?(this.h.info("Successfully pinged google.com"),P(2)):(this.h.info("Failed to ping google.com"),P(1))};function gf(a){a.G=0,a.I=-1,a.j&&((gJ(a.i).length!=0||a.l.length!=0)&&(a.i.i.length=0,fe(a.l),a.l.length=0),a.j.ua())}function ge(c,b,d){let a=or(d);if(a.i!="")b&&dF(a,b+"."+a.i),dG(a,a.m);else{const c=h.location;a=op(c.protocol,b?b+"."+c.hostname:c.hostname,+c.port,d)}return c.aa&&fa(c.aa,function(b,c){t(a,c,b)}),b=c.D,d=c.sa,b&&d&&t(a,b,d),t(a,"VER",c.ma),bM(c,a),a}function gc(a,b,c){if(b&&!a.H)throw Error("Can't create secondary domain capable XhrIo object.");return b=c&&a.Ba&&!a.qa?new z(new bG({ib:!0})):new z(a.qa),b.L=a.H,b}function gb(){}e=gb.prototype,e.xa=function(){},e.wa=function(){},e.va=function(){},e.ua=function(){},e.Oa=function(){};function dc(){if(by&&!(10<=Number(oQ)))throw Error("Environmental error: no available transport.")}dc.prototype.g=function(a,b){return new Z(a,b)};function Z(b,a){A.call(this),this.g=new gq(a),this.l=b,this.h=a&&a.messageUrlParams||null,b=a&&a.messageHeaders||null,a&&a.clientProtocolHeaderRequired&&(b?b["X-Client-Protocol"]="webchannel":b={"X-Client-Protocol":"webchannel"}),this.g.s=b,b=a&&a.initMessageHeaders||null,a&&a.messageContentType&&(b?b["X-WebChannel-Content-Type"]=a.messageContentType:b={"X-WebChannel-Content-Type":a.messageContentType}),a&&a.ya&&(b?b["X-WebChannel-Client-Profile"]=a.ya:b={"X-WebChannel-Client-Profile":a.ya}),this.g.P=b,(b=a&&a.httpHeadersOverwriteParam)&&!c$(b)&&(this.g.o=b),this.A=a&&a.supportsCrossDomainXhr||!1,this.v=a&&a.sendRawJson||!1,(a=a&&a.httpSessionIdParam)&&!c$(a)&&(this.g.D=a,b=this.h,b!==null&&a in b&&(b=this.h,a in b&&delete b[a])),this.j=new bv(this)}F(Z,A),Z.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var a=this.g,b=this.l,c=this.h||void 0;a.Wa&&(a.h.info("Origin Trials enabled."),eg(C(a.hb,a,b))),P(0),a.W=b,a.aa=c||{},a.N=a.X,a.F=ge(a,null,a.W),cK(a)},Z.prototype.close=function(){eL(this.g)},Z.prototype.u=function(b){if(typeof b=="string"){var a={};a.__data__=b,eO(this.g,a)}else this.v?(a={},a.__data__=ev(b),eO(this.g,a)):eO(this.g,b)},Z.prototype.M=function(){this.g.j=null,delete this.j,eL(this.g),delete this.g,Z.Z.M.call(this)};function ga(a){em.call(this);var b=a.__sm__;if(b){a:{for(const c in b){a=c;break a}a=void 0}(this.i=a)&&(a=this.i,b=b!==null&&a in b?b[a]:void 0),this.data=b}else this.data=a}F(ga,em);function f_(){el.call(this),this.status=1}F(f_,el);function bv(a){this.g=a}F(bv,gb),bv.prototype.xa=function(){D(this.g,"a")},bv.prototype.wa=function(a){D(this.g,new ga(a))},bv.prototype.va=function(a){D(this.g,new f_(a))},bv.prototype.ua=function(){D(this.g,"b")},dc.prototype.createWebChannel=dc.prototype.g,Z.prototype.send=Z.prototype.u,Z.prototype.open=Z.prototype.m,Z.prototype.close=Z.prototype.close,cW.NO_ERROR=0,cW.TIMEOUT=8,cW.HTTP_ERROR=6,hB.COMPLETE="complete",hx.EventType=bL,bL.OPEN="a",bL.CLOSE="b",bL.ERROR="c",bL.MESSAGE="d",A.prototype.listen=A.prototype.N,z.prototype.listenOnce=z.prototype.O,z.prototype.getLastError=z.prototype.La,z.prototype.getLastErrorCode=z.prototype.Da,z.prototype.getStatus=z.prototype.ba,z.prototype.getResponseJson=z.prototype.Qa,z.prototype.getResponseText=z.prototype.ga,z.prototype.send=z.prototype.ea,nB=ao.createWebChannelTransport=function(){return new dc},nz=ao.getStatEventTarget=function(){return cP()},fl=ao.ErrorCode=cW,ny=ao.EventType=hB,nw=ao.Event=aT,fU=ao.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},ns=ao.FetchXmlHttpFactory=bG,dx=ao.WebChannel=hx,nr=ao.XhrIo=z,fP="@firebase/firestore",T=class{constructor(a){this.uid=a}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(a){return a.uid===this.uid}},T.UNAUTHENTICATED=new T(null),T.GOOGLE_CREDENTIALS=new T("google-credentials-uid"),T.FIRST_PARTY=new T("first-party-uid"),T.MOCK_USER=new T("mock-user"),bj="9.6.1",aJ=new jH("@firebase/firestore");function fw(){return aJ.logLevel}function c(a,...b){if(aJ.logLevel<=n.DEBUG){const c=b.map(fA);aJ.debug(`Firestore (${bj}): ${a}`,...c)}}function W(a,...b){if(aJ.logLevel<=n.ERROR){const c=b.map(fA);aJ.error(`Firestore (${bj}): ${a}`,...c)}}function fO(a,...b){if(aJ.logLevel<=n.WARN){const c=b.map(fA);aJ.warn(`Firestore (${bj}): ${a}`,...c)}}function fA(a){if(typeof a=="string")return a;try{return b=a,JSON.stringify(b)}catch(b){return a}var b}function g(b="Unexpected state"){const a=`FIRESTORE (${bj}) INTERNAL ASSERTION FAILED: `+b;throw W(a),new Error(a)}function i(a,b){a||g()}function j(a,b){return a}a={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},d=class extends Error{constructor(b,a){super(a),this.code=b,this.message=a,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}},an=class{constructor(){this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}},np=class{constructor(a,b){this.user=b,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${a}`)}},nm=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(a,b){a.enqueueRetryable(()=>b(T.UNAUTHENTICATED))}shutdown(){}},nl=class{constructor(a){this.t=a,this.currentUser=T.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(b,h){let d=this.i;const e=a=>this.i!==d?(d=this.i,h(a)):Promise.resolve();let a=new an;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new an,b.enqueueRetryable(()=>e(this.currentUser))};const f=()=>{const c=a;b.enqueueRetryable(async()=>{await c.promise,await e(this.currentUser)})},g=a=>{c("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=a,this.auth.addAuthTokenListener(this.o),f()};this.t.onInit(a=>g(a)),setTimeout(()=>{if(!this.auth){const b=this.t.getImmediate({optional:!0});b?g(b):(c("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new an)}},0),f()}getToken(){const a=this.i,b=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(b).then(b=>this.i!==a?(c("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):b?(i(typeof b.accessToken=="string"),new np(b.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const a=this.auth&&this.auth.getUid();return i(a===null||typeof a=="string"),new T(a)}},nk=class{constructor(c,d,a){this.type="FirstParty",this.user=T.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",d);const b=c.auth.getAuthHeaderValueForFirstParty([]);b&&this.headers.set("Authorization",b),a&&this.headers.set("X-Goog-Iam-Authorization-Token",a)}},nj=class{constructor(a,b,c){this.h=a,this.l=b,this.m=c}getToken(){return Promise.resolve(new nk(this.h,this.l,this.m))}start(a,b){a.enqueueRetryable(()=>b(T.FIRST_PARTY))}shutdown(){}invalidateToken(){}},ni=class{constructor(a){this.value=a,this.type="AppCheck",this.headers=new Map,a&&a.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},nh=class{constructor(a){this.g=a,this.forceRefresh=!1,this.appCheck=null}start(b,d){this.o=a=>{b.enqueueRetryable(()=>(a=>(a.error!=null&&c("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`),d(a.token)))(a))};const a=a=>{c("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.appCheck.addTokenListener(this.o)};this.g.onInit(b=>a(b)),setTimeout(()=>{if(!this.appCheck){const b=this.g.getImmediate({optional:!0});b?a(b):c("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const a=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(a).then(a=>a?(i(typeof a.token=="string"),new ni(a.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}},ac=class{constructor(b,a){this.previousValue=b,a&&(a.sequenceNumberHandler=a=>this.p(a),this.T=b=>a.writeSequenceNumber(b))}p(a){return this.previousValue=Math.max(a,this.previousValue),this.previousValue}next(){const a=++this.previousValue;return this.T&&this.T(a),a}};function ng(c){const a=typeof self!="undefined"&&(self.crypto||self.msCrypto),b=new Uint8Array(c);if(a&&typeof a.getRandomValues=="function")a.getRandomValues(b);else for(let a=0;a<c;a++)b[a]=Math.floor(256*Math.random());return b}ac.I=-1,nf=class{static A(){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=Math.floor(256/a.length)*a.length;let b="";for(;b.length<20;){const d=ng(40);for(let e=0;e<d.length;++e)b.length<20&&d[e]<c&&(b+=a.charAt(d[e]%a.length))}return b}};function l(a,b){return a<b?-1:a>b?1:0}function bg(a,b,c){return a.length===b.length&&a.every((a,d)=>c(a,b[d]))}function fT(a){return a+"\0"}M=class{constructor(b,c){if(this.seconds=b,this.nanoseconds=c,c<0)throw new d(a.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+c);if(c>=1e9)throw new d(a.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+c);if(b<-62135596800)throw new d(a.INVALID_ARGUMENT,"Timestamp seconds out of range: "+b);if(b>=253402300800)throw new d(a.INVALID_ARGUMENT,"Timestamp seconds out of range: "+b)}static now(){return M.fromMillis(Date.now())}static fromDate(a){return M.fromMillis(a.getTime())}static fromMillis(a){const b=Math.floor(a/1e3),c=Math.floor(1e6*(a-1e3*b));return new M(b,c)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(a){return this.seconds===a.seconds?l(this.nanoseconds,a.nanoseconds):l(this.seconds,a.seconds)}isEqual(a){return a.seconds===this.seconds&&a.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const a=this.seconds- -62135596800;return String(a).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}},k=class{constructor(a){this.timestamp=a}static fromTimestamp(a){return new k(a)}static min(){return new k(new M(0,0))}compareTo(a){return this.timestamp._compareTo(a.timestamp)}isEqual(a){return this.timestamp.isEqual(a.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};function fW(a){let b=0;for(const c in a)Object.prototype.hasOwnProperty.call(a,c)&&b++;return b}function bD(a,b){for(const c in a)Object.prototype.hasOwnProperty.call(a,c)&&b(c,a[c])}function fY(a){for(const b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0}ds=class{constructor(b,a,c){a===void 0?a=0:a>b.length&&g(),c===void 0?c=b.length-a:c>b.length-a&&g(),this.segments=b,this.offset=a,this.len=c}get length(){return this.len}isEqual(a){return ds.comparator(this,a)===0}child(a){const b=this.segments.slice(this.offset,this.limit());return a instanceof ds?a.forEach(a=>{b.push(a)}):b.push(a),this.construct(b)}limit(){return this.offset+this.length}popFirst(a){return a=a===void 0?1:a,this.construct(this.segments,this.offset+a,this.length-a)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(a){return this.segments[this.offset+a]}isEmpty(){return this.length===0}isPrefixOf(a){if(a.length<this.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}isImmediateParentOf(a){if(this.length+1!==a.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}forEach(a){for(let b=this.offset,c=this.limit();b<c;b++)a(this.segments[b])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(a,b){const c=Math.min(a.length,b.length);for(let d=0;d<c;d++){const e=a.get(d),f=b.get(d);if(e<f)return-1;if(e>f)return 1}return a.length<b.length?-1:a.length>b.length?1:0}},r=class extends ds{construct(a,b,c){return new r(a,b,c)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...c){const b=[];for(const e of c){if(e.indexOf("//")>=0)throw new d(a.INVALID_ARGUMENT,`Invalid segment (${e}). Paths must not contain // in them.`);b.push(...e.split("/").filter(a=>a.length>0))}return new r(b)}static emptyPath(){return new r([])}},nc=/^[_a-zA-Z][_a-zA-Z0-9]*$/,R=class extends ds{construct(a,b,c){return new R(a,b,c)}static isValidIdentifier(a){return nc.test(a)}canonicalString(){return this.toArray().map(a=>(a=a.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),R.isValidIdentifier(a)||(a="`"+a+"`"),a)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new R(["__name__"])}static fromServerFormat(b){const g=[];let e="",c=0;const h=()=>{if(e.length===0)throw new d(a.INVALID_ARGUMENT,`Invalid field path (${b}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);g.push(e),e=""};let f=!1;for(;c<b.length;){const g=b[c];if(g==="\\"){if(c+1===b.length)throw new d(a.INVALID_ARGUMENT,"Path has trailing escape character: "+b);const f=b[c+1];if(f!=="\\"&&f!=="."&&f!=="`")throw new d(a.INVALID_ARGUMENT,"Path has invalid escape sequence: "+b);e+=f,c+=2}else g==="`"?(f=!f,c++):g!=="."||f?(e+=g,c++):(h(),c++)}if(h(),f)throw new d(a.INVALID_ARGUMENT,"Unterminated ` in path: "+b);return new R(g)}static emptyPath(){return new R([])}},nb=class{constructor(a){this.fields=a,a.sort(R.comparator)}covers(a){for(const b of this.fields)if(b.isPrefixOf(a))return!0;return!1}isEqual(a){return bg(this.fields,a.fields,(a,b)=>a.isEqual(b))}},K=class{constructor(a){this.binaryString=a}static fromBase64String(a){const b=atob(a);return new K(b)}static fromUint8Array(a){const b=function(a){let b="";for(let c=0;c<a.length;++c)b+=String.fromCharCode(a[c]);return b}(a);return new K(b)}toBase64(){return a=this.binaryString,btoa(a);var a}toUint8Array(){return function(a){const b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(a){return l(this.binaryString,a.binaryString)}isEqual(a){return this.binaryString===a.binaryString}},K.EMPTY_BYTE_STRING=new K(""),mX=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function at(a){if(i(!!a),typeof a=="string"){let c=0;const b=mX.exec(a);if(i(!!b),b[1]){let a=b[1];a=(a+"000000000").substr(0,9),c=Number(a)}const d=new Date(a);return{seconds:Math.floor(d.getTime()/1e3),nanos:c}}return{seconds:y(a.seconds),nanos:y(a.nanos)}}function y(a){return typeof a=="number"?a:typeof a=="string"?Number(a):0}function bA(a){return typeof a=="string"?K.fromBase64String(a):K.fromUint8Array(a)}function gh(c){var a,b;return((b=(((a=c==null?void 0:c.mapValue)===null||a===void 0?void 0:a.fields)||{}).__type__)===null||b===void 0?void 0:b.stringValue)==="server_timestamp"}function gi(b){const a=b.mapValue.fields.__previous_value__;return gh(a)?gi(a):a}function bH(b){const a=at(b.mapValue.fields.__local_write_time__.timestampValue);return new M(a.seconds,a.nanos)}function bt(a){return a==null}function dR(a){return a===0&&1/a==-1/0}function lc(a){return typeof a=="number"&&Number.isInteger(a)&&!dR(a)&&a<=Number.MAX_SAFE_INTEGER&&a>=Number.MIN_SAFE_INTEGER}f=class{constructor(a){this.path=a}static fromPath(a){return new f(r.fromString(a))}static fromName(a){return new f(r.fromString(a).popFirst(5))}hasCollectionId(a){return this.path.length>=2&&this.path.get(this.path.length-2)===a}isEqual(a){return a!==null&&r.comparator(this.path,a.path)===0}toString(){return this.path.toString()}static comparator(a,b){return r.comparator(a.path,b.path)}static isDocumentKey(a){return a.length%2==0}static fromSegments(a){return new f(new r(a.slice()))}};function aW(a){return"nullValue"in a?0:"booleanValue"in a?1:"integerValue"in a||"doubleValue"in a?2:"timestampValue"in a?3:"stringValue"in a?5:"bytesValue"in a?6:"referenceValue"in a?7:"geoPointValue"in a?8:"arrayValue"in a?9:"mapValue"in a?gh(a)?4:10:g()}function ah(a,b){const c=aW(a);if(c!==aW(b))return!1;switch(c){case 0:return!0;case 1:return a.booleanValue===b.booleanValue;case 4:return bH(a).isEqual(bH(b));case 3:return function(a,b){if(typeof a.timestampValue=="string"&&typeof b.timestampValue=="string"&&a.timestampValue.length===b.timestampValue.length)return a.timestampValue===b.timestampValue;const c=at(a.timestampValue),d=at(b.timestampValue);return c.seconds===d.seconds&&c.nanos===d.nanos}(a,b);case 5:return a.stringValue===b.stringValue;case 6:return function(a,b){return bA(a.bytesValue).isEqual(bA(b.bytesValue))}(a,b);case 7:return a.referenceValue===b.referenceValue;case 8:return function(a,b){return y(a.geoPointValue.latitude)===y(b.geoPointValue.latitude)&&y(a.geoPointValue.longitude)===y(b.geoPointValue.longitude)}(a,b);case 2:return function(a,b){if("integerValue"in a&&"integerValue"in b)return y(a.integerValue)===y(b.integerValue);if("doubleValue"in a&&"doubleValue"in b){const c=y(a.doubleValue),d=y(b.doubleValue);return c===d?dR(c)===dR(d):isNaN(c)&&isNaN(d)}return!1}(a,b);case 9:return bg(a.arrayValue.values||[],b.arrayValue.values||[],ah);case 10:return function(c,d){const a=c.mapValue.fields||{},b=d.mapValue.fields||{};if(fW(a)!==fW(b))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(b[c]===void 0||!ah(a[c],b[c])))return!1;return!0}(a,b);default:return g()}}function bZ(a,b){return(a.values||[]).find(a=>ah(a,b))!==void 0}function aY(a,b){const c=aW(a),d=aW(b);if(c!==d)return l(c,d);switch(c){case 0:return 0;case 1:return l(a.booleanValue,b.booleanValue);case 2:return function(c,d){const a=y(c.integerValue||c.doubleValue),b=y(d.integerValue||d.doubleValue);return a<b?-1:a>b?1:a===b?0:isNaN(a)?isNaN(b)?0:-1:1}(a,b);case 3:return gs(a.timestampValue,b.timestampValue);case 4:return gs(bH(a),bH(b));case 5:return l(a.stringValue,b.stringValue);case 6:return function(a,b){const c=bA(a),d=bA(b);return c.compareTo(d)}(a.bytesValue,b.bytesValue);case 7:return function(c,d){const a=c.split("/"),b=d.split("/");for(let c=0;c<a.length&&c<b.length;c++){const d=l(a[c],b[c]);if(d!==0)return d}return l(a.length,b.length)}(a.referenceValue,b.referenceValue);case 8:return function(a,b){const c=l(y(a.latitude),y(b.latitude));return c!==0?c:l(y(a.longitude),y(b.longitude))}(a.geoPointValue,b.geoPointValue);case 9:return function(c,d){const a=c.values||[],b=d.values||[];for(let c=0;c<a.length&&c<b.length;++c){const d=aY(a[c],b[c]);if(d)return d}return l(a.length,b.length)}(a.arrayValue,b.arrayValue);case 10:return function(e,f){const c=e.fields||{},a=Object.keys(c),d=f.fields||{},b=Object.keys(d);a.sort(),b.sort();for(let e=0;e<a.length&&e<b.length;++e){const f=l(a[e],b[e]);if(f!==0)return f;const g=aY(c[a[e]],d[b[e]]);if(g!==0)return g}return l(a.length,b.length)}(a.mapValue,b.mapValue);default:throw g()}}function gs(a,b){if(typeof a=="string"&&typeof b=="string"&&a.length===b.length)return l(a,b);const c=at(a),d=at(b),e=l(c.seconds,d.seconds);return e!==0?e:l(c.nanos,d.nanos)}function eE(a){return eC(a)}function eC(a){return"nullValue"in a?"null":"booleanValue"in a?""+a.booleanValue:"integerValue"in a?""+a.integerValue:"doubleValue"in a?""+a.doubleValue:"timestampValue"in a?function(b){const a=at(b);return`time(${a.seconds},${a.nanos})`}(a.timestampValue):"stringValue"in a?a.stringValue:"bytesValue"in a?bA(a.bytesValue).toBase64():"referenceValue"in a?(c=a.referenceValue,f.fromName(c).toString()):"geoPointValue"in a?`geo(${(b=a.geoPointValue).latitude},${b.longitude})`:"arrayValue"in a?function(c){let a="[",b=!0;for(const d of c.values||[])b?b=!1:a+=",",a+=eC(d);return a+"]"}(a.arrayValue):"mapValue"in a?function(b){const d=Object.keys(b.fields||{}).sort();let a="{",c=!0;for(const e of d)c?c=!1:a+=",",a+=`${e}:${eC(b.fields[e])}`;return a+"}"}(a.mapValue):g();var b,c}function gv(a,b){return{referenceValue:`projects/${a.projectId}/databases/${a.database}/documents/${b.path.canonicalString()}`}}function eB(a){return!!a&&"integerValue"in a}function eA(a){return!!a&&"arrayValue"in a}function gy(a){return!!a&&"nullValue"in a}function gz(a){return!!a&&"doubleValue"in a&&isNaN(Number(a.doubleValue))}function ez(a){return!!a&&"mapValue"in a}function ci(a){if(a.geoPointValue)return{geoPointValue:Object.assign({},a.geoPointValue)};if(a.timestampValue&&typeof a.timestampValue=="object")return{timestampValue:Object.assign({},a.timestampValue)};if(a.mapValue){const b={mapValue:{fields:{}}};return bD(a.mapValue.fields,(a,c)=>b.mapValue.fields[a]=ci(c)),b}if(a.arrayValue){const b={arrayValue:{values:[]}};for(let c=0;c<(a.arrayValue.values||[]).length;++c)b.arrayValue.values[c]=ci(a.arrayValue.values[c]);return b}return Object.assign({},a)}ad=class{constructor(a){this.value=a}static empty(){return new ad({mapValue:{}})}field(a){if(a.isEmpty())return this.value;{let b=this.value;for(let c=0;c<a.length-1;++c)if(b=(b.mapValue.fields||{})[a.get(c)],!ez(b))return null;return b=(b.mapValue.fields||{})[a.lastSegment()],b||null}}set(a,b){this.getFieldsMap(a.popLast())[a.lastSegment()]=ci(b)}setAll(d){let a=R.emptyPath(),b={},c=[];d.forEach((e,d)=>{if(!a.isImmediateParentOf(d)){const e=this.getFieldsMap(a);this.applyChanges(e,b,c),b={},c=[],a=d.popLast()}e?b[d.lastSegment()]=ci(e):c.push(d.lastSegment())});const e=this.getFieldsMap(a);this.applyChanges(e,b,c)}delete(b){const a=this.field(b.popLast());ez(a)&&a.mapValue.fields&&delete a.mapValue.fields[b.lastSegment()]}isEqual(a){return ah(this.value,a.value)}getFieldsMap(b){let a=this.value;a.mapValue.fields||(a.mapValue={fields:{}});for(let d=0;d<b.length;++d){let c=a.mapValue.fields[b.get(d)];ez(c)&&c.mapValue.fields||(c={mapValue:{fields:{}}},a.mapValue.fields[b.get(d)]=c),a=c}return a.mapValue.fields}applyChanges(a,b,c){bD(b,(b,c)=>a[b]=c);for(const b of c)delete a[b]}clone(){return new ad(ci(this.value))}},w=class{constructor(a,b,c,d,e){this.key=a,this.documentType=b,this.version=c,this.data=d,this.documentState=e}static newInvalidDocument(a){return new w(a,0,k.min(),ad.empty(),0)}static newFoundDocument(a,b,c){return new w(a,1,b,c,0)}static newNoDocument(a,b){return new w(a,2,b,ad.empty(),0)}static newUnknownDocument(a,b){return new w(a,3,b,ad.empty(),2)}convertToFoundDocument(a,b){return this.version=a,this.documentType=1,this.data=b,this.documentState=0,this}convertToNoDocument(a){return this.version=a,this.documentType=2,this.data=ad.empty(),this.documentState=0,this}convertToUnknownDocument(a){return this.version=a,this.documentType=3,this.data=ad.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(a){return a instanceof w&&this.key.isEqual(a.key)&&this.version.isEqual(a.version)&&this.documentType===a.documentType&&this.documentState===a.documentState&&this.data.isEqual(a.data)}clone(){return new w(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}},mW=class{constructor(a,b=null,c=[],d=[],e=null,f=null,g=null){this.path=a,this.collectionGroup=b,this.orderBy=c,this.filters=d,this.limit=e,this.startAt=f,this.endAt=g,this.R=null}};function gF(a,b=null,c=[],d=[],e=null,f=null,g=null){return new mW(a,b,c,d,e,f,g)}function bN(b){const a=j(b);if(a.R===null){let b=a.path.canonicalString();a.collectionGroup!==null&&(b+="|cg:"+a.collectionGroup),b+="|f:",b+=a.filters.map(a=>mR(a)).join(","),b+="|ob:",b+=a.orderBy.map(a=>function(a){return a.field.canonicalString()+a.dir}(a)).join(","),bt(a.limit)||(b+="|l:",b+=a.limit),a.startAt&&(b+="|lb:",b+=dv(a.startAt)),a.endAt&&(b+="|ub:",b+=dv(a.endAt)),a.R=b}return a.R}function mT(a){let b=a.path.canonicalString();return a.collectionGroup!==null&&(b+=" collectionGroup="+a.collectionGroup),a.filters.length>0&&(b+=`, filters: [${a.filters.map(b=>{return`${(a=b).field.canonicalString()} ${a.op} ${eE(a.value)}`;var a}).join(", ")}]`),bt(a.limit)||(b+=", limit: "+a.limit),a.orderBy.length>0&&(b+=`, orderBy: [${a.orderBy.map(a=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(a)).join(", ")}]`),a.startAt&&(b+=", startAt: "+dv(a.startAt)),a.endAt&&(b+=", endAt: "+dv(a.endAt)),`Target(${b})`}function dg(a,b){if(a.limit!==b.limit)return!1;if(a.orderBy.length!==b.orderBy.length)return!1;for(let c=0;c<a.orderBy.length;c++)if(!mB(a.orderBy[c],b.orderBy[c]))return!1;if(a.filters.length!==b.filters.length)return!1;for(let e=0;e<a.filters.length;e++)if(c=a.filters[e],d=b.filters[e],c.op!==d.op||!c.field.isEqual(d.field)||!ah(c.value,d.value))return!1;var c,d;return a.collectionGroup===b.collectionGroup&&!!a.path.isEqual(b.path)&&!!gZ(a.startAt,b.startAt)&&gZ(a.endAt,b.endAt)}function dh(a){return f.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}V=class extends class{}{constructor(a,b,c){super(),this.field=a,this.op=b,this.value=c}static create(b,a,c){return b.isKeyField()?a==="in"||a==="not-in"?this.P(b,a,c):new mM(b,a,c):a==="array-contains"?new mI(b,c):a==="in"?new mH(b,c):a==="not-in"?new mG(b,c):a==="array-contains-any"?new mF(b,c):new V(b,a,c)}static P(a,c,b){return c==="in"?new mL(a,b):new mJ(a,b)}matches(b){const a=b.data.field(this.field);return this.op==="!="?a!==null&&this.v(aY(a,this.value)):a!==null&&aW(this.value)===aW(a)&&this.v(aY(a,this.value))}v(a){switch(this.op){case"<":return a<0;case"<=":return a<=0;case"==":return a===0;case"!=":return a!==0;case">":return a>0;case">=":return a>=0;default:return g()}}V(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}};function mR(a){return a.field.canonicalString()+a.op.toString()+eE(a.value)}mM=class extends V{constructor(b,c,a){super(b,c,a),this.key=f.fromName(a.referenceValue)}matches(a){const b=f.comparator(a.key,this.key);return this.v(b)}},mL=class extends V{constructor(b,a){super(b,"in",a),this.keys=gP("in",a)}matches(a){return this.keys.some(b=>b.isEqual(a.key))}},mJ=class extends V{constructor(b,a){super(b,"not-in",a),this.keys=gP("not-in",a)}matches(a){return!this.keys.some(b=>b.isEqual(a.key))}};function gP(c,b){var a;return(((a=b.arrayValue)===null||a===void 0?void 0:a.values)||[]).map(a=>f.fromName(a.referenceValue))}mI=class extends V{constructor(a,b){super(a,"array-contains",b)}matches(b){const a=b.data.field(this.field);return eA(a)&&bZ(a.arrayValue,this.value)}},mH=class extends V{constructor(a,b){super(a,"in",b)}matches(b){const a=b.data.field(this.field);return a!==null&&bZ(this.value.arrayValue,a)}},mG=class extends V{constructor(a,b){super(a,"not-in",b)}matches(b){if(bZ(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const a=b.data.field(this.field);return a!==null&&!bZ(this.value.arrayValue,a)}},mF=class extends V{constructor(a,b){super(a,"array-contains-any",b)}matches(b){const a=b.data.field(this.field);return!(!eA(a)||!a.arrayValue.values)&&a.arrayValue.values.some(a=>bZ(this.value.arrayValue,a))}},d$=class{constructor(a,b){this.position=a,this.before=b}};function dv(a){return`${a.before?"b":"a"}:${a.position.map(a=>eE(a)).join(",")}`}b$=class{constructor(a,b="asc"){this.field=a,this.dir=b}};function mB(a,b){return a.dir===b.dir&&a.field.isEqual(b.field)}function gY(b,d,c){let a=0;for(let e=0;e<b.position.length;e++){const g=d[e],h=b.position[e];if(g.field.isKeyField()?a=f.comparator(f.fromName(h.referenceValue),c.key):a=aY(h,c.data.field(g.field)),g.dir==="desc"&&(a*=-1),a!==0)break}return b.before?a<=0:a<0}function gZ(a,b){if(a===null)return b===null;if(b===null)return!1;if(a.before!==b.before||a.position.length!==b.position.length)return!1;for(let c=0;c<a.position.length;c++)if(!ah(a.position[c],b.position[c]))return!1;return!0}cf=class{constructor(a,b=null,c=[],d=[],e=null,f="F",g=null,h=null){this.path=a,this.collectionGroup=b,this.explicitOrderBy=c,this.filters=d,this.limit=e,this.limitType=f,this.startAt=g,this.endAt=h,this.S=null,this.D=null,this.startAt,this.endAt}};function mA(a,b,c,d,e,f,g,h){return new cf(a,b,c,d,e,f,g,h)}function dU(a){return new cf(a)}function cF(a){return!bt(a.limit)&&a.limitType==="F"}function dP(a){return!bt(a.limit)&&a.limitType==="L"}function hd(a){return a.explicitOrderBy.length>0?a.explicitOrderBy[0].field:null}function he(a){for(const b of a.filters)if(b.V())return b.field;return null}function hf(a){return a.collectionGroup!==null}function cq(b){const a=j(b);if(a.S===null){a.S=[];const b=he(a),c=hd(a);if(b!==null&&c===null)b.isKeyField()||a.S.push(new b$(b)),a.S.push(new b$(R.keyField(),"asc"));else{let b=!1;for(const c of a.explicitOrderBy)a.S.push(c),c.field.isKeyField()&&(b=!0);if(!b){const b=a.explicitOrderBy.length>0?a.explicitOrderBy[a.explicitOrderBy.length-1].dir:"asc";a.S.push(new b$(R.keyField(),b))}}}return a.S}function ap(b){const a=j(b);if(!a.D)if(a.limitType==="F")a.D=gF(a.path,a.collectionGroup,cq(a),a.filters,a.limit,a.startAt,a.endAt);else{const b=[];for(const c of cq(a)){const d=c.dir==="desc"?"asc":"desc";b.push(new b$(c.field,d))}const c=a.endAt?new d$(a.endAt.position,!a.endAt.before):null,d=a.startAt?new d$(a.startAt.position,!a.startAt.before):null;a.D=gF(a.path,a.collectionGroup,b,a.filters,a.limit,c,d)}return a.D}function ms(a,b,c){return new cf(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),b,c,a.startAt,a.endAt)}function dA(a,b){return dg(ap(a),ap(b))&&a.limitType===b.limitType}function hk(a){return`${bN(ap(a))}|lt:${a.limitType}`}function dY(a){return`Query(target=${mT(ap(a))}; limitType=${a.limitType})`}function bY(b,a){return a.isFoundDocument()&&function(a,c){const b=c.key.path;return a.collectionGroup!==null?c.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(b):f.isDocumentKey(a.path)?a.path.isEqual(b):a.path.isImmediateParentOf(b)}(b,a)&&function(a,b){for(const c of a.explicitOrderBy)if(!c.field.isKeyField()&&b.data.field(c.field)===null)return!1;return!0}(b,a)&&function(a,b){for(const c of a.filters)if(!c.matches(b))return!1;return!0}(b,a)&&function(a,b){return!(a.startAt&&!gY(a.startAt,cq(a),b))&&(!(a.endAt&&gY(a.endAt,cq(a),b)))}(b,a)}function hn(a){return(c,d)=>{let b=!1;for(const e of cq(a)){const f=mr(e,c,d);if(f!==0)return f;b=b||e.field.isKeyField()}return 0}}function mr(a,b,c){const d=a.field.isKeyField()?f.comparator(b.key,c.key):function(a,d,e){const b=d.data.field(a),c=e.data.field(a);return b!==null&&c!==null?aY(b,c):g()}(a.field,b,c);switch(a.dir){case"asc":return d;case"desc":return-1*d;default:return g()}}function hp(b,a){if(b.C){if(isNaN(a))return{doubleValue:"NaN"};if(a===1/0)return{doubleValue:"Infinity"};if(a===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:dR(a)?"-0":a}}function hq(a){return{integerValue:""+a}}function mp(b,a){return lc(a)?hq(a):hp(b,a)}dm=class{constructor(){this._=void 0}};function mi(a,b,c){return a instanceof bQ?function(a,b){const c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return b&&(c.fields.__previous_value__=b),{mapValue:c}}(c,b):a instanceof bn?hy(a,b):a instanceof bz?hA(a,b):function(a,d){const b=mg(a,d),c=hC(b)+hC(a.N);return eB(b)&&eB(a.N)?hq(c):hp(a.k,c)}(a,b)}function mh(a,b,c){return a instanceof bn?hy(a,b):a instanceof bz?hA(a,b):c}function mg(c,a){return c instanceof bE?eB(b=a)||function(a){return!!a&&"doubleValue"in a}(b)?a:{integerValue:0}:null;var b}bQ=class extends dm{},bn=class extends dm{constructor(a){super(),this.elements=a}};function hy(b,c){const a=hD(c);for(const c of b.elements)a.some(a=>ah(a,c))||a.push(c);return{arrayValue:{values:a}}}bz=class extends dm{constructor(a){super(),this.elements=a}};function hA(b,c){let a=hD(c);for(const c of b.elements)a=a.filter(a=>!ah(a,c));return{arrayValue:{values:a}}}bE=class extends dm{constructor(a,b){super(),this.k=a,this.N=b}};function hC(a){return y(a.integerValue||a.doubleValue)}function hD(a){return eA(a)&&a.arrayValue.values?a.arrayValue.values.slice():[]}mf=class{constructor(a,b){this.field=a,this.transform=b}};function me(a,b){return a.field.isEqual(b.field)&&function(a,b){return a instanceof bn&&b instanceof bn||a instanceof bz&&b instanceof bz?bg(a.elements,b.elements,ah):a instanceof bE&&b instanceof bE?ah(a.N,b.N):a instanceof bQ&&b instanceof bQ}(a.transform,b.transform)}md=class{constructor(a,b){this.version=a,this.transformResults=b}},aN=class{constructor(a,b){this.updateTime=a,this.exists=b}static none(){return new aN}static exists(a){return new aN(void 0,a)}static updateTime(a){return new aN(a)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(a){return this.exists===a.exists&&(this.updateTime?!!a.updateTime&&this.updateTime.isEqual(a.updateTime):!a.updateTime)}};function cQ(a,b){return a.updateTime!==void 0?b.isFoundDocument()&&b.version.isEqual(a.updateTime):a.exists===void 0||a.exists===b.isFoundDocument()}cO=class{};function mc(a,b,c){a instanceof cG?function(a,b,c){const d=a.value.clone(),e=hR(a.fieldTransforms,b,c.transformResults);d.setAll(e),b.convertToFoundDocument(c.version,d).setHasCommittedMutations()}(a,b,c):a instanceof bT?function(b,a,c){if(!cQ(b.precondition,a))return void a.convertToUnknownDocument(c.version);const e=hR(b.fieldTransforms,a,c.transformResults),d=a.data;d.setAll(hQ(b)),d.setAll(e),a.convertToFoundDocument(c.version,d).setHasCommittedMutations()}(a,b,c):function(c,a,b){a.convertToNoDocument(b.version).setHasCommittedMutations()}(0,b,c)}function fM(a,b,c){a instanceof cG?function(b,a,d){if(!cQ(b.precondition,a))return;const c=b.value.clone(),e=hS(b.fieldTransforms,d,a);c.setAll(e),a.convertToFoundDocument(hN(a),c).setHasLocalMutations()}(a,b,c):a instanceof bT?function(b,a,d){if(!cQ(b.precondition,a))return;const e=hS(b.fieldTransforms,d,a),c=a.data;c.setAll(hQ(b)),c.setAll(e),a.convertToFoundDocument(hN(a),c).setHasLocalMutations()}(a,b,c):function(b,a){cQ(b.precondition,a)&&a.convertToNoDocument(k.min())}(a,b)}function hM(a,b){return a.type===b.type&&!!a.key.isEqual(b.key)&&!!a.precondition.isEqual(b.precondition)&&!!function(a,b){return a===void 0&&b===void 0||!(!a||!b)&&bg(a,b,(a,b)=>me(a,b))}(a.fieldTransforms,b.fieldTransforms)&&(a.type===0?a.value.isEqual(b.value):a.type!==1||a.data.isEqual(b.data)&&a.fieldMask.isEqual(b.fieldMask))}function hN(a){return a.isFoundDocument()?a.version:k.min()}cG=class extends cO{constructor(a,b,c,d=[]){super(),this.key=a,this.value=b,this.precondition=c,this.fieldTransforms=d,this.type=0}},bT=class extends cO{constructor(a,b,c,d,e=[]){super(),this.key=a,this.data=b,this.fieldMask=c,this.precondition=d,this.fieldTransforms=e,this.type=1}};function hQ(a){const b=new Map;return a.fieldMask.fields.forEach(c=>{if(!c.isEmpty()){const d=a.data.field(c);b.set(c,d)}}),b}function hR(b,d,a){const c=new Map;i(b.length===a.length);for(let e=0;e<a.length;e++){const f=b[e],g=f.transform,h=d.data.field(f.field);c.set(f.field,mh(g,h,a[e]))}return c}function hS(b,c,d){const a=new Map;for(const e of b){const f=e.transform,g=d.data.field(e.field);a.set(e.field,mi(f,g,c))}return a}hT=class extends cO{constructor(a,b){super(),this.key=a,this.precondition=b,this.type=2,this.fieldTransforms=[]}},hU=class extends cO{constructor(a,b){super(),this.key=a,this.precondition=b,this.type=3,this.fieldTransforms=[]}},lY=class{constructor(a){this.count=a}};function lX(b){switch(b){default:return g();case a.CANCELLED:case a.UNKNOWN:case a.DEADLINE_EXCEEDED:case a.RESOURCE_EXHAUSTED:case a.INTERNAL:case a.UNAVAILABLE:case a.UNAUTHENTICATED:return!1;case a.INVALID_ARGUMENT:case a.NOT_FOUND:case a.ALREADY_EXISTS:case a.PERMISSION_DENIED:case a.FAILED_PRECONDITION:case a.ABORTED:case a.OUT_OF_RANGE:case a.UNIMPLEMENTED:case a.DATA_LOSS:return!0}}function hZ(b){if(b===void 0)return W("GRPC error has no .code"),a.UNKNOWN;switch(b){case x.OK:return a.OK;case x.CANCELLED:return a.CANCELLED;case x.UNKNOWN:return a.UNKNOWN;case x.DEADLINE_EXCEEDED:return a.DEADLINE_EXCEEDED;case x.RESOURCE_EXHAUSTED:return a.RESOURCE_EXHAUSTED;case x.INTERNAL:return a.INTERNAL;case x.UNAVAILABLE:return a.UNAVAILABLE;case x.UNAUTHENTICATED:return a.UNAUTHENTICATED;case x.INVALID_ARGUMENT:return a.INVALID_ARGUMENT;case x.NOT_FOUND:return a.NOT_FOUND;case x.ALREADY_EXISTS:return a.ALREADY_EXISTS;case x.PERMISSION_DENIED:return a.PERMISSION_DENIED;case x.FAILED_PRECONDITION:return a.FAILED_PRECONDITION;case x.ABORTED:return a.ABORTED;case x.OUT_OF_RANGE:return a.OUT_OF_RANGE;case x.UNIMPLEMENTED:return a.UNIMPLEMENTED;case x.DATA_LOSS:return a.DATA_LOSS;default:return g()}}(m=x||(x={}))[m.OK=0]="OK",m[m.CANCELLED=1]="CANCELLED",m[m.UNKNOWN=2]="UNKNOWN",m[m.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",m[m.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",m[m.NOT_FOUND=5]="NOT_FOUND",m[m.ALREADY_EXISTS=6]="ALREADY_EXISTS",m[m.PERMISSION_DENIED=7]="PERMISSION_DENIED",m[m.UNAUTHENTICATED=16]="UNAUTHENTICATED",m[m.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",m[m.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",m[m.ABORTED=10]="ABORTED",m[m.OUT_OF_RANGE=11]="OUT_OF_RANGE",m[m.UNIMPLEMENTED=12]="UNIMPLEMENTED",m[m.INTERNAL=13]="INTERNAL",m[m.UNAVAILABLE=14]="UNAVAILABLE",m[m.DATA_LOSS=15]="DATA_LOSS",O=class{constructor(a,b){this.comparator=a,this.root=b||H.EMPTY}insert(a,b){return new O(this.comparator,this.root.insert(a,b,this.comparator).copy(null,null,H.BLACK,null,null))}remove(a){return new O(this.comparator,this.root.remove(a,this.comparator).copy(null,null,H.BLACK,null,null))}get(b){let a=this.root;for(;!a.isEmpty();){const c=this.comparator(b,a.key);if(c===0)return a.value;c<0?a=a.left:c>0&&(a=a.right)}return null}indexOf(c){let b=0,a=this.root;for(;!a.isEmpty();){const d=this.comparator(c,a.key);if(d===0)return b+a.left.size;d<0?a=a.left:(b+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(a){return this.root.inorderTraversal(a)}forEach(a){this.inorderTraversal((b,c)=>(a(b,c),!1))}toString(){const a=[];return this.inorderTraversal((b,c)=>(a.push(`${b}:${c}`),!1)),`{${a.join(", ")}}`}reverseTraversal(a){return this.root.reverseTraversal(a)}getIterator(){return new cz(this.root,null,this.comparator,!1)}getIteratorFrom(a){return new cz(this.root,a,this.comparator,!1)}getReverseIterator(){return new cz(this.root,null,this.comparator,!0)}getReverseIteratorFrom(a){return new cz(this.root,a,this.comparator,!0)}},cz=class{constructor(a,c,e,d){this.isReverse=d,this.nodeStack=[];let b=1;for(;!a.isEmpty();)if(b=c?e(a.key,c):1,d&&(b*=-1),b<0)a=this.isReverse?a.left:a.right;else{if(b===0){this.nodeStack.push(a);break}this.nodeStack.push(a),a=this.isReverse?a.right:a.left}}getNext(){let a=this.nodeStack.pop();const b={key:a.key,value:a.value};if(this.isReverse)for(a=a.left;!a.isEmpty();)this.nodeStack.push(a),a=a.right;else for(a=a.right;!a.isEmpty();)this.nodeStack.push(a),a=a.left;return b}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const a=this.nodeStack[this.nodeStack.length-1];return{key:a.key,value:a.value}}},H=class{constructor(d,e,a,b,c){this.key=d,this.value=e,this.color=a!=null?a:H.RED,this.left=b!=null?b:H.EMPTY,this.right=c!=null?c:H.EMPTY,this.size=this.left.size+1+this.right.size}copy(a,b,c,d,e){return new H(a!=null?a:this.key,b!=null?b:this.value,c!=null?c:this.color,d!=null?d:this.left,e!=null?e:this.right)}isEmpty(){return!1}inorderTraversal(a){return this.left.inorderTraversal(a)||a(this.key,this.value)||this.right.inorderTraversal(a)}reverseTraversal(a){return this.right.reverseTraversal(a)||a(this.key,this.value)||this.left.reverseTraversal(a)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(b,c,d){let a=this;const e=d(b,a.key);return a=e<0?a.copy(null,null,null,a.left.insert(b,c,d),null):e===0?a.copy(null,c,null,null,null):a.copy(null,null,null,null,a.right.insert(b,c,d)),a.fixUp()}removeMin(){if(this.left.isEmpty())return H.EMPTY;let a=this;return a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.removeMin(),null),a.fixUp()}remove(b,c){let d,a=this;if(c(b,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(b,c),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),c(b,a.key)===0){if(a.right.isEmpty())return H.EMPTY;d=a.right.min(),a=a.copy(d.key,d.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(b,c))}return a.fixUp()}isRed(){return this.color}fixUp(){let a=this;return a.right.isRed()&&!a.left.isRed()&&(a=a.rotateLeft()),a.left.isRed()&&a.left.left.isRed()&&(a=a.rotateRight()),a.left.isRed()&&a.right.isRed()&&(a=a.colorFlip()),a}moveRedLeft(){let a=this.colorFlip();return a.right.left.isRed()&&(a=a.copy(null,null,null,null,a.right.rotateRight()),a=a.rotateLeft(),a=a.colorFlip()),a}moveRedRight(){let a=this.colorFlip();return a.left.left.isRed()&&(a=a.rotateRight(),a=a.colorFlip()),a}rotateLeft(){const a=this.copy(null,null,H.RED,null,this.right.left);return this.right.copy(null,null,this.color,a,null)}rotateRight(){const a=this.copy(null,null,H.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,a)}colorFlip(){const a=this.left.copy(null,null,!this.left.color,null,null),b=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,a,b)}checkMaxDepth(){const a=this.check();return Math.pow(2,a)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw g();if(this.right.isRed())throw g();const a=this.left.check();if(a!==this.right.check())throw g();return a+(this.isRed()?0:1)}},H.EMPTY=null,H.RED=!0,H.BLACK=!1,H.EMPTY=new class{constructor(){this.size=0}get key(){throw g()}get value(){throw g()}get color(){throw g()}get left(){throw g()}get right(){throw g()}copy(a,b,c,d,e){return this}insert(a,b,c){return new H(a,b)}remove(a,b){return this}isEmpty(){return!0}inorderTraversal(a){return!1}reverseTraversal(a){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}},v=class{constructor(a){this.comparator=a,this.data=new O(this.comparator)}has(a){return this.data.get(a)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(a){return this.data.indexOf(a)}forEach(a){this.data.inorderTraversal((b,c)=>(a(b),!1))}forEachInRange(a,c){const b=this.data.getIteratorFrom(a[0]);for(;b.hasNext();){const d=b.getNext();if(this.comparator(d.key,a[1])>=0)return;c(d.key)}}forEachWhile(c,b){let a;for(a=b!==void 0?this.data.getIteratorFrom(b):this.data.getIterator();a.hasNext();)if(!c(a.getNext().key))return}firstAfterOrEqual(b){const a=this.data.getIteratorFrom(b);return a.hasNext()?a.getNext().key:null}getIterator(){return new ic(this.data.getIterator())}getIteratorFrom(a){return new ic(this.data.getIteratorFrom(a))}add(a){return this.copy(this.data.remove(a).insert(a,!0))}delete(a){return this.has(a)?this.copy(this.data.remove(a)):this}isEmpty(){return this.data.isEmpty()}unionWith(b){let a=this;return a.size<b.size&&(a=b,b=this),b.forEach(b=>{a=a.add(b)}),a}isEqual(a){if(!(a instanceof v))return!1;if(this.size!==a.size)return!1;const b=this.data.getIterator(),c=a.data.getIterator();for(;b.hasNext();){const a=b.getNext().key,d=c.getNext().key;if(this.comparator(a,d)!==0)return!1}return!0}toArray(){const a=[];return this.forEach(b=>{a.push(b)}),a}toString(){const a=[];return this.forEach(b=>a.push(b)),"SortedSet("+a.toString()+")"}copy(b){const a=new v(this.comparator);return a.data=b,a}},ic=class{constructor(a){this.iter=a}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}},lU=new O(f.comparator);function ai(){return lU}lT=new O(f.comparator);function eJ(){return lT}lS=new O(f.comparator);function lO(){return lS}lN=new v(f.comparator);function q(...b){let a=lN;for(const c of b)a=a.add(c);return a}lM=new v(l);function io(){return lM}eR=class{constructor(a,b,c,d,e){this.snapshotVersion=a,this.targetChanges=b,this.targetMismatches=c,this.documentUpdates=d,this.resolvedLimboDocuments=e}static createSynthesizedRemoteEventForCurrentChange(a,c){const b=new Map;return b.set(a,cR.createSynthesizedTargetChangeForCurrentChange(a,c)),new eR(k.min(),b,io(),ai(),q())}},cR=class{constructor(a,b,c,d,e){this.resumeToken=a,this.current=b,this.addedDocuments=c,this.modifiedDocuments=d,this.removedDocuments=e}static createSynthesizedTargetChangeForCurrentChange(b,a){return new cR(K.EMPTY_BYTE_STRING,a,q(),q(),q())}},cS=class{constructor(a,b,c,d){this.$=a,this.removedTargetIds=b,this.key=c,this.F=d}},is=class{constructor(a,b){this.targetId=a,this.O=b}},it=class{constructor(a,b,c=K.EMPTY_BYTE_STRING,d=null){this.state=a,this.targetIds=b,this.resumeToken=c,this.cause=d}},iu=class{constructor(){this.M=0,this.L=ix(),this.B=K.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return this.M!==0}get j(){return this.q}W(a){a.approximateByteSize()>0&&(this.q=!0,this.B=a)}G(){let a=q(),b=q(),c=q();return this.L.forEach((d,e)=>{switch(e){case 0:a=a.add(d);break;case 2:b=b.add(d);break;case 1:c=c.add(d);break;default:g()}}),new cR(this.B,this.U,a,b,c)}H(){this.q=!1,this.L=ix()}J(a,b){this.q=!0,this.L=this.L.insert(a,b)}Y(a){this.q=!0,this.L=this.L.remove(a)}X(){this.M+=1}Z(){this.M-=1}tt(){this.q=!0,this.U=!0}},lL=class{constructor(a){this.et=a,this.nt=new Map,this.st=ai(),this.it=iw(),this.rt=new v(l)}ot(a){for(const b of a.$)a.F&&a.F.isFoundDocument()?this.at(b,a.F):this.ct(b,a.key,a.F);for(const b of a.removedTargetIds)this.ct(b,a.key,a.F)}ut(a){this.forEachTarget(a,c=>{const b=this.ht(c);switch(a.state){case 0:this.lt(c)&&b.W(a.resumeToken);break;case 1:b.Z(),b.K||b.H(),b.W(a.resumeToken);break;case 2:b.Z(),b.K||this.removeTarget(c);break;case 3:this.lt(c)&&(b.tt(),b.W(a.resumeToken));break;case 4:this.lt(c)&&(this.ft(c),b.W(a.resumeToken));break;default:g()}})}forEachTarget(a,b){a.targetIds.length>0?a.targetIds.forEach(b):this.nt.forEach((c,a)=>{this.lt(a)&&b(a)})}dt(c){const a=c.targetId,b=c.O.count,d=this.wt(a);if(d){const c=d.target;if(dh(c))if(b===0){const b=new f(c.path);this.ct(a,b,w.newNoDocument(b,k.min()))}else i(b===1);else this._t(a)!==b&&(this.ft(a),this.rt=this.rt.add(a))}}gt(b){const c=new Map;this.nt.forEach((a,d)=>{const e=this.wt(d);if(e){if(a.current&&dh(e.target)){const a=new f(e.target.path);this.st.get(a)!==null||this.yt(d,a)||this.ct(d,a,w.newNoDocument(a,b))}a.j&&(c.set(d,a.G()),a.H())}});let a=q();this.it.forEach((c,d)=>{let b=!0;d.forEachWhile(c=>{const a=this.wt(c);return!a||a.purpose===2||(b=!1,!1)}),b&&(a=a.add(c))});const d=new eR(b,c,this.rt,this.st,a);return this.st=ai(),this.it=iw(),this.rt=new v(l),d}at(b,a){if(!this.lt(b))return;const c=this.yt(b,a.key)?2:0;this.ht(b).J(a.key,c),this.st=this.st.insert(a.key,a),this.it=this.it.insert(a.key,this.Tt(a.key).add(b))}ct(b,a,c){if(!this.lt(b))return;const d=this.ht(b);this.yt(b,a)?d.J(a,1):d.Y(a),this.it=this.it.insert(a,this.Tt(a).delete(b)),c&&(this.st=this.st.insert(a,c))}removeTarget(a){this.nt.delete(a)}_t(a){const b=this.ht(a).G();return this.et.getRemoteKeysForTarget(a).size+b.addedDocuments.size-b.removedDocuments.size}X(a){this.ht(a).X()}ht(b){let a=this.nt.get(b);return a||(a=new iu,this.nt.set(b,a)),a}Tt(b){let a=this.it.get(b);return a||(a=new v(l),this.it=this.it.insert(b,a)),a}lt(a){const b=this.wt(a)!==null;return b||c("WatchChangeAggregator","Detected inactive target",a),b}wt(a){const b=this.nt.get(a);return b&&b.K?null:this.et.Et(a)}ft(a){this.nt.set(a,new iu),this.et.getRemoteKeysForTarget(a).forEach(b=>{this.ct(a,b,null)})}yt(a,b){return this.et.getRemoteKeysForTarget(a).has(b)}};function iw(){return new O(f.comparator)}function ix(){return new O(f.comparator)}lK=(()=>{const a={asc:"ASCENDING",desc:"DESCENDING"};return a})(),lJ=(()=>{const a={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};return a})(),lI=class{constructor(a,b){this.databaseId=a,this.C=b}};function bI(b,a){return b.C?`${new Date(1e3*a.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+a.nanoseconds).slice(-9)}Z`:{seconds:""+a.seconds,nanos:a.nanoseconds}}function iC(b,a){return b.C?a.toBase64():a.toUint8Array()}function lH(a,b){return bI(a,b.toTimestamp())}function _(a){return i(!!a),k.fromTimestamp(function(b){const a=at(b);return new M(a.seconds,a.nanos)}(a))}function eY(a,b){return function(a){return new r(["projects",a.projectId,"databases",a.database])}(a).child("documents").child(b).canonicalString()}function iG(b){const a=r.fromString(b);return i(jf(a)),a}function cZ(a,b){return eY(a.databaseId,b.path)}function aK(c,e){const b=iG(e);if(b.get(1)!==c.databaseId.projectId)throw new d(a.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+b.get(1)+" vs "+c.databaseId.projectId);if(b.get(3)!==c.databaseId.database)throw new d(a.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+b.get(3)+" vs "+c.databaseId.database);return new f(iM(b))}function fL(a,b){return eY(a.databaseId,b)}function iK(b){const a=iG(b);return a.length===4?r.emptyPath():iM(a)}function e$(a){return new r(["projects",a.databaseId.projectId,"databases",a.databaseId.database]).canonicalString()}function iM(a){return i(a.length>4&&a.get(4)==="documents"),a.popFirst(5)}function iN(a,b,c){return{name:cZ(a,b),fields:c.value.mapValue.fields}}function lG(g,b,c){const d=aK(g,b.name),e=_(b.updateTime),f=new ad({mapValue:{fields:b.fields}}),a=w.newFoundDocument(d,e,f);return c&&a.setHasCommittedMutations(),c?a.setHasCommittedMutations():a}function lF(e,b){let c;if("targetChange"in b){b.targetChange;const h=function(a){return a==="NO_CHANGE"?0:a==="ADD"?1:a==="REMOVE"?2:a==="CURRENT"?3:a==="RESET"?4:g()}(b.targetChange.targetChangeType||"NO_CHANGE"),j=b.targetChange.targetIds||[],k=function(b,a){return b.C?(i(a===void 0||typeof a=="string"),K.fromBase64String(a||"")):(i(a===void 0||a instanceof Uint8Array),K.fromUint8Array(a||new Uint8Array))}(e,b.targetChange.resumeToken),f=b.targetChange.cause,l=f&&function(b){const c=b.code===void 0?a.UNKNOWN:hZ(b.code);return new d(c,b.message||"")}(f);c=new it(h,j,k,l||null)}else if("documentChange"in b){b.documentChange;const a=b.documentChange;a.document,a.document.name,a.document.updateTime;const f=aK(e,a.document.name),g=_(a.document.updateTime),h=new ad({mapValue:{fields:a.document.fields}}),d=w.newFoundDocument(f,g,h),i=a.targetIds||[],j=a.removedTargetIds||[];c=new cS(i,j,d.key,d)}else if("documentDelete"in b){b.documentDelete;const a=b.documentDelete;a.document;const f=aK(e,a.document),g=a.readTime?_(a.readTime):k.min(),d=w.newNoDocument(f,g),h=a.removedTargetIds||[];c=new cS([],h,d.key,d)}else if("documentRemove"in b){b.documentRemove;const a=b.documentRemove;a.document;const d=aK(e,a.document),f=a.removedTargetIds||[];c=new cS([],f,d,null)}else{if(!("filter"in b))return g();{b.filter;const a=b.filter;a.targetId;const d=a.count||0,e=new lY(d),f=a.targetId;c=new is(f,e)}}return c}function ff(c,a){let b;if(a instanceof cG)b={update:iN(c,a.key,a.value)};else if(a instanceof hT)b={delete:cZ(c,a.key)};else if(a instanceof bT)b={update:iN(c,a.key,a.data),updateMask:lo(a.fieldMask)};else{if(!(a instanceof hU))return g();b={verify:cZ(c,a.key)}}return a.fieldTransforms.length>0&&(b.updateTransforms=a.fieldTransforms.map(a=>function(c,b){const a=b.transform;if(a instanceof bQ)return{fieldPath:b.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof bn)return{fieldPath:b.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof bz)return{fieldPath:b.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof bE)return{fieldPath:b.field.canonicalString(),increment:a.N};throw g()}(0,a))),a.precondition.isNone||(b.currentDocument=function(b,a){return a.updateTime!==void 0?{updateTime:lH(b,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:g()}(c,a.precondition)),b}function iR(b,a){const c=a.currentDocument?function(a){return a.updateTime!==void 0?aN.updateTime(_(a.updateTime)):a.exists!==void 0?aN.exists(a.exists):aN.none()}(a.currentDocument):aN.none(),d=a.updateTransforms?a.updateTransforms.map(a=>function(c,a){let b=null;if("setToServerValue"in a)i(a.setToServerValue==="REQUEST_TIME"),b=new bQ;else if("appendMissingElements"in a){const c=a.appendMissingElements.values||[];b=new bn(c)}else if("removeAllFromArray"in a){const c=a.removeAllFromArray.values||[];b=new bz(c)}else"increment"in a?b=new bE(c,a.increment):g();const d=R.fromServerFormat(a.fieldPath);return new mf(d,b)}(b,a)):[];if(a.update){a.update.name;const e=aK(b,a.update.name),f=new ad({mapValue:{fields:a.update.fields}});if(a.updateMask){const b=function(a){const b=a.fieldPaths||[];return new nb(b.map(a=>R.fromServerFormat(a)))}(a.updateMask);return new bT(e,f,b,c,d)}return new cG(e,f,c,d)}if(a.delete){const d=aK(b,a.delete);return new hT(d,c)}if(a.verify){const d=aK(b,a.verify);return new hU(d,c)}return g()}function lz(a,b){return a&&a.length>0?(i(b!==void 0),a.map(a=>function(a,c){let b=a.updateTime?_(a.updateTime):_(c);return b.isEqual(k.min())&&(b=_(c)),new md(b,a.transformResults||[])}(a,b))):[]}function iT(a,b){return{documents:[fL(a,b.path)]}}function iU(c,a){const b={structuredQuery:{}},d=a.path;a.collectionGroup!==null?(b.parent=fL(c,d),b.structuredQuery.from=[{collectionId:a.collectionGroup,allDescendants:!0}]):(b.parent=fL(c,d.popLast()),b.structuredQuery.from=[{collectionId:d.lastSegment()}]);const e=function(b){if(b.length===0)return;const a=b.map(a=>function(a){if(a.op==="=="){{if(gz(a.value))return{unaryFilter:{field:aZ(a.field),op:"IS_NAN"}};if(gy(a.value))return{unaryFilter:{field:aZ(a.field),op:"IS_NULL"}}}}else if(a.op==="!="){if(gz(a.value))return{unaryFilter:{field:aZ(a.field),op:"IS_NOT_NAN"}};if(gy(a.value))return{unaryFilter:{field:aZ(a.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:aZ(a.field),op:lw(a.op),value:a.value}}}(a));return a.length===1?a[0]:{compositeFilter:{op:"AND",filters:a}}}(a.filters);e&&(b.structuredQuery.where=e);const f=function(a){if(a.length===0)return;return a.map(a=>function(a){return{field:aZ(a.field),direction:lx(a.dir)}}(a))}(a.orderBy);f&&(b.structuredQuery.orderBy=f);const g=function(b,a){return b.C||bt(a)?a:{value:a}}(c,a.limit);return g!==null&&(b.structuredQuery.limit=g),a.startAt&&(b.structuredQuery.startAt=iY(a.startAt)),a.endAt&&(b.structuredQuery.endAt=iY(a.endAt)),b}function iV(c){let b=iK(c.parent);const a=c.structuredQuery,d=a.from?a.from.length:0;let e=null;if(d>0){i(d===1);const c=a.from[0];c.allDescendants?e=c.collectionId:b=b.child(c.collectionId)}let f=[];a.where&&(f=iX(a.where));let g=[];a.orderBy&&(g=a.orderBy.map(a=>function(a){return new b$(bs(a.field),function(a){switch(a){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(a.direction))}(a)));let h=null;a.limit&&(h=function(a){let b;return b=typeof a=="object"?a.value:a,bt(b)?null:b}(a.limit));let j=null;a.startAt&&(j=iZ(a.startAt));let k=null;return a.endAt&&(k=iZ(a.endAt)),mA(b,e,g,f,h,"F",j,k)}function ly(c,b){const a=function(b,a){switch(a){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return g()}}(0,b.purpose);return a==null?null:{"goog-listen-tags":a}}function iX(a){return a?a.unaryFilter!==void 0?[lp(a)]:a.fieldFilter!==void 0?[lr(a)]:a.compositeFilter!==void 0?a.compositeFilter.filters.map(a=>iX(a)).reduce((a,b)=>a.concat(b)):g():[]}function iY(a){return{before:a.before,values:a.position}}function iZ(a){const b=!!a.before,c=a.values||[];return new d$(c,b)}function lx(a){return lK[a]}function lw(a){return lJ[a]}function aZ(a){return{fieldPath:a.canonicalString()}}function bs(a){return R.fromServerFormat(a.fieldPath)}function lr(a){return V.create(bs(a.fieldFilter.field),function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return g()}}(a.fieldFilter.op),a.fieldFilter.value)}function lp(a){switch(a.unaryFilter.op){case"IS_NAN":const b=bs(a.unaryFilter.field);return V.create(b,"==",{doubleValue:NaN});case"IS_NULL":const c=bs(a.unaryFilter.field);return V.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=bs(a.unaryFilter.field);return V.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const e=bs(a.unaryFilter.field);return V.create(e,"!=",{nullValue:"NULL_VALUE"});default:return g()}}function lo(b){const a=[];return b.fields.forEach(b=>a.push(b.canonicalString())),{fieldPaths:a}}function jf(a){return a.length>=4&&a.get(0)==="projects"&&a.get(2)==="databases"}function ab(b){let a="";for(let c=0;c<b.length;c++)a.length>0&&(a=hL(a)),a=ln(b.get(c),a);return hL(a)}function ln(b,c){let a=c;const d=b.length;for(let c=0;c<d;c++){const e=b.charAt(c);switch(e){case"\0":a+="";break;case"":a+="";break;default:a+=e}}return a}function hL(a){return a+""}function am(a){const c=a.length;if(i(c>=2),c===2)return i(a.charAt(0)===""&&a.charAt(1)===""),r.emptyPath();const e=c-2,d=[];let b="";for(let h=0;h<c;){const f=a.indexOf("",h);switch((f<0||f>e)&&g(),a.charAt(f+1)){case"":const e=a.substring(h,f);let c;b.length===0?c=e:(b+=e,c=b,b=""),d.push(c);break;case"":b+=a.substring(h,f),b+="\0";break;case"":b+=a.substring(h,f+1);break;default:g()}h=f+2}return new r(d)}lg=class{constructor(a,b){this.seconds=a,this.nanoseconds=b}},X=class{constructor(a,b,c){this.ownerId=a,this.allowTabSynchronization=b,this.leaseTimestampMs=c}},X.store="owner",X.key="owner",ar=class{constructor(a,b,c){this.userId=a,this.lastAcknowledgedBatchId=b,this.lastStreamToken=c}},ar.store="mutationQueues",ar.keyPath="userId",s=class{constructor(a,b,c,d,e){this.userId=a,this.batchId=b,this.localWriteTimeMs=c,this.baseMutations=d,this.mutations=e}},s.store="mutations",s.keyPath="batchId",s.userMutationsIndex="userMutationsIndex",s.userMutationsKeyPath=["userId","batchId"],I=class{constructor(){}static prefixForUser(a){return[a]}static prefixForPath(a,b){return[a,ab(b)]}static key(a,b,c){return[a,ab(b),c]}},I.store="documentMutations",I.PLACEHOLDER=new I,lf=class{constructor(a,b){this.path=a,this.readTime=b}},lb=class{constructor(a,b){this.path=a,this.version=b}},u=class{constructor(a,b,c,d,e,f){this.unknownDocument=a,this.noDocument=b,this.document=c,this.hasCommittedMutations=d,this.readTime=e,this.parentPath=f}},u.store="remoteDocuments",u.readTimeIndex="readTimeIndex",u.readTimeIndexPath="readTime",u.collectionReadTimeIndex="collectionReadTimeIndex",u.collectionReadTimeIndexPath=["parentPath","readTime"],ag=class{constructor(a){this.byteSize=a}},ag.store="remoteDocumentGlobal",ag.key="remoteDocumentGlobalKey",U=class{constructor(a,b,c,d,e,f,g){this.targetId=a,this.canonicalId=b,this.readTime=c,this.resumeToken=d,this.lastListenSequenceNumber=e,this.lastLimboFreeSnapshotVersion=f,this.query=g}},U.store="targets",U.keyPath="targetId",U.queryTargetsIndexName="queryTargetsIndex",U.queryTargetsKeyPath=["canonicalId","targetId"],G=class{constructor(a,b,c){this.targetId=a,this.path=b,this.sequenceNumber=c}},G.store="targetDocuments",G.keyPath=["targetId","path"],G.documentTargetsIndex="documentTargetsIndex",G.documentTargetsKeyPath=["path","targetId"],$=class{constructor(a,b,c,d){this.highestTargetId=a,this.highestListenSequenceNumber=b,this.lastRemoteSnapshotVersion=c,this.targetCount=d}},$.key="targetGlobalKey",$.store="targetGlobal",aQ=class{constructor(a,b){this.collectionId=a,this.parent=b}},aQ.store="collectionParents",aQ.keyPath=["collectionId","parent"],aq=class{constructor(a,b,c,d){this.clientId=a,this.updateTimeMs=b,this.networkEnabled=c,this.inForeground=d}},aq.store="clientMetadata",aq.keyPath="clientId",bf=class{constructor(a,b,c){this.bundleId=a,this.createTime=b,this.version=c}},bf.store="bundles",bf.keyPath="bundleId",bw=class{constructor(a,b,c){this.name=a,this.readTime=b,this.bundledQuery=c}},bw.store="namedQueries",bw.keyPath="name",kY=[...[...[...[...[ar.store,s.store,I.store,u.store,U.store,X.store,$.store,G.store],aq.store],ag.store],aQ.store],bf.store,bw.store],jB="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",jC=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(a){this.onCommittedListeners.push(a)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(a=>a())}},b=class{constructor(a){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,a(a=>{this.isDone=!0,this.result=a,this.nextCallback&&this.nextCallback(a)},a=>{this.isDone=!0,this.error=a,this.catchCallback&&this.catchCallback(a)})}catch(a){return this.next(void 0,a)}next(a,c){return this.callbackAttached&&g(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(c,this.error):this.wrapSuccess(a,this.result):new b((b,d)=>{this.nextCallback=c=>{this.wrapSuccess(a,c).next(b,d)},this.catchCallback=a=>{this.wrapFailure(c,a).next(b,d)}})}toPromise(){return new Promise((a,b)=>{this.next(a,b)})}wrapUserFunction(a){try{const c=a();return c instanceof b?c:b.resolve(c)}catch(a){return b.reject(a)}}wrapSuccess(a,c){return a?this.wrapUserFunction(()=>a(c)):b.resolve(c)}wrapFailure(a,c){return a?this.wrapUserFunction(()=>a(c)):b.reject(c)}static resolve(a){return new b((b,c)=>{b(a)})}static reject(a){return new b((c,b)=>{b(a)})}static waitFor(a){return new b((d,f)=>{let b=0,c=0,e=!1;a.forEach(a=>{++b,a.next(()=>{++c,e&&c===b&&d()},a=>f(a))}),e=!0,c===b&&d()})}static or(c){let a=b.resolve(!1);for(const d of c)a=a.next(a=>a?b.resolve(a):d());return a}static forEach(b,c){const a=[];return b.forEach((b,d)=>{a.push(c.call(this,b,d))}),this.waitFor(a)}},fB=class{constructor(a,b){this.action=a,this.transaction=b,this.aborted=!1,this.It=new an,this.transaction.oncomplete=()=>{this.It.resolve()},this.transaction.onabort=()=>{b.error?this.It.reject(new cg(a,b.error)):this.It.resolve()},this.transaction.onerror=b=>{const c=fC(b.target.error);this.It.reject(new cg(a,c))}}static open(b,a,c,d){try{return new fB(a,b.transaction(d,c))}catch(b){throw new cg(a,b)}}get At(){return this.It.promise}abort(a){a&&this.It.reject(a),this.aborted||(c("SimpleDb","Aborting transaction:",a?a.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(a){const b=this.transaction.objectStore(a);return new kV(b)}},aw=class{constructor(a,b,c){this.name=a,this.version=b,this.Rt=c,aw.Pt(aM())===12.2&&W("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(a){return c("SimpleDb","Removing database:",a),aV(window.indexedDB.deleteDatabase(a)).toPromise()}static bt(){if(!rA())return!1;if(aw.vt())return!0;const a=aM(),b=aw.Pt(a),d=0<b&&b<10,c=aw.Vt(a),e=0<c&&c<4.5;return!(a.indexOf("MSIE ")>0||a.indexOf("Trident/")>0||a.indexOf("Edge/")>0||d||e)}static vt(){var a;return typeof process!="undefined"&&((a=process.env)===null||a===void 0?void 0:a.St)==="YES"}static Dt(a,b){return a.store(b)}static Pt(b){const a=b.match(/i(?:phone|pad|pod) os ([\d_]+)/i),c=a?a[1].split("_").slice(0,2).join("."):"-1";return Number(c)}static Vt(b){const a=b.match(/Android ([\d.]+)/i),c=a?a[1].split(".").slice(0,2).join("."):"-1";return Number(c)}async Ct(b){return this.db||(c("SimpleDb","Opening database:",this.name),this.db=await new Promise((g,f)=>{const e=indexedDB.open(this.name,this.version);e.onsuccess=a=>{const b=a.target.result;g(b)},e.onblocked=()=>{f(new cg(b,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},e.onerror=e=>{const c=e.target.error;c.name==="VersionError"?f(new d(a.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):c.name==="InvalidStateError"?f(new d(a.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+c)):f(new cg(b,c))},e.onupgradeneeded=a=>{c("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',a.oldVersion);const b=a.target.result;this.Rt.Nt(b,e.transaction,a.oldVersion,this.version).next(()=>{c("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.kt&&(this.db.onversionchange=a=>this.kt(a)),this.db}xt(a){this.kt=a,this.db&&(this.db.onversionchange=b=>a(b))}async runTransaction(a,e,f,g){const h=e==="readonly";let d=0;for(;;){++d;try{this.db=await this.Ct(a);const c=fB.open(this.db,a,h?"readonly":"readwrite",f),d=g(c).catch(a=>(c.abort(a),b.reject(a))).toPromise();return d.catch(()=>{}),await c.At,d}catch(a){const b=a.name!=="FirebaseError"&&d<3;if(c("SimpleDb","Transaction failed with error:",a.message,"Retrying:",b),this.close(),!b)return Promise.reject(a)}}}close(){this.db&&this.db.close(),this.db=void 0}},kW=class{constructor(a){this.$t=a,this.Ft=!1,this.Ot=null}get isDone(){return this.Ft}get Mt(){return this.Ot}set cursor(a){this.$t=a}done(){this.Ft=!0}Lt(a){this.Ot=a}delete(){return aV(this.$t.delete())}},cg=class extends d{constructor(b,c){super(a.UNAVAILABLE,`IndexedDB transaction '${b}' failed: ${c}`),this.name="IndexedDbTransactionError"}};function aU(a){return a.name==="IndexedDbTransactionError"}kV=class{constructor(a){this.store=a}put(a,b){let d;return b!==void 0?(c("SimpleDb","PUT",this.store.name,a,b),d=this.store.put(b,a)):(c("SimpleDb","PUT",this.store.name,"<auto-key>",a),d=this.store.put(a)),aV(d)}add(a){return c("SimpleDb","ADD",this.store.name,a,a),aV(this.store.add(a))}get(a){return aV(this.store.get(a)).next(b=>(b===void 0&&(b=null),c("SimpleDb","GET",this.store.name,a,b),b))}delete(a){return c("SimpleDb","DELETE",this.store.name,a),aV(this.store.delete(a))}count(){return c("SimpleDb","COUNT",this.store.name),aV(this.store.count())}Bt(b,c){const d=this.cursor(this.options(b,c)),a=[];return this.Ut(d,(c,b)=>{a.push(b)}).next(()=>a)}qt(b,d){c("SimpleDb","DELETE ALL",this.store.name);const a=this.options(b,d);a.Kt=!1;const e=this.cursor(a);return this.Ut(e,(b,c,a)=>a.delete())}jt(c,a){let b;a?b=c:(b={},a=c);const d=this.cursor(b);return this.Ut(d,a)}Qt(c){const a=this.cursor({});return new b((b,d)=>{a.onerror=a=>{const b=fC(a.target.error);d(b)},a.onsuccess=d=>{const a=d.target.result;a?c(a.primaryKey,a.value).next(c=>{c?a.continue():b()}):b()}})}Ut(a,d){const c=[];return new b((e,f)=>{a.onerror=a=>{f(a.target.error)},a.onsuccess=h=>{const a=h.target.result;if(!a)return void e();const f=new kW(a),g=d(a.primaryKey,a.value,f);if(g instanceof b){const a=g.catch(a=>(f.done(),b.reject(a)));c.push(a)}f.isDone?e():f.Mt===null?a.continue():a.continue(f.Mt)}}).next(()=>b.waitFor(c))}options(a,b){let c;return a!==void 0&&(typeof a=="string"?c=a:b=a),{index:c,range:b}}cursor(a){let b="next";if(a.reverse&&(b="prev"),a.index){const c=this.store.index(a.index);return a.Kt?c.openKeyCursor(a.range,b):c.openCursor(a.range,b)}return this.store.openCursor(a.range,b)}};function aV(a){return new b((b,c)=>{a.onsuccess=a=>{const c=a.target.result;b(c)},a.onerror=a=>{const b=fC(a.target.error);c(b)}})}jL=!1;function fC(a){const b=aw.Pt(aM());if(b>=12.2&&b<13){const b="An internal error was encountered in the Indexed Database server";if(a.message.indexOf(b)>=0){const a=new d("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${b}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return jL||(jL=!0,setTimeout(()=>{throw a},0)),a}}return a}jN=class extends jC{constructor(a,b){super(),this.Wt=a,this.currentSequenceNumber=b}};function S(a,b){const c=j(a);return aw.Dt(c.Wt,b)}fD=class{constructor(a,b,c,d){this.batchId=a,this.localWriteTime=b,this.baseMutations=c,this.mutations=d}applyToRemoteDocument(a,b){const c=b.mutationResults;for(let b=0;b<this.mutations.length;b++){const d=this.mutations[b];d.key.isEqual(a.key)&&mc(d,a,c[b])}}applyToLocalView(a){for(const b of this.baseMutations)b.key.isEqual(a.key)&&fM(b,a,this.localWriteTime);for(const b of this.mutations)b.key.isEqual(a.key)&&fM(b,a,this.localWriteTime)}applyToLocalDocumentSet(a){this.mutations.forEach(d=>{const b=a.get(d.key),c=b;this.applyToLocalView(c),b.isValidDocument()||c.convertToNoDocument(k.min())})}keys(){return this.mutations.reduce((a,b)=>a.add(b.key),q())}isEqual(a){return this.batchId===a.batchId&&bg(this.mutations,a.mutations,(a,b)=>hM(a,b))&&bg(this.baseMutations,a.baseMutations,(a,b)=>hM(a,b))}},jQ=class{constructor(a,b,c,d){this.batch=a,this.commitVersion=b,this.mutationResults=c,this.docVersions=d}static from(a,e,b){i(a.mutations.length===b.length);let c=lO();const d=a.mutations;for(let a=0;a<d.length;a++)c=c.insert(d[a].key,b[a].version);return new jQ(a,e,b,c)}},aX=class{constructor(a,b,c,d,e=k.min(),f=k.min(),g=K.EMPTY_BYTE_STRING){this.target=a,this.targetId=b,this.purpose=c,this.sequenceNumber=d,this.snapshotVersion=e,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=g}withSequenceNumber(a){return new aX(this.target,this.targetId,this.purpose,a,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(a,b){return new aX(this.target,this.targetId,this.purpose,this.sequenceNumber,b,this.lastLimboFreeSnapshotVersion,a)}withLastLimboFreeSnapshotVersion(a){return new aX(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,a,this.resumeToken)}},jS=class{constructor(a){this.Gt=a}};function jT(b,a){if(a.document)return lG(b.Gt,a.document,!!a.hasCommittedMutations);if(a.noDocument){const c=f.fromSegments(a.noDocument.path),d=bb(a.noDocument.readTime),b=w.newNoDocument(c,d);return a.hasCommittedMutations?b.setHasCommittedMutations():b}if(a.unknownDocument){const b=f.fromSegments(a.unknownDocument.path),c=bb(a.unknownDocument.version);return w.newUnknownDocument(b,c)}return g()}function jU(d,a,e){const b=jV(e),c=a.key.path.popLast().toArray();if(a.isFoundDocument()){const e=function(b,a){return{name:cZ(b,a.key),fields:a.data.value.mapValue.fields,updateTime:bI(b,a.version.toTimestamp())}}(d.Gt,a),f=a.hasCommittedMutations;return new u(null,null,e,f,b,c)}if(a.isNoDocument()){const d=a.key.path.toArray(),e=a$(a.version),f=a.hasCommittedMutations;return new u(null,new lf(d,e),null,f,b,c)}if(a.isUnknownDocument()){const d=a.key.path.toArray(),e=a$(a.version);return new u(new lb(d,e),null,null,!0,b,c)}return g()}function jV(b){const a=b.toTimestamp();return[a.seconds,a.nanoseconds]}function kT(a){const b=new M(a[0],a[1]);return k.fromTimestamp(b)}function a$(b){const a=b.toTimestamp();return new lg(a.seconds,a.nanoseconds)}function bb(a){const b=new M(a.seconds,a.nanoseconds);return k.fromTimestamp(b)}function bh(b,a){const c=(a.baseMutations||[]).map(a=>iR(b.Gt,a));for(let b=0;b<a.mutations.length-1;++b){const c=a.mutations[b];if(b+1<a.mutations.length&&a.mutations[b+1].transform!==void 0){const d=a.mutations[b+1];c.updateTransforms=d.transform.fieldTransforms,a.mutations.splice(b+1,1),++b}}const d=a.mutations.map(a=>iR(b.Gt,a)),e=M.fromMillis(a.localWriteTimeMs);return new fD(a.batchId,e,c,d)}function ck(a){const d=bb(a.readTime),e=a.lastLimboFreeSnapshotVersion!==void 0?bb(a.lastLimboFreeSnapshotVersion):k.min();let b;var c;return a.query.documents!==void 0?(i((c=a.query).documents.length===1),b=ap(dU(iK(c.documents[0])))):b=function(a){return ap(iV(a))}(a.query),new aX(b,a.targetId,0,a.lastListenSequenceNumber,d,e,K.fromBase64String(a.resumeToken))}function kF(b,a){const d=a$(a.snapshotVersion),e=a$(a.lastLimboFreeSnapshotVersion);let c;c=dh(a.target)?iT(b.Gt,a.target):iU(b.Gt,a.target);const f=a.resumeToken.toBase64();return new U(a.targetId,bN(a.target),d,f,a.sequenceNumber,e,c)}function ka(a){const b=iV({parent:a.parent,structuredQuery:a.structuredQuery});return a.limitType==="LAST"?ms(b,b.limit,"L"):b}kS=class{getBundleMetadata(a,b){return kc(a).get(b).next(b=>{if(b)return{id:(a=b).bundleId,createTime:bb(a.createTime),version:a.version};var a})}saveBundleMetadata(b,c){return kc(b).put({bundleId:(a=c).id,createTime:a$(_(a.createTime)),version:a.version});var a}getNamedQuery(a,b){return kd(a).get(b).next(b=>{if(b)return{name:(a=b).name,query:ka(a.bundledQuery),readTime:bb(a.readTime)};var a})}saveNamedQuery(a,b){return kd(a).put(function(a){return{name:a.name,readTime:a$(_(a.readTime)),bundledQuery:a.bundledQuery}}(b))}};function kc(a){return S(a,bf.store)}function kd(a){return S(a,bw.store)}kR=class{constructor(){this.zt=new fF}addToCollectionParentIndex(c,a){return this.zt.add(a),b.resolve()}getCollectionParents(c,a){return b.resolve(this.zt.getEntries(a))}},fF=class{constructor(){this.index={}}add(a){const b=a.lastSegment(),c=a.popLast(),d=this.index[b]||new v(r.comparator),e=!d.has(c);return this.index[b]=d.add(c),e}has(a){const c=a.lastSegment(),d=a.popLast(),b=this.index[c];return b&&b.has(d)}getEntries(a){return(this.index[a]||new v(r.comparator)).toArray()}},kP=class{constructor(){this.Ht=new fF}addToCollectionParentIndex(c,a){if(!this.Ht.has(a)){const b=a.lastSegment(),d=a.popLast();c.addOnCommittedListener(()=>{this.Ht.add(a)});const e={collectionId:b,parent:ab(d)};return kh(c).put(e)}return b.resolve()}getCollectionParents(c,a){const b=[],d=IDBKeyRange.bound([a,""],[fT(a),""],!1,!0);return kh(c).Bt(d).next(c=>{for(const d of c){if(d.collectionId!==a)break;b.push(am(d.parent))}return b})}};function kh(a){return S(a,aQ.store)}ki={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Y=class{constructor(a,b,c){this.cacheSizeCollectionThreshold=a,this.percentileToCollect=b,this.maximumSequenceNumbersToCollect=c}static withCacheSize(a){return new Y(a,Y.DEFAULT_COLLECTION_PERCENTILE,Y.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function kk(d,j,a){const l=d.store(s.store),g=d.store(I.store),c=[],h=IDBKeyRange.only(a.batchId);let e=0;const k=l.jt({range:h},(b,c,a)=>(e++,a.delete()));c.push(k.next(()=>{i(e===1)}));const f=[];for(const b of a.mutations){const d=I.key(j,b.key.path,a.batchId);c.push(g.delete(d)),f.push(b.key)}return b.waitFor(c).next(()=>f)}function dH(a){if(!a)return 0;let b;if(a.document)b=a.document;else if(a.unknownDocument)b=a.unknownDocument;else{if(!a.noDocument)throw g();b=a.noDocument}return JSON.stringify(b).length}Y.DEFAULT_COLLECTION_PERCENTILE=10,Y.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Y.DEFAULT=new Y(41943040,Y.DEFAULT_COLLECTION_PERCENTILE,Y.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Y.DISABLED=new Y(-1,0,0),km=class{constructor(a,b,c,d){this.userId=a,this.k=b,this.Jt=c,this.referenceDelegate=d,this.Yt={}}static Xt(a,b,c,d){i(a.uid!=="");const e=a.isAuthenticated()?a.uid:"";return new km(e,b,c,d)}checkEmpty(b){let a=!0;const c=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return aA(b).jt({index:s.userMutationsIndex,range:c},(c,d,b)=>{a=!1,b.done()}).next(()=>a)}addMutationBatch(a,e,f,c){const g=bk(a),d=aA(a);return d.add({}).next(h=>{i(typeof h=="number");const k=new fD(h,e,f,c),n=function(b,c,a){const d=a.baseMutations.map(a=>ff(b.Gt,a)),e=a.mutations.map(a=>ff(b.Gt,a));return new s(c,a.batchId,a.localWriteTime.toMillis(),d,e)}(this.k,this.userId,k),j=[];let m=new v((a,b)=>l(a.canonicalString(),b.canonicalString()));for(const a of c){const b=I.key(this.userId,a.key.path,h);m=m.add(a.key.path.popLast()),j.push(d.put(n)),j.push(g.put(b,I.PLACEHOLDER))}return m.forEach(b=>{j.push(this.Jt.addToCollectionParentIndex(a,b))}),a.addOnCommittedListener(()=>{this.Yt[h]=k.keys()}),b.waitFor(j).next(()=>k)})}lookupMutationBatch(a,b){return aA(a).get(b).next(a=>a?(i(a.userId===this.userId),bh(this.k,a)):null)}Zt(c,a){return this.Yt[a]?b.resolve(this.Yt[a]):this.lookupMutationBatch(c,a).next(b=>{if(b){const c=b.keys();return this.Yt[a]=c,c}return null})}getNextMutationBatchAfterBatchId(c,d){const a=d+1,e=IDBKeyRange.lowerBound([this.userId,a]);let b=null;return aA(c).jt({index:s.userMutationsIndex,range:e},(e,c,d)=>{c.userId===this.userId&&(i(c.batchId>=a),b=bh(this.k,c)),d.done()}).next(()=>b)}getHighestUnacknowledgedBatchId(b){const c=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let a=-1;return aA(b).jt({index:s.userMutationsIndex,range:c,reverse:!0},(d,b,c)=>{a=b.batchId,c.done()}).next(()=>a)}getAllMutationBatches(a){const b=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return aA(a).Bt(s.userMutationsIndex,b).next(a=>a.map(a=>bh(this.k,a)))}getAllMutationBatchesAffectingDocumentKey(a,b){const d=I.prefixForPath(this.userId,b.path),e=IDBKeyRange.lowerBound(d),c=[];return bk(a).jt({range:e},(d,l,e)=>{const[f,h,j]=d,k=am(h);if(f===this.userId&&b.path.isEqual(k))return aA(a).get(j).next(a=>{if(!a)throw g();i(a.userId===this.userId),c.push(bh(this.k,a))});e.done()}).next(()=>c)}getAllMutationBatchesAffectingDocumentKeys(c,e){let a=new v(l);const d=[];return e.forEach(b=>{const e=I.prefixForPath(this.userId,b.path),f=IDBKeyRange.lowerBound(e),g=bk(c).jt({range:f},(c,i,d)=>{const[e,f,g]=c,h=am(f);e===this.userId&&b.path.isEqual(h)?a=a.add(g):d.done()});d.push(g)}),b.waitFor(d).next(()=>this.te(c,a))}getAllMutationBatchesAffectingQuery(c,d){const b=d.path,e=b.length+1,f=I.prefixForPath(this.userId,b),g=IDBKeyRange.lowerBound(f);let a=new v(l);return bk(c).jt({range:g},(i,j,d)=>{const[f,g,h]=i,c=am(g);f===this.userId&&b.isPrefixOf(c)?c.length===e&&(a=a.add(h)):d.done()}).next(()=>this.te(c,a))}te(d,e){const a=[],c=[];return e.forEach(b=>{c.push(aA(d).get(b).next(b=>{if(b===null)throw g();i(b.userId===this.userId),a.push(bh(this.k,b))}))}),b.waitFor(c).next(()=>a)}removeMutationBatch(a,c){return kk(a.Wt,this.userId,c).next(d=>(a.addOnCommittedListener(()=>{this.ee(c.batchId)}),b.forEach(d,b=>this.referenceDelegate.markPotentiallyOrphaned(a,b))))}ee(a){delete this.Yt[a]}performConsistencyCheck(a){return this.checkEmpty(a).next(d=>{if(!d)return b.resolve();const e=IDBKeyRange.lowerBound(I.prefixForUser(this.userId)),c=[];return bk(a).jt({range:e},(a,d,b)=>{if(a[0]===this.userId){const b=am(a[1]);c.push(b)}else b.done()}).next(()=>{i(c.length===0)})})}containsKey(a,b){return kn(a,this.userId,b)}ne(a){return kq(a).get(this.userId).next(a=>a||new ar(this.userId,-1,""))}};function kn(g,b,d){const c=I.prefixForPath(b,d.path),e=c[1],f=IDBKeyRange.lowerBound(c);let a=!1;return bk(g).jt({range:f,Kt:!0},(c,h,d)=>{const[f,g,i]=c;f===b&&g===e&&(a=!0),d.done()}).next(()=>a)}function aA(a){return S(a,s.store)}function bk(a){return S(a,I.store)}function kq(a){return S(a,ar.store)}bl=class{constructor(a){this.se=a}next(){return this.se+=2,this.se}static ie(){return new bl(0)}static re(){return new bl(-1)}},kO=class{constructor(a,b){this.referenceDelegate=a,this.k=b}allocateTargetId(a){return this.oe(a).next(b=>{const c=new bl(b.highestTargetId);return b.highestTargetId=c.next(),this.ae(a,b).next(()=>b.highestTargetId)})}getLastRemoteSnapshotVersion(a){return this.oe(a).next(a=>k.fromTimestamp(new M(a.lastRemoteSnapshotVersion.seconds,a.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(a){return this.oe(a).next(a=>a.highestListenSequenceNumber)}setTargetsMetadata(b,a,c){return this.oe(b).next(d=>(d.highestListenSequenceNumber=a,c&&(d.lastRemoteSnapshotVersion=c.toTimestamp()),a>d.highestListenSequenceNumber&&(d.highestListenSequenceNumber=a),this.ae(b,d)))}addTargetData(a,b){return this.ce(a,b).next(()=>this.oe(a).next(c=>(c.targetCount+=1,this.ue(b,c),this.ae(a,c))))}updateTargetData(a,b){return this.ce(a,b)}removeTargetData(a,b){return this.removeMatchingKeysForTargetId(a,b.targetId).next(()=>bm(a).delete(b.targetId)).next(()=>this.oe(a)).next(b=>(i(b.targetCount>0),b.targetCount-=1,this.ae(a,b)))}removeTargets(a,e,f){let c=0;const d=[];return bm(a).jt((h,g)=>{const b=ck(g);b.sequenceNumber<=e&&f.get(b.targetId)===null&&(c++,d.push(this.removeTargetData(a,b)))}).next(()=>b.waitFor(d)).next(()=>c)}forEachTarget(a,b){return bm(a).jt((d,a)=>{const c=ck(a);b(c)})}oe(a){return ku(a).get($.key).next(a=>(i(a!==null),a))}ae(a,b){return ku(a).put($.key,b)}ce(a,b){return bm(a).put(kF(this.k,b))}ue(a,b){let c=!1;return a.targetId>b.highestTargetId&&(b.highestTargetId=a.targetId,c=!0),a.sequenceNumber>b.highestListenSequenceNumber&&(b.highestListenSequenceNumber=a.sequenceNumber,c=!0),c}getTargetCount(a){return this.oe(a).next(a=>a.targetCount)}getTargetData(d,a){const b=bN(a),e=IDBKeyRange.bound([b,Number.NEGATIVE_INFINITY],[b,Number.POSITIVE_INFINITY]);let c=null;return bm(d).jt({range:e,index:U.queryTargetsIndexName},(f,d,e)=>{const b=ck(d);dg(a,b.target)&&(c=b,e.done())}).next(()=>c)}addMatchingKeys(c,e,d){const a=[],f=aC(c);return e.forEach(b=>{const e=ab(b.path);a.push(f.put(new G(d,e))),a.push(this.referenceDelegate.addReference(c,d,b))}),b.waitFor(a)}removeMatchingKeys(a,d,c){const e=aC(a);return b.forEach(d,d=>{const f=ab(d.path);return b.waitFor([e.delete([c,f]),this.referenceDelegate.removeReference(a,c,d)])})}removeMatchingKeysForTargetId(b,a){const c=aC(b),d=IDBKeyRange.bound([a],[a+1],!1,!0);return c.delete(d)}getMatchingKeysForTargetId(c,b){const d=IDBKeyRange.bound([b],[b+1],!1,!0),e=aC(c);let a=q();return e.jt({range:d,Kt:!0},(b,e,g)=>{const c=am(b[1]),d=new f(c);a=a.add(d)}).next(()=>a)}containsKey(c,d){const a=ab(d.path),e=IDBKeyRange.bound([a],[fT(a)],!1,!0);let b=0;return aC(c).jt({index:G.documentTargetsIndex,Kt:!0,range:e},([a,d],e,c)=>{a!==0&&(b++,c.done())}).next(()=>b>0)}Et(a,b){return bm(a).get(b).next(a=>a?ck(a):null)}};function bm(a){return S(a,U.store)}function ku(a){return S(a,$.store)}function aC(a){return S(a,G.store)}async function bo(b){if(b.code!==a.FAILED_PRECONDITION||b.message!==jB)throw b;c("LocalStore","Unexpectedly lost primary lease")}function kx([b,c],[d,e]){const a=l(b,d);return a===0?l(c,e):a}kN=class{constructor(a){this.he=a,this.buffer=new v(kx),this.le=0}fe(){return++this.le}de(b){const a=[b,this.fe()];if(this.buffer.size<this.he)this.buffer=this.buffer.add(a);else{const b=this.buffer.last();kx(a,b)<0&&(this.buffer=this.buffer.delete(b).add(a))}}get maxValue(){return this.buffer.last()[0]}},kM=class{constructor(a,b){this.garbageCollector=a,this.asyncQueue=b,this.we=!1,this._e=null}start(a){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.me(a)}stop(){this._e&&(this._e.cancel(),this._e=null)}get started(){return this._e!==null}me(a){const b=this.we?3e5:6e4;c("LruGarbageCollector",`Garbage collection scheduled in ${b}ms`),this._e=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",b,async()=>{this._e=null,this.we=!0;try{await a.collectGarbage(this.garbageCollector)}catch(a){aU(a)?c("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",a):await bo(a)}await this.me(a)})}},kL=class{constructor(a,b){this.ge=a,this.params=b}calculateTargetCount(a,b){return this.ge.ye(a).next(a=>Math.floor(b/100*a))}nthSequenceNumber(c,d){if(d===0)return b.resolve(ac.I);const a=new kN(d);return this.ge.forEachTarget(c,b=>a.de(b.sequenceNumber)).next(()=>this.ge.pe(c,b=>a.de(b))).next(()=>a.maxValue)}removeTargets(a,b,c){return this.ge.removeTargets(a,b,c)}removeOrphanedDocuments(a,b){return this.ge.removeOrphanedDocuments(a,b)}collect(a,d){return this.params.cacheSizeCollectionThreshold===-1?(c("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(ki)):this.getCacheSize(a).next(b=>b<this.params.cacheSizeCollectionThreshold?(c("LruGarbageCollector",`Garbage collection skipped; Cache size ${b} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ki):this.Te(a,d))}getCacheSize(a){return this.ge.getCacheSize(a)}Te(d,l){let f,a,g,h,i,e,j;const k=Date.now();return this.calculateTargetCount(d,this.params.percentileToCollect).next(b=>(b>this.params.maximumSequenceNumbersToCollect?(c("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${b}`),a=this.params.maximumSequenceNumbersToCollect):a=b,h=Date.now(),this.nthSequenceNumber(d,a))).next(a=>(f=a,i=Date.now(),this.removeTargets(d,f,l))).next(a=>(g=a,e=Date.now(),this.removeOrphanedDocuments(d,f))).next(d=>(j=Date.now(),fw()<=n.DEBUG&&c("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${h-k}ms
	Determined least recently used ${a} in `+(i-h)+`ms
	Removed ${g} targets in `+(e-i)+`ms
	Removed ${d} documents in `+(j-e)+`ms
Total Duration: ${j-k}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:a,targetsRemoved:g,documentsRemoved:d})))}},kJ=class{constructor(a,b){this.db=a,this.garbageCollector=function(a,b){return new kL(a,b)}(this,b)}ye(a){const b=this.Ee(a);return this.db.getTargetCache().getTargetCount(a).next(a=>b.next(b=>a+b))}Ee(b){let a=0;return this.pe(b,b=>{a++}).next(()=>a)}forEachTarget(a,b){return this.db.getTargetCache().forEachTarget(a,b)}pe(a,b){return this.Ie(a,(c,a)=>b(a))}addReference(a,c,b){return dN(a,b)}removeReference(a,c,b){return dN(a,b)}removeTargets(a,b,c){return this.db.getTargetCache().removeTargets(a,b,c)}markPotentiallyOrphaned(a,b){return dN(a,b)}Ae(a,c){return function(a,d){let c=!1;return kq(a).Qt(e=>kn(a,e,d).next(a=>(a&&(c=!0),b.resolve(!a)))).next(()=>c)}(a,c)}removeOrphanedDocuments(a,f){const c=this.db.getRemoteDocumentCache().newChangeBuffer(),d=[];let e=0;return this.Ie(a,(b,g)=>{if(g<=f){const f=this.Ae(a,b).next(d=>{if(!d)return e++,c.getEntry(a,b).next(()=>(c.removeEntry(b),aC(a).delete([0,ab(b.path)])))});d.push(f)}}).next(()=>b.waitFor(d)).next(()=>c.apply(a)).next(()=>e)}removeTarget(a,b){const c=b.withSequenceNumber(a.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(a,c)}updateLimboDocument(a,b){return dN(a,b)}Ie(d,c){const e=aC(d);let b,a=ac.I;return e.jt({index:G.documentTargetsIndex},([d,h],{path:e,sequenceNumber:g})=>{d===0?(a!==ac.I&&c(new f(am(b)),a),a=g,b=e):a=ac.I}).next(()=>{a!==ac.I&&c(new f(am(b)),a)})}getCacheSize(a){return this.db.getRemoteDocumentCache().getSize(a)}};function dN(a,b){return aC(a).put(function(a,b){return new G(0,ab(a.path),b)}(b,a.currentSequenceNumber))}bB=class{constructor(a,b){this.mapKeyFn=a,this.equalsFn=b,this.inner={}}get(a){const c=this.mapKeyFn(a),b=this.inner[c];if(b!==void 0)for(const[c,d]of b)if(this.equalsFn(c,a))return d}has(a){return this.get(a)!==void 0}set(a,c){const d=this.mapKeyFn(a),b=this.inner[d];if(b!==void 0){for(let d=0;d<b.length;d++)if(this.equalsFn(b[d][0],a))return void(b[d]=[a,c]);b.push([a,c])}else this.inner[d]=[[a,c]]}delete(b){const c=this.mapKeyFn(b),a=this.inner[c];if(a===void 0)return!1;for(let d=0;d<a.length;d++)if(this.equalsFn(a[d][0],b))return a.length===1?delete this.inner[c]:a.splice(d,1),!0;return!1}forEach(a){bD(this.inner,(c,b)=>{for(const[c,d]of b)a(c,d)})}isEmpty(){return fY(this.inner)}},kE=class{constructor(){this.changes=new bB(a=>a.toString(),(a,b)=>a.isEqual(b)),this.changesApplied=!1}getReadTime(b){const a=this.changes.get(b);return a?a.readTime:k.min()}addEntry(a,b){this.assertNotApplied(),this.changes.set(a.key,{document:a,readTime:b})}removeEntry(a,b=null){this.assertNotApplied(),this.changes.set(a,{document:w.newInvalidDocument(a),readTime:b})}getEntry(d,a){this.assertNotApplied();const c=this.changes.get(a);return c!==void 0?b.resolve(c.document):this.getFromCache(d,a)}getEntries(a,b){return this.getAllFromCache(a,b)}apply(a){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(a)}assertNotApplied(){}},kI=class{constructor(a,b){this.k=a,this.Jt=b}addEntry(a,b,c){return aI(a).put(dK(b),c)}removeEntry(a,b){const c=aI(a),d=dK(b);return c.delete(d)}updateMetadata(a,b){return this.getMetadata(a).next(c=>(c.byteSize+=b,this.Re(a,c)))}getEntry(b,a){return aI(b).get(dK(a)).next(b=>this.Pe(a,b))}be(b,a){return aI(b).get(dK(a)).next(b=>({document:this.Pe(a,b),size:dH(b)}))}getEntries(b,c){let a=ai();return this.ve(b,c,(b,c)=>{const d=this.Pe(b,c);a=a.insert(b,d)}).next(()=>a)}Ve(c,d){let a=ai(),b=new O(f.comparator);return this.ve(c,d,(c,d)=>{const e=this.Pe(c,d);a=a.insert(c,e),b=b.insert(c,dH(d))}).next(()=>({documents:a,Se:b}))}ve(g,d,e){if(d.isEmpty())return b.resolve();const h=IDBKeyRange.bound(d.first().path.toArray(),d.last().path.toArray()),c=d.getIterator();let a=c.getNext();return aI(g).jt({range:h},(g,h,b)=>{const d=f.fromSegments(g);for(;a&&f.comparator(a,d)<0;)e(a,null),a=c.getNext();a&&a.isEqual(d)&&(e(a,h),a=c.hasNext()?c.getNext():null),a?b.Lt(a.path.toArray()):b.done()}).next(()=>{for(;a;)e(a,null),a=c.hasNext()?c.getNext():null})}getDocumentsMatchingQuery(e,a,d){let c=ai();const f=a.path.length+1,b={};if(d.isEqual(k.min())){const c=a.path.toArray();b.range=IDBKeyRange.lowerBound(c)}else{const c=a.path.toArray(),e=jV(d);b.range=IDBKeyRange.lowerBound([c,e],!0),b.index=u.collectionReadTimeIndex}return aI(e).jt(b,(d,e,g)=>{if(d.length!==f)return;const b=jT(this.k,e);a.path.isPrefixOf(b.key.path)?bY(a,b)&&(c=c.insert(b.key,b)):g.done()}).next(()=>c)}newChangeBuffer(a){return new kH(this,!!a&&a.trackRemovals)}getSize(a){return this.getMetadata(a).next(a=>a.byteSize)}getMetadata(a){return im(a).get(ag.key).next(a=>(i(!!a),a))}Re(a,b){return im(a).put(ag.key,b)}Pe(b,a){if(a){const b=jT(this.k,a);if(!(b.isNoDocument()&&b.version.isEqual(k.min())))return b}return w.newInvalidDocument(b)}},kH=class extends kE{constructor(a,b){super(),this.De=a,this.trackRemovals=b,this.Ce=new bB(a=>a.toString(),(a,b)=>a.isEqual(b))}applyChanges(c){const a=[];let d=0,e=new v((a,b)=>l(a.canonicalString(),b.canonicalString()));return this.changes.forEach((b,f)=>{const g=this.Ce.get(b);if(f.document.isValidDocument()){const h=jU(this.De.k,f.document,this.getReadTime(b));e=e.add(b.path.popLast());const i=dH(h);d+=i-g,a.push(this.De.addEntry(c,b,h))}else if(d-=g,this.trackRemovals){const d=jU(this.De.k,w.newNoDocument(b,k.min()),this.getReadTime(b));a.push(this.De.addEntry(c,b,d))}else a.push(this.De.removeEntry(c,b))}),e.forEach(b=>{a.push(this.De.Jt.addToCollectionParentIndex(c,b))}),a.push(this.De.updateMetadata(c,d)),b.waitFor(a)}getFromCache(b,a){return this.De.be(b,a).next(b=>(this.Ce.set(a,b.size),b.document))}getAllFromCache(a,b){return this.De.Ve(a,b).next(({documents:a,Se:b})=>(b.forEach((a,b)=>{this.Ce.set(a,b)}),a))}};function im(a){return S(a,ag.store)}function aI(a){return S(a,u.store)}function dK(a){return a.path.toArray()}kK=class{constructor(a){this.k=a}Nt(d,g,c,e){i(c<e&&c>=0&&e<=11);const f=new fB("createOrUpgrade",g);c<1&&e>=1&&(function(a){a.createObjectStore(X.store)}(d),function(a){a.createObjectStore(ar.store,{keyPath:ar.keyPath}),a.createObjectStore(s.store,{keyPath:s.keyPath,autoIncrement:!0}).createIndex(s.userMutationsIndex,s.userMutationsKeyPath,{unique:!0}),a.createObjectStore(I.store)}(d),kA(d),function(a){a.createObjectStore(u.store)}(d));let a=b.resolve();return c<3&&e>=3&&(c!==0&&(!function(a){a.deleteObjectStore(G.store),a.deleteObjectStore(U.store),a.deleteObjectStore($.store)}(d),kA(d)),a=a.next(()=>function(a){const b=a.store($.store),c=new $(0,0,k.min().toTimestamp(),0);return b.put($.key,c)}(f))),c<4&&e>=4&&(c!==0&&(a=a.next(()=>function(a,c){return c.store(s.store).Bt().next(d=>{a.deleteObjectStore(s.store),a.createObjectStore(s.store,{keyPath:s.keyPath,autoIncrement:!0}).createIndex(s.userMutationsIndex,s.userMutationsKeyPath,{unique:!0});const e=c.store(s.store),f=d.map(a=>e.put(a));return b.waitFor(f)})}(d,f))),a=a.next(()=>{!function(a){a.createObjectStore(aq.store,{keyPath:aq.keyPath})}(d)})),c<5&&e>=5&&(a=a.next(()=>this.Ne(f))),c<6&&e>=6&&(a=a.next(()=>(function(a){a.createObjectStore(ag.store)}(d),this.ke(f)))),c<7&&e>=7&&(a=a.next(()=>this.xe(f))),c<8&&e>=8&&(a=a.next(()=>this.$e(d,f))),c<9&&e>=9&&(a=a.next(()=>{!function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")}(d),function(b){const a=b.objectStore(u.store);a.createIndex(u.readTimeIndex,u.readTimeIndexPath,{unique:!1}),a.createIndex(u.collectionReadTimeIndex,u.collectionReadTimeIndexPath,{unique:!1})}(g)})),c<10&&e>=10&&(a=a.next(()=>this.Fe(f))),c<11&&e>=11&&(a=a.next(()=>{!function(a){a.createObjectStore(bf.store,{keyPath:bf.keyPath})}(d),function(a){a.createObjectStore(bw.store,{keyPath:bw.keyPath})}(d)})),a}ke(a){let b=0;return a.store(u.store).jt((c,a)=>{b+=dH(a)}).next(()=>{const c=new ag(b);return a.store(ag.store).put(ag.key,c)})}Ne(a){const c=a.store(ar.store),d=a.store(s.store);return c.Bt().next(c=>b.forEach(c,c=>{const e=IDBKeyRange.bound([c.userId,-1],[c.userId,c.lastAcknowledgedBatchId]);return d.Bt(s.userMutationsIndex,e).next(d=>b.forEach(d,b=>{i(b.userId===c.userId);const d=bh(this.k,b);return kk(a,c.userId,d).next(()=>{})}))}))}xe(a){const c=a.store(G.store),d=a.store(u.store);return a.store($.store).get($.key).next(e=>{const a=[];return d.jt((f,h)=>{const d=new r(f),g=function(a){return[0,ab(a)]}(d);a.push(c.get(g).next(a=>a?b.resolve():(a=>c.put(new G(0,ab(a),e.highestListenSequenceNumber)))(d)))}).next(()=>b.waitFor(a))})}$e(c,a){c.createObjectStore(aQ.store,{keyPath:aQ.keyPath});const d=a.store(aQ.store),e=new fF,b=a=>{if(e.add(a)){const b=a.lastSegment(),c=a.popLast();return d.put({collectionId:b,parent:ab(c)})}};return a.store(u.store).jt({Kt:!0},(a,d)=>{const c=new r(a);return b(c.popLast())}).next(()=>a.store(I.store).jt({Kt:!0},([d,a,e],f)=>{const c=am(a);return b(c.popLast())}))}Fe(b){const a=b.store(U.store);return a.jt((e,b)=>{const c=ck(b),d=kF(this.k,c);return a.put(d)})}};function kA(a){a.createObjectStore(G.store,{keyPath:G.keyPath}).createIndex(G.documentTargetsIndex,G.documentTargetsKeyPath,{unique:!0}),a.createObjectStore(U.store,{keyPath:U.keyPath}).createIndex(U.queryTargetsIndexName,U.queryTargetsKeyPath,{unique:!0}),a.createObjectStore($.store)}fI="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ky=class{constructor(e,b,f,l,g,h,i,j,k,c){if(this.allowTabSynchronization=e,this.persistenceKey=b,this.clientId=f,this.Oe=g,this.window=h,this.document=i,this.Me=k,this.Le=c,this.Be=null,this.Ue=!1,this.isPrimary=!1,this.networkEnabled=!0,this.qe=null,this.inForeground=!1,this.Ke=null,this.je=null,this.Qe=Number.NEGATIVE_INFINITY,this.We=a=>Promise.resolve(),!ky.bt())throw new d(a.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new kJ(this,l),this.Ge=b+"main",this.k=new jS(j),this.ze=new aw(this.Ge,11,new kK(this.k)),this.He=new kO(this.referenceDelegate,this.k),this.Jt=new kP,this.Je=function(a,b){return new kI(a,b)}(this.k,this.Jt),this.Ye=new kS,this.window&&this.window.localStorage?this.Xe=this.window.localStorage:(this.Xe=null,c===!1&&W("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ze().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new d(a.FAILED_PRECONDITION,fI);return this.tn(),this.en(),this.nn(),this.runTransaction("getHighestListenSequenceNumber","readonly",a=>this.He.getHighestSequenceNumber(a))}).then(a=>{this.Be=new ac(a,this.Me)}).then(()=>{this.Ue=!0}).catch(a=>(this.ze&&this.ze.close(),Promise.reject(a)))}sn(a){return this.We=async b=>{if(this.started)return a(b)},a(this.isPrimary)}setDatabaseDeletedListener(a){this.ze.xt(async b=>{b.newVersion===null&&await a()})}setNetworkEnabled(a){this.networkEnabled!==a&&(this.networkEnabled=a,this.Oe.enqueueAndForget(async()=>{this.started&&await this.Ze()}))}Ze(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",a=>dD(a).put(new aq(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.rn(a).next(a=>{a||(this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.We(!1)))})}).next(()=>this.on(a)).next(b=>this.isPrimary&&!b?this.an(a).next(()=>!1):!!b&&this.cn(a).next(()=>!0))).catch(a=>{if(aU(a))return c("IndexedDbPersistence","Failed to extend owner lease: ",a),this.isPrimary;if(!this.allowTabSynchronization)throw a;return c("IndexedDbPersistence","Releasing owner lease after error during lease refresh",a),!1}).then(a=>{this.isPrimary!==a&&this.Oe.enqueueRetryable(()=>this.We(a)),this.isPrimary=a})}rn(a){return cm(a).get(X.key).next(a=>b.resolve(this.un(a)))}hn(a){return dD(a).delete(this.clientId)}async ln(){if(this.isPrimary&&!this.fn(this.Qe,18e5)){this.Qe=Date.now();const a=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",c=>{const a=S(c,aq.store);return a.Bt().next(c=>{const e=this.dn(c,18e5),d=c.filter(a=>e.indexOf(a)===-1);return b.forEach(d,b=>a.delete(b.clientId)).next(()=>d)})}).catch(()=>[]);if(this.Xe)for(const b of a)this.Xe.removeItem(this.wn(b.clientId))}}nn(){this.je=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ze().then(()=>this.ln()).then(()=>this.nn()))}un(a){return!!a&&a.ownerId===this.clientId}on(e){return this.Le?b.resolve(!0):cm(e).get(X.key).next(b=>{if(b!==null&&this.fn(b.leaseTimestampMs,5e3)&&!this._n(b.ownerId)){if(this.un(b)&&this.networkEnabled)return!0;if(!this.un(b)){if(!b.allowTabSynchronization)throw new d(a.FAILED_PRECONDITION,fI);return!1}}return!(!this.networkEnabled||!this.inForeground)||dD(e).Bt().next(a=>this.dn(a,5e3).find(a=>{if(this.clientId!==a.clientId){const b=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,d=this.networkEnabled===a.networkEnabled;if(b||c&&d)return!0}return!1})===void 0)}).next(a=>(this.isPrimary!==a&&c("IndexedDbPersistence",`Client ${a?"is":"is not"} eligible for a primary lease.`),a))}async shutdown(){this.Ue=!1,this.mn(),this.je&&(this.je.cancel(),this.je=null),this.gn(),this.yn(),await this.ze.runTransaction("shutdown","readwrite",[X.store,aq.store],b=>{const a=new jN(b,ac.I);return this.an(a).next(()=>this.hn(a))}),this.ze.close(),this.pn()}dn(a,b){return a.filter(a=>this.fn(a.updateTimeMs,b)&&!this._n(a.clientId))}Tn(){return this.runTransaction("getActiveClients","readonly",a=>dD(a).Bt().next(a=>this.dn(a,18e5).map(a=>a.clientId)))}get started(){return this.Ue}getMutationQueue(a){return km.Xt(a,this.k,this.Jt,this.referenceDelegate)}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getIndexManager(){return this.Jt}getBundleCache(){return this.Ye}runTransaction(e,f,g){c("IndexedDbPersistence","Starting transaction:",e);const h=f==="readonly"?"readonly":"readwrite";let b;return this.ze.runTransaction(e,h,kY,c=>(b=new jN(c,this.Be?this.Be.next():ac.I),f==="readwrite-primary"?this.rn(b).next(a=>!!a||this.on(b)).next(c=>{if(!c)throw W(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.We(!1)),new d(a.FAILED_PRECONDITION,jB);return g(b)}).next(a=>this.cn(b).next(()=>a)):this.En(b).next(()=>g(b)))).then(a=>(b.raiseOnCommittedEvent(),a))}En(b){return cm(b).get(X.key).next(b=>{if(b!==null&&this.fn(b.leaseTimestampMs,5e3)&&!this._n(b.ownerId)&&!this.un(b)&&!(this.Le||this.allowTabSynchronization&&b.allowTabSynchronization))throw new d(a.FAILED_PRECONDITION,fI)})}cn(a){const b=new X(this.clientId,this.allowTabSynchronization,Date.now());return cm(a).put(X.key,b)}static bt(){return aw.bt()}an(d){const a=cm(d);return a.get(X.key).next(d=>this.un(d)?(c("IndexedDbPersistence","Releasing primary lease."),a.delete(X.key)):b.resolve())}fn(a,c){const b=Date.now();return!(a<b-c)&&(!(a>b)||(W(`Detected an update time that is in the future: ${a} > ${b}`),!1))}tn(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ke=()=>{this.Oe.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ze()))},this.document.addEventListener("visibilitychange",this.Ke),this.inForeground=this.document.visibilityState==="visible")}gn(){this.Ke&&(this.document.removeEventListener("visibilitychange",this.Ke),this.Ke=null)}en(){var a;typeof((a=this.window)===null||a===void 0?void 0:a.addEventListener)=="function"&&(this.qe=()=>{this.mn(),rD()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Oe.enterRestrictedMode(!0),this.Oe.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.qe))}yn(){this.qe&&(this.window.removeEventListener("pagehide",this.qe),this.qe=null)}_n(b){var a;try{const d=((a=this.Xe)===null||a===void 0?void 0:a.getItem(this.wn(b)))!==null;return c("IndexedDbPersistence",`Client '${b}' ${d?"is":"is not"} zombied in LocalStorage`),d}catch(a){return W("IndexedDbPersistence","Failed to get zombied client id.",a),!1}}mn(){if(this.Xe)try{this.Xe.setItem(this.wn(this.clientId),String(Date.now()))}catch(a){W("Failed to set zombie client id.",a)}}pn(){if(this.Xe)try{this.Xe.removeItem(this.wn(this.clientId))}catch(a){}}wn(a){return`firestore_zombie_${this.persistenceKey}_${a}`}};function cm(a){return S(a,X.store)}function dD(a){return S(a,aq.store)}function kQ(a,c){let b=a.projectId;return a.isDefaultDatabase||(b+="."+a.database),"firestore/"+c+"/"+b+"/"}ke=class{constructor(a,b,c){this.Je=a,this.An=b,this.Jt=c}Rn(a,b){return this.An.getAllMutationBatchesAffectingDocumentKey(a,b).next(c=>this.Pn(a,b,c))}Pn(a,b,c){return this.Je.getEntry(a,b).next(a=>{for(const b of c)b.applyToLocalView(a);return a})}bn(a,b){a.forEach((c,a)=>{for(const c of b)c.applyToLocalView(a)})}vn(a,b){return this.Je.getEntries(a,b).next(b=>this.Vn(a,b).next(()=>b))}Vn(b,a){return this.An.getAllMutationBatchesAffectingDocumentKeys(b,a).next(b=>this.bn(a,b))}getDocumentsMatchingQuery(b,a,c){return function(a){return f.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(a)?this.Sn(b,a.path):hf(a)?this.Dn(b,a,c):this.Cn(b,a,c)}Sn(a,b){return this.Rn(a,new f(b)).next(a=>{let b=eJ();return a.isFoundDocument()&&(b=b.insert(a.key,a)),b})}Dn(c,d,f){const e=d.collectionGroup;let a=eJ();return this.Jt.getCollectionParents(c,e).next(g=>b.forEach(g,b=>{const g=function(a,b){return new cf(b,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}(d,b.child(e));return this.Cn(c,g,f).next(b=>{b.forEach((b,c)=>{a=a.insert(b,c)})})}).next(()=>a))}Cn(b,c,e){let a,d;return this.Je.getDocumentsMatchingQuery(b,c,e).next(d=>(a=d,this.An.getAllMutationBatchesAffectingQuery(b,c))).next(c=>(d=c,this.Nn(b,d,a).next(b=>{a=b;for(const b of d)for(const e of b.mutations){const d=e.key;let c=a.get(d);c==null&&(c=w.newInvalidDocument(d),a=a.insert(d,c)),fM(e,c,b.localWriteTime),c.isFoundDocument()||(a=a.remove(d))}}))).next(()=>(a.forEach((b,d)=>{bY(c,d)||(a=a.remove(b))}),a))}Nn(d,e,c){let a=q();for(const b of e)for(const d of b.mutations)d instanceof bT&&c.get(d.key)===null&&(a=a.add(d.key));let b=c;return this.Je.getEntries(d,a).next(a=>(a.forEach((c,a)=>{a.isFoundDocument()&&(b=b.insert(c,a))}),b))}},kb=class{constructor(a,b,c,d){this.targetId=a,this.fromCache=b,this.kn=c,this.xn=d}static $n(d,c){let a=q(),b=q();for(const d of c.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:b=b.add(d.doc.key)}return new kb(d,c.fromCache,a,b)}},jW=class{Fn(a){this.On=a}getDocumentsMatchingQuery(b,a,d,e){return function(a){return a.filters.length===0&&a.limit===null&&a.startAt==null&&a.endAt==null&&(a.explicitOrderBy.length===0||a.explicitOrderBy.length===1&&a.explicitOrderBy[0].field.isKeyField())}(a)||d.isEqual(k.min())?this.Mn(b,a):this.On.vn(b,e).next(g=>{const f=this.Ln(a,g);return(cF(a)||dP(a))&&this.Bn(a.limitType,f,e,d)?this.Mn(b,a):(fw()<=n.DEBUG&&c("QueryEngine","Re-using previous result from %s to execute query: %s",d.toString(),dY(a)),this.On.getDocumentsMatchingQuery(b,a,d).next(a=>(f.forEach(b=>{a=a.insert(b.key,b)}),a)))})}Ln(b,c){let a=new v(hn(b));return c.forEach((d,c)=>{bY(b,c)&&(a=a.add(c))}),a}Bn(c,a,d,e){if(d.size!==a.size)return!0;const b=c==="F"?a.last():a.first();return!!b&&(b.hasPendingWrites||b.version.compareTo(e)>0)}Mn(b,a){return fw()<=n.DEBUG&&c("QueryEngine","Using full collection scan to execute query:",dY(a)),this.On.getDocumentsMatchingQuery(b,a,k.min())}},kU=class{constructor(a,b,c,d){this.persistence=a,this.Un=b,this.k=d,this.qn=new O(l),this.Kn=new bB(a=>bN(a),dg),this.jn=k.min(),this.An=a.getMutationQueue(c),this.Qn=a.getRemoteDocumentCache(),this.He=a.getTargetCache(),this.Wn=new ke(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=a.getBundleCache(),this.Un.Fn(this.Wn)}collectGarbage(a){return this.persistence.runTransaction("Collect garbage","readwrite-primary",b=>a.collect(b,this.qn))}};function jJ(a,b,c,d){return new kU(a,b,c,d)}async function jG(d,e){const a=j(d);let b=a.An,c=a.Wn;const f=await a.persistence.runTransaction("Handle user change","readonly",d=>{let f;return a.An.getAllMutationBatches(d).next(g=>(f=g,b=a.persistence.getMutationQueue(e),c=new ke(a.Qn,b,a.persistence.getIndexManager()),b.getAllMutationBatches(d))).next(g=>{const b=[],e=[];let a=q();for(const c of f){b.push(c.batchId);for(const b of c.mutations)a=a.add(b.key)}for(const b of g){e.push(b.batchId);for(const c of b.mutations)a=a.add(c.key)}return c.vn(d,a).next(a=>({Gn:a,removedBatchIds:b,addedBatchIds:e}))})});return a.An=b,a.Wn=c,a.Un.Fn(a.Wn),f}function kX(d,c){const a=j(d);return a.persistence.runTransaction("Acknowledge batch","readwrite-primary",d=>{const f=c.batch.keys(),e=a.Qn.newChangeBuffer({trackRemovals:!0});return function(h,e,a,f){const d=a.batch,g=d.keys();let c=b.resolve();return g.forEach(b=>{c=c.next(()=>f.getEntry(e,b)).next(c=>{const e=a.docVersions.get(b);i(e!==null),c.version.compareTo(e)<0&&(d.applyToRemoteDocument(c,a),c.isValidDocument()&&f.addEntry(c,a.commitVersion))})}),c.next(()=>h.An.removeMutationBatch(e,d))}(a,d,c,e).next(()=>e.apply(d)).next(()=>a.An.performConsistencyCheck(d)).next(()=>a.Wn.vn(d,f))})}function jA(b){const a=j(b);return a.persistence.runTransaction("Get last remote snapshot version","readonly",b=>a.He.getLastRemoteSnapshotVersion(b))}function kZ(f,c){const a=j(f),e=c.snapshotVersion;let d=a.qn;return a.persistence.runTransaction("Apply remote event","readwrite-primary",f=>{const j=a.Qn.newChangeBuffer({trackRemovals:!0});d=a.qn;const g=[];c.targetChanges.forEach((b,c)=>{const h=d.get(c);if(!h)return;g.push(a.He.removeMatchingKeys(f,b.removedDocuments,c).next(()=>a.He.addMatchingKeys(f,b.addedDocuments,c)));const j=b.resumeToken;if(j.approximateByteSize()>0){const k=h.withResumeToken(j,e).withSequenceNumber(f.currentSequenceNumber);d=d.insert(c,k),function(b,c,a){return!!(i(c.resumeToken.approximateByteSize()>0),b.resumeToken.approximateByteSize()===0)||(c.snapshotVersion.toMicroseconds()-b.snapshotVersion.toMicroseconds()>=3e8||a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size>0)}(h,k,b)&&g.push(a.He.updateTargetData(f,k))}});let h=ai();if(c.documentUpdates.forEach((b,d)=>{c.resolvedLimboDocuments.has(b)&&g.push(a.persistence.referenceDelegate.updateLimboDocument(f,b))}),g.push(k_(f,j,c.documentUpdates,e,void 0).next(a=>{h=a})),!e.isEqual(k.min())){const b=a.He.getLastRemoteSnapshotVersion(f).next(b=>a.He.setTargetsMetadata(f,f.currentSequenceNumber,e));g.push(b)}return b.waitFor(g).next(()=>j.apply(f)).next(()=>a.Wn.Vn(f,h)).next(()=>h)}).then(b=>(a.qn=d,b))}function k_(f,a,d,g,e){let b=q();return d.forEach(a=>b=b.add(a)),a.getEntries(f,b).next(f=>{let b=ai();return d.forEach((h,d)=>{const i=f.get(h),j=(e==null?void 0:e.get(h))||g;d.isNoDocument()&&d.version.isEqual(k.min())?(a.removeEntry(h,j),b=b.insert(h,d)):!i.isValidDocument()||d.version.compareTo(i.version)>0||d.version.compareTo(i.version)===0&&i.hasPendingWrites?(a.addEntry(d,j),b=b.insert(h,d)):c("LocalStore","Ignoring outdated watch update for ",h,". Current version:",i.version," Watch version:",d.version)}),b})}function k$(c,a){const b=j(c);return b.persistence.runTransaction("Get next mutation batch","readonly",c=>(a===void 0&&(a=-1),b.An.getNextMutationBatchAfterBatchId(c,a)))}function la(d,c){const a=j(d);return a.persistence.runTransaction("Allocate target","readwrite",e=>{let d;return a.He.getTargetData(e,c).next(f=>f?(d=f,b.resolve(d)):a.He.allocateTargetId(e).next(b=>(d=new aX(c,b,0,e.currentSequenceNumber),a.He.addTargetData(e,d).next(()=>d))))}).then(b=>{const d=a.qn.get(b.targetId);return(d===null||b.snapshotVersion.compareTo(d.snapshotVersion)>0)&&(a.qn=a.qn.insert(b.targetId,b),a.Kn.set(c,b.targetId)),b})}async function fr(f,b,d){const a=j(f),e=a.qn.get(b),g=d?"readwrite":"readwrite-primary";try{d||await a.persistence.runTransaction("Release target",g,b=>a.persistence.referenceDelegate.removeTarget(b,e))}catch(a){if(!aU(a))throw a;c("LocalStore",`Failed to update sequence numbers for target ${b}: ${a}`)}a.qn=a.qn.remove(b),a.Kn.delete(e.target)}function kG(g,d,e){const a=j(g);let f=k.min(),c=q();return a.persistence.runTransaction("Execute query","readonly",g=>function(e,f,c){const a=j(e),d=a.Kn.get(c);return d!==void 0?b.resolve(a.qn.get(d)):a.He.getTargetData(f,c)}(a,g,ap(d)).next(b=>{if(b)return f=b.lastLimboFreeSnapshotVersion,a.He.getMatchingKeysForTargetId(g,b.targetId).next(a=>{c=a})}).next(()=>a.Un.getDocumentsMatchingQuery(g,d,e?f:k.min(),e?c:q())).next(a=>({documents:a,zn:c})))}async function ld(b){const a=j(b);return a.persistence.runTransaction("Synchronize last document change read time","readonly",a=>function(b){const c=aI(b);let a=k.min();return c.jt({index:u.readTimeIndex,reverse:!0},(d,b,c)=>{b.readTime&&(a=kT(b.readTime)),c.done()}).next(()=>a)}(a)).then(b=>{a.jn=b})}le=class{constructor(a){this.k=a,this.Xn=new Map,this.Zn=new Map}getBundleMetadata(c,a){return b.resolve(this.Xn.get(a))}saveBundleMetadata(d,c){var a;return this.Xn.set(c.id,{id:(a=c).id,version:a.version,createTime:_(a.createTime)}),b.resolve()}getNamedQuery(c,a){return b.resolve(this.Zn.get(a))}saveNamedQuery(c,a){return this.Zn.set(a.name,function(a){return{name:a.name,query:ka(a.bundledQuery),readTime:_(a.readTime)}}(a)),b.resolve()}},fq=class{constructor(){this.ts=new v(B.es),this.ns=new v(B.ss)}isEmpty(){return this.ts.isEmpty()}addReference(b,c){const a=new B(b,c);this.ts=this.ts.add(a),this.ns=this.ns.add(a)}rs(a,b){a.forEach(a=>this.addReference(a,b))}removeReference(a,b){this.os(new B(a,b))}cs(a,b){a.forEach(a=>this.removeReference(a,b))}us(a){const b=new f(new r([])),d=new B(b,a),e=new B(b,a+1),c=[];return this.ns.forEachInRange([d,e],a=>{this.os(a),c.push(a.key)}),c}hs(){this.ts.forEach(a=>this.os(a))}os(a){this.ts=this.ts.delete(a),this.ns=this.ns.delete(a)}ls(b){const c=new f(new r([])),d=new B(c,b),e=new B(c,b+1);let a=q();return this.ns.forEachInRange([d,e],b=>{a=a.add(b.key)}),a}containsKey(a){const c=new B(a,0),b=this.ts.firstAfterOrEqual(c);return b!==null&&a.isEqual(b.key)}},B=class{constructor(a,b){this.key=a,this.fs=b}static es(a,b){return f.comparator(a.key,b.key)||l(a.fs,b.fs)}static ss(a,b){return l(a.fs,b.fs)||f.comparator(a.key,b.key)}},lh=class{constructor(a,b){this.Jt=a,this.referenceDelegate=b,this.An=[],this.ds=1,this.ws=new v(B.es)}checkEmpty(a){return b.resolve(this.An.length===0)}addMutationBatch(e,f,g,a){const c=this.ds;this.ds++,this.An.length>0&&this.An[this.An.length-1];const d=new fD(c,f,g,a);this.An.push(d);for(const b of a)this.ws=this.ws.add(new B(b.key,c)),this.Jt.addToCollectionParentIndex(e,b.key.path.popLast());return b.resolve(d)}lookupMutationBatch(c,a){return b.resolve(this._s(a))}getNextMutationBatchAfterBatchId(f,d){const e=d+1,a=this.gs(e),c=a<0?0:a;return b.resolve(this.An.length>c?this.An[c]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.An.length===0?-1:this.ds-1)}getAllMutationBatches(a){return b.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(f,a){const d=new B(a,0),e=new B(a,Number.POSITIVE_INFINITY),c=[];return this.ws.forEachInRange([d,e],a=>{const b=this._s(a.fs);c.push(b)}),b.resolve(c)}getAllMutationBatchesAffectingDocumentKeys(d,c){let a=new v(l);return c.forEach(b=>{const c=new B(b,0),d=new B(b,Number.POSITIVE_INFINITY);this.ws.forEachInRange([c,d],b=>{a=a.add(b.fs)})}),b.resolve(this.ys(a))}getAllMutationBatchesAffectingQuery(i,e){const d=e.path,g=d.length+1;let a=d;f.isDocumentKey(a)||(a=a.child(""));const h=new B(new f(a),0);let c=new v(l);return this.ws.forEachWhile(a=>{const b=a.key.path;return!!d.isPrefixOf(b)&&(b.length===g&&(c=c.add(a.fs)),!0)},h),b.resolve(this.ys(c))}ys(b){const a=[];return b.forEach(c=>{const b=this._s(c);b!==null&&a.push(b)}),a}removeMutationBatch(d,a){i(this.ps(a.batchId,"removed")===0),this.An.shift();let c=this.ws;return b.forEach(a.mutations,b=>{const e=new B(b.key,a.batchId);return c=c.delete(e),this.referenceDelegate.markPotentiallyOrphaned(d,b.key)}).next(()=>{this.ws=c})}ee(a){}containsKey(e,a){const d=new B(a,0),c=this.ws.firstAfterOrEqual(d);return b.resolve(a.isEqual(c&&c.key))}performConsistencyCheck(a){return this.An.length,b.resolve()}ps(a,b){return this.gs(a)}gs(a){return this.An.length===0?0:a-this.An[0].batchId}_s(b){const a=this.gs(b);return a<0||a>=this.An.length?null:this.An[a]}},li=class{constructor(a,b){this.Jt=a,this.Ts=b,this.docs=new O(f.comparator),this.size=0}addEntry(g,a,e){const b=a.key,d=this.docs.get(b),f=d?d.size:0,c=this.Ts(a);return this.docs=this.docs.insert(b,{document:a.clone(),size:c,readTime:e}),this.size+=c-f,this.Jt.addToCollectionParentIndex(g,b.path.popLast())}removeEntry(a){const b=this.docs.get(a);b&&(this.docs=this.docs.remove(a),this.size-=b.size)}getEntry(d,a){const c=this.docs.get(a);return b.resolve(c?c.document.clone():w.newInvalidDocument(a))}getEntries(d,c){let a=ai();return c.forEach(b=>{const c=this.docs.get(b);a=a.insert(b,c?c.document.clone():w.newInvalidDocument(b))}),b.resolve(a)}getDocumentsMatchingQuery(h,a,e){let c=ai();const g=new f(a.path.child("")),d=this.docs.getIteratorFrom(g);for(;d.hasNext();){const{key:f,value:{document:b,readTime:g}}=d.getNext();if(!a.path.isPrefixOf(f.path))break;g.compareTo(e)<=0||bY(a,b)&&(c=c.insert(b.key,b.clone()))}return b.resolve(c)}Es(c,a){return b.forEach(this.docs,b=>a(b))}newChangeBuffer(a){return new lj(this)}getSize(a){return b.resolve(this.size)}},lj=class extends kE{constructor(a){super(),this.De=a}applyChanges(c){const a=[];return this.changes.forEach((b,d)=>{d.document.isValidDocument()?a.push(this.De.addEntry(c,d.document,this.getReadTime(b))):this.De.removeEntry(b)}),b.waitFor(a)}getFromCache(a,b){return this.De.getEntry(a,b)}getAllFromCache(a,b){return this.De.getEntries(a,b)}},lk=class{constructor(a){this.persistence=a,this.Is=new bB(a=>bN(a),dg),this.lastRemoteSnapshotVersion=k.min(),this.highestTargetId=0,this.As=0,this.Rs=new fq,this.targetCount=0,this.Ps=bl.ie()}forEachTarget(c,a){return this.Is.forEach((c,b)=>a(b)),b.resolve()}getLastRemoteSnapshotVersion(a){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(a){return b.resolve(this.As)}allocateTargetId(a){return this.highestTargetId=this.Ps.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(d,a,c){return c&&(this.lastRemoteSnapshotVersion=c),a>this.As&&(this.As=a),b.resolve()}ce(a){this.Is.set(a.target,a);const b=a.targetId;b>this.highestTargetId&&(this.Ps=new bl(b),this.highestTargetId=b),a.sequenceNumber>this.As&&(this.As=a.sequenceNumber)}addTargetData(c,a){return this.ce(a),this.targetCount+=1,b.resolve()}updateTargetData(c,a){return this.ce(a),b.resolve()}removeTargetData(c,a){return this.Is.delete(a.target),this.Rs.us(a.targetId),this.targetCount-=1,b.resolve()}removeTargets(d,e,f){let a=0;const c=[];return this.Is.forEach((g,b)=>{b.sequenceNumber<=e&&f.get(b.targetId)===null&&(this.Is.delete(g),c.push(this.removeMatchingKeysForTargetId(d,b.targetId)),a++)}),b.waitFor(c).next(()=>a)}getTargetCount(a){return b.resolve(this.targetCount)}getTargetData(d,a){const c=this.Is.get(a)||null;return b.resolve(c)}addMatchingKeys(d,a,c){return this.Rs.rs(a,c),b.resolve()}removeMatchingKeys(e,a,f){this.Rs.cs(a,f);const c=this.persistence.referenceDelegate,d=[];return c&&a.forEach(a=>{d.push(c.markPotentiallyOrphaned(e,a))}),b.waitFor(d)}removeMatchingKeysForTargetId(c,a){return this.Rs.us(a),b.resolve()}getMatchingKeysForTargetId(d,a){const c=this.Rs.ls(a);return b.resolve(c)}containsKey(c,a){return b.resolve(this.Rs.containsKey(a))}},ll=class{constructor(a,b){this.bs={},this.Be=new ac(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=a(this),this.He=new lk(this),this.Jt=new kR,this.Je=function(a,b){return new li(a,b)}(this.Jt,a=>this.referenceDelegate.vs(a)),this.k=new jS(b),this.Ye=new le(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(b){let a=this.bs[b.toKey()];return a||(a=new lh(this.Jt,this.referenceDelegate),this.bs[b.toKey()]=a),a}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(b,e,d){c("MemoryPersistence","Starting transaction:",b);const a=new lm(this.Be.next());return this.referenceDelegate.Vs(),d(a).next(b=>this.referenceDelegate.Ss(a).next(()=>b)).toPromise().then(b=>(a.raiseOnCommittedEvent(),b))}Ds(a,c){return b.or(Object.values(this.bs).map(b=>()=>b.containsKey(a,c)))}},lm=class extends jC{constructor(a){super(),this.currentSequenceNumber=a}},jh=class{constructor(a){this.persistence=a,this.Cs=new fq,this.Ns=null}static ks(a){return new jh(a)}get xs(){if(this.Ns)return this.Ns;throw g()}addReference(d,c,a){return this.Cs.addReference(a,c),this.xs.delete(a.toString()),b.resolve()}removeReference(d,c,a){return this.Cs.removeReference(a,c),this.xs.add(a.toString()),b.resolve()}markPotentiallyOrphaned(c,a){return this.xs.add(a.toString()),b.resolve()}removeTarget(b,a){this.Cs.us(a.targetId).forEach(a=>this.xs.add(a.toString()));const c=this.persistence.getTargetCache();return c.getMatchingKeysForTargetId(b,a.targetId).next(a=>{a.forEach(a=>this.xs.add(a.toString()))}).next(()=>c.removeTargetData(b,a))}Vs(){this.Ns=new Set}Ss(a){const c=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.xs,d=>{const b=f.fromPath(d);return this.$s(a,b).next(a=>{a||c.removeEntry(b)})}).next(()=>(this.Ns=null,c.apply(a)))}updateLimboDocument(b,a){return this.$s(b,a).next(b=>{b?this.xs.delete(a.toString()):this.xs.add(a.toString())})}vs(a){return 0}$s(c,a){return b.or([()=>b.resolve(this.Cs.containsKey(a)),()=>this.persistence.getTargetCache().containsKey(c,a),()=>this.persistence.Ds(c,a)])}},je=class{constructor(){this.activeTargetIds=io()}Ms(a){this.activeTargetIds=this.activeTargetIds.add(a)}Ls(a){this.activeTargetIds=this.activeTargetIds.delete(a)}Os(){const a={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(a)}},jd=class{constructor(){this.pi=new je,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(a){}updateMutationState(a,b,c){}addLocalQueryTarget(a){return this.pi.Ms(a),this.Ti[a]||"not-current"}updateQueryState(a,b,c){this.Ti[a]=b}removeLocalQueryTarget(a){this.pi.Ls(a)}isLocalQueryTarget(a){return this.pi.activeTargetIds.has(a)}clearQueryState(a){delete this.Ti[a]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(a){return this.pi.activeTargetIds.has(a)}start(){return this.pi=new je,Promise.resolve()}handleUserChange(a,b,c){}setOnlineState(a){}shutdown(){}writeSequenceNumber(a){}notifyBundleLoaded(){}},lq=class{Ei(a){}shutdown(){}},jc=class{constructor(){this.Ii=()=>this.Ai(),this.Ri=()=>this.Pi(),this.bi=[],this.vi()}Ei(a){this.bi.push(a)}shutdown(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}Ai(){c("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const a of this.bi)a(0)}Pi(){c("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const a of this.bi)a(1)}static bt(){return typeof window!="undefined"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}},ls={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},lt=class{constructor(a){this.Vi=a.Vi,this.Si=a.Si}Di(a){this.Ci=a}Ni(a){this.ki=a}onMessage(a){this.xi=a}close(){this.Si()}send(a){this.Vi(a)}$i(){this.Ci()}Fi(a){this.ki(a)}Oi(a){this.xi(a)}},lu=class extends class{constructor(a){this.databaseInfo=a,this.databaseId=a.databaseId;const b=a.ssl?"https":"http";this.Mi=b+"://"+a.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(a,f,b,g,h){const d=this.Ui(a,f);c("RestConnection","Sending: ",d,b);const e={};return this.qi(e,g,h),this.Ki(a,d,e,b).then(a=>(c("RestConnection","Received: ",a),a),c=>{throw fO("RestConnection",`${a} failed with error: `,c,"url: ",d,"request:",b),c})}ji(a,b,c,d,e){return this.Bi(a,b,c,d,e)}qi(a,b,c){a["X-Goog-Api-Client"]="gl-js/ fire/"+bj,a["Content-Type"]="text/plain",this.databaseInfo.appId&&(a["X-Firebase-GMPID"]=this.databaseInfo.appId),b&&b.headers.forEach((b,c)=>a[c]=b),c&&c.headers.forEach((b,c)=>a[c]=b)}Ui(a,b){const c=ls[a];return`${this.Mi}/v1/${b}:${c}`}}{constructor(a){super(a),this.forceLongPolling=a.forceLongPolling,this.autoDetectLongPolling=a.autoDetectLongPolling,this.useFetchStreams=a.useFetchStreams}Ki(b,e,f,h){return new Promise((k,j)=>{const i=new nr;i.listenOnce(ny.COMPLETE,()=>{try{switch(i.getLastErrorCode()){case fl.NO_ERROR:const e=i.getResponseJson();c("Connection","XHR received:",JSON.stringify(e)),k(e);break;case fl.TIMEOUT:c("Connection",'RPC "'+b+'" timed out'),j(new d(a.DEADLINE_EXCEEDED,"Request time out"));break;case fl.HTTP_ERROR:const f=i.getStatus();if(c("Connection",'RPC "'+b+'" failed with status:',f,"response text:",i.getResponseText()),f>0){const b=i.getResponseJson().error;if(b&&b.status&&b.message){const c=function(c){const b=c.toLowerCase().replace(/_/g,"-");return Object.values(a).indexOf(b)>=0?b:a.UNKNOWN}(b.status);j(new d(c,b.message))}else j(new d(a.UNKNOWN,"Server responded with status "+i.getStatus()))}else j(new d(a.UNAVAILABLE,"Connection failed."));break;default:g()}}finally{c("Connection",'RPC "'+b+'" completed.')}});const l=JSON.stringify(h);i.send(e,"POST",l,f,15)})}Qi(q,p,o){const n=[this.Mi,"/","google.firestore.v1.Firestore","/",q,"/channel"],m=nB(),l=nz(),g={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(g.xmlHttpFactory=new ns({})),this.qi(g.initMessageHeaders,p,o),rX()||rR()||rN()||rG()||rE()||rS()||(g.httpHeadersOverwriteParam="$httpHeaders");const j=n.join("");c("Connection","Creating WebChannel: "+j,g);const e=m.createWebChannel(j,g);let k=!1,b=!1;const f=new lt({Vi:a=>{b?c("Connection","Not sending because WebChannel is closed:",a):(k||(c("Connection","Opening WebChannel transport."),e.open(),k=!0),c("Connection","WebChannel sending:",a),e.send(a))},Si:()=>e.close()}),h=(a,b,c)=>{a.listen(b,a=>{try{c(a)}catch(a){setTimeout(()=>{throw a},0)}})};return h(e,dx.EventType.OPEN,()=>{b||c("Connection","WebChannel transport opened.")}),h(e,dx.EventType.CLOSE,()=>{b||(b=!0,c("Connection","WebChannel transport closed"),f.Fi())}),h(e,dx.EventType.ERROR,c=>{b||(b=!0,fO("Connection","WebChannel transport errored:",c),f.Fi(new d(a.UNAVAILABLE,"The operation could not be completed")))}),h(e,dx.EventType.MESSAGE,h=>{var g;if(!b){const k=h.data[0];i(!!k);const l=k,j=l.error||((g=l[0])===null||g===void 0?void 0:g.error);if(j){c("Connection","WebChannel received error:",j);const h=j.status;let g=function(b){const a=x[b];if(a!==void 0)return hZ(a)}(h),i=j.message;g===void 0&&(g=a.INTERNAL,i="Unknown error status: "+h+" with message "+j.message),b=!0,f.Fi(new d(g,i)),e.close()}else c("Connection","WebChannel received:",k),f.Oi(k)}}),h(l,nw.STAT_EVENT,a=>{a.stat===fU.PROXY?c("Connection","Detected buffering proxy"):a.stat===fU.NOPROXY&&c("Connection","Detected no buffering proxy")}),setTimeout(()=>{f.$i()},0),f}};function lv(){return typeof window!="undefined"?window:null}function di(){return typeof document!="undefined"?document:null}function df(a){return new lI(a,!0)}iW=class{constructor(a,b,c=1e3,d=1.5,e=6e4){this.Oe=a,this.timerId=b,this.Wi=c,this.Gi=d,this.zi=e,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(e){this.cancel();const b=Math.floor(this.Hi+this.tr()),d=Math.max(0,Date.now()-this.Yi),a=Math.max(0,b-d);a>0&&c("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.Hi} ms, delay with jitter: ${b} ms, last attempt: ${d} ms ago)`),this.Ji=this.Oe.enqueueAfterDelay(this.timerId,a,()=>(this.Yi=Date.now(),e())),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}er(){this.Ji!==null&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){this.Ji!==null&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}},iS=class{constructor(a,b,c,d,e,f,g,h){this.Oe=a,this.nr=c,this.sr=d,this.ir=e,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=g,this.listener=h,this.state=0,this.rr=0,this.ar=null,this.cr=null,this.stream=null,this.ur=new iW(a,b)}hr(){return this.state===1||this.state===5||this.lr()}lr(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.dr()}async stop(){this.hr()&&await this.close(0)}wr(){this.state=0,this.ur.reset()}_r(){this.lr()&&this.ar===null&&(this.ar=this.Oe.enqueueAfterDelay(this.nr,6e4,()=>this.mr()))}gr(a){this.yr(),this.stream.send(a)}async mr(){if(this.lr())return this.close(0)}yr(){this.ar&&(this.ar.cancel(),this.ar=null)}pr(){this.cr&&(this.cr.cancel(),this.cr=null)}async close(c,b){this.yr(),this.pr(),this.ur.cancel(),this.rr++,c!==4?this.ur.reset():b&&b.code===a.RESOURCE_EXHAUSTED?(W(b.toString()),W("Using maximum backoff delay to prevent overloading the backend."),this.ur.Xi()):b&&b.code===a.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Tr(),this.stream.close(),this.stream=null),this.state=c,await this.listener.Ni(b)}Tr(){}auth(){this.state=1;const b=this.Er(this.rr),c=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,b])=>{this.rr===c&&this.Ir(a,b)},c=>{b(()=>{const b=new d(a.UNKNOWN,"Fetching auth token failed: "+c.message);return this.Ar(b)})})}Ir(b,c){const a=this.Er(this.rr);this.stream=this.Rr(b,c),this.stream.Di(()=>{a(()=>(this.state=2,this.cr=this.Oe.enqueueAfterDelay(this.sr,1e4,()=>(this.lr()&&(this.state=3),Promise.resolve())),this.listener.Di()))}),this.stream.Ni(b=>{a(()=>this.Ar(b))}),this.stream.onMessage(b=>{a(()=>this.onMessage(b))})}dr(){this.state=5,this.ur.Zi(async()=>{this.state=0,this.start()})}Ar(a){return c("PersistentStream",`close with error: ${a}`),this.stream=null,this.close(4,a)}Er(a){return b=>{this.Oe.enqueueAndForget(()=>this.rr===a?b():(c("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},lA=class extends iS{constructor(a,b,c,d,e,f){super(a,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",b,c,d,f),this.k=e}Rr(a,b){return this.ir.Qi("Listen",a,b)}onMessage(a){this.ur.reset();const b=lF(this.k,a),c=function(b){if(!("targetChange"in b))return k.min();const a=b.targetChange;return a.targetIds&&a.targetIds.length?k.min():a.readTime?_(a.readTime):k.min()}(a);return this.listener.Pr(b,c)}br(b){const a={};a.database=e$(this.k),a.addTarget=function(c,a){let b;const d=a.target;return b=dh(d)?{documents:iT(c,d)}:{query:iU(c,d)},b.targetId=a.targetId,a.resumeToken.approximateByteSize()>0?b.resumeToken=iC(c,a.resumeToken):a.snapshotVersion.compareTo(k.min())>0&&(b.readTime=bI(c,a.snapshotVersion.toTimestamp())),b}(this.k,b);const c=ly(this.k,b);c&&(a.labels=c),this.gr(a)}vr(b){const a={};a.database=e$(this.k),a.removeTarget=b,this.gr(a)}},lB=class extends iS{constructor(a,b,c,d,e,f){super(a,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",b,c,d,f),this.k=e,this.Vr=!1}get Sr(){return this.Vr}start(){this.Vr=!1,this.lastStreamToken=void 0,super.start()}Tr(){this.Vr&&this.Dr([])}Rr(a,b){return this.ir.Qi("Write",a,b)}onMessage(a){if(i(!!a.streamToken),this.lastStreamToken=a.streamToken,this.Vr){this.ur.reset();const b=lz(a.writeResults,a.commitTime),c=_(a.commitTime);return this.listener.Cr(c,b)}return i(!a.writeResults||a.writeResults.length===0),this.Vr=!0,this.listener.Nr()}kr(){const a={};a.database=e$(this.k),this.gr(a)}Dr(a){const b={streamToken:this.lastStreamToken,writes:a.map(a=>ff(this.k,a))};this.gr(b)}},lC=class extends class{}{constructor(a,b,c,d){super(),this.authCredentials=a,this.appCheckCredentials=b,this.ir=c,this.k=d,this.$r=!1}Fr(){if(this.$r)throw new d(a.FAILED_PRECONDITION,"The client has already been terminated.")}Bi(b,c,e){return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,d])=>this.ir.Bi(b,c,e,a,d)).catch(b=>{throw b.name==="FirebaseError"?(b.code===a.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),b):new d(a.UNKNOWN,b.toString())})}ji(b,c,e){return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,d])=>this.ir.ji(b,c,e,a,d)).catch(b=>{throw b.name==="FirebaseError"?(b.code===a.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),b):new d(a.UNKNOWN,b.toString())})}terminate(){this.$r=!0}},lD=class{constructor(a,b){this.asyncQueue=a,this.onlineStateHandler=b,this.state="Unknown",this.Or=0,this.Mr=null,this.Lr=!0}Br(){this.Or===0&&(this.Ur("Unknown"),this.Mr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.Mr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve())))}Kr(a){this.state==="Online"?this.Ur("Unknown"):(this.Or++,this.Or>=1&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${a.toString()}`),this.Ur("Offline")))}set(a){this.jr(),this.Or=0,a==="Online"&&(this.Lr=!1),this.Ur(a)}Ur(a){a!==this.state&&(this.state=a,this.onlineStateHandler(a))}qr(b){const a=`Could not reach Cloud Firestore backend. ${b}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?(W(a),this.Lr=!1):c("OnlineStateTracker",a)}jr(){this.Mr!==null&&(this.Mr.cancel(),this.Mr=null)}},lE=class{constructor(b,d,a,e,f){this.localStore=b,this.datastore=d,this.asyncQueue=a,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=f,this.Hr.Ei(b=>{a.enqueueAndForget(async()=>{aR(this)&&(c("RemoteStore","Restarting streams for network reachability change."),await async function(b){const a=j(b);a.Gr.add(4),await bK(a),a.Jr.set("Unknown"),a.Gr.delete(4),await de(a)}(this))})}),this.Jr=new lD(a,e)}};async function de(a){if(aR(a))for(const b of a.zr)await b(!0)}async function bK(a){for(const b of a.zr)await b(!1)}function iD(c,b){const a=j(c);a.Wr.has(b.targetId)||(a.Wr.set(b.targetId,b),eQ(a)?eS(a):ba(a).lr()&&eX(a,b))}function iA(d,c){const a=j(d),b=ba(a);a.Wr.delete(c),b.lr()&&iy(a,c),a.Wr.size===0&&(b.lr()?b._r():aR(a)&&a.Jr.set("Unknown"))}function eX(a,b){a.Yr.X(b.targetId),ba(a).br(b)}function iy(a,b){a.Yr.X(b),ba(a).vr(b)}function eS(a){a.Yr=new lL({getRemoteKeysForTarget:b=>a.remoteSyncer.getRemoteKeysForTarget(b),Et:b=>a.Wr.get(b)||null}),ba(a).start(),a.Jr.Br()}function eQ(a){return aR(a)&&!ba(a).hr()&&a.Wr.size>0}function aR(a){return j(a).Gr.size===0}function ij(a){a.Yr=void 0}async function lP(a){a.Wr.forEach((b,c)=>{eX(a,b)})}async function lQ(a,b){ij(a),eQ(a)?(a.Jr.Kr(b),eS(a)):a.Jr.set("Unknown")}async function lR(b,a,d){if(b.Jr.set("Online"),a instanceof it&&a.state===2&&a.cause)try{await async function(a,b){const c=b.cause;for(const d of b.targetIds)a.Wr.has(d)&&(await a.remoteSyncer.rejectListen(d,c),a.Wr.delete(d),a.Yr.removeTarget(d))}(b,a)}catch(d){c("RemoteStore","Failed to remove targets %s: %s ",a.targetIds.join(","),d),await cI(b,d)}else if(a instanceof cS?b.Yr.ot(a):a instanceof is?b.Yr.dt(a):b.Yr.ut(a),!d.isEqual(k.min()))try{const a=await jA(b.localStore);d.compareTo(a)>=0&&await function(a,c){const b=a.Yr.gt(c);return b.targetChanges.forEach((b,d)=>{if(b.resumeToken.approximateByteSize()>0){const e=a.Wr.get(d);e&&a.Wr.set(d,e.withResumeToken(b.resumeToken,c))}}),b.targetMismatches.forEach(c=>{const b=a.Wr.get(c);if(!b)return;a.Wr.set(c,b.withResumeToken(K.EMPTY_BYTE_STRING,b.snapshotVersion)),iy(a,c);const d=new aX(b.target,c,1,b.sequenceNumber);eX(a,d)}),a.remoteSyncer.applyRemoteEvent(b)}(b,d)}catch(a){c("RemoteStore","Failed to raise snapshot:",a),await cI(b,a)}}async function cI(a,d,b){if(!aU(d))throw d;a.Gr.add(1),await bK(a),a.Jr.set("Offline"),b||(b=()=>jA(a.localStore)),a.asyncQueue.enqueueRetryable(async()=>{c("RemoteStore","Retrying IndexedDB access"),await b(),a.Gr.delete(1),await de(a)})}function ig(b,a){return a().catch(c=>cI(b,c,a))}async function cE(c){const a=j(c),d=ay(a);let b=a.Qr.length>0?a.Qr[a.Qr.length-1].batchId:-1;for(;lV(a);)try{const c=await k$(a.localStore,b);if(c===null){a.Qr.length===0&&d._r();break}b=c.batchId,lW(a,c)}catch(b){await cI(a,b)}hY(a)&&hV(a)}function lV(a){return aR(a)&&a.Qr.length<10}function lW(b,c){b.Qr.push(c);const a=ay(b);a.lr()&&a.Sr&&a.Dr(c.mutations)}function hY(a){return aR(a)&&!ay(a).hr()&&a.Qr.length>0}function hV(a){ay(a).start()}async function lZ(a){ay(a).kr()}async function l_(a){const b=ay(a);for(const c of a.Qr)b.Dr(c.mutations)}async function l$(a,b,c){const d=a.Qr.shift(),e=jQ.from(d,b,c);await ig(a,()=>a.remoteSyncer.applySuccessfulWrite(e)),await cE(a)}async function ma(b,c){c&&ay(b).Sr&&await async function(b,d){if(c=d.code,lX(c)&&c!==a.ABORTED){const a=b.Qr.shift();ay(b).wr(),await ig(b,()=>b.remoteSyncer.rejectFailedWrite(a.batchId,d)),await cE(b)}var c}(b,c),hY(b)&&hV(b)}async function mb(c,b){const a=j(c);b?(a.Gr.delete(2),await de(a)):b||(a.Gr.add(2),await bK(a),a.Jr.set("Unknown"))}function ba(a){return a.Xr||(a.Xr=function(b,c,d){const a=j(b);return a.Fr(),new lA(c,a.ir,a.authCredentials,a.appCheckCredentials,a.k,d)}(a.datastore,a.asyncQueue,{Di:lP.bind(null,a),Ni:lQ.bind(null,a),Pr:lR.bind(null,a)}),a.zr.push(async b=>{b?(a.Xr.wr(),eQ(a)?eS(a):a.Jr.set("Unknown")):(await a.Xr.stop(),ij(a))})),a.Xr}function ay(a){return a.Zr||(a.Zr=function(b,c,d){const a=j(b);return a.Fr(),new lB(c,a.ir,a.authCredentials,a.appCheckCredentials,a.k,d)}(a.datastore,a.asyncQueue,{Di:lZ.bind(null,a),Ni:ma.bind(null,a),Nr:l_.bind(null,a),Cr:l$.bind(null,a)}),a.zr.push(async b=>{b?(a.Zr.wr(),await cE(a)):(await a.Zr.stop(),a.Qr.length>0&&(c("RemoteStore",`Stopping write stream with ${a.Qr.length} pending writes`),a.Qr=[]))})),a.Zr}hF=class{constructor(a,b,c,d,e){this.asyncQueue=a,this.timerId=b,this.targetTimeMs=c,this.op=d,this.removalCallback=e,this.deferred=new an,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}static createAndSchedule(g,c,b,d,e){const f=Date.now()+b,a=new hF(g,c,f,d,e);return a.start(b),a}start(a){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),a)}skipDelay(){return this.handleDelayElapsed()}cancel(b){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new d(a.CANCELLED,"Operation cancelled"+(b?": "+b:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(a=>this.deferred.resolve(a))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function hE(b,c){if(W("AsyncQueue",`${c}: ${b}`),aU(b))return new d(a.UNAVAILABLE,`${c}: ${b}`);throw b}bU=class{constructor(a){this.comparator=a?(b,c)=>a(b,c)||f.comparator(b.key,c.key):(a,b)=>f.comparator(a.key,b.key),this.keyedMap=eJ(),this.sortedSet=new O(this.comparator)}static emptySet(a){return new bU(a.comparator)}has(a){return this.keyedMap.get(a)!=null}get(a){return this.keyedMap.get(a)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(b){const a=this.keyedMap.get(b);return a?this.sortedSet.indexOf(a):-1}get size(){return this.sortedSet.size}forEach(a){this.sortedSet.inorderTraversal((b,c)=>(a(b),!1))}add(a){const b=this.delete(a.key);return b.copy(b.keyedMap.insert(a.key,a),b.sortedSet.insert(a,null))}delete(a){const b=this.get(a);return b?this.copy(this.keyedMap.remove(a),this.sortedSet.remove(b)):this}isEqual(a){if(!(a instanceof bU))return!1;if(this.size!==a.size)return!1;const b=this.sortedSet.getIterator(),c=a.sortedSet.getIterator();for(;b.hasNext();){const a=b.getNext().key,d=c.getNext().key;if(!a.isEqual(d))return!1}return!0}toString(){const a=[];return this.forEach(b=>{a.push(b.toString())}),a.length===0?"DocumentSet ()":"DocumentSet (\n  "+a.join("  \n")+"\n)"}copy(b,c){const a=new bU;return a.comparator=this.comparator,a.keyedMap=b,a.sortedSet=c,a}},hu=class{constructor(){this.eo=new O(f.comparator)}track(a){const c=a.doc.key,b=this.eo.get(c);b?a.type!==0&&b.type===3?this.eo=this.eo.insert(c,a):a.type===3&&b.type!==1?this.eo=this.eo.insert(c,{type:b.type,doc:a.doc}):a.type===2&&b.type===2?this.eo=this.eo.insert(c,{type:2,doc:a.doc}):a.type===2&&b.type===0?this.eo=this.eo.insert(c,{type:0,doc:a.doc}):a.type===1&&b.type===0?this.eo=this.eo.remove(c):a.type===1&&b.type===2?this.eo=this.eo.insert(c,{type:1,doc:b.doc}):a.type===0&&b.type===1?this.eo=this.eo.insert(c,{type:2,doc:a.doc}):g():this.eo=this.eo.insert(c,a)}no(){const a=[];return this.eo.inorderTraversal((c,b)=>{a.push(b)}),a}},bV=class{constructor(a,b,c,d,e,f,g,h){this.query=a,this.docs=b,this.oldDocs=c,this.docChanges=d,this.mutatedKeys=e,this.fromCache=f,this.syncStateChanged=g,this.excludesMetadataChanges=h}static fromInitialDocuments(c,a,d,e){const b=[];return a.forEach(a=>{b.push({type:0,doc:a})}),new bV(c,a,bU.emptySet(a),b,d,e,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(a){if(!(this.fromCache===a.fromCache&&this.syncStateChanged===a.syncStateChanged&&this.mutatedKeys.isEqual(a.mutatedKeys)&&dA(this.query,a.query)&&this.docs.isEqual(a.docs)&&this.oldDocs.isEqual(a.oldDocs)))return!1;const b=this.docChanges,c=a.docChanges;if(b.length!==c.length)return!1;for(let a=0;a<b.length;a++)if(b[a].type!==c[a].type||!b[a].doc.isEqual(c[a].doc))return!1;return!0}},mj=class{constructor(){this.so=void 0,this.listeners=[]}},mk=class{constructor(){this.queries=new bB(a=>hk(a),dA),this.onlineState="Unknown",this.io=new Set}};async function ml(f,b){const c=j(f),d=b.query;let e=!1,a=c.queries.get(d);if(a||(e=!0,a=new mj),e)try{a.so=await c.onListen(d)}catch(a){const c=hE(a,`Initialization of query '${dY(b.query)}' failed`);return void b.onError(c)}c.queries.set(d,a),a.listeners.push(b),b.ro(c.onlineState),a.so&&b.oo(a.so)&&d_(c)}async function mm(f,d){const b=j(f),c=d.query;let e=!1;const a=b.queries.get(c);if(a){const b=a.listeners.indexOf(d);b>=0&&(a.listeners.splice(b,1),e=a.listeners.length===0)}if(e)return b.queries.delete(c),b.onUnlisten(c)}function mn(c,d){const a=j(c);let b=!1;for(const c of d){const f=c.query,e=a.queries.get(f);if(e){for(const a of e.listeners)a.oo(c)&&(b=!0);e.so=c}}b&&d_(a)}function mo(d,a,e){const b=j(d),c=b.queries.get(a);if(c)for(const a of c.listeners)a.onError(e);b.queries.delete(a)}function d_(a){a.io.forEach(a=>{a.next()})}mq=class{constructor(a,b,c){this.query=a,this.ao=b,this.co=!1,this.uo=null,this.onlineState="Unknown",this.options=c||{}}oo(a){if(!this.options.includeMetadataChanges){const b=[];for(const c of a.docChanges)c.type!==3&&b.push(c);a=new bV(a.query,a.docs,a.oldDocs,b,a.mutatedKeys,a.fromCache,a.syncStateChanged,!0)}let b=!1;return this.co?this.ho(a)&&(this.ao.next(a),b=!0):this.lo(a,this.onlineState)&&(this.fo(a),b=!0),this.uo=a,b}onError(a){this.ao.error(a)}ro(a){this.onlineState=a;let b=!1;return this.uo&&!this.co&&this.lo(this.uo,a)&&(this.fo(this.uo),b=!0),b}lo(a,b){if(!a.fromCache)return!0;const c=b!=="Offline";return(!this.options.wo||!c)&&(!a.docs.isEmpty()||b==="Offline")}ho(a){if(a.docChanges.length>0)return!0;const b=this.uo&&this.uo.hasPendingWrites!==a.hasPendingWrites;return!(!a.syncStateChanged&&!b)&&this.options.includeMetadataChanges===!0}fo(a){a=bV.fromInitialDocuments(a.query,a.docs,a.mutatedKeys,a.fromCache),this.co=!0,this.ao.next(a)}},ho=class{constructor(a){this.key=a}},hi=class{constructor(a){this.key=a}},mt=class{constructor(a,b){this.query=a,this.To=b,this.Eo=null,this.current=!1,this.Io=q(),this.mutatedKeys=q(),this.Ao=hn(a),this.Ro=new bU(this.Ao)}get Po(){return this.To}bo(i,c){const d=c?c.vo:new hu,e=c?c.Ro:this.Ro;let b=c?c.mutatedKeys:this.mutatedKeys,a=e,f=!1;const g=cF(this.query)&&e.size===this.query.limit?e.last():null,h=dP(this.query)&&e.size===this.query.limit?e.first():null;if(i.inorderTraversal((j,l)=>{const i=e.get(j),c=bY(this.query,l)?l:null,n=!!i&&this.mutatedKeys.has(i.key),m=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations);let k=!1;i&&c?i.data.isEqual(c.data)?n!==m&&(d.track({type:3,doc:c}),k=!0):this.Vo(i,c)||(d.track({type:2,doc:c}),k=!0,(g&&this.Ao(c,g)>0||h&&this.Ao(c,h)<0)&&(f=!0)):!i&&c?(d.track({type:0,doc:c}),k=!0):i&&!c&&(d.track({type:1,doc:i}),k=!0,(g||h)&&(f=!0)),k&&(c?(a=a.add(c),b=m?b.add(j):b.delete(j)):(a=a.delete(j),b=b.delete(j)))}),cF(this.query)||dP(this.query))for(;a.size>this.query.limit;){const c=cF(this.query)?a.last():a.first();a=a.delete(c.key),b=b.delete(c.key),d.track({type:1,doc:c})}return{Ro:a,vo:d,Bn:f,mutatedKeys:b}}Vo(b,a){return b.hasLocalMutations&&a.hasCommittedMutations&&!a.hasLocalMutations}applyChanges(a,i,f){const h=this.Ro;this.Ro=a.Ro,this.mutatedKeys=a.mutatedKeys;const b=a.vo.no();b.sort((a,b)=>function(b,c){const a=a=>{switch(a){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return g()}};return a(b)-a(c)}(a.type,b.type)||this.Ao(a.doc,b.doc)),this.So(f);const e=i?this.Do():[],c=this.Io.size===0&&this.current?1:0,d=c!==this.Eo;return this.Eo=c,b.length!==0||d?{snapshot:new bV(this.query,a.Ro,h,b,a.mutatedKeys,c===0,d,!1),Co:e}:{Co:e}}ro(a){return this.current&&a==="Offline"?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new hu,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}No(a){return!this.To.has(a)&&!!this.Ro.has(a)&&!this.Ro.get(a).hasLocalMutations}So(a){a&&(a.addedDocuments.forEach(a=>this.To=this.To.add(a)),a.modifiedDocuments.forEach(a=>{}),a.removedDocuments.forEach(a=>this.To=this.To.delete(a)),this.current=a.current)}Do(){if(!this.current)return[];const b=this.Io;this.Io=q(),this.Ro.forEach(a=>{this.No(a.key)&&(this.Io=this.Io.add(a.key))});const a=[];return b.forEach(b=>{this.Io.has(b)||a.push(new hi(b))}),this.Io.forEach(c=>{b.has(c)||a.push(new ho(c))}),a}ko(a){this.To=a.zn,this.Io=q();const b=this.bo(a.documents);return this.applyChanges(b,!0)}xo(){return bV.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,this.Eo===0)}},mu=class{constructor(a,b,c){this.query=a,this.targetId=b,this.view=c}},mv=class{constructor(a){this.key=a,this.$o=!1}},mw=class{constructor(a,b,c,d,e,g){this.localStore=a,this.remoteStore=b,this.eventManager=c,this.sharedClientState=d,this.currentUser=e,this.maxConcurrentLimboResolutions=g,this.Fo={},this.Oo=new bB(a=>hk(a),dA),this.Mo=new Map,this.Lo=new Set,this.Bo=new O(f.comparator),this.Uo=new Map,this.qo=new fq,this.Ko={},this.jo=new Map,this.Qo=bl.re(),this.onlineState="Unknown",this.Wo=void 0}get isPrimaryClient(){return this.Wo===!0}};async function mx(f,c){const a=mP(f);let b,d;const e=a.Oo.get(c);if(e)b=e.targetId,a.sharedClientState.addLocalQueryTarget(b),d=e.view.xo();else{const e=await la(a.localStore,ap(c)),f=a.sharedClientState.addLocalQueryTarget(e.targetId);b=e.targetId,d=await my(a,c,b,f==="current"),a.isPrimaryClient&&iD(a.remoteStore,e)}return d}async function my(a,b,c,g){a.Go=(b,c,d)=>async function(c,a,f,d){let b=a.view.bo(f);b.Bn&&(b=await kG(c.localStore,a.query,!1).then(({documents:c})=>a.view.bo(c,b)));const g=d&&d.targetChanges.get(a.targetId),e=a.view.applyChanges(b,c.isPrimaryClient,g);return gO(c,a.targetId,e.Co),e.snapshot}(a,b,c,d);const e=await kG(a.localStore,b,!0),d=new mt(b,e.zn),h=d.bo(e.documents),i=cR.createSynthesizedTargetChangeForCurrentChange(c,g&&a.onlineState!=="Offline"),f=d.applyChanges(h,a.isPrimaryClient,i);gO(a,c,f.Co);const j=new mu(b,c,d);return a.Oo.set(b,j),a.Mo.has(c)?a.Mo.get(c).push(b):a.Mo.set(c,[b]),f.snapshot}async function mz(e,c){const a=j(e),b=a.Oo.get(c),d=a.Mo.get(b.targetId);if(d.length>1)return a.Mo.set(b.targetId,d.filter(a=>!dA(a,c))),void a.Oo.delete(c);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(b.targetId),a.sharedClientState.isActiveQueryTarget(b.targetId)||await fr(a.localStore,b.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(b.targetId),iA(a.remoteStore,b.targetId),ea(a,b.targetId)}).catch(bo)):(ea(a,b.targetId),await fr(a.localStore,b.targetId,!0))}async function g$(c,a){const b=j(c);try{const c=await kZ(b.localStore,a);a.targetChanges.forEach((a,d)=>{const c=b.Uo.get(d);c&&(i(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1),a.addedDocuments.size>0?c.$o=!0:a.modifiedDocuments.size>0?i(c.$o):a.removedDocuments.size>0&&(i(c.$o),c.$o=!1))}),await dQ(b,c,a)}catch(a){await bo(a)}}function gX(d,b,c){const a=j(d);if(a.isPrimaryClient&&c===0||!a.isPrimaryClient&&c===1){const c=[];a.Oo.forEach((e,d)=>{const a=d.view.ro(b);a.snapshot&&c.push(a.snapshot)}),function(d,b){const a=j(d);a.onlineState=b;let c=!1;a.queries.forEach((d,a)=>{for(const d of a.listeners)d.ro(b)&&(c=!0)}),c&&d_(a)}(a.eventManager,b),c.length&&a.Fo.Pr(c),a.onlineState=b,a.isPrimaryClient&&a.sharedClientState.setOnlineState(b)}}async function mC(g,b,d){const a=j(g);a.sharedClientState.updateQueryState(b,"rejected",d);const e=a.Uo.get(b),c=e&&e.key;if(c){let d=new O(f.comparator);d=d.insert(c,w.newNoDocument(c,k.min()));const e=q().add(c),g=new eR(k.min(),new Map,new v(l),d,e);await g$(a,g),a.Bo=a.Bo.remove(c),a.Uo.delete(b),ec(a)}else await fr(a.localStore,b,!1).then(()=>ea(a,b,d)).catch(bo)}async function mD(d,c){const a=j(d),b=c.batch.batchId;try{const d=await kX(a.localStore,c);gS(a,b,null),gT(a,b),a.sharedClientState.updateMutationState(b,"acknowledged"),await dQ(a,d)}catch(a){await bo(a)}}async function mE(d,b,c){const a=j(d);try{const d=await function(b,c){const a=j(b);return a.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let d;return a.An.lookupMutationBatch(b,c).next(c=>(i(c!==null),d=c.keys(),a.An.removeMutationBatch(b,c))).next(()=>a.An.performConsistencyCheck(b)).next(()=>a.Wn.vn(b,d))})}(a.localStore,b);gS(a,b,c),gT(a,b),a.sharedClientState.updateMutationState(b,"rejected",c),await dQ(a,d)}catch(a){await bo(a)}}function gT(a,b){(a.jo.get(b)||[]).forEach(a=>{a.resolve()}),a.jo.delete(b)}function gS(e,c,d){const b=j(e);let a=b.Ko[b.currentUser.toKey()];if(a){const e=a.get(c);e&&(d?e.reject(d):e.resolve(),a=a.remove(c)),b.Ko[b.currentUser.toKey()]=a}}function ea(a,b,c=null){a.sharedClientState.removeLocalQueryTarget(b);for(const d of a.Mo.get(b))a.Oo.delete(d),c&&a.Fo.zo(d,c);a.Mo.delete(b),a.isPrimaryClient&&a.qo.us(b).forEach(b=>{a.qo.containsKey(b)||gQ(a,b)})}function gQ(a,b){a.Lo.delete(b.path.canonicalString());const c=a.Bo.get(b);c!==null&&(iA(a.remoteStore,c),a.Bo=a.Bo.remove(b),a.Uo.delete(c),ec(a))}function gO(a,b,d){for(const e of d)e instanceof ho?(a.qo.addReference(e.key,b),mK(a,e)):e instanceof hi?(c("SyncEngine","Document no longer in limbo: "+e.key),a.qo.removeReference(e.key,b),a.qo.containsKey(e.key)||gQ(a,e.key)):g()}function mK(a,e){const b=e.key,d=b.path.canonicalString();a.Bo.get(b)||a.Lo.has(d)||(c("SyncEngine","New document in limbo: "+b),a.Lo.add(d),ec(a))}function ec(a){for(;a.Lo.size>0&&a.Bo.size<a.maxConcurrentLimboResolutions;){const d=a.Lo.values().next().value;a.Lo.delete(d);const b=new f(r.fromString(d)),c=a.Qo.next();a.Uo.set(c,new mv(b)),a.Bo=a.Bo.insert(b,c),iD(a.remoteStore,new aX(ap(dU(b.path)),c,2,ac.I))}}async function dQ(i,g,h){const a=j(i),e=[],f=[],d=[];a.Oo.isEmpty()||(a.Oo.forEach((c,b)=>{d.push(a.Go(b,g,h).then(c=>{if(c){a.isPrimaryClient&&a.sharedClientState.updateQueryState(b.targetId,c.fromCache?"not-current":"current"),e.push(c);const d=kb.$n(b.targetId,c);f.push(d)}}))}),await Promise.all(d),a.Fo.Pr(e),await async function(e,d){const a=j(e);try{await a.persistence.runTransaction("notifyLocalViewChanges","readwrite",c=>b.forEach(d,d=>b.forEach(d.kn,b=>a.persistence.referenceDelegate.addReference(c,d.targetId,b)).next(()=>b.forEach(d.xn,b=>a.persistence.referenceDelegate.removeReference(c,d.targetId,b)))))}catch(a){if(!aU(a))throw a;c("LocalStore","Failed to update sequence numbers: "+a)}for(const b of d){const c=b.targetId;if(!b.fromCache){const b=a.qn.get(c),d=b.snapshotVersion,e=b.withLastLimboFreeSnapshotVersion(d);a.qn=a.qn.insert(c,e)}}}(a.localStore,f))}async function mN(f,e){const b=j(f);if(!b.currentUser.isEqual(e)){c("SyncEngine","User change. New user:",e.toKey());const f=await jG(b.localStore,e);b.currentUser=e,function(b,c){b.jo.forEach(b=>{b.forEach(b=>{b.reject(new d(a.CANCELLED,c))})}),b.jo.clear()}(b,"'waitForPendingWrites' promise is rejected due to a user change."),b.sharedClientState.handleUserChange(e,f.removedBatchIds,f.addedBatchIds),await dQ(b,f.Gn)}}function mO(d,c){const a=j(d),b=a.Uo.get(c);if(b&&b.$o)return q().add(b.key);{let b=q();const d=a.Mo.get(c);if(!d)return b;for(const c of d){const e=a.Oo.get(c);b=b.unionWith(e.view.Po)}return b}}function mP(b){const a=j(b);return a.remoteStore.remoteSyncer.applyRemoteEvent=g$.bind(null,a),a.remoteStore.remoteSyncer.getRemoteKeysForTarget=mO.bind(null,a),a.remoteStore.remoteSyncer.rejectListen=mC.bind(null,a),a.Fo.Pr=mn.bind(null,a.eventManager),a.Fo.zo=mo.bind(null,a.eventManager),a}function mQ(b){const a=j(b);return a.remoteStore.remoteSyncer.applySuccessfulWrite=mD.bind(null,a),a.remoteStore.remoteSyncer.rejectFailedWrite=mE.bind(null,a),a}gL=class{constructor(){this.synchronizeTabs=!1}async initialize(a){this.k=df(a.databaseInfo.databaseId),this.sharedClientState=this.Jo(a),this.persistence=this.Yo(a),await this.persistence.start(),this.gcScheduler=this.Xo(a),this.localStore=this.Zo(a)}Xo(a){return null}Zo(a){return jJ(this.persistence,new jW,a.initialUser,this.k)}Yo(a){return new ll(jh.ks,this.k)}Jo(a){return new jd}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}},mS=class extends gL{constructor(a,b,c){super(),this.ta=a,this.cacheSizeBytes=b,this.forceOwnership=c,this.synchronizeTabs=!1}async initialize(a){await super.initialize(a),await ld(this.localStore),await this.ta.initialize(this,a),await mQ(this.ta.syncEngine),await cE(this.ta.remoteStore),await this.persistence.sn(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve()))}Zo(a){return jJ(this.persistence,new jW,a.initialUser,this.k)}Xo(a){const b=this.persistence.referenceDelegate.garbageCollector;return new kM(b,a.asyncQueue)}Yo(a){const b=kQ(a.databaseInfo.databaseId,a.databaseInfo.persistenceKey),c=this.cacheSizeBytes!==void 0?Y.withCacheSize(this.cacheSizeBytes):Y.DEFAULT;return new ky(this.synchronizeTabs,b,a.clientId,c,a.asyncQueue,lv(),di(),this.k,this.sharedClientState,!!this.forceOwnership)}Jo(a){return new jd}},gH=class{async initialize(b,a){this.localStore||(this.localStore=b.localStore,this.sharedClientState=b.sharedClientState,this.datastore=this.createDatastore(a),this.remoteStore=this.createRemoteStore(a),this.eventManager=this.createEventManager(a),this.syncEngine=this.createSyncEngine(a,!b.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>gX(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=mN.bind(null,this.syncEngine),await mb(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(a){return new mk}createDatastore(a){const c=df(a.databaseInfo.databaseId),d=(b=a.databaseInfo,new lu(b));var b;return function(a,b,c,d){return new lC(a,b,c,d)}(a.authCredentials,a.appCheckCredentials,d,c)}createRemoteStore(f){return a=this.localStore,b=this.datastore,c=f.asyncQueue,d=a=>gX(this.syncEngine,a,0),e=jc.bt()?new jc:new lq,new lE(a,b,c,d,e);var a,b,c,d,e}createSyncEngine(a,b){return function(b,h,c,d,e,f,g){const a=new mw(b,h,c,d,e,f);return g&&(a.Wo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,a.initialUser,a.maxConcurrentLimboResolutions,b)}terminate(){return async function(b){const a=j(b);c("RemoteStore","RemoteStore shutting down."),a.Gr.add(5),await bK(a),a.Hr.shutdown(),a.Jr.set("Unknown")}(this.remoteStore)}},mU=class{constructor(a){this.observer=a,this.muted=!1}next(a){this.observer.next&&this.ea(this.observer.next,a)}error(a){this.observer.error?this.ea(this.observer.error,a):console.error("Uncaught Error in snapshot listener:",a)}na(){this.muted=!0}ea(a,b){this.muted||setTimeout(()=>{this.muted||a(b)},0)}},mV=class{constructor(b,d,a,e){this.authCredentials=b,this.appCheckCredentials=d,this.asyncQueue=a,this.databaseInfo=e,this.user=T.UNAUTHENTICATED,this.clientId=nf.A(),this.authCredentialListener=()=>Promise.resolve(),this.authCredentials.start(a,async a=>{c("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(a,()=>Promise.resolve())}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(a){this.authCredentialListener=a}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new d(a.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const a=new an;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),a.resolve()}catch(b){const c=hE(b,"Failed to shutdown persistence");a.reject(c)}}),a.promise}};async function gE(a,b){a.asyncQueue.verifyOperationInProgress(),c("FirestoreClient","Initializing OfflineComponentProvider");const d=await a.getConfiguration();await b.initialize(d);let e=d.initialUser;a.setCredentialChangeListener(async a=>{e.isEqual(a)||(await jG(b.localStore,a),e=a)}),b.persistence.setDatabaseDeletedListener(()=>a.terminate()),a.offlineComponents=b}async function gd(a,b){a.asyncQueue.verifyOperationInProgress();const d=await mY(a);c("FirestoreClient","Initializing OnlineComponentProvider");const e=await a.getConfiguration();await b.initialize(d,e),a.setCredentialChangeListener(a=>async function(b,d){const a=j(b);a.asyncQueue.verifyOperationInProgress(),c("RemoteStore","RemoteStore received new credentials");const e=aR(a);a.Gr.add(3),await bK(a),e&&a.Jr.set("Unknown"),await a.remoteSyncer.handleCredentialChange(d),a.Gr.delete(3),await de(a)}(b.remoteStore,a)),a.onlineComponents=b}async function mY(a){return a.offlineComponents||(c("FirestoreClient","Using default OfflineComponentProvider"),await gE(a,new gL)),a.offlineComponents}async function mZ(a){return a.onlineComponents||(c("FirestoreClient","Using default OnlineComponentProvider"),await gd(a,new gH)),a.onlineComponents}async function m_(c){const a=await mZ(c),b=a.eventManager;return b.onListen=mx.bind(null,a.syncEngine),b.onUnlisten=mz.bind(null,a.syncEngine),b}function m$(b,e,f={}){const c=new an;return b.asyncQueue.enqueueAndForget(async()=>function(c,f,g,h,b){const i=new mU({next:g=>{f.enqueueAndForget(()=>mm(c,e)),g.fromCache&&h.source==="server"?b.reject(new d(a.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(g)},error:a=>b.reject(a)}),e=new mq(g,i,{includeMetadataChanges:!0,wo:!0});return ml(c,e)}(await m_(b),b.asyncQueue,e,f,c)),c.promise}na=class{constructor(a,b,c,d,e,f,g,h){this.databaseId=a,this.appId=b,this.persistenceKey=c,this.host=d,this.ssl=e,this.forceLongPolling=f,this.autoDetectLongPolling=g,this.useFetchStreams=h}},c_=class{constructor(a,b){this.projectId=a,this.database=b||"(default)"}get isDefaultDatabase(){return this.database==="(default)"}isEqual(a){return a instanceof c_&&a.projectId===this.projectId&&a.database===this.database}},f$=new Map;function nd(b,c,e){if(!e)throw new d(a.INVALID_ARGUMENT,`Function ${b}() cannot be called with an empty ${c}.`)}function ne(b,c,e,f){if(c===!0&&f===!0)throw new d(a.INVALID_ARGUMENT,`${b} and ${e} cannot be used together.`)}function fQ(b){if(f.isDocumentKey(b))throw new d(a.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${b} has ${b.length}.`)}function dy(a){if(a===void 0)return"undefined";if(a===null)return"null";if(typeof a=="string")return a.length>20&&(a=`${a.substring(0,20)}...`),JSON.stringify(a);if(typeof a=="number"||typeof a=="boolean")return""+a;if(typeof a=="object"){if(a instanceof Array)return"an array";{const b=function(a){return a.constructor?a.constructor.name:null}(a);return b?`a custom ${b} object`:"an object"}}return typeof a=="function"?"a function":g()}function fn(b,c){if("_delegate"in b&&(b=b._delegate),!(b instanceof c)){if(c.name===b.constructor.name)throw new d(a.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=dy(b);throw new d(a.INVALID_ARGUMENT,`Expected type '${c.name}', but it was: ${e}`)}}return b}fN=class{constructor(b){var c;if(b.host===void 0){if(b.ssl!==void 0)throw new d(a.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=b.host,this.ssl=(c=b.ssl)===null||c===void 0||c;if(this.credentials=b.credentials,this.ignoreUndefinedProperties=!!b.ignoreUndefinedProperties,b.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(b.cacheSizeBytes!==-1&&b.cacheSizeBytes<1048576)throw new d(a.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=b.cacheSizeBytes}this.experimentalForceLongPolling=!!b.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!b.experimentalAutoDetectLongPolling,this.useFetchStreams=!!b.useFetchStreams,ne("experimentalForceLongPolling",b.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",b.experimentalAutoDetectLongPolling)}isEqual(a){return this.host===a.host&&this.ssl===a.ssl&&this.credentials===a.credentials&&this.cacheSizeBytes===a.cacheSizeBytes&&this.experimentalForceLongPolling===a.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===a.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===a.ignoreUndefinedProperties&&this.useFetchStreams===a.useFetchStreams}},j$=class{constructor(b,c,e){this._authCredentials=c,this._appCheckCredentials=e,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new fN({}),this._settingsFrozen=!1,b instanceof c_?this._databaseId=b:(this._app=b,this._databaseId=function(b){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new d(a.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new c_(b.options.projectId)}(b))}get app(){if(!this._app)throw new d(a.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(b){if(this._settingsFrozen)throw new d(a.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new fN(b),b.credentials!==void 0&&(this._authCredentials=function(b){if(!b)return new nm;switch(b.type){case"gapi":const c=b.client;return i(!(typeof c!="object"||c===null||!c.auth||!c.auth.getAuthHeaderValueForFirstParty)),new nj(c,b.sessionIndex||"0",b.iamToken||null);case"provider":return b.client;default:throw new d(a.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(b.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(a){const b=f$.get(a);b&&(c("ComponentProvider","Removing Datastore"),f$.delete(a),b.terminate())}(this),Promise.resolve()}},aD=class{constructor(a,b,c){this.converter=b,this._key=c,this.type="document",this.firestore=a}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new cp(this.firestore,this.converter,this._key.path.popLast())}withConverter(a){return new aD(this.firestore,a,this._key)}},dI=class{constructor(a,b,c){this.converter=b,this._query=c,this.type="query",this.firestore=a}withConverter(a){return new dI(this.firestore,a,this._query)}},cp=class extends dI{constructor(b,c,a){super(b,c,dU(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const a=this._path.popLast();return a.isEmpty()?null:new aD(this.firestore,null,new f(a))}withConverter(a){return new cp(this.firestore,a,this._path)}};function nn(b,c,...e){if(b=cx(b),nd("collection","path",c),b instanceof j$){const a=r.fromString(c,...e);return fQ(a),new cp(b,null,a)}{if(!(b instanceof aD||b instanceof cp))throw new d(a.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const f=b._path.child(r.fromString(c,...e));return fQ(f),new cp(b.firestore,null,f)}}no=class{constructor(){this.ma=Promise.resolve(),this.ga=[],this.ya=!1,this.pa=[],this.Ta=null,this.Ea=!1,this.Ia=!1,this.Aa=[],this.ur=new iW(this,"async_queue_retry"),this.Ra=()=>{const a=di();a&&c("AsyncQueue","Visibility state changed to "+a.visibilityState),this.ur.er()};const a=di();a&&typeof a.addEventListener=="function"&&a.addEventListener("visibilitychange",this.Ra)}get isShuttingDown(){return this.ya}enqueueAndForget(a){this.enqueue(a)}enqueueAndForgetEvenWhileRestricted(a){this.Pa(),this.ba(a)}enterRestrictedMode(a){if(!this.ya){this.ya=!0,this.Ia=a||!1;const b=di();b&&typeof b.removeEventListener=="function"&&b.removeEventListener("visibilitychange",this.Ra)}}enqueue(b){if(this.Pa(),this.ya)return new Promise(()=>{});const a=new an;return this.ba(()=>this.ya&&this.Ia?Promise.resolve():(b().then(a.resolve,a.reject),a.promise)).then(()=>a.promise)}enqueueRetryable(a){this.enqueueAndForget(()=>(this.ga.push(a),this.va()))}async va(){if(this.ga.length!==0){try{await this.ga[0](),this.ga.shift(),this.ur.reset()}catch(a){if(!aU(a))throw a;c("AsyncQueue","Operation failed with retryable error: "+a)}this.ga.length>0&&this.ur.Zi(()=>this.va())}}ba(b){const a=this.ma.then(()=>(this.Ea=!0,b().catch(a=>{this.Ta=a,this.Ea=!1;const b=function(a){let b=a.message||"";return a.stack&&(b=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),b}(a);throw W("INTERNAL UNHANDLED ERROR: ",b),a}).then(a=>(this.Ea=!1,a))));return this.ma=a,a}enqueueAfterDelay(a,b,d){this.Pa(),this.Aa.indexOf(a)>-1&&(b=0);const c=hF.createAndSchedule(this,a,b,d,a=>this.Va(a));return this.pa.push(c),c}Pa(){this.Ta&&g()}verifyOperationInProgress(){}async Sa(){let a;do a=this.ma,await a;while(a!==this.ma)}Da(a){for(const b of this.pa)if(b.timerId===a)return!0;return!1}Ca(a){return this.Sa().then(()=>{this.pa.sort((a,b)=>a.targetTimeMs-b.targetTimeMs);for(const b of this.pa)if(b.skipDelay(),a!=="all"&&b.timerId===a)break;return this.Sa()})}Na(a){this.Aa.push(a)}Va(a){const b=this.pa.indexOf(a);this.pa.splice(b,1)}},fH=class extends j${constructor(a,b,c){super(a,b,c),this.type="firestore",this._queue=new no,this._persistenceKey="name"in a?a.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||fS(this),this._firestoreClient.terminate()}};function nq(a=po()){return pu(a,"firestore").getImmediate()}function fR(a){return a._firestoreClient||fS(a),a._firestoreClient.verifyNotTerminated(),a._firestoreClient}function fS(a){var b;const c=a._freezeSettings(),d=function(b,c,d,a){return new na(b,c,d,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams)}(a._databaseId,((b=a._app)===null||b===void 0?void 0:b.options.appId)||"",a._persistenceKey,c);a._firestoreClient=new mV(a._authCredentials,a._appCheckCredentials,a._queue,d)}function nt(a,b){nv(a=fn(a,fH));const d=fR(a),e=a._freezeSettings(),c=new gH;return nu(d,c,new mS(c,e.cacheSizeBytes,b==null?void 0:b.forceOwnership))}function nu(b,d,e){const c=new an;return b.asyncQueue.enqueue(async()=>{try{await gE(b,e),await gd(b,d),c.resolve()}catch(b){if(!function(b){return b.name==="FirebaseError"?b.code===a.FAILED_PRECONDITION||b.code===a.UNIMPLEMENTED:!(typeof DOMException!="undefined"&&b instanceof DOMException)||b.code===22||b.code===20||b.code===11}(b))throw b;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+b),c.reject(b)}}).then(()=>c.promise)}function nv(b){if(b._initialized||b._terminated)throw new d(a.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}fV=class{constructor(...b){for(let c=0;c<b.length;++c)if(b[c].length===0)throw new d(a.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new R(b)}isEqual(a){return this._internalPath.isEqual(a._internalPath)}},bJ=class{constructor(a){this._byteString=a}static fromBase64String(b){try{return new bJ(K.fromBase64String(b))}catch(b){throw new d(a.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+b)}}static fromUint8Array(a){return new bJ(K.fromUint8Array(a))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(a){return this._byteString.isEqual(a._byteString)}},fX=class{constructor(a){this._methodName=a}},fk=class{constructor(b,c){if(!isFinite(b)||b<-90||b>90)throw new d(a.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+b);if(!isFinite(c)||c<-180||c>180)throw new d(a.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+c);this._lat=b,this._long=c}get latitude(){return this._lat}get longitude(){return this._long}isEqual(a){return this._lat===a._lat&&this._long===a._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(a){return l(this._lat,a._lat)||l(this._long,a._long)}},nA=/^__.*__$/;function fZ(a){switch(a){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw g()}}go=class{constructor(b,c,d,e,a,f){this.settings=b,this.databaseId=c,this.k=d,this.ignoreUndefinedProperties=e,a===void 0&&this.ka(),this.fieldTransforms=a||[],this.fieldMask=f||[]}get path(){return this.settings.path}get xa(){return this.settings.xa}$a(a){return new go(Object.assign(Object.assign({},this.settings),a),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Fa(b){var a;const d=(a=this.path)===null||a===void 0?void 0:a.child(b),c=this.$a({path:d,Oa:!1});return c.Ma(b),c}La(c){var a;const d=(a=this.path)===null||a===void 0?void 0:a.child(c),b=this.$a({path:d,Oa:!1});return b.ka(),b}Ba(a){return this.$a({path:void 0,Oa:!0})}Ua(a){return ey(a,this.settings.methodName,this.settings.qa||!1,this.path,this.settings.Ka)}contains(a){return this.fieldMask.find(b=>a.isPrefixOf(b))!==void 0||this.fieldTransforms.find(b=>a.isPrefixOf(b.field))!==void 0}ka(){if(this.path)for(let a=0;a<this.path.length;a++)this.Ma(this.path.get(a))}Ma(a){if(a.length===0)throw this.Ua("Document fields must not be empty");if(fZ(this.xa)&&nA.test(a))throw this.Ua('Document fields cannot begin and end with "__"')}},nD=class{constructor(a,b,c){this.databaseId=a,this.ignoreUndefinedProperties=b,this.k=c||df(a)}ja(a,b,c,d=!1){return new go({xa:a,methodName:b,Ka:c,path:R.emptyPath(),Oa:!1,qa:d},this.databaseId,this.k,this.ignoreUndefinedProperties)}};function nE(a){const b=a._freezeSettings(),c=df(a._databaseId);return new nD(a._databaseId,!!b.ignoreUndefinedProperties,c)}function nF(a,b,c,d=!1){return eH(c,a.ja(d?4:3,b))}function eH(b,a){if(gA(b=cx(b)))return nJ("Unsupported field value:",a,b),nH(b,a);if(b instanceof fX)return function(b,a){if(!fZ(a.xa))throw a.Ua(`${b._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Ua(`${b._methodName}() is not currently supported inside arrays`);const c=b._toFieldTransform(a);c&&a.fieldTransforms.push(c)}(b,a),null;if(b===void 0&&a.ignoreUndefinedProperties)return null;if(a.path&&a.fieldMask.push(a.path),b instanceof Array){if(a.settings.Oa&&a.xa!==4)throw a.Ua("Nested arrays are not supported");return function(c,d){const a=[];let b=0;for(const f of c){let e=eH(f,d.Ba(b));e==null&&(e={nullValue:"NULL_VALUE"}),a.push(e),b++}return{arrayValue:{values:a}}}(b,a)}return function(a,b){if((a=cx(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return mp(b.k,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const c=M.fromDate(a);return{timestampValue:bI(b.k,c)}}if(a instanceof M){const c=new M(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:bI(b.k,c)}}if(a instanceof fk)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof bJ)return{bytesValue:iC(b.k,a._byteString)};if(a instanceof aD){const c=b.databaseId,d=a.firestore._databaseId;if(!d.isEqual(c))throw b.Ua(`Document reference is for database ${d.projectId}/${d.database} but should be for database ${c.projectId}/${c.database}`);return{referenceValue:eY(a.firestore._databaseId||b.databaseId,a._key.path)}}throw b.Ua(`Unsupported field value: ${dy(a)}`)}(b,a)}function nH(b,a){const c={};return fY(b)?a.path&&a.path.length>0&&a.fieldMask.push(a.path):bD(b,(b,e)=>{const d=eH(e,a.Fa(b));d!=null&&(c[b]=d)}),{mapValue:{fields:c}}}function gA(a){return!(typeof a!="object"||a===null||a instanceof Array||a instanceof Date||a instanceof M||a instanceof fk||a instanceof bJ||a instanceof aD||a instanceof fX)}function nJ(b,c,a){if(!gA(a)||!function(a){return typeof a=="object"&&a!==null&&(Object.getPrototypeOf(a)===Object.prototype||Object.getPrototypeOf(a)===null)}(a)){const d=dy(a);throw d==="an object"?c.Ua(b+" a custom object"):c.Ua(b+" "+d)}}nK=new RegExp("[~\\*/\\[\\]]");function nL(b,a,c){if(a.search(nK)>=0)throw ey(`Invalid field path (${a}). Paths must not contain '~', '*', '/', '[', or ']'`,b,!1,void 0,c);try{return new fV(...a.split("."))._internalPath}catch(d){throw ey(`Invalid field path (${a}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,b,!1,void 0,c)}}function ey(i,j,k,e,g){const h=e&&!e.isEmpty(),f=g!==void 0;let c=`Function ${j}() called with invalid data`;k&&(c+=" (via `toFirestore()`)"),c+=". ";let b="";return(h||f)&&(b+=" (found",h&&(b+=` in field ${e}`),f&&(b+=` in document ${g}`),b+=")"),new d(a.INVALID_ARGUMENT,c+i+b)}gB=class{constructor(a,b,c,d,e){this._firestore=a,this._userDataWriter=b,this._key=c,this._document=d,this._converter=e}get id(){return this._key.path.lastSegment()}get ref(){return new aD(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const a=new nO(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(a)}return this._userDataWriter.convertValue(this._document.data.value)}}get(a){if(this._document){const b=this._document.data.field(ew("DocumentSnapshot.get",a));if(b!==null)return this._userDataWriter.convertValue(b)}}},nO=class extends gB{data(){return super.data()}};function ew(b,a){return typeof a=="string"?nL(b,a):a instanceof fV?a._internalPath:a._delegate._internalPath}cA=class{constructor(a,b){this.hasPendingWrites=a,this.fromCache=b}isEqual(a){return this.hasPendingWrites===a.hasPendingWrites&&this.fromCache===a.fromCache}},nR=class extends gB{constructor(a,b,c,d,e,f){super(a,b,c,d,f),this._firestore=a,this._firestoreImpl=a,this.metadata=e}exists(){return super.exists()}data(a={}){if(this._document){if(this._converter){const b=new db(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(b,a)}return this._userDataWriter.convertValue(this._document.data.value,a.serverTimestamps)}}get(a,b={}){if(this._document){const c=this._document.data.field(ew("DocumentSnapshot.get",a));if(c!==null)return this._userDataWriter.convertValue(c,b.serverTimestamps)}}},db=class extends nR{data(a={}){return super.data(a)}},nT=class{constructor(b,c,d,a){this._firestore=b,this._userDataWriter=c,this._snapshot=a,this.metadata=new cA(a.hasPendingWrites,a.fromCache),this.query=d}get docs(){const a=[];return this.forEach(b=>a.push(b)),a}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(a,b){this._snapshot.docs.forEach(c=>{a.call(b,new db(this._firestore,this._userDataWriter,c.key,c,new cA(this._snapshot.mutatedKeys.has(c.key),this._snapshot.fromCache),this.query.converter))})}docChanges(c={}){const b=!!c.includeMetadataChanges;if(b&&this._snapshot.excludesMetadataChanges)throw new d(a.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===b||(this._cachedChanges=function(a,b){if(a._snapshot.oldDocs.isEmpty()){let b=0;return a._snapshot.docChanges.map(c=>({type:"added",doc:new db(a._firestore,a._userDataWriter,c.doc.key,c.doc,new cA(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter),oldIndex:-1,newIndex:b++}))}{let c=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(a=>b||a.type!==3).map(b=>{const f=new db(a._firestore,a._userDataWriter,b.doc.key,b.doc,new cA(a._snapshot.mutatedKeys.has(b.doc.key),a._snapshot.fromCache),a.query.converter);let d=-1,e=-1;return b.type!==0&&(d=c.indexOf(b.doc.key),c=c.delete(b.doc.key)),b.type!==1&&(c=c.add(b.doc),e=c.indexOf(b.doc.key)),{type:nU(b.type),doc:f,oldIndex:d,newIndex:e}})}}(this,b),this._cachedChangesIncludeMetadataChanges=b),this._cachedChanges}};function nU(a){switch(a){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return g()}}function nV(b){if(dP(b)&&b.explicitOrderBy.length===0)throw new d(a.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}nW=class{};function nX(a,...b){for(const c of b)a=c._apply(a);return a}nY=class extends nW{constructor(a,b,c){super(),this.Ga=a,this.za=b,this.Ha=c,this.type="where"}_apply(b){const c=nE(b.firestore),e=function(f,j,k,h,i,b,c){let e;if(i.isKeyField()){if(b==="array-contains"||b==="array-contains-any")throw new d(a.INVALID_ARGUMENT,`Invalid Query. You can't perform '${b}' queries on FieldPath.documentId().`);if(b==="in"||b==="not-in"){gI(c,b);const a=[];for(const b of c)a.push(gG(h,f,b));e={arrayValue:{values:a}}}else e=gG(h,f,c)}else b!=="in"&&b!=="not-in"&&b!=="array-contains-any"||gI(c,b),e=nF(k,j,c,b==="in"||b==="not-in");const g=V.create(i,b,e);return function(c,b){if(b.V()){const e=he(c);if(e!==null&&!e.isEqual(b.field))throw new d(a.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${e.toString()}' and '${b.field.toString()}'`);const f=hd(c);f!==null&&oa(c,b.field,f)}const e=function(a,b){for(const c of a.filters)if(b.indexOf(c.op)>=0)return c.op;return null}(c,function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(b.op));if(e!==null)throw e===b.op?new d(a.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${b.op.toString()}' filter.`):new d(a.INVALID_ARGUMENT,`Invalid query. You cannot use '${b.op.toString()}' filters with '${e.toString()}' filters.`)}(f,g),g}(b._query,"where",c,b.firestore._databaseId,this.Ga,this.za,this.Ha);return new dI(b.firestore,b.converter,function(a,b){const c=a.filters.concat([b]);return new cf(a.path,a.collectionGroup,a.explicitOrderBy.slice(),c,a.limit,a.limitType,a.startAt,a.endAt)}(b._query,e))}};function nZ(a,b,c){const d=b,e=ew("where",a);return new nY(e,d,c)}function gG(c,e,b){if(typeof(b=cx(b))=="string"){if(b==="")throw new d(a.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!hf(e)&&b.indexOf("/")!==-1)throw new d(a.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${b}' contains a '/' character.`);const g=e.path.child(r.fromString(b));if(!f.isDocumentKey(g))throw new d(a.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${g}' is not because it has an odd number of segments (${g.length}).`);return gv(c,new f(g))}if(b instanceof aD)return gv(c,b._key);throw new d(a.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${dy(b)}.`)}function gI(b,c){if(!Array.isArray(b)||b.length===0)throw new d(a.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${c.toString()}' filters.`);if(b.length>10)throw new d(a.INVALID_ARGUMENT,`Invalid Query. '${c.toString()}' filters support a maximum of 10 elements in the value array.`)}function oa(e,b,c){if(!c.isEqual(b))throw new d(a.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${b.toString()}' and so you must also use '${b.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${c.toString()}' instead.`)}ob=class{convertValue(a,b="none"){switch(aW(a)){case 0:return null;case 1:return a.booleanValue;case 2:return y(a.integerValue||a.doubleValue);case 3:return this.convertTimestamp(a.timestampValue);case 4:return this.convertServerTimestamp(a,b);case 5:return a.stringValue;case 6:return this.convertBytes(bA(a.bytesValue));case 7:return this.convertReference(a.referenceValue);case 8:return this.convertGeoPoint(a.geoPointValue);case 9:return this.convertArray(a.arrayValue,b);case 10:return this.convertObject(a.mapValue,b);default:throw g()}}convertObject(b,c){const a={};return bD(b.fields,(b,d)=>{a[b]=this.convertValue(d,c)}),a}convertGeoPoint(a){return new fk(y(a.latitude),y(a.longitude))}convertArray(a,b){return(a.values||[]).map(a=>this.convertValue(a,b))}convertServerTimestamp(a,b){switch(b){case"previous":const c=gi(a);return c==null?null:this.convertValue(c,b);case"estimate":return this.convertTimestamp(bH(a));default:return null}}convertTimestamp(b){const a=at(b);return new M(a.seconds,a.nanos)}convertDocumentKey(e,b){const a=r.fromString(e);i(jf(a));const c=new c_(a.get(1),a.get(3)),d=new f(a.popFirst(5));return c.isEqual(b)||W(`Document ${d} contains a document reference within a different database (${c.projectId}/${c.database}) which is not supported. It will be treated as a reference in the current database (${b.projectId}/${b.database}) instead.`),d}},oc=class extends ob{constructor(a){super(),this.firestore=a}convertBytes(a){return new bJ(a)}convertReference(a){const b=this.convertDocumentKey(a,this.firestore._databaseId);return new aD(this.firestore,null,b)}};function od(a){a=fn(a,dI);const b=fn(a.firestore,fH),c=fR(b),d=new oc(b);return nV(a._query),m$(c,a._query).then(c=>new nT(b,d,a,c))}!function(a,b=!0){!function(a){bj=a}(pr),fo(new dC("firestore",(a,{options:c})=>{const e=a.getProvider("app").getImmediate(),d=new fH(e,new nl(a.getProvider("auth-internal")),new nh(a.getProvider("app-check-internal")));return c=Object.assign({useFetchStreams:b},c),d._setSettings(c),d},"PUBLIC")),bu(fP,"3.4.1",a),bu(fP,"3.4.1","esm2017")}();function eb(a,b,c={}){const d=new CustomEvent(b,{bubbles:!0,composed:!0,detail:c});a.dispatchEvent(d)}og={apiKey:"AIzaSyAg0cVb-NI8UNGGmXxIe9vxk1fVTcMA2VQ",authDomain:"dnd-project-b2aa4.firebaseapp.com",databaseURL:"https://dnd-project-b2aa4-default-rtdb.firebaseio.com",projectId:"dnd-project-b2aa4",storageBucket:"dnd-project-b2aa4.appspot.com",messagingSenderId:"1031136765027",appId:"1:1031136765027:web:8b106f77f9f22ba7cc8456"},pq(og),gU=nq(),nt(gU).catch(a=>{console.log(a),a.code==="failed-precondition"||a.code==="unimplemented"}),dn={},oj=async()=>{const a=nn(gU,"items"),b=nX(a,nZ("image","!=",null)),c=await od(b);c.forEach(a=>{dn[a.id]=a.data()}),eb(window,"ITEMS")},oj(),dT=window.ShadowRoot&&(window.ShadyCSS===void 0||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,dS=Symbol(),ha=new Map,hb=class{constructor(a,b){if(this._$cssResult$=!0,b!==dS)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=a}get styleSheet(){let a=ha.get(this.cssText);return dT&&a===void 0&&(ha.set(this.cssText,a=new CSSStyleSheet),a.replaceSync(this.cssText)),a}toString(){return this.cssText}},cu=a=>new hb(typeof a=="string"?a:a+"",dS),bC=(a,...b)=>{const c=a.length===1?a[0]:b.reduce((b,c,d)=>b+(a=>{if(a._$cssResult$===!0)return a.cssText;if(typeof a=="number")return a;throw Error("Value passed to 'css' function must be a 'css' function result: "+a+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(c)+a[d+1],a[0]);return new hb(c,dS)},oq=(a,b)=>{dT?a.adoptedStyleSheets=b.map(a=>a instanceof CSSStyleSheet?a:a.styleSheet):b.forEach(d=>{const b=document.createElement("style"),c=window.litNonce;c!==void 0&&b.setAttribute("nonce",c),b.textContent=d.cssText,a.appendChild(b)})},hg=dT?a=>a:a=>a instanceof CSSStyleSheet?(b=>{let a="";for(const c of b.cssRules)a+=c.cssText;return cu(a)})(a):a,hl=window.trustedTypes,ou=hl?hl.emptyScript:"",hr=window.reactiveElementPolyfillSupport,ej={toAttribute(a,b){switch(b){case Boolean:a=a?ou:null;break;case Object:case Array:a=a==null?a:JSON.stringify(a)}return a},fromAttribute(a,c){let b=a;switch(c){case Boolean:b=a!==null;break;case Number:b=a===null?null:Number(a);break;case Object:case Array:try{b=JSON.parse(a)}catch(a){b=null}}return b}},hK=(a,b)=>b!==a&&(b==b||a==a),eo={attribute:!0,type:String,converter:ej,reflect:!1,hasChanged:hK},bd=class extends HTMLElement{constructor(){super(),this._$Et=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Ei=null,this.o()}static addInitializer(b){var a;(a=this.l)!==null&&a!==void 0||(this.l=[]),this.l.push(b)}static get observedAttributes(){this.finalize();const a=[];return this.elementProperties.forEach((d,c)=>{const b=this._$Eh(c,d);b!==void 0&&(this._$Eu.set(b,c),a.push(b))}),a}static createProperty(a,b=eo){if(b.state&&(b.attribute=!1),this.finalize(),this.elementProperties.set(a,b),!b.noAccessor&&!this.prototype.hasOwnProperty(a)){const d=typeof a=="symbol"?Symbol():"__"+a,c=this.getPropertyDescriptor(a,d,b);c!==void 0&&Object.defineProperty(this.prototype,a,c)}}static getPropertyDescriptor(a,b,c){return{get(){return this[b]},set(d){const e=this[a];this[b]=d,this.requestUpdate(a,e,c)},configurable:!0,enumerable:!0}}static getPropertyOptions(a){return this.elementProperties.get(a)||eo}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const a=Object.getPrototypeOf(this);if(a.finalize(),this.elementProperties=new Map(a.elementProperties),this._$Eu=new Map,this.hasOwnProperty("properties")){const a=this.properties,b=[...Object.getOwnPropertyNames(a),...Object.getOwnPropertySymbols(a)];for(const c of b)this.createProperty(c,a[c])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(a){const b=[];if(Array.isArray(a)){const c=new Set(a.flat(1/0).reverse());for(const a of c)b.unshift(hg(a))}else a!==void 0&&b.push(hg(a));return b}static _$Eh(b,c){const a=c.attribute;return a===!1?void 0:typeof a=="string"?a:typeof b=="string"?b.toLowerCase():void 0}o(){var a;this._$Ep=new Promise(a=>this.enableUpdating=a),this._$AL=new Map,this._$Em(),this.requestUpdate(),(a=this.constructor.l)===null||a===void 0||a.forEach(a=>a(this))}addController(a){var b,c;((b=this._$Eg)!==null&&b!==void 0?b:this._$Eg=[]).push(a),this.renderRoot!==void 0&&this.isConnected&&((c=a.hostConnected)===null||c===void 0||c.call(a))}removeController(b){var a;(a=this._$Eg)===null||a===void 0||a.splice(this._$Eg.indexOf(b)>>>0,1)}_$Em(){this.constructor.elementProperties.forEach((b,a)=>{this.hasOwnProperty(a)&&(this._$Et.set(a,this[a]),delete this[a])})}createRenderRoot(){var a;const b=(a=this.shadowRoot)!==null&&a!==void 0?a:this.attachShadow(this.constructor.shadowRootOptions);return oq(b,this.constructor.elementStyles),b}connectedCallback(){var a;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(a=this._$Eg)===null||a===void 0||a.forEach(b=>{var a;return(a=b.hostConnected)===null||a===void 0?void 0:a.call(b)})}enableUpdating(a){}disconnectedCallback(){var a;(a=this._$Eg)===null||a===void 0||a.forEach(b=>{var a;return(a=b.hostDisconnected)===null||a===void 0?void 0:a.call(b)})}attributeChangedCallback(a,c,b){this._$AK(a,b)}_$ES(e,f,a=eo){var b,c;const d=this.constructor._$Eh(e,a);if(d!==void 0&&a.reflect===!0){const g=((c=(b=a.converter)===null||b===void 0?void 0:b.toAttribute)!==null&&c!==void 0?c:ej.toAttribute)(f,a.type);this._$Ei=e,g==null?this.removeAttribute(d):this.setAttribute(d,g),this._$Ei=null}}_$AK(g,f){var b,c,d;const e=this.constructor,a=e._$Eu.get(g);if(a!==void 0&&this._$Ei!==a){const h=e.getPropertyOptions(a),g=h.converter,i=(d=(c=(b=g)===null||b===void 0?void 0:b.fromAttribute)!==null&&c!==void 0?c:typeof g=="function"?g:null)!==null&&d!==void 0?d:ej.fromAttribute;this._$Ei=a,this[a]=i(f,h.type),this._$Ei=null}}requestUpdate(a,c,b){let d=!0;a!==void 0&&(((b=b||this.constructor.getPropertyOptions(a)).hasChanged||hK)(this[a],c)?(this._$AL.has(a)||this._$AL.set(a,c),b.reflect===!0&&this._$Ei!==a&&(this._$E_===void 0&&(this._$E_=new Map),this._$E_.set(a,b))):d=!1),!this.isUpdatePending&&d&&(this._$Ep=this._$EC())}async _$EC(){this.isUpdatePending=!0;try{await this._$Ep}catch(a){Promise.reject(a)}const a=this.scheduleUpdate();return a!=null&&await a,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var c;if(!this.isUpdatePending)return;this.hasUpdated,this._$Et&&(this._$Et.forEach((a,b)=>this[b]=a),this._$Et=void 0);let a=!1;const b=this._$AL;try{a=this.shouldUpdate(b),a?(this.willUpdate(b),(c=this._$Eg)===null||c===void 0||c.forEach(b=>{var a;return(a=b.hostUpdate)===null||a===void 0?void 0:a.call(b)}),this.update(b)):this._$EU()}catch(b){throw a=!1,this._$EU(),b}a&&this._$AE(b)}willUpdate(a){}_$AE(b){var a;(a=this._$Eg)===null||a===void 0||a.forEach(b=>{var a;return(a=b.hostUpdated)===null||a===void 0?void 0:a.call(b)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(b)),this.updated(b)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Ep}shouldUpdate(a){return!0}update(a){this._$E_!==void 0&&(this._$E_.forEach((b,a)=>this._$ES(a,this[a],b)),this._$E_=void 0),this._$EU()}updated(a){}firstUpdated(a){}},bd.finalized=!0,bd.elementProperties=new Map,bd.elementStyles=[],bd.shadowRootOptions={mode:"open"},hr==null||hr({ReactiveElement:bd}),((dV=globalThis.reactiveElementVersions)!==null&&dV!==void 0?dV:globalThis.reactiveElementVersions=[]).push("1.0.2"),bi=globalThis.trustedTypes,h_=bi?bi.createPolicy("lit-html",{createHTML:a=>a}):void 0,az=`lit$${(Math.random()+"").slice(9)}$`,ia="?"+az,oF=`<${ia}>`,br=document,co=(a="")=>br.createComment(a),cn=a=>a===null||typeof a!="object"&&typeof a!="function",id=Array.isArray,oK=b=>{var a;return id(b)||typeof((a=b)===null||a===void 0?void 0:a[Symbol.iterator])=="function"},ca=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,ip=/-->/g,iq=/>/g,aP=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,ir=/'/g,iv=/"/g,iz=/^(?:script|style|textarea)$/i,iB=a=>(b,...c)=>({_$litType$:a,strings:b,values:c}),o=iB(1),sl=iB(2),aF=Symbol.for("lit-noChange"),p=Symbol.for("lit-nothing"),iQ=new WeakMap,oY=(g,e,a)=>{var c,d;const f=(c=a==null?void 0:a.renderBefore)!==null&&c!==void 0?c:e;let b=f._$litPart$;if(b===void 0){const c=(d=a==null?void 0:a.renderBefore)!==null&&d!==void 0?d:null;f._$litPart$=b=new dl(e.insertBefore(co(),c),c,void 0,a!=null?a:{})}return b._$AI(g),b},be=br.createTreeWalker(br,129,null,!1),o_=(c,e)=>{const f=c.length-1,d=[];let b,g=e===2?"<svg>":"",a=ca;for(let j=0;j<f;j++){const i=c[j];let l,e,h=-1,k=0;for(;k<i.length&&(a.lastIndex=k,e=a.exec(i),e!==null);)k=a.lastIndex,a===ca?e[1]==="!--"?a=ip:e[1]!==void 0?a=iq:e[2]!==void 0?(iz.test(e[2])&&(b=RegExp("</"+e[2],"g")),a=aP):e[3]!==void 0&&(a=aP):a===aP?e[0]===">"?(a=b!=null?b:ca,h=-1):e[1]===void 0?h=-2:(h=a.lastIndex-e[2].length,l=e[1],a=e[3]===void 0?aP:e[3]==='"'?iv:ir):a===iv||a===ir?a=aP:a===ip||a===iq?a=ca:(a=aP,b=void 0);const m=a===aP&&c[j+1].startsWith("/>")?" ":"";g+=a===ca?i+oF:h>=0?(d.push(l),i.slice(0,h)+"$lit$"+i.slice(h)+az+m):i+az+(h===-2?(d.push(void 0),j):m)}const h=g+(c[f]||"<?>")+(e===2?"</svg>":"");return[h_!==void 0?h_.createHTML(h):h,d]},dj=class{constructor({strings:d,_$litType$:e},f){let a;this.parts=[];let c=0,g=0;const h=d.length-1,b=this.parts,[i,j]=o_(d,e);if(this.el=dj.createElement(i,f),be.currentNode=this.el.content,e===2){const a=this.el.content,b=a.firstChild;b.remove(),a.append(...b.childNodes)}for(;(a=be.nextNode())!==null&&b.length<h;){if(a.nodeType===1){{if(a.hasAttributes()){const d=[];for(const e of a.getAttributeNames())if(e.endsWith("$lit$")||e.startsWith(az)){const f=j[g++];if(d.push(e),f!==void 0){const e=a.getAttribute(f.toLowerCase()+"$lit$").split(az),d=/([.?@])?(.*)/.exec(f);b.push({type:1,index:c,name:d[2],strings:e,ctor:d[1]==="."?pe:d[1]==="?"?pg:d[1]==="@"?ph:dp})}else b.push({type:6,index:c})}for(const b of d)a.removeAttribute(b)}if(iz.test(a.tagName)){const d=a.textContent.split(az),e=d.length-1;if(e>0){a.textContent=bi?bi.emptyScript:"";for(let f=0;f<e;f++)a.append(d[f],co()),be.nextNode(),b.push({type:2,index:++c});a.append(d[e],co())}}}}else if(a.nodeType===8)if(a.data===ia)b.push({type:2,index:c});else{let d=-1;for(;(d=a.data.indexOf(az,d+1))!==-1;)b.push({type:7,index:c}),d+=az.length-1}c++}}static createElement(b,c){const a=br.createElement("template");return a.innerHTML=b,a}};function a_(d,b,e=d,c){var f,g,h,j;if(b===aF)return b;let a=c!==void 0?(f=e._$Cl)===null||f===void 0?void 0:f[c]:e._$Cu;const i=cn(b)?void 0:b._$litDirective$;return(a==null?void 0:a.constructor)!==i&&((g=a==null?void 0:a._$AO)===null||g===void 0||g.call(a,!1),i===void 0?a=void 0:(a=new i(d),a._$AT(d,e,c)),c!==void 0?((h=(j=e)._$Cl)!==null&&h!==void 0?h:j._$Cl=[])[c]=a:e._$Cu=a),a!==void 0&&(b=a_(d,a._$AS(d,b.values),a,c)),b}pb=class{constructor(a,b){this.v=[],this._$AN=void 0,this._$AD=a,this._$AM=b}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}p(b){var d;const{el:{content:i},parts:f}=this._$AD,g=((d=b==null?void 0:b.creationScope)!==null&&d!==void 0?d:br).importNode(i,!0);be.currentNode=g;let c=be.nextNode(),e=0,h=0,a=f[0];for(;a!==void 0;){if(e===a.index){let d;a.type===2?d=new dl(c,c.nextSibling,this,b):a.type===1?d=new a.ctor(c,a.name,a.strings,this,b):a.type===6&&(d=new pi(c,this,b)),this.v.push(d),a=f[++h]}e!==(a==null?void 0:a.index)&&(c=be.nextNode(),e++)}return g}m(b){let a=0;for(const c of this.v)c!==void 0&&(c.strings!==void 0?(c._$AI(b,c,a),a+=c.strings.length-2):c._$AI(b[a])),a++}},dl=class{constructor(c,d,e,a){var b;this.type=2,this._$AH=p,this._$AN=void 0,this._$AA=c,this._$AB=d,this._$AM=e,this.options=a,this._$Cg=(b=a==null?void 0:a.isConnected)===null||b===void 0||b}get _$AU(){var a,b;return(b=(a=this._$AM)===null||a===void 0?void 0:a._$AU)!==null&&b!==void 0?b:this._$Cg}get parentNode(){let a=this._$AA.parentNode;const b=this._$AM;return b!==void 0&&a.nodeType===11&&(a=b.parentNode),a}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(a,b=this){a=a_(this,a,b),cn(a)?a===p||a==null||a===""?(this._$AH!==p&&this._$AR(),this._$AH=p):a!==this._$AH&&a!==aF&&this.$(a):a._$litType$!==void 0?this.T(a):a.nodeType!==void 0?this.S(a):oK(a)?this.M(a):this.$(a)}A(a,b=this._$AB){return this._$AA.parentNode.insertBefore(a,b)}S(a){this._$AH!==a&&(this._$AR(),this._$AH=this.A(a))}$(a){this._$AH!==p&&cn(this._$AH)?this._$AA.nextSibling.data=a:this.S(br.createTextNode(a)),this._$AH=a}T(c){var b;const{values:d,_$litType$:a}=c,e=typeof a=="number"?this._$AC(c):(a.el===void 0&&(a.el=dj.createElement(a.h,this.options)),a);if(((b=this._$AH)===null||b===void 0?void 0:b._$AD)===e)this._$AH.m(d);else{const a=new pb(e,this),b=a.p(this.options);a.m(d),this.S(b),this._$AH=a}}_$AC(a){let b=iQ.get(a.strings);return b===void 0&&iQ.set(a.strings,b=new dj(a)),b}M(d){id(this._$AH)||(this._$AH=[],this._$AR());const b=this._$AH;let c,a=0;for(const e of d)a===b.length?b.push(c=new dl(this.A(co()),this.A(co()),this,this.options)):c=b[a],c._$AI(e),a++;a<b.length&&(this._$AR(c&&c._$AB.nextSibling,a),b.length=a)}_$AR(a=this._$AA.nextSibling,c){var b;for((b=this._$AP)===null||b===void 0||b.call(this,!1,!0,c);a&&a!==this._$AB;){const d=a.nextSibling;a.remove(),a=d}}setConnected(b){var a;this._$AM===void 0&&(this._$Cg=b,(a=this._$AP)===null||a===void 0||a.call(this,b))}},dp=class{constructor(b,c,a,d,e){this.type=1,this._$AH=p,this._$AN=void 0,this.element=b,this.name=c,this._$AM=d,this.options=e,a.length>2||a[0]!==""||a[1]!==""?(this._$AH=Array(a.length-1).fill(new String),this.strings=a):this._$AH=p}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(a,d=this,e,f){const c=this.strings;let b=!1;if(c===void 0)a=a_(this,a,d,0),b=!cn(a)||a!==this._$AH&&a!==aF,b&&(this._$AH=a);else{const h=a;let f,g;for(a=c[0],f=0;f<c.length-1;f++)g=a_(this,h[e+f],d,f),g===aF&&(g=this._$AH[f]),b||(b=!cn(g)||g!==this._$AH[f]),g===p?a=p:a!==p&&(a+=(g!=null?g:"")+c[f+1]),this._$AH[f]=g}b&&!f&&this.k(a)}k(a){a===p?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,a!=null?a:"")}},pe=class extends dp{constructor(){super(...arguments),this.type=3}k(a){this.element[this.name]=a===p?void 0:a}},pf=bi?bi.emptyScript:"",pg=class extends dp{constructor(){super(...arguments),this.type=4}k(a){a&&a!==p?this.element.setAttribute(this.name,pf):this.element.removeAttribute(this.name)}},ph=class extends dp{constructor(a,b,c,d,e){super(a,b,c,d,e),this.type=5}_$AI(a,e=this){var c;if((a=(c=a_(this,a,e,0))!==null&&c!==void 0?c:p)===aF)return;const b=this._$AH,d=a===p&&b!==p||a.capture!==b.capture||a.once!==b.once||a.passive!==b.passive,f=a!==p&&(b===p||d);d&&this.element.removeEventListener(this.name,this,b),f&&this.element.addEventListener(this.name,this,a),this._$AH=a}handleEvent(c){var a,b;typeof this._$AH=="function"?this._$AH.call((b=(a=this.options)===null||a===void 0?void 0:a.host)!==null&&b!==void 0?b:this.element,c):this._$AH.handleEvent(c)}},pi=class{constructor(a,b,c){this.element=a,this.type=6,this._$AN=void 0,this._$AM=b,this.options=c}get _$AU(){return this._$AM._$AU}_$AI(a){a_(this,a)}},ja=window.litHtmlPolyfillSupport,ja==null||ja(dj,dl),((eq=globalThis.litHtmlVersions)!==null&&eq!==void 0?eq:globalThis.litHtmlVersions=[]).push("2.0.2"),aB=class extends bd{constructor(){super(...arguments),this.renderOptions={host:this},this._$Dt=void 0}createRenderRoot(){var a,b;const c=super.createRenderRoot();return(a=(b=this.renderOptions).renderBefore)!==null&&a!==void 0||(b.renderBefore=c.firstChild),c}update(a){const b=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(a),this._$Dt=oY(b,this.renderRoot,this.renderOptions)}connectedCallback(){var a;super.connectedCallback(),(a=this._$Dt)===null||a===void 0||a.setConnected(!0)}disconnectedCallback(){var a;super.disconnectedCallback(),(a=this._$Dt)===null||a===void 0||a.setConnected(!1)}render(){return aF}},aB.finalized=!0,aB._$litElement$=!0,(fj=globalThis.litElementHydrateSupport)===null||fj===void 0||fj.call(globalThis,{LitElement:aB}),jb=globalThis.litElementPolyfillSupport,jb==null||jb({LitElement:aB}),((fm=globalThis.litElementVersions)!==null&&fm!==void 0?fm:globalThis.litElementVersions=[]).push("3.0.2"),dB=a=>b=>typeof b=="function"?((b,a)=>(window.customElements.define(b,a),a))(a,b):((a,b)=>{const{kind:c,elements:d}=b;return{kind:c,elements:d,finisher(b){window.customElements.define(a,b)}}})(a,b),pp=(b,a)=>a.kind==="method"&&a.descriptor&&!("value"in a.descriptor)?{...a,finisher(c){c.createProperty(a.key,b)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:a.key,initializer(){typeof a.initializer=="function"&&(this[a.key]=a.initializer.call(this))},finisher(c){c.createProperty(a.key,b)}};function ax(a){return(b,c)=>c!==void 0?((a,b,c)=>{b.constructor.createProperty(c,a)})(a,b,c):pp(a,b)}function dt(a){return ax({...a,state:!0})}ae=class{constructor(a){this.values=[],this.delimiter=":",this.hasValue(a)&&this.addValue(a)}toString(){return this.values.join(this.delimiter)}hasValue(a){return typeof a!="undefined"&&a!==null&&a!==""}addValue(a){return Array.isArray(a)?this.values=this.values.concat(a):this.values.push(a),this.values=this.values.filter(a=>this.hasValue(a)),this}setDelimiter(a){return this.delimiter=a,this}},E=class{constructor(b,a){this.delimiter="_",this.key=b,a instanceof ae?this.qualifierValue=a:(this.qualifierValue=new ae,this.qualifierValue.addValue(a))}toString(){const{key:a,delimiter:b,qualifierValue:c}=this;return`${a}${b}${c.toString()}`}addValue(a){return this.qualifierValue.addValue(a),this}},aa=class extends E{constructor(c,a){let b;a?b=new ae([c,`${a}`]).setDelimiter(":"):b=c,super("fl",b),this.flagValue=a}toString(){return super.toString().replace(/\./,"%2E")}getFlagValue(){return this.flagValue}};function pv(b,c){const a=Array.from(b.entries());return c.forEach(b=>{a.push(["fl",b])}),a.sort().map(a=>a[1])}pw=class extends Error{constructor(a="Unsupported"){super(a)}};function jg(a){return new pw(a)}cb=class{constructor(){this._actionModel={},this.qualifiers=new Map,this.flags=[],this.delimiter=",",this.actionTag=""}prepareQualifiers(){}getActionTag(){return this.actionTag}setActionTag(a){return this.actionTag=a,this}toString(){return this.prepareQualifiers(),pv(this.qualifiers,this.flags).join(this.delimiter)}addQualifier(a){if(typeof a=="string"){const[b,c]=a.toLowerCase().split("_");b==="fl"?this.flags.push(new aa(c)):this.qualifiers.set(b,new E(b,c))}else this.qualifiers.set(a.key,a);return this}addFlag(a){return typeof a=="string"?this.flags.push(new aa(a)):a instanceof aa&&this.flags.push(a),this}toJson(){return this._actionModel.actionType?this._actionModel:{error:jg(`unsupported action ${this.constructor.name}`)}}addValueToQualifier(a,b){return this.qualifiers.get(a).addValue(b),this}};function jj(b){const a=b.toString();if(a.match(/[A-Z]/gi))return a;if(a.length>1&&a[0]==="0")return a;const c=!isNaN(parseFloat(a))&&a.indexOf(":")===-1;return c&&a.indexOf(".")===-1?`${a}.0`:a}pA=class extends ae{};function pB(){return new aa("ignore_aspect_ratio")}function pC(){return new aa("lossy")}function pD(){return new aa("preserve_transparency")}function pE(a){return new aa("progressive",a)}function pF(){return new aa("region_relative")}function pG(){return new aa("relative")}function cd(a){const b={};return Object.keys(a).forEach(c=>{b[a[c]]=c}),b}jk=["cname","secureDistribution","privateCdn","signUrl","longUrlSignature","shorten","useRootPath","secure","forceVersion","analytics"],jl={"=":"eq","!=":"ne","<":"lt",">":"gt","<=":"lte",">=":"gte","&&":"and","||":"or","*":"mul","/":"div","+":"add","-":"sub","^":"pow"},jm={aspect_ratio:"ar",aspectRatio:"ar",current_page:"cp",currentPage:"cp",duration:"du",face_count:"fc",faceCount:"fc",height:"h",initial_aspect_ratio:"iar",initial_height:"ih",initial_width:"iw",initialAspectRatio:"iar",initialHeight:"ih",initialWidth:"iw",initial_duration:"idu",initialDuration:"idu",page_count:"pc",page_x:"px",page_y:"py",pageCount:"pc",pageX:"px",pageY:"py",tags:"tags",width:"w",trimmed_aspect_ratio:"tar",current_public_id:"cpi",initial_density:"idn",page_names:"pgnames"},jn={limitFit:"limit",limitFill:"lfill",minimumFit:"mfit",thumbnail:"thumb",limitPad:"lpad",minimumPad:"mpad"},pM={colorSpace:"cs",dpr:"dpr",density:"dn",defaultImage:"d",format:"f",quality:"q"},pN={redEye:"redeye",advancedRedEye:"adv_redeye",oilPaint:"oil_paint",unsharpMask:"unsharp_mask"},pO={444:"CHROMA_444",420:"CHROMA_420"},pP={noCmyk:"no_cmyk",keepCmyk:"keep_cmyk",tinySrgb:"tinysrgb",srgbTrueColor:"srgb:truecolor"},sk=cd(pO),sj=cd(pP),pS=cd(jn),nx=cd(pM),si=cd(pN),pV=class extends cb{constructor(a,b,c){super(),this._actionModel={dimensions:{}},this._actionModel.actionType=pS[a]||a,this.addQualifier(new E("c",a)),b&&this.width(b),c&&this.height(c)}height(a){return this._actionModel.dimensions.height=a,this.addQualifier(new E("h",a))}width(a){return this._actionModel.dimensions.width=a,this.addQualifier(new E("w",a))}aspectRatio(a){if(a instanceof pA)return this._actionModel.dimensions.aspectRatio=`${a}`,this.addQualifier(new E("ar",a));if(typeof a=="number"||typeof a=="string")return this._actionModel.dimensions.aspectRatio=jj(a),this.addQualifier(new E("ar",jj(a)));if(a instanceof aa)return this._actionModel.dimensions.aspectRatio=`${a.qualifierValue}`,this.addFlag(a)}relative(){return this._actionModel.relative=!0,this.addFlag(pG())}regionRelative(){return this._actionModel.regionRelative=!0,this.addFlag(pF())}static fromJson(d){const{actionType:c,dimensions:e,relative:j,regionRelative:f}=d,{aspectRatio:b,width:g,height:h}=e,i=jn[c]||c,a=new this(i,g,h);return b&&a.aspectRatio(b==="ignore_aspect_ratio"?pB():b),j&&a.relative(),f&&a.regionRelative(),a}},jo=class extends E{constructor(a){super("g",new ae(a))}},jp=class extends jo{constructor(){super("auto")}autoFocus(...a){return this.addValue(a),this}},pY=class extends jo{constructor(a){super(a)}fallbackGravity(a){return this.addValue(a.qualifierValue),this}};function jq(...a){const b=[...a];return new pY(b)}function jr(){return new jp}function p$(a){const b=fs(a);return["north","center","east","west","south","north_west","south_east","south_west","north_east"].includes(b)}function fs(a){return`${a}`.replace("g_","")}function qb(a){return{compass:fs(a),gravityType:"direction"}}function qc(a){return fs(a)==="ocr_text"}function qd(){return{gravityType:"ocr"}}function qe(a){return`${a.qualifierValue}`.split(":")[0]==="auto"}function qf(c){const d=c.toString(),a=d.split("_"),b={object:a[0]};return a.length>1&&(a[1]==="avoid"?b.avoid=!0:b.weight=+a[1]),b}function js(a){const b=a==="auto"?new jp:a,c=b.qualifierValue.values.filter(a=>a!=="auto"),d=c.map(qf);return{gravityType:"auto",autoFocus:d}}function qh(b){const c=`${b}`.split(":").includes("auto"),a=b.qualifierValue.values,e=c?a.slice(0,a.length-1):a,d={gravityType:"object",focusOnObjects:e.map(a=>`${a}`)};if(c){const b=a[a.length-1].values.slice(1),c=jr().autoFocus(...b);d.fallbackGravity=js(c)}return d}function qi(a){return p$(a)?qb(a):qc(a)?qd():a==="auto"||qe(a)?js(a):qh(a)}ft=class extends ae{constructor(a){super(),this.name=a}toString(){return this.name}};function qk(){return new ft("ocr_text")}jt=class extends ae{constructor(a,b){super(),this._weight=b,this.focusOn=a,this.shouldAvoid=!1}static focusOn(a,b){return new jt(a,b)}shouldAddWeight(){return typeof this._weight=="number"||typeof this._weight=="string"||this.shouldAvoid}getName(){return this.focusOn.name}getWeight(){return this.shouldAvoid?"avoid":this._weight}toString(){return this.shouldAddWeight()?`${this.getName()}_${this.getWeight()}`:`${this.getName()}`}weight(a){return this._weight=a,this}avoid(){return this.shouldAvoid=!0,this}};function qm(a){return a.gravityType==="direction"}function qn(a){return a.gravityType==="ocr"}function qo(a){return a.gravityType==="auto"}function qp(c){const{object:d,weight:a,avoid:e}=c,b=new jt(new ft(d));return(a||a===0)&&b.weight(a),e&&b.avoid(),b}function ju(a){const b=a.autoFocus||[],c=b.map(qp);return jr().autoFocus(...c)}function qr(a){const c=(a.focusOnObjects||[]).map(a=>new ft(a)),b=jq(...c);if(a.fallbackGravity){const c=ju(a.fallbackGravity);b.fallbackGravity(c)}return b}function qs(a){return qm(a)?a.compass:qn(a)?jq(qk()):qo(a)?ju(a):qr(a)}fu=class extends pV{gravity(a){this._actionModel.gravity=qi(a);const b=typeof a=="string"?new E("g",a):a;return this.addQualifier(b)}static fromJson(a){const b=super.fromJson.apply(this,[a]);return a.gravity&&b.gravity(qs(a.gravity)),b}},dz=class extends E{constructor(a){super("b"),a&&this.addValue(a)}},qv=class extends dz{intensity(a){return this.intensityLevel=a,this}brightness(a){return this.brightnessLevel=a,this}toString(){return`
    b_blurred
    ${this.intensityLevel?`:${this.intensityLevel}`:""}
    ${this.brightnessLevel?`:${this.brightnessLevel}`:""}
    `.replace(/\s+/g,"")}},jv=qv;function fv(a){return a&&a.match(/^#/)?`rgb:${a.substr(1)}`:a}fx=class extends dz{constructor(){super(),this._palette=[]}contrast(){return this._contrast=!0,this}palette(...a){return this._palette=a.map(a=>fv(a)),this}},jw=class extends fx{toString(){return`
    b_auto:border
    ${this._contrast?"_contrast":""}
    ${this._palette.length?`:palette_${this._palette.join("_")}`:""}
    `.replace(/\s+/g,"")}},jx=class extends fx{gradientColors(a){return this._gradientColors=a,this}gradientDirection(a){return this._gradientDirection=a,this}},jy=class extends jx{toString(){return`
    b_auto:border_gradient
    ${this._contrast?"_contrast":""}
    ${this._gradientColors?`:${this._gradientColors}`:""}
    ${this._gradientDirection?`:${this._gradientDirection}`:""}
    ${this._palette.length?`:palette_${this._palette.join("_")}`:""}
    `.replace(/\s+/g,"")}},jz=class extends jx{toString(){return`
    b_auto:predominant_gradient
    ${this._contrast?"_contrast":""}
    ${this._gradientColors?`:${this._gradientColors}`:""}
    ${this._gradientDirection?`:${this._gradientDirection}`:""}
    ${this._palette.length?`:palette_${this._palette.join("_")}`:""}
    `.replace(/\s+/g,"")}},jE=class extends fx{toString(){return`
    b_auto:predominant
    ${this._contrast?"_contrast":""}
    ${this._palette.length?`:palette_${this._palette.join("_")}`:""}
    `.replace(/\s+/g,"")}};function jF(a){return`${a}`.replace("b_","")}function qF(){return{backgroundType:"auto"}}function qG(d){const{intensityLevel:a,brightnessLevel:b}=d,c={backgroundType:"blurred"};return(a||a===0)&&(c.intensity=a),(b||b===0)&&(c.brightness=b),c}function fK(b){const d=b._contrast,c=b._palette,a={backgroundType:""};return d&&(a.contrast=!0),c&&(a.palette=c),a}function qI(a){return Object.assign(Object.assign({},fK(a)),{backgroundType:"border"})}function jI(a){const c=a._gradientColors,d=`${a._gradientDirection}`,b=fK(a);return c&&(b.gradientColors=c),d&&(b.gradientDirection=d),b}function qK(a){return Object.assign(Object.assign({},jI(a)),{backgroundType:"borderGradient"})}function qL(a){return{backgroundType:"color",color:jF(a)}}function qM(a){return Object.assign(Object.assign({},fK(a)),{backgroundType:"predominant"})}function qN(a){return Object.assign(Object.assign({},jI(a)),{backgroundType:"predominantGradient"})}function qO(a){return jF(a)==="auto"?qF():a instanceof jv?qG(a):a instanceof jw?qI(a):a instanceof jy?qK(a):a instanceof jE?qM(a):a instanceof jz?qN(a):qL(a)}qP=class extends ae{constructor(a){super(a),this.val=a}getValue(){return this.val}},qQ=class extends ae{constructor(a){super(),this.value=a}toString(){return this.value}};function qR(a){const b=Object.keys(jl).map(a=>`\\s${a.replace(/(\*|\+|\^|\|)/g,"\\$1")}\\s`),c=b.join("|"),d=new RegExp(`(${c})`,"g"),e=a.toString().replace(d,a=>`_${jl[a.trim()]}_`),f=Object.keys(jm),g=f.join("|"),h=new RegExp(`(\\$_*[^_ ]+)|${g}`,"g"),i=e.replace(h,a=>a.startsWith("$")?a:jm[a]||a),j=i.replace(/\s/g,"_");return new qQ(j)}function jK(){return new jw}function jM(){return new dz("auto")}function jO(){return new jy}function jP(){return new jz}function jR(){return new jE}function jX(a){return new dz(fv(a))}function qY(){return new jv}qZ={auto:jM,border:jK,borderGradient:jO,predominantGradient:jP,predominant:jR,color:jX,blurred:qY};function q_(d){const{brightness:a,intensity:b}=d,c=qZ.blurred();return(a||a==0)&&c.brightness(a),(b||b==0)&&c.intensity(b),c}function jY(a,e){const{gradientColors:b,gradientDirection:c,contrast:f,palette:d}=e;return f&&a.contrast(),d&&a.palette(...d),b&&a.gradientColors(+b),c&&a.gradientDirection(c),a}function jZ(a,c){const{contrast:d,palette:b}=c;return d&&a.contrast(),b&&a.palette(...b),a}function rb(a){const{backgroundType:b}=a;switch(b){case"auto":return jM();case"blurred":return q_(a);case"border":return jZ(jK(),a);case"borderGradient":return jY(jO(),a);case"predominant":return jZ(jR(),a);case"predominantGradient":return jY(jP(),a);default:return jX(a.color)}}rc=class extends fu{background(a){return this._actionModel.background=qO(a),this.addQualifier(a)}offsetX(a){return this._actionModel.x=a,this.addQualifier(new E("x",a))}offsetY(a){return this._actionModel.y=a,this.addQualifier(new E("y",a))}static fromJson(a){const b=super.fromJson.apply(this,[a]);return a.background&&b.background(rb(a.background)),a.x&&b.offsetX(a.x),a.y&&b.offsetY(a.y),a.zoom&&b.zoom(a.zoom),b}},rd=class extends fu{zoom(a){return this._actionModel.zoom=a,this.addQualifier(new E("z",a))}static fromJson(a){const b=super.fromJson.apply(this,[a]);return a.zoom&&b.zoom(a.zoom),b}},re=class extends fu{x(a){return this._actionModel.x=a,this.addQualifier(new E("x",a))}y(a){return this._actionModel.y=a,this.addQualifier(new E("y",a))}static fromJson(a){const b=super.fromJson.apply(this,[a]);return a.x&&b.x(a.x),a.y&&b.y(a.y),b}};function rf(a,b){return new re("fill",a,b)}function rg(a,b){return new rc("pad",a,b)}function rh(a,b){return new rd("thumb",a,b)}ri=class extends cb{constructor(a){super(),this.addQualifier(new E("b",new ae(a).setDelimiter("_")))}},kf=class{constructor(a){this.raw=a}toString(){return this.raw}toJson(){return{error:jg(`unsupported action ${this.constructor.name}`)}}};function rk(b){const a=b;return"error"in a&&!!a.error}cl=class{constructor(){this.actions=[]}addAction(a){let b;if(typeof a=="string"){if(a.indexOf("/")>=0)throw"addAction cannot accept a string with a forward slash in it - /, use .addTransformation() instead";b=new kf(a)}else b=a;return this.actions.push(b),this}addTransformation(a){return a instanceof cl?this.actions=this.actions.concat(a.actions):this.actions.push(new kf(a)),this}toString(){return this.actions.map(a=>a.toString()).filter(a=>a).join("/")}animated(a){return this.addAction(a)}border(a){return this.addAction(a)}reshape(a){return this.addAction(a)}resize(a){return this.addAction(a)}quality(a){return this.addAction(a)}roundCorners(a){return this.addAction(a)}overlay(a){return this.addAction(a)}underlay(a){return a.setLayerType("u"),this.addAction(a)}addVariable(a){return this.addAction(a)}conditional(a){return this.addAction(a)}effect(a){return this.addAction(a)}adjust(a){return this.addAction(a)}rotate(a){return this.addAction(a)}namedTransformation(a){return this.addAction(a)}delivery(a){return this.addAction(a)}backgroundColor(a){return this.addAction(new ri(fv(a)))}psdTools(a){return this.addAction(a)}extract(a){return this.addAction(a)}addFlag(a){const b=new cb;let c=a;return typeof a=="string"&&(c=new aa(a)),b.addQualifier(c),this.addAction(b)}customFunction(a){return this.addAction(a)}transcode(a){return this.addAction(a)}videoEdit(a){return this.addAction(a)}toJson(){const a=[];for(const c of this.actions){const b=c.toJson();if(rk(b))return b;a.push(b)}return a}},rm=class extends cl{},rn=class extends cl{};function ro(a){return a.match(/^https?:\//)}function rp(a){return a.indexOf("/")<0}function rq(a){return a.match(/^v[0-9]+/)}function rr(c,d){const a=d.secure,f=d.privateCdn,e=d.cname,b=d.secureDistribution;return!a&&!e?`http://res.cloudinary.com/${c}`:a&&!b&&f?`https://${c}-res.cloudinary.com`:a&&!b?`https://res.cloudinary.com/${c}`:a&&b&&f?`https://${b}`:a&&b?`https://${b}/${c}`:!a&&e?`http://${e}/${c}`:"ERROR"}function rs(a){return a||"image"}function rt(a){return a||"upload"}function ru(a,b,c){const d=c!==!1;return b?`v${b}`:rq(a)||ro(a)||rp(a)?"":d?"v1":""}function rv(a){return!(typeof a!="object"||a instanceof Array)}rw=class{filterOutNonSupportedKeys(a,c){const b=Object.create({});return rv(a)?(Object.keys(a).forEach(d=>{c.indexOf(d)>=0?b[d]=a[d]:console.warn("Warning - unsupported key provided to configuration: ",d)}),b):Object.create({})}},rx=rw,kl=class extends rx{constructor(a){super();const b=this.filterOutNonSupportedKeys(a,jk);Object.assign(this,{secure:!0},b)}extend(a){const b=this.filterOutNonSupportedKeys(a,jk);return new kl(Object.assign({},this,b))}setCname(a){return this.cname=a,this}setSecureDistribution(a){return this.secureDistribution=a,this}setPrivateCdn(a){return this.privateCdn=a,this}setSignUrl(a){return this.signUrl=a,this}setLongUrlSignature(a){return this.longUrlSignature=a,this}setShorten(a){return this.shorten=a,this}setUseRootPath(a){return this.useRootPath=a,this}setSecure(a){return this.secure=a,this}setForceVersion(a){return this.forceVersion=a,this}},rz=kl;function fG(c,e,d){let a=e>>0,b=String(typeof d!="undefined"?d:" ");return c.length>a?String(c):(a=a-c.length,a>b.length&&(b+=rB(b,a/b.length)),b.slice(0,a)+String(c))}function rB(c,d){let a=d,b="";while(a>0)b+=c,a--;return b}rC="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ko={},kp=0,rC.split("").forEach(b=>{let a=kp.toString(2);a=fG(a,6,"0"),ko[a]=b,kp++});function rF(a){if(a.split(".").length<2)throw new Error("invalid semVer, must have at least two segments");return a.split(".").reverse().map(a=>{const b=+a;if(isNaN(b)||b<0)throw"Invalid version number provided";return fG(a,2,"0")}).join(".")}function kr(c){let b="";const d=c.split(".").length,e=d*6,f=rF(c),g=parseInt(f.split(".").join(""));let a=g.toString(2);if(a=fG(a,e,"0"),a.length%6!==0)throw"Version must be smaller than 43.21.26)";return a.match(/.{1,6}/g).forEach(a=>{b+=ko[a]}),b}function rH(a){const b={sdkSemver:a.sdkSemver,techVersion:a.techVersion,sdkCode:a.sdkCode,feature:"0"};return a.accessibility&&(b.feature="D"),a.lazyload&&(b.feature="C"),a.responsive&&(b.feature="A"),a.placeholder&&(b.feature="B"),b}rI="1.3.0";function rJ(){const a="0.0.0";if(typeof window!="undefined")return a;try{return process.versions.node||a}catch(b){return a}}function rK(a){const b={techVersion:rJ(),sdkCode:"T",sdkSemver:rI.split("-")[0],responsive:!1,placeholder:!1,lazyload:!1,accessibility:!1};return a?Object.assign(Object.assign({},b),a):b}function rL(b){const c=rK(b),a=rH(c);try{const b=rM(a.techVersion),c=kr(a.sdkSemver),d=kr(b),e=a.feature,f=a.sdkCode,g="A";return`${g}${f}${c}${d}${e}`}catch(a){return"E"}}function rM(b){const a=b.split(".");return`${a[0]}.${a[1]}`}ks={"image/upload":"images","image/private":"private_images","image/authenticated":"authenticated_images","raw/upload":"files","video/upload":"videos"},rO=class{constructor(a,b={},c){this.setPublicID(a),this.setCloudConfig(b),this.setURLConfig(c)}setURLConfig(a){return this.urlConfig=new rz(a),this}setCloudConfig(a){return this.cloudName=a.cloudName,this.apiKey=a.apiKey,this.apiSecret=a.apiSecret,this.authToken=a.authToken,this}setPublicID(a){return this.publicID=a?a.toString():"",this}setDeliveryType(a){return this.deliveryType=a,this}setSuffix(a){return this.suffix=a,this}setSignature(a){return this.signature=a,this}setVersion(a){return a&&(this.version=a),this}setAssetType(a){return a&&(this.assetType=a),this}sign(){return this}toURL(a={}){return this.createCloudinaryURL(null,a.trackedAnalytics)}validateAssetForURLCreation(){if(typeof this.cloudName=="undefined")throw"You must supply a cloudName when initializing the asset";const a=this.suffix&&this.suffix.indexOf(".")>=0,b=this.suffix&&this.suffix.indexOf("/")>=0;if(a||b)throw"`suffix`` should not include . or /"}getResourceType(){const b=rs(this.assetType),c=rt(this.deliveryType),e=!!this.suffix,a=`${b}/${c}`,d=ks[`${b}/${c}`],f=this.urlConfig.useRootPath,g=this.urlConfig.shorten;if(f){if(a==="image/upload")return"";throw new Error(`useRootPath can only be used with assetType: 'image' and deliveryType: 'upload'. Provided: ${a} instead`)}if(g&&a==="image/upload")return"iu";if(e){if(d)return d;throw new Error(`URL Suffix only supported for ${Object.keys(ks).join(", ")}, Provided: ${a} instead`)}return a}getSignature(){return this.signature?`s--${this.signature}--`:""}createCloudinaryURL(a,h){if(!this.publicID)return"";this.validateAssetForURLCreation();const e=rr(this.cloudName,this.urlConfig),f=a?a.toString():"",g=ru(this.publicID,this.version,this.urlConfig.forceVersion),c=this.publicID.replace(/,/g,"%2C"),d=[e,this.getResourceType(),this.getSignature(),f,g,c,this.suffix].filter(a=>a).join("/");if(typeof a=="string")return d;const b=encodeURI(d).replace(/\?/g,"%3F").replace(/=/g,"%3D");return this.urlConfig.analytics!==!1&&!c.includes("?")?`${b}?_a=${rL(h)}`:b}},rP=class extends cb{constructor(c,a,d){super(),this._actionModel={};let b;a instanceof qP?b=a.getValue():b=a,this._actionModel.actionType=nx[c],this._actionModel[d]=b,this.addQualifier(new E(c,a))}},rQ=class extends aa{constructor(a){super("progressive",a)}},kt=class extends rP{constructor(a,b){super(a,b,"formatType")}lossy(){return this._actionModel.lossy=!0,this.addFlag(pC()),this}progressive(a){return a instanceof rQ?(this._actionModel.progressive={mode:a.getFlagValue()},this.addFlag(a)):(this._actionModel.progressive={mode:a},this.addFlag(pE(a))),this}preserveTransparency(){return this._actionModel.preserveTransparency=!0,this.addFlag(pD()),this}static fromJson(d){const{formatType:c,lossy:e,progressive:b,preserveTransparency:f}=d;let a;return c?a=new this("f",c):a=new this("f"),b&&(b.mode?a.progressive(b.mode):a.progressive()),e&&a.lossy(),f&&a.preserveTransparency(),a}},kv=class extends rO{constructor(a,b,c,d){super(a,b,c),this.transformation=d}animated(a){return this.transformation.animated(a),this}border(a){return this.transformation.border(a),this}reshape(a){return this.transformation.reshape(a),this}resize(a){return this.transformation.resize(a),this}quality(a){return this.addAction(new kt("q",a)),this}format(a){return this.addAction(new kt("f",a)),this}roundCorners(a){return this.transformation.roundCorners(a),this}overlay(a){return this.transformation.overlay(a),this}addVariable(a){return this.transformation.addVariable(a),this}conditional(a){return this.transformation.conditional(a),this}effect(a){return this.transformation.effect(a),this}adjust(a){return this.transformation.adjust(a),this}rotate(a){return this.transformation.rotate(a),this}namedTransformation(a){return this.transformation.namedTransformation(a),this}delivery(a){return this.transformation.delivery(a),this}backgroundColor(a){return this.transformation.backgroundColor(a),this}psdTools(a){return this.transformation.psdTools(a),this}extract(a){return this.transformation.extract(a),this}addFlag(a){return this.transformation.addFlag(a),this}customFunction(a){return this.transformation.customFunction(a),this}addAction(a){return this.transformation.addAction(a),this}addTransformation(a){return this.transformation.addTransformation(a),this}toString(){return this.transformation.toString()}underlay(a){return this.transformation.underlay(a),this}toURL(a={}){return this.createCloudinaryURL(this.transformation,a===null||a===void 0?void 0:a.trackedAnalytics)}},rT=class extends kv{constructor(a,b,c){super(a,b,c,new rm)}},rU=class extends kv{constructor(a,b,c){super(a,b,c,new rn),this.assetType="video"}transcode(a){return this.transformation.transcode(a),this}videoEdit(a){return this.transformation.videoEdit(a),this}},rV=class{constructor(a){a&&(this.cloudinaryConfig=a)}image(a){return new rT(a,this.cloudinaryConfig.cloud,this.cloudinaryConfig.url)}video(a){return new rU(a,this.cloudinaryConfig.cloud,this.cloudinaryConfig.url)}setConfig(a){return this.cloudinaryConfig=a,this}getConfig(){return this.cloudinaryConfig}extendConfig(){}},kw=new rV({cloud:{cloudName:"timbomckay"},url:{secure:!0}}),kz=Math.round(window.devicePixelRatio*60),bq=class extends aB{connectedCallback(){super.connectedCallback(),this.setAttribute("tabindex","0"),this.addEventListener("dragstart",()=>{this.classList.add("dragging")}),this.addEventListener("dragend",()=>{this.classList.remove("dragging")}),this.addEventListener("dragenter",()=>{this.classList.add("hovering")}),this.addEventListener("dragleave",()=>{this.classList.remove("hovering")}),this.addEventListener("drop",()=>{this.classList.remove("hovering")})}render(){if(this.uid==null)return p;const{details:a}=this;if(this.title=a.name,a.rarity&&(this.rarity=a.rarity),a.image){const c=Object.keys(a.sources).shift(),d=a.name.replace(/\s/g,"_").replace(/,/g,"").replace(/\(/g,"").replace(/\)/g,"").replace(/'/g,""),b=kw.image(`items/${c}/${d}`);return b.format("auto").resize(rh().width(kz).height(kz)),o`<img src="${b.toURL()}" alt="${a.name}" crossorigin="anonymous" />`}return a.extends&&eb(this,"click"),o`${a.name}`}},bq.styles=bC`
    * { box-sizing: border-box; }
  
    :host {
      aspect-ratio: 1/1;
      border-color: #78350f;
      border-style: solid;
      border-width: 1px;
      font-size: 0.75rem;
      line-height: 1;
      overflow: hidden;
      padding: 0.25rem;
      position: relative;
    }
    :host(.hovering) {
      background-color: red;
    }
    :host(.dragging) {
      background-color: yellow;
      transform: scale(1.15);
    }

    img {
      height: auto;
      width: auto;
      max-width: 100%;
      transform: scale(1.75);
      pointer-events: none;
    }

    :host([rarity])::before {      
      background-color: var(--rarity, transparent);
      content: "";
      display: block;
      height: 1rem;
      position: absolute;
      right: 0px;
      top: 0px;
      transform-origin: top;
      transform: rotate(45deg) translate(50%, -100%);
      width: 1rem;
      z-index: 1;
    }

    :host([rarity="common"]) { --rarity: #94A3B8; }
    :host([rarity="uncommon"]) { --rarity: #84CC16; }
    :host([rarity="rare"]) { --rarity: #3B82F6; }
    :host([rarity="very rare"]) { --rarity: #7C3AED; }
    :host([rarity="legendary"]) { --rarity: #FCD34D; }
    :host([rarity="artifact"]) { --rarity: #DC2626; }
  `,L([ax()],bq.prototype,"uid",2),L([ax({type:String,reflect:!0})],bq.prototype,"rarity",2),L([ax({type:Object,attribute:!1,hasChanged(a,b){return JSON.stringify(a)!==JSON.stringify(b)}})],bq.prototype,"details",2),bq=L([dB("wc-item")],bq),rZ={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},r_=a=>(...b)=>({_$litDirective$:a,values:b}),r$=class{constructor(a){}get _$AU(){return this._$AM._$AU}_$AT(a,b,c){this._$Ct=a,this._$AM=b,this._$Ci=c}_$AS(a,b){return this.update(a,b)}update(b,a){return this.render(...a)}},fJ=class extends r${constructor(a){if(super(a),this.it=p,a.type!==rZ.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(a){if(a===p||a==null)return this.vt=void 0,this.it=a;if(a===aF)return a;if(typeof a!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(a===this.it)return this.vt;this.it=a;const b=[a];return b.raw=b,this.vt={_$litType$:this.constructor.resultType,strings:b,values:[]}}},fJ.directiveName="unsafeHTML",fJ.resultType=1,kB=r_(fJ),sc=class extends cb{constructor(a,b){super(),this.exp=a,this.ifTx=b}otherwise(a){return this.elseTx=a,this}toString(){return[`if_${qR(this.exp)}`,`${this.ifTx}`,this.elseTx&&`if_else/${this.elseTx}`,`if_end`].filter(a=>a).join("/")}};function sd(a,b){return new sc(a,b)}dL=se(sa()),ox={AI:"Acquisitions Incorporated",AL:"Adventurers' League",AWM:"Adventure with Muk",AZfyT:"A Zib for your Thoughts",AitFR:"Adventures in the Forgotten Realms",BGDIA:"Baldur's Gate: Descent Into Avernus",CM:"Candlekeep Mysteries",CoS:"Curse of Strahd",DC:"Divine Contention",DIP:"Dragon of Icespire Peak",DMG:"Dungeon Master's Guide",DoD:"Domains of Delight",EEPC:"Elemental Evil Player's Companion",EET:"Elemental Evil: Trinkets",EFR:"Eberron: Forgotten Relics",EGW:"Explorer's Guide to Wildemount",ERLW:"Eberron: Rising from the Last War",ESK:"Essentials Kit",FTD:"Fizban's Treasury of Dragons",GGR:"Guildmasters' Guide to Ravnica",GoS:"Ghosts of Saltmarsh",HEROES_FEAST:"Heroes' Feast",HftT:"Hunt for the Thessalhydra",HoL:"The House of Lament",HotDQ:"Hoard of the Dragon Queen",IDRotF:"Icewind Dale: Rime of the Frostmaiden",IMR:"Infernal Machine Rebuild",KKW:"Krenko's Way",LLK:"Lost Laboratory of Kwalish",LMoP:"Lost Mine of Phandelver",LR:"Locathah Rising",MFF:"Mordenkainen's Fiendish Folio",MM:"Monster Manual",MOT:"Mythic Odysseys of Theros",MTF:"Mordenkainen's Tome of Foes",MaBJoV:"Minsc and Boo's Journal of Villainy",NRH:"NERDS Restoring Harmony",OGA:"One Grung Above",OoW:"The Orrery of the Wanderer",OotA:"Out of the Abyss",PHB:"Player's Handbook",PotA:"Princes of the Apocalypse",RMBRE:"The Lost Dungeon of Rickedness: Big Rick Energy",RMR:"Dungeons & Dragons vs. Rick and Morty: Basic Rules",RoT:"The Rise of Tiamat",RoTOS:"The Rise of Tiamat Online Supplement",RtG:"Return to Glory",SAC:"Sage Advice Compendium",SADS:"Sapphire Anniversary Dice Set",SCAG:"Sword Coast Adventurer's Guide",SCC:"Strixhaven: A Curriculum of Chaos",SCC_ARiR:"A Reckoning in Ruins",SCC_CK:"Campus Kerfuffle",SCC_HfMT:"Hunt for Mage Tower",SCC_TMM:"The Magister's Masquerade",SCREEN:"Dungeon Master's Screen",SCREEN_WILDERNESS_KIT:"Dungeon Master's Screen: Wilderness Kit",SDW:"Sleeping Dragon's Wake",SKT:"Storm King's Thunder",SLW:"Storm Lord's Wrath",TCE:"Tasha's Cauldron of Everything",TLK:"The Lost Kenku",TTP:"The Tortle Package",TftYP:"Tales from the Yawning Portal",ToA:"Tomb of Annihilation",ToD:"Tyranny of Dragons",VGM:"Volo's Guide to Monsters",VRGR:"Van Richten's Guide to Ravenloft",WBtW:"The Wild Beyond the Witchlight",WDH:"Waterdeep: Dragon Heist",WDMM:"Waterdeep: Dungeon of the Mad Mage",XGE:"Xanathar's Guide to Everything",XMtS:"X Marks the Spot"},dM=Math.round(window.devicePixelRatio*480),ct=class extends aB{constructor(){super(...arguments),this.uid=null}imageTemplate(){const{details:a}=this;if(!a.image)return p;const c=Object.keys(a.sources).shift(),d=a.name.replace(/\s/g,"_").replace(/,/g,"").replace(/\(/g,"").replace(/\)/g,"").replace(/'/g,""),b=kw.image(`items/${c}/${d}`);return b.format("auto").conditional(sd("aspect_ratio > 1.2",(new cl).resize(rf().width(dM).height(dM*.5625))).otherwise((new cl).resize(rg().width(dM).height(dM*.5)))),o`<div class="image-container">
      <img src="${b.toURL()}" alt="${a.name}" width="2" height="1" crossorigin="anonymous" />
    </div>`}attunementTemplate(a){if(!a)return p;const b=o`<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 20 20" height="20" viewBox="0 0 20 20" width="20"><g><rect fill="none" height="20" width="20"/></g><g><path d="M18,10l-1.77-2.03l0.25-2.69l-2.63-0.6l-1.37-2.32L10,3.43L7.53,2.36L6.15,4.68L3.53,5.28l0.25,2.69L2,10l1.77,2.03 l-0.25,2.69l2.63,0.6l1.37,2.32L10,16.56l2.47,1.07l1.37-2.32l2.63-0.6l-0.25-2.69L18,10z M8.59,13.07l-2.12-2.12l0.71-0.71 l1.41,1.41l4.24-4.24l0.71,0.71L8.59,13.07z"/></g></svg>`,c=o`<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M23 12l-2.44-2.78.34-3.68-3.61-.82-1.89-3.18L12 3 8.6 1.54 6.71 4.72l-3.61.81.34 3.68L1 12l2.44 2.78-.34 3.69 3.61.82 1.89 3.18L12 21l3.4 1.46 1.89-3.18 3.61-.82-.34-3.68L23 12zm-10 5h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>`;return o`<span class="attunement icon" data-tooltip="requires attunement${a.length?` ${a}`:""}">
      ${b}
    </span>`}damageTemplate(a){if(!a)return p;const{roll:b,type:c,versatile:d}=a;return o`
      <span class="icon">
        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0zm21.02 19c0 1.1-.9 2-2 2h-14c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v14z" fill="none"/><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM7.5 18c-.83 0-1.5-.67-1.5-1.5S6.67 15 7.5 15s1.5.67 1.5 1.5S8.33 18 7.5 18zm0-9C6.67 9 6 8.33 6 7.5S6.67 6 7.5 6 9 6.67 9 7.5 8.33 9 7.5 9zm4.5 4.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4.5 4.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm0-9c-.83 0-1.5-.67-1.5-1.5S15.67 6 16.5 6s1.5.67 1.5 1.5S17.33 9 16.5 9z"/></svg>
      </span>
      ${[b,d].filter(a=>!!a).join("/")} ${c}
      <span style="margin-right: auto;"></span>`}chargeTemplate(a){if(!a)return p;const b=()=>o`<span class="icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M11 21h-1l1-7H7.5c-.58 0-.57-.32-.38-.66.19-.34.05-.08.07-.12C8.48 10.94 10.42 7.54 13 3h1l-1 7h3.5c.49 0 .56.33.47.51l-.07.15C12.96 17.55 11 21 11 21z"/></svg>
    </span>`;return a>8?o`<span class="charges">
        ${b()}<span>*${a}</span>
      </span>`:o`<span class="charges">${Array.from(Array(a)).map(()=>b())}</span>`}rarityTemplate(a){return!a||a==="varies"?p:o`<span data-rarity="${a}"></span>`}closeButtonTemplate(){const a=o`<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>`;return o`<button style="line-height: 0;" type="button" @click="${()=>{eb(this,"close")}}">${a}</button>`}menuButtonTemplate(){const a=o`<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>`;return o`<details>
      <summary style="line-height: 0;">${a}</summary>
      <div>
        <i>Menu in Progress</i>
      </div>
    </details>`}processEntries(a){return o`${a==null?p:a.map(a=>this.processEntry(a))}`}processEntry(a,b){if(typeof a=="string")switch(b){case"li":return o`<li>${kB(a)}</li>`;default:return o`<p>${kB(a)}</p>`}if(Array.isArray(a))return o`Array: <pre>${JSON.stringify(a,null,2)}</pre>`;switch(a.type){case"list":return o`<ul class=${a.style}>${a.items.map(a=>o`${this.processEntry(a,"li")}`)}</ul>`;default:return o`<pre>${JSON.stringify(a,null,2)}</pre>`}}render(){if(!this.uid)return p;const{attunement:f,charges:k,damage:j,entries:i,image:m,name:g,properties:a,range:n,rarity:d,sources:c,srd:l,tier:b,type:h,...e}=this.details;return o`
      ${this.imageTemplate()}
      <div class="title">
        ${g}
        <div>
          ${this.attunementTemplate(f)}
        </div>
        ${this.rarityTemplate(d)}
      </div>
      <div class="content">
        <div class="content-inner">
          <div class="info">
            <i>${h} ${b?`(${b})`:""} ${d}</i>
            <div style="display: flex; align-items: center; gap: 0.5rem; flex-shrink: 0;">
              ${this.chargeTemplate(k)}
              ${a?o`<div>${a.map((a,b)=>o`<span class="property" style="z-index: -${b};">${a}</span>`)}</div>`:""}
            </div>
          </div>
          ${Object.keys(e).length?o`<pre>${JSON.stringify(e,null,2)}</pre>`:""}
          ${this.processEntries(i)}
          <div>
            <i class="sources">
              ${c?Object.keys(c).map(a=>ox[a]).join(" \u2022\xA0"):""}
            </i>
          </div>
        </div>
      </div>
      <div class="footer">
        ${this.damageTemplate(j)}
        ${this.menuButtonTemplate()}
        ${this.closeButtonTemplate()}
      </div>
    `}},ct.styles=bC`
    * { box-sizing: border-box; }

    :host {
      border-color: ${cu(dL.primary[800])};
      border-style: solid;
      border-width: 0 0 1px 0;
      display: block;
    }

    :host([uid=""]) {
      display: none;
    }

    .image-container {
      padding: 0;
      position: relative;
    }

    img {
      display: block;
      height: auto;
      line-height: 0;
      margin-left: auto;
      margin-right: auto;
      max-width: 100%;
      mix-blend-mode: multiply;
      width: 100%;
    }
    
    .content {
      padding: 0 0.5rem;
    }

    .content-inner {
      border-color: ${cu(dL.yellow[600])};
      border-style: solid;
      border-width: 1px 0;
      font-size: 0.85em;
      padding: 0.5rem 0;
      line-height: 1.25;
      max-height: 50vh;
      overflow: auto;
    }

    .title, .info {
      align-items: center;
      display: flex;
      gap: 1rem;
      justify-content: space-between;
    }

    .title {
      color: ${cu(dL.primary[600])};
      font-size: 1.125rem;
      line-height: 1;
      font-weight: 600;
      padding: 0.5rem;
      position: relative;
    }

    .title .attunement {
      flex-shrink: 0;
      color: ${cu(dL.primary[900])};
      color: black;
      opacity: 0.325;
    }

    .icon {
      display: inline-block;
      line-height: 0;
    }
    
    .icon > svg {
      display: block;
      fill: currentColor;
      height: 1em;
      max-height: 100%;
      max-width: 100%;
      width: 1em;
    }

    b { line-height: 1; }

    ul { padding-left: 1.25rem; }

    li, p {
      margin-top: 0.5em;
    }

    ul.none {
      padding-left: 0;
      list-style-none;
    }

    .charges {
      line-height: 1;
      display: inline-flex;
    }

    .charges > .icon {
      margin-left: -0.5em;
    }

    .sources {
      font-size: 0.9em;
      margin-top: 1rem;
      display: block;
    }

    .property {
      background-color: black;
      border-radius: 9999px;
      border: 1px solid white;
      color: white;
      display: inline-grid;
      font-family: sans-serif;
      font-size: 12px;
      font-weight: bold;
      height: 1rem;
      line-height: 1;
      margin-left: -0.325rem;
      padding: 0 0.325rem;
      place-content: center;
      position: relative;
      text-align: center;
    }

    .footer {
      display: flex;
      align-items: center;
      padding: 0.5rem;
      gap: 0.25rem;
      justify-content: flex-end;
      font-size: 0.85em;
    }

    button {
      border: 0;
      background-color: transparent;
      background-image: none;
      cursor: pointer;
      color: inherit;
      line-height: inherit;
      padding: 0;
    }

    details {
      position: relative;
    }

    summary {
      cursor: pointer;
      list-style: none;
    }

    ::-webkit-details-marker {
      display: none;
    }

    details > div {
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 2px;
      bottom: 100%;
      filter: drop-shadow(1px 2px 2px rgba(0, 0, 0, 0.125));
      padding: 0.5rem;
      position: absolute;
      right: -0.25rem;
      width: 14ch;
    }

    span[data-rarity] {
      background-color: var(--rarity, transparent);
      box-shadow: 0 0 0 2px white;
      content: "";
      display: block;
      font-size: 0.45rem;
      height: 1em;
      left: 50%;
      position: absolute;
      top: 100%;
      transform: translate(-50%, -50%) rotate(-45deg);
      width: 1em;
      z-index: 1;
    }

    span[data-rarity="common"] { --rarity: #94A3B8; }
    span[data-rarity="uncommon"] { --rarity: #84CC16; }
    span[data-rarity="rare"] { --rarity: #3B82F6; }
    span[data-rarity="very rare"] { --rarity: #7C3AED; }
    span[data-rarity="legendary"] { --rarity: #FCD34D; }
    span[data-rarity="artifact"] { --rarity: #DC2626; }

    pre {
      background-color: whitesmoke;
      border: 1px solid #ccc;
      padding: 0.5rem;
      border-radius: 0.5rem;
      overflow: auto;
      font-size: 0.75rem;
    }
  `,L([ax()],ct.prototype,"uid",2),L([ax({type:Object,attribute:!1,hasChanged(a,b){return JSON.stringify(a)!==JSON.stringify(b)}})],ct.prototype,"details",2),ct=L([dB("wc-item-details")],ct),aG=class extends aB{constructor(){super(...arguments),this.list=[],this.uid="--uid--",this.isDropTarget=!1,this.active=""}connectedCallback(){super.connectedCallback(),this.addEventListener("dragenter",a=>a.preventDefault()),this.addEventListener("dragover",a=>{a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"})}render(){return o`
      <div class="title">${this.uid}</div>
      <wc-item-details
        uid="${this.active}"
        .details="${dn[this.active]}"
        @close="${()=>{this.active=""}}"
      ></wc-item-details>
      <div class="container ${this.isDropTarget?"highlight":""}">
        ${this.list.map((a,b)=>o`<wc-item
          uid="${a}"
          .index="${b}"
          .details="${dn[a]}"
          draggable="true"
          @click="${()=>{this.active=a}}"
        ></wc-item>`)}
      </div>
    `}},aG.styles=[bC`
      * { box-sizing: border-box; }

      .title {
        background-color: rgb(254, 243, 199);
        font-size: 0.9rem;
        padding: 0 0.25rem;
        text-align: center;
        position: sticky;
        top: 4.5rem;
        z-index: 9;
      }
      .container {
        padding: 0.5rem;
        display: grid;
        gap: 0.25rem;
        grid-template-columns: repeat(auto-fill, minmax(2.5rem, 1fr));
      }
      .highlight {
        background-color: yellow;
      }
    `,bC`@media (min-width: 48rem) {
      .container {
        padding: 0.25rem;
      }

      .title {
        top: 2.5rem;
      }
    }`],L([ax({type:Array,attribute:!1,hasChanged(a,b){return JSON.stringify(a)!==JSON.stringify(b)}})],aG.prototype,"list",2),L([ax()],aG.prototype,"uid",2),L([dt()],aG.prototype,"isDropTarget",2),L([dt()],aG.prototype,"active",2),aG=L([dB("wc-item-list")],aG);function ak(){const a=Object.keys(dn);return a[Math.floor(Math.random()*a.length)]}function af(){return Array.from(Array(Math.floor(Math.random()*24+7)),()=>ak())}oU=()=>({"ch-uid-123":{name:"Tenebrae",inventory:{Attuned:[ak(),ak()],Inventory:af(),Backpack:af(),"Bag of Holding":af()}},"ch-uid-321":{name:"Cyan",inventory:{Attuned:[ak(),ak(),ak()],Inventory:af(),Backpack:af(),"Astral Scarf":af()}},"ch-uid-aaa":{name:"Chris...?",inventory:{Attuned:[ak()],Inventory:af(),Backpack:af()}},"ch-uid-abc":{name:"DOMO",inventory:{Attuned:[ak(),ak()],Inventory:af(),Backpack:af()}}}),ce=class extends aB{constructor(){super(...arguments),this.data=null,this.dragging={}}handleDrag(a,b,c){const{index:d,uid:e}=c.composedPath().shift();this.dragging={ch:a,list:b,index:d,uid:e}}handleDrop(c,d,e){e.preventDefault();const a=JSON.parse(JSON.stringify(this.data)),{ch:f,list:g,index:h,uid:i}=this.dragging;let{index:b}=e.composedPath().shift();b==null&&(b=a[c].inventory[d].length),a[f].inventory[g].splice(h,1),a[c].inventory[d].splice(b,0,i),this.data=a,this.dragging={}}setData(){this.data=oU()}connectedCallback(){super.connectedCallback(),window.addEventListener("ITEMS",()=>this.setData())}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("ITEMS",()=>this.setData())}render(){return this.data==null?p:o`${Object.entries(this.data).map(([a,b])=>o`<div class="character">
        <div class="name">${b.name}</div>
        ${Object.entries(b.inventory).map(([b,c])=>o`<wc-item-list
            .list="${c}"
            @drop="${c=>this.handleDrop(a,b,c)}"
            @dragstart="${c=>this.handleDrag(a,b,c)}"
            uid="${b}"
          ></wc-item-list>`)}
      </div>`)}`}},ce.styles=[bC`
      * { box-sizing: border-box; }

      :host {
        min-height: calc(100vh - 5rem);
      }
      .character {
        border-width: 0 0 1px 0;
        border-color: #78350f;
        border-style: solid;
        list-style: none;
      }
      .name {
        text-align: center;
        padding: 0.5rem;
        position: sticky;
        top: 2rem;
        z-index: 10;
        background-color: white;
        height: 2.5rem;
      }
    `,bC`@media (min-width: 48rem) {
      :host {
        display: flex;
        flex-direction: row;
        gap: 1rem;
        height: calc(100vh - 4rem);
      }
      .character {
        border-width: 1px;
        flex: 1 0 32ch;
        overflow: auto;
      }
      .name {
        top: 0;
      }
    }`],L([dt()],ce.prototype,"data",2),L([dt()],ce.prototype,"dragging",2),ce=L([dB("wc-inventory")],ce)})()